<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03 Setting Up Your Testing Environment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">01 Getting Started</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-3-setting-up-your-testing-environment">Chapter 3: Setting Up Your Testing Environment</h1>
<h2 id="project-structure-best-practices">Project Structure Best Practices</h2>
<h2 id="the-foundation-of-a-maintainable-project">The Foundation of a Maintainable Project</h2>
<p>Before writing a single test, the most crucial decision you'll make is how to structure your project. A well-organized project is easy to navigate, test, and package. A disorganized one creates friction at every step, leading to confusing imports, difficulty in separating test code from application code, and deployment headaches.</p>
<p>This chapter is about building a solid foundation. We will start with a common but problematic structure and iteratively refine it, demonstrating <em>why</em> each improvement is necessary by showing the exact failure it prevents.</p>
<h3 id="phase-1-establish-the-reference-implementation">Phase 1: Establish the Reference Implementation</h3>
<p>Let's begin with a simple but realistic example that will be our anchor for this chapter. We'll build a <code>Wallet</code> application.</p>
<p>Here is the application code:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># wallet.py</span>

<span class="k">class</span><span class="w"> </span><span class="nc">InsufficientAmount</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom exception for when a wallet doesn&#39;t have enough funds.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Wallet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple wallet to hold and manage a balance.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_amount</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">initial_amount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Initial amount cannot be negative.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">initial_amount</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">spend_cash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">&lt;</span> <span class="n">amount</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InsufficientAmount</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You don&#39;t have </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> to spend.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_cash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
</code></pre></div>

<p>And here is a basic test for it:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_wallet.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">wallet</span><span class="w"> </span><span class="kn">import</span> <span class="n">Wallet</span><span class="p">,</span> <span class="n">InsufficientAmount</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_default_initial_amount</span><span class="p">():</span>
    <span class="n">wallet</span> <span class="o">=</span> <span class="n">Wallet</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">wallet</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_setting_initial_amount</span><span class="p">():</span>
    <span class="n">wallet</span> <span class="o">=</span> <span class="n">Wallet</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">wallet</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="mi">100</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_wallet_add_cash</span><span class="p">():</span>
    <span class="n">wallet</span> <span class="o">=</span> <span class="n">Wallet</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">wallet</span><span class="o">.</span><span class="n">add_cash</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">wallet</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="mi">100</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_wallet_spend_cash</span><span class="p">():</span>
    <span class="n">wallet</span> <span class="o">=</span> <span class="n">Wallet</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">wallet</span><span class="o">.</span><span class="n">spend_cash</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">wallet</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="mi">10</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_wallet_spend_cash_raises_exception_on_insufficient_amount</span><span class="p">():</span>
    <span class="n">wallet</span> <span class="o">=</span> <span class="n">Wallet</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">InsufficientAmount</span><span class="p">):</span>
        <span class="n">wallet</span><span class="o">.</span><span class="n">spend_cash</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>

<h3 id="the-flat-layout-problem">The "Flat Layout" Problem</h3>
<p>The simplest way to organize these files is to put them all in the root directory. This is often called a "flat layout."</p>
<div class="codehilite"><pre><span></span><code>wallet-project/
‚îú‚îÄ‚îÄ<span class="w"> </span>wallet.py
‚îî‚îÄ‚îÄ<span class="w"> </span>test_wallet.py
</code></pre></div>

<p>Let's run pytest from the <code>wallet-project/</code> directory.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="nv">pytest</span>
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.11.5,<span class="w"> </span>pytest-8.1.1,<span class="w"> </span>pluggy-1.4.0
rootdir:<span class="w"> </span>/path/to/wallet-project
collected<span class="w"> </span><span class="m">5</span><span class="w"> </span>items

test_wallet.py<span class="w"> </span>.....<span class="w">                                             </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01s<span class="w"> </span><span class="o">===========================</span>
</code></pre></div>

<p>It works! So, what's the problem? This structure seems simple and effective.</p>
<p>The "flat layout" is a trap. It works for tiny projects but breaks down quickly, creating subtle and frustrating problems as your project grows:</p>
<ol>
<li><strong>Ambiguous Imports:</strong> Is <code>import wallet</code> referring to <code>wallet.py</code> in the current directory or an installed package named <code>wallet</code>? This ambiguity can cause your tests to pass locally but fail in production or CI/CD environments where the code is installed as a package.</li>
<li><strong>Source vs. Test Confusion:</strong> As the project grows, your root directory becomes a cluttered mix of application code, test files, configuration files, and documentation. It's hard to tell what's part of the deliverable application and what's for testing.</li>
<li><strong>Packaging Nightmares:</strong> When you try to package your application for distribution (e.g., to PyPI), it's difficult to configure the packaging tools to include <em>only</em> your application code (<code>wallet.py</code>) and exclude your tests (<code>test_wallet.py</code>).</li>
</ol>
<p>To build a professional, scalable testing setup, we must first fix our project structure.</p>
<h2 id="creating-a-tests-directory">Creating a tests/ Directory</h2>
<h2 id="iteration-1-separating-tests-from-source-code">Iteration 1: Separating Tests from Source Code</h2>
<p>Our first step is to create a clear separation between the code that runs the application and the code that tests it. The standard convention is to place all test files in a dedicated <code>tests/</code> directory.</p>
<h3 id="current-state-recap">Current State Recap</h3>
<p>Our project is a flat directory. Tests and source code are mixed together.</p>
<div class="codehilite"><pre><span></span><code>wallet-project/
‚îú‚îÄ‚îÄ<span class="w"> </span>wallet.py
‚îî‚îÄ‚îÄ<span class="w"> </span>test_wallet.py
</code></pre></div>

<h3 id="current-limitation">Current Limitation</h3>
<p>This structure is messy and makes packaging difficult. We need to isolate the test code.</p>
<h3 id="new-scenario-moving-the-test-file">New Scenario: Moving the Test File</h3>
<p>Let's create a <code>tests/</code> directory and move our test file into it.</p>
<div class="codehilite"><pre><span></span><code>wallet-project/
‚îú‚îÄ‚îÄ<span class="w"> </span>wallet.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_wallet.py
</code></pre></div>

<p>Now, let's try to run pytest again from the root <code>wallet-project/</code> directory.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest
</code></pre></div>

<h3 id="failure-demonstration">Failure Demonstration</h3>
<p>This simple change breaks our tests completely.</p>
<div class="codehilite"><pre><span></span><code><span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.11.5,<span class="w"> </span>pytest-8.1.1,<span class="w"> </span>pluggy-1.4.0
rootdir:<span class="w"> </span>/path/to/wallet-project
collected<span class="w"> </span><span class="m">0</span><span class="w"> </span>items<span class="w"> </span>/<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nv">error</span>

<span class="o">================================</span><span class="w"> </span><span class="nv">ERRORS</span><span class="w"> </span><span class="o">================================</span>
___________________<span class="w"> </span>ERROR<span class="w"> </span>collecting<span class="w"> </span>tests/test_wallet.py<span class="w"> </span>____________________
ImportError<span class="w"> </span><span class="k">while</span><span class="w"> </span>importing<span class="w"> </span><span class="nb">test</span><span class="w"> </span>module<span class="w"> </span><span class="s1">&#39;/path/to/wallet-project/tests/test_wallet.py&#39;</span>.
Hint:<span class="w"> </span>make<span class="w"> </span>sure<span class="w"> </span>your<span class="w"> </span><span class="nb">test</span><span class="w"> </span>modules/packages<span class="w"> </span>have<span class="w"> </span>valid<span class="w"> </span>Python<span class="w"> </span>names.
Traceback:
/usr/lib/python3.11/importlib/__init__.py:126:<span class="w"> </span><span class="k">in</span><span class="w"> </span>import_module
<span class="w">    </span><span class="k">return</span><span class="w"> </span>_bootstrap._gcd_import<span class="o">(</span>name<span class="o">[</span>level:<span class="o">]</span>,<span class="w"> </span>package,<span class="w"> </span>level<span class="o">)</span>
tests/test_wallet.py:3:<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>from<span class="w"> </span>wallet<span class="w"> </span>import<span class="w"> </span>Wallet,<span class="w"> </span>InsufficientAmount
E<span class="w">   </span>ModuleNotFoundError:<span class="w"> </span>No<span class="w"> </span>module<span class="w"> </span>named<span class="w"> </span><span class="s1">&#39;wallet&#39;</span>
<span class="o">=======================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">========================</span>
ERROR<span class="w"> </span>tests/test_wallet.py
!!!!!!!!!!!!!!!!<span class="w"> </span>Interrupted:<span class="w"> </span><span class="m">1</span><span class="w"> </span>error<span class="w"> </span>during<span class="w"> </span>collection<span class="w"> </span>!!!!!!!!!!!!!!!!
<span class="o">==========================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>error<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.08s<span class="w"> </span><span class="o">============================</span>
</code></pre></div>

<h3 id="diagnostic-analysis-reading-the-failure">Diagnostic Analysis: Reading the Failure</h3>
<p><strong>The complete output</strong>: The summary shows <code>1 error during collection</code>. This is a critical clue. The problem isn't a failing assertion; pytest couldn't even <em>load</em> the test file to find the tests.</p>
<p><strong>Let's parse this section by section</strong>:</p>
<ol>
<li>
<p><strong>The summary line</strong>: <code>ERROR collecting tests/test_wallet.py</code></p>
<ul>
<li><strong>What this tells us</strong>: The failure happened before any tests were run. Pytest was trying to discover tests inside <code>tests/test_wallet.py</code> and encountered a fatal error.</li>
</ul>
</li>
<li>
<p><strong>The traceback</strong>:
    <code>tests/test_wallet.py:3: in &lt;module&gt;
        from wallet import Wallet, InsufficientAmount
    E   ModuleNotFoundError: No module named 'wallet'</code></p>
<ul>
<li><strong>What this tells us</strong>: The traceback points directly to the problem.</li>
<li><strong>Key line</strong>: <code>from wallet import Wallet, InsufficientAmount</code> followed by <code>ModuleNotFoundError: No module named 'wallet'</code>.</li>
</ul>
</li>
</ol>
<p><strong>Root cause identified</strong>: Python can no longer find the <code>wallet</code> module.
<strong>Why the current approach can't solve this</strong>: When we run <code>pytest</code>, it adds the root directory (<code>wallet-project/</code>) to Python's import path (<code>sys.path</code>). The test runner looks inside <code>tests/test_wallet.py</code> and tries to execute <code>from wallet import ...</code>. Python looks for <code>wallet.py</code> in the current directory (<code>tests/</code>) and in the directories on <code>sys.path</code>. It can't find <code>wallet.py</code> inside <code>tests/</code>, and while <code>wallet-project/</code> is on the path, the <code>wallet.py</code> file is in the parent directory relative to the test file's new location. This creates an import problem.</p>
<p><strong>What we need</strong>: We need a project structure that makes our application code a proper, installable package, so that imports are reliable and unambiguous, regardless of where the tests are located.</p>
<h3 id="the-src-layout-the-professional-standard">The <code>src</code> Layout: The Professional Standard</h3>
<p>The most robust solution is the "source" or <code>src</code> layout. This involves placing your main application code inside a <code>src</code> directory. This forces you to install your project to test it, which mimics how it will be used in the real world and eliminates a whole class of import problems.</p>
<p><strong>Technique Introduced</strong>: The <code>src</code> layout and editable installs.</p>
<p><strong>Solution Implementation</strong>:</p>
<ol>
<li>Create a <code>src</code> directory.</li>
<li>Inside <code>src</code>, create a directory for your package (e.g., <code>wallet</code>).</li>
<li>Move your application code (<code>wallet.py</code>) into this package directory.</li>
<li>Create a <code>pyproject.toml</code> file to make your project installable.</li>
</ol>
<p>Our new, much improved, project structure:</p>
<div class="codehilite"><pre><span></span><code>wallet-project/
‚îú‚îÄ‚îÄ<span class="w"> </span>pyproject.toml
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>wallet/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py<span class="w">   </span><span class="c1"># Can be empty</span>
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>wallet.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_wallet.py
</code></pre></div>

<p>The <code>pyproject.toml</code> file tells Python's build tools that this is an installable project. A minimal version looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># pyproject.toml</span>
<span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;wallet&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>

<span class="k">[tool.setuptools.packages.find]</span>
<span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>
</code></pre></div>

<p>Now, the crucial step: we must <strong>install our package in editable mode</strong>. This creates a link from our virtual environment's <code>site-packages</code> directory to our source code. Any changes we make in <code>src/wallet/wallet.py</code> will be immediately available to our tests without reinstalling.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># First, ensure you are in a virtual environment (more on this next!)</span>
<span class="c1"># Then, from the root directory (wallet-project/):</span>
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</code></pre></div>

<p>The <code>-e</code> stands for "editable". The <code>.</code> refers to the current directory, where <code>pyproject.toml</code> is located.</p>
<h3 id="verification">Verification</h3>
<p>With the project installed, let's run pytest again.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="nv">pytest</span>
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.11.5,<span class="w"> </span>pytest-8.1.1,<span class="w"> </span>pluggy-1.4.0
rootdir:<span class="w"> </span>/path/to/wallet-project
collected<span class="w"> </span><span class="m">5</span><span class="w"> </span>items

tests/test_wallet.py<span class="w"> </span>.....<span class="w">                                       </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01s<span class="w"> </span><span class="o">===========================</span>
</code></pre></div>

<p>Success! The <code>ModuleNotFoundError</code> is gone. Because our <code>wallet</code> package is now properly installed, Python can find it no matter where the test runner is invoked from. We have achieved a clean separation of concerns.</p>
<h3 id="when-to-apply-this-solution">When to Apply This Solution</h3>
<ul>
<li><strong>What it optimizes for</strong>: Reliability, maintainability, and preventing import errors. It ensures your test environment closely mirrors your production environment.</li>
<li><strong>What it sacrifices</strong>: A tiny amount of initial setup complexity. You can no longer just run a Python script from a flat directory.</li>
<li><strong>When to choose this approach</strong>: Always, for any project that you expect to last more than a day or be shared with others.</li>
<li><strong>When to avoid this approach</strong>: Only for single-file, disposable scripts.</li>
</ul>
<p><strong>Limitation preview</strong>: Our project structure is now robust, but our development environment is not. We are likely installing packages into our global Python installation, which can lead to dependency conflicts between projects. We need to isolate our project's dependencies.</p>
<h2 id="using-virtual-environments">Using Virtual Environments</h2>
<h2 id="iteration-2-isolating-dependencies">Iteration 2: Isolating Dependencies</h2>
<p>Our project structure is solid, but it lives on a shaky foundation: the system-wide Python environment. Every <code>pip install</code> command we run without a virtual environment modifies our global collection of packages.</p>
<h3 id="current-state-recap_1">Current State Recap</h3>
<p>We have a <code>src</code> layout and have installed our package in editable mode.</p>
<div class="codehilite"><pre><span></span><code>wallet-project/
‚îú‚îÄ‚îÄ<span class="w"> </span>pyproject.toml
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>wallet/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>wallet.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_wallet.py
</code></pre></div>

<h3 id="current-limitation_1">Current Limitation</h3>
<p>Our project's dependencies (like <code>pytest</code>) are installed globally. This creates two major problems:</p>
<ol>
<li><strong>Dependency Hell</strong>: Project A requires <code>pytest==7.0</code>, but Project B requires <code>pytest==8.0</code>. Installing one will break the other.</li>
<li><strong>Implicit Dependencies</strong>: If our code happens to use a package that's already installed globally (e.g., <code>requests</code>), we might forget to list it as a dependency for our project. The code works on our machine but will crash for anyone else who tries to run it on a clean system.</li>
</ol>
<h3 id="new-scenario-ensuring-a-reproducible-environment">New Scenario: Ensuring a Reproducible Environment</h3>
<p>We need to guarantee that our project has its own isolated set of dependencies that don't interfere with other projects and are explicitly defined.</p>
<p>The "failure" here isn't a test crash, but a workflow failure. Imagine giving your project to a colleague. They run <code>pip install pytest</code> and get the latest version, which happens to be incompatible with your tests. Your test suite, which worked perfectly on your machine, now fails for them. This is a failure of reproducibility.</p>
<p><strong>Technique Introduced</strong>: Python's built-in <code>venv</code> module for creating virtual environments.</p>
<p>A virtual environment is a self-contained directory tree that contains a Python installation for a particular version of Python, plus a number of additional packages.</p>
<h3 id="solution-implementation">Solution Implementation</h3>
<p>Let's create and activate a virtual environment for our project.</p>
<p><strong>Step 1: Create the virtual environment</strong></p>
<p>From the root of <code>wallet-project/</code>, run the following command. It's conventional to name the environment <code>venv</code> or <code>.venv</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># This creates a directory named &#39;venv&#39; containing a private Python installation.</span>
python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
</code></pre></div>

<p>You should also add <code>venv/</code> to your <code>.gitignore</code> file to prevent committing it to version control.</p>
<p><strong>Step 2: Activate the virtual environment</strong></p>
<p>Activation configures your current shell to use the Python interpreter and packages from within the <code>venv</code> directory.</p>
<ul>
<li>On macOS and Linux:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>venv/bin/activate
</code></pre></div>

<ul>
<li>On Windows (Command Prompt):</li>
</ul>
<div class="codehilite"><pre><span></span><code>venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate.bat
</code></pre></div>

<ul>
<li>On Windows (PowerShell):</li>
</ul>
<div class="codehilite"><pre><span></span><code>venv<span class="se">\S</span>cripts<span class="se">\A</span>ctivate.ps1
</code></pre></div>

<p>After activation, your shell prompt will typically change to show the name of the active environment, like <code>(venv) $</code>.</p>
<p><strong>Step 3: Install dependencies into the isolated environment</strong></p>
<p>Now that the environment is active, any <code>pip</code> command will operate <em>only</em> inside the <code>venv</code> directory. Let's install our project and its testing dependencies.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip<span class="w">  </span><span class="c1"># Good practice to use the latest pip</span>
<span class="o">(</span>venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pytest
<span class="o">(</span>venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.<span class="w">           </span><span class="c1"># Install our local &#39;wallet&#39; package</span>
</code></pre></div>

<p>If you run <code>pip list</code> now, you will see a very short list of packages‚Äîonly what you just installed and their dependencies. This is our clean, isolated environment.</p>
<h3 id="verification_1">Verification</h3>
<p>Let's run our tests from within the activated virtual environment.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span><span class="nv">pytest</span>
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.11.5,<span class="w"> </span>pytest-8.1.1,<span class="w"> </span>pluggy-1.4.0
rootdir:<span class="w"> </span>/path/to/wallet-project
collected<span class="w"> </span><span class="m">5</span><span class="w"> </span>items

tests/test_wallet.py<span class="w"> </span>.....<span class="w">                                       </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01s<span class="w"> </span><span class="o">===========================</span>
</code></pre></div>

<p>Everything still passes, but now we have a guarantee: our test run is completely self-contained and reproducible. Anyone else can create their own virtual environment, install the same dependencies, and get the exact same result.</p>
<p><strong>Limitation preview</strong>: Our setup is now isolated and structured well. However, running tests still relies on remembering specific command-line options. If one developer runs <code>pytest</code> and another runs <code>pytest -v --strict-markers</code>, they might see different results or warnings. We need a way to enforce consistent test execution for everyone on the team.</p>
<h2 id="pytest-configuration-files-pytestini-setupcfg-pyprojecttoml">Pytest Configuration Files (pytest.ini, setup.cfg, pyproject.toml)</h2>
<h2 id="iteration-3-centralizing-configuration">Iteration 3: Centralizing Configuration</h2>
<p>We have a professional project structure and an isolated environment. The final piece of the setup puzzle is creating a single source of truth for how our tests should be run. Relying on developers to remember command-line flags is a recipe for inconsistency.</p>
<h3 id="current-state-recap_2">Current State Recap</h3>
<p>We run <code>pytest</code> from within an activated virtual environment. The command is simple, but it uses pytest's default settings.</p>
<h3 id="current-limitation_2">Current Limitation</h3>
<p>To get more informative output or enforce stricter checks, we need to add flags. For example:</p>
<ul>
<li><code>pytest -v</code>: for verbose output, showing one line per test.</li>
<li><code>pytest --strict-markers</code>: to fail the test suite if an unregistered marker is used.</li>
</ul>
<p>Forgetting these flags can lead to developers missing important information or introducing errors (like marker typos) that go unnoticed.</p>
<h3 id="new-scenario-enforcing-consistent-test-runs">New Scenario: Enforcing Consistent Test Runs</h3>
<p>We want to ensure that every time anyone runs <code>pytest</code>, it automatically uses a standard set of options, like <code>-v</code>.</p>
<p><strong>Failure Demonstration</strong>: The "failure" is the subtle difference in output and behavior.</p>
<p>Run without flags:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span><span class="nv">pytest</span>
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
tests/test_wallet.py<span class="w"> </span>.....<span class="w">                                       </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>
<span class="o">==========================</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01s<span class="w"> </span><span class="o">===========================</span>
</code></pre></div>

<p>Now run with the verbose flag:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>pytest<span class="w"> </span>-v
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
tests/test_wallet.py::test_default_initial_amount<span class="w"> </span>PASSED<span class="w">         </span><span class="o">[</span><span class="w"> </span><span class="m">20</span>%<span class="o">]</span>
tests/test_wallet.py::test_setting_initial_amount<span class="w"> </span>PASSED<span class="w">         </span><span class="o">[</span><span class="w"> </span><span class="m">40</span>%<span class="o">]</span>
tests/test_wallet.py::test_wallet_add_cash<span class="w"> </span>PASSED<span class="w">                </span><span class="o">[</span><span class="w"> </span><span class="m">60</span>%<span class="o">]</span>
tests/test_wallet.py::test_wallet_spend_cash<span class="w"> </span>PASSED<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">80</span>%<span class="o">]</span>
tests/test_wallet.py::test_wallet_spend_cash_raises_exception_on_insufficient_amount<span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>
<span class="o">==========================</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01s<span class="w"> </span><span class="o">===========================</span>
</code></pre></div>

<p>The verbose output is much more informative. We want this to be the default, without having to type it every time.</p>
<p><strong>Technique Introduced</strong>: Pytest configuration files.</p>
<p>Pytest automatically discovers and reads configuration from one of several files in your project's root directory. The search order is: <code>pytest.ini</code>, <code>pyproject.toml</code>, <code>tox.ini</code>, <code>setup.cfg</code>.</p>
<p>The modern standard is <code>pyproject.toml</code>, as it is the unified configuration file for all Python tooling (build systems, linters, formatters, and test runners). We will use it.</p>
<h3 id="solution-implementation_1">Solution Implementation</h3>
<p>We will add a new section to our existing <code>pyproject.toml</code> file to hold our pytest configuration.</p>
<p><strong>Before</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># pyproject.toml</span>
<span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;wallet&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>

<span class="k">[tool.setuptools.packages.find]</span>
<span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>
</code></pre></div>

<p><strong>After</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># pyproject.toml</span>
<span class="k">[project]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;wallet&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span>

<span class="k">[tool.setuptools.packages.find]</span>
<span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>

<span class="k">[tool.pytest.ini_options]</span>
<span class="c1"># Add command-line options here</span>
<span class="n">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-v --strict-markers&quot;</span>
</code></pre></div>

<p>The <code>[tool.pytest.ini_options]</code> table is where all pytest settings go. The <code>addopts</code> key is a string of command-line arguments that pytest will automatically prepend to every run.</p>
<h3 id="verification_2">Verification</h3>
<p>Now, let's run the plain <code>pytest</code> command again, with no extra arguments.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span><span class="nv">pytest</span>
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
tests/test_wallet.py::test_default_initial_amount<span class="w"> </span>PASSED<span class="w">         </span><span class="o">[</span><span class="w"> </span><span class="m">20</span>%<span class="o">]</span>
tests/test_wallet.py::test_setting_initial_amount<span class="w"> </span>PASSED<span class="w">         </span><span class="o">[</span><span class="w"> </span><span class="m">40</span>%<span class="o">]</span>
tests/test_wallet.py::test_wallet_add_cash<span class="w"> </span>PASSED<span class="w">                </span><span class="o">[</span><span class="w"> </span><span class="m">60</span>%<span class="o">]</span>
tests/test_wallet.py::test_wallet_spend_cash<span class="w"> </span>PASSED<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">80</span>%<span class="o">]</span>
tests/test_wallet.py::test_wallet_spend_cash_raises_exception_on_insufficient_amount<span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>
<span class="o">==========================</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01s<span class="w"> </span><span class="o">===========================</span>
</code></pre></div>

<p>Perfect. The output is automatically verbose. We have successfully centralized our testing configuration, ensuring every test run is consistent.</p>
<h2 id="common-configuration-options">Common Configuration Options</h2>
<h2 id="configuring-pytest-for-professional-workflows">Configuring Pytest for Professional Workflows</h2>
<p>The <code>[tool.pytest.ini_options]</code> section in your <code>pyproject.toml</code> is your command center for controlling pytest's behavior. Let's explore some of the most valuable options you'll use in day-to-day development.</p>
<p>Our starting configuration:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># pyproject.toml</span>

<span class="k">[tool.pytest.ini_options]</span>
<span class="n">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-v --strict-markers&quot;</span>
</code></pre></div>

<h3 id="testpaths-specifying-where-to-find-tests"><code>testpaths</code>: Specifying Where to Find Tests</h3>
<p>By default, pytest searches the entire project directory for tests. In a large project, this can be slow. You can speed up test discovery by telling pytest exactly where to look.</p>
<p><strong>Problem</strong>: Slow test collection in large repositories with many files.
<strong>Solution</strong>: Use <code>testpaths</code> to limit the search.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[tool.pytest.ini_options]</span>
<span class="n">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-v --strict-markers&quot;</span>
<span class="n">testpaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]</span>
</code></pre></div>

<p>With this setting, <code>pytest</code> will <em>only</em> look for tests inside the <code>tests/</code> directory and ignore everything else.</p>
<h3 id="minversion-enforcing-a-pytest-version"><code>minversion</code>: Enforcing a Pytest Version</h3>
<p><strong>Problem</strong>: A new developer joins the team and installs an old, incompatible version of pytest, causing strange errors.
<strong>Solution</strong>: Specify a minimum required version.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[tool.pytest.ini_options]</span>
<span class="n">minversion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;8.0&quot;</span><span class="w"> </span><span class="c1"># Require pytest version 8.0 or newer</span>
<span class="n">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-v --strict-markers&quot;</span>
<span class="n">testpaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]</span>
</code></pre></div>

<p>If someone tries to run the suite with an older version, pytest will exit immediately with a clear error message.</p>
<h3 id="markers-registering-custom-markers"><code>markers</code>: Registering Custom Markers</h3>
<p>As we'll see in Chapter 6, markers are a powerful way to categorize tests (e.g., <code>@pytest.mark.slow</code>, <code>@pytest.mark.api</code>). The <code>--strict-markers</code> option in <code>addopts</code> will cause an error if you use a marker that hasn't been officially registered. This is a good thing‚Äîit prevents typos!</p>
<p><strong>Problem</strong>: Typos in marker names (<code>@pytest.mark.slwo</code>) go unnoticed, and tests are not selected or skipped as intended.
<strong>Solution</strong>: Register all valid markers in the configuration file.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[tool.pytest.ini_options]</span>
<span class="n">minversion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;8.0&quot;</span>
<span class="n">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-v --strict-markers&quot;</span>
<span class="n">testpaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]</span>
<span class="n">markers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;slow: marks tests as slow (select with &#39;-m slow&#39;)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;api: marks tests that hit a live API endpoint&quot;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<p>Now, if you accidentally type <code>@pytest.mark.slwo</code>, the test suite will fail with an error telling you that the marker is not registered.</p>
<h3 id="customizing-test-discovery">Customizing Test Discovery</h3>
<p>Pytest's discovery rules are sensible by default (it looks for <code>test_*.py</code> or <code>*_test.py</code> files), but you can override them if your project has different conventions.</p>
<p><strong>Problem</strong>: Your project uses a different naming convention for test files, like <code>check_*.py</code>.
<strong>Solution</strong>: Use <code>python_files</code>, <code>python_classes</code>, and <code>python_functions</code> to change the discovery patterns.</p>
<div class="codehilite"><pre><span></span><code><span class="k">[tool.pytest.ini_options]</span>
<span class="c1"># ... other options</span>
<span class="n">python_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test_*.py *_test.py check_*.py&quot;</span>
<span class="n">python_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Test* Check*&quot;</span>
<span class="n">python_functions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test_* check_*&quot;</span>
</code></pre></div>

<p>This tells pytest to also discover tests in files like <code>check_wallet.py</code>, inside classes like <code>CheckWallet</code>, and from functions like <code>check_initial_balance</code>.</p>
<h3 id="a-complete-configuration-example">A Complete Configuration Example</h3>
<p>Here is what a robust, professional <code>pytest.ini_options</code> section might look like, combining these common settings.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># pyproject.toml</span>

<span class="c1"># ... [project] and [tool.setuptools.packages.find] sections ...</span>

<span class="k">[tool.pytest.ini_options]</span>
<span class="c1"># Enforce a minimum pytest version for consistency</span>
<span class="n">minversion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;8.0&quot;</span>

<span class="c1"># Specify the directory where tests are located</span>
<span class="n">testpaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]</span>

<span class="c1"># Add command-line options that should always be used</span>
<span class="c1"># -v: verbose</span>
<span class="c1"># -rA: show extra test summary info for all outcomes</span>
<span class="c1"># --strict-markers: fail on unregistered markers</span>
<span class="c1"># --color=yes: force color output (good for CI)</span>
<span class="n">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-v -rA --strict-markers --color=yes&quot;</span>

<span class="c1"># Register custom markers to avoid typos and provide help</span>
<span class="n">markers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;slow: marks tests as slow to run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;smoke: marks a small subset of critical-path tests&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;regression: marks regression tests for a specific bug&quot;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>
        </div>
        <div class="footer">
            Generated on 2025-11-24 14:31:15 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>