<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>02 Understanding Test Fundamentals</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">01 Getting Started</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-2-understanding-test-fundamentals">Chapter 2: Understanding Test Fundamentals</h1>
<h2 id="assertions-the-heart-of-testing">Assertions: The Heart of Testing</h2>
<h2 id="assertions-the-heart-of-testing_1">Assertions: The Heart of Testing</h2>
<p>Every test ultimately answers one question: <strong>Does this code behave as expected?</strong> The mechanism that answers this question is the assertion‚Äîa statement that declares what should be true. If the assertion holds, the test passes. If it fails, the test fails, and pytest tells you exactly what went wrong.</p>
<p>In this section, we'll build a reference implementation that we'll refine throughout the chapter: a simple user authentication system. We'll start with basic assertions and progressively discover their power through the failures they reveal.</p>
<h3 id="the-reference-problem-user-authentication">The Reference Problem: User Authentication</h3>
<p>Let's test a function that validates user credentials. This is our anchor example‚Äîrealistic enough to matter, simple enough to understand immediately.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># auth.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Authenticate a user against a database of valid credentials.</span>

<span class="sd">    Args:</span>
<span class="sd">        username: The username to check</span>
<span class="sd">        password: The password to verify</span>
<span class="sd">        users_db: Dictionary mapping usernames to passwords</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if credentials are valid, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">users_db</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">==</span> <span class="n">password</span>
</code></pre></div>

<h3 id="iteration-0-the-naive-first-test">Iteration 0: The Naive First Test</h3>
<p>Let's write our first test using the most basic assertion possible.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="s2">&quot;password456&quot;</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span>
</code></pre></div>

<p>Run this test:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials PASSED                              [100%]

========================== 1 passed in 0.01s ===========================
</code></pre></div>

<p>Success! But this test only covers the happy path. What happens when we test invalid credentials?</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="s2">&quot;password456&quot;</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="s2">&quot;password456&quot;</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong_password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span>  <span class="c1"># This should fail!</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials PASSED                              [ 50%]
test_auth.py::test_invalid_password FAILED                               [100%]

=========================== FAILURES ====================================
__________________ test_invalid_password ________________________________

    def test_invalid_password():
        users = {&quot;alice&quot;: &quot;secret123&quot;, &quot;bob&quot;: &quot;password456&quot;}
        result = authenticate_user(&quot;alice&quot;, &quot;wrong_password&quot;, users)
&gt;       assert result
E       assert False

test_auth.py:11: AssertionError
======================== short test summary info ========================
FAILED test_auth.py::test_invalid_password - assert False
===================== 1 failed, 1 passed in 0.03s =======================
</code></pre></div>

<h3 id="diagnostic-analysis-reading-the-failure">Diagnostic Analysis: Reading the Failure</h3>
<p><strong>The complete output tells a story</strong>. Let's parse it section by section.</p>
<p><strong>1. The summary line</strong>: <code>FAILED test_auth.py::test_invalid_password - assert False</code></p>
<p>What this tells us:
- Which test failed: <code>test_invalid_password</code>
- Where it lives: <code>test_auth.py</code>
- The immediate cause: <code>assert False</code></p>
<p><strong>2. The traceback</strong>:</p>
<div class="codehilite"><pre><span></span><code>def test_invalid_password():
        users = {&quot;alice&quot;: &quot;secret123&quot;, &quot;bob&quot;: &quot;password456&quot;}
        result = authenticate_user(&quot;alice&quot;, &quot;wrong_password&quot;, users)
&gt;       assert result
E       assert False
</code></pre></div>

<p>What this tells us:
- The <code>&gt;</code> marker shows the exact line that failed
- The <code>E</code> prefix shows pytest's interpretation: <code>assert False</code>
- The assertion evaluated to <code>False</code>, which caused the failure</p>
<p><strong>3. The assertion introspection</strong>:</p>
<div class="codehilite"><pre><span></span><code>E       assert False
</code></pre></div>

<p>What this tells us:
- The variable <code>result</code> contained the value <code>False</code>
- Our assertion <code>assert result</code> expected a truthy value
- Pytest shows us the actual value that caused the failure</p>
<p><strong>Root cause identified</strong>: We wrote <code>assert result</code> when we meant to test that the result is <code>False</code> for invalid credentials.</p>
<p><strong>Why the current approach can't solve this</strong>: The assertion <code>assert result</code> only passes when <code>result</code> is truthy. We need a way to assert that something is <code>False</code>.</p>
<p><strong>What we need</strong>: Explicit comparison assertions that state our expectations clearly.</p>
<h3 id="iteration-1-explicit-comparisons">Iteration 1: Explicit Comparisons</h3>
<p>The problem with <code>assert result</code> is ambiguity. Does it mean "result should be True" or "result should exist"? Let's be explicit about what we expect.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="s2">&quot;password456&quot;</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">True</span>  <span class="c1"># Explicit: we expect True</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="s2">&quot;password456&quot;</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong_password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">False</span>  <span class="c1"># Explicit: we expect False</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials PASSED                              [ 50%]
test_auth.py::test_invalid_password PASSED                               [100%]

========================== 2 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Both tests now pass because we're explicitly stating what we expect. The assertion <code>result == False</code> passes when authentication correctly fails.</p>
<p><strong>Current limitation</strong>: Our assertions work, but what happens when they fail? Let's intentionally break our code to see how pytest helps us debug.</p>
<h3 id="iteration-2-understanding-assertion-introspection">Iteration 2: Understanding Assertion Introspection</h3>
<p>Let's introduce a bug in our authentication function to see how pytest's assertion introspection helps us diagnose problems.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># auth.py (with intentional bug)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Authenticate a user against a database of valid credentials.</span>
<span class="sd">    (Buggy version for demonstration)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Bug: always returns True if user exists, ignoring password</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials PASSED                              [ 50%]
test_auth.py::test_invalid_password FAILED                               [100%]

=========================== FAILURES ====================================
__________________ test_invalid_password ________________________________

    def test_invalid_password():
        users = {&quot;alice&quot;: &quot;secret123&quot;, &quot;bob&quot;: &quot;password456&quot;}
        result = authenticate_user(&quot;alice&quot;, &quot;wrong_password&quot;, users)
&gt;       assert result == False
E       assert True == False

test_auth.py:11: AssertionError
======================== short test summary info ========================
FAILED test_auth.py::test_invalid_password - assert True == False
===================== 1 failed, 1 passed in 0.03s =======================
</code></pre></div>

<h3 id="diagnostic-analysis-reading-the-comparison-failure">Diagnostic Analysis: Reading the Comparison Failure</h3>
<p><strong>The complete output</strong>:</p>
<div class="codehilite"><pre><span></span><code>&gt;       assert result == False
E       assert True == False
</code></pre></div>

<p><strong>Let's parse this</strong>:</p>
<ol>
<li><strong>The assertion line</strong>: <code>assert result == False</code></li>
<li>What we expected: <code>False</code> (invalid credentials should be rejected)</li>
<li>
<p>What we're testing: The variable <code>result</code></p>
</li>
<li>
<p><strong>The introspection</strong>: <code>assert True == False</code></p>
</li>
<li>What we got: <code>True</code></li>
<li>What we expected: <code>False</code></li>
<li>The comparison: These are not equal</li>
</ol>
<p><strong>Root cause identified</strong>: The function returned <code>True</code> when we expected <code>False</code>. The bug is now obvious‚Äîour authentication function isn't checking the password.</p>
<p><strong>Key insight</strong>: Pytest's assertion introspection shows both sides of the comparison. We don't need to add print statements or use a debugger to see what went wrong. The failure message tells us exactly what value we got versus what we expected.</p>
<p>Let's fix the bug:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># auth.py (fixed)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Authenticate a user against a database of valid credentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">users_db</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">==</span> <span class="n">password</span>  <span class="c1"># Fixed: actually check password</span>
</code></pre></div>

<p>Run the tests again:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials PASSED                              [ 50%]
test_auth.py::test_invalid_password PASSED                               [100%]

========================== 2 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: The bug is fixed, and pytest's introspection made the problem immediately visible without any debugging effort.</p>
<p><strong>Current limitation</strong>: We're only testing boolean results. What about testing more complex values like strings, numbers, or collections?</p>
<h3 id="iteration-3-assertions-with-complex-data-types">Iteration 3: Assertions with Complex Data Types</h3>
<p>Let's extend our authentication system to return more information. Instead of just <code>True</code>/<code>False</code>, let's return a user profile dictionary on success.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># auth.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Authenticate a user and return their profile.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with user info if valid, None if invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">stored_password</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">users_db</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">stored_password</span> <span class="o">!=</span> <span class="n">password</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">profile</span>
</code></pre></div>

<p>Now let's test this enhanced version:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials_returns_profile</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">})</span>
    <span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">}</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">expected</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_password_returns_none</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">})</span>
    <span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong_password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials_returns_profile PASSED             [ 50%]
test_auth.py::test_invalid_password_returns_none PASSED                 [100%]

========================== 2 passed in 0.01s ===========================
</code></pre></div>

<p>Great! But what happens when a dictionary comparison fails? Let's introduce a bug to see pytest's introspection for complex types.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># auth.py (with bug in profile)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Authenticate a user and return their profile.</span>
<span class="sd">    (Buggy version - wrong email domain)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">stored_password</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">users_db</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">stored_password</span> <span class="o">!=</span> <span class="n">password</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Bug: changing email domain</span>
    <span class="n">buggy_profile</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">buggy_profile</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;@wrong.com&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">buggy_profile</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials_returns_profile FAILED             [ 50%]
test_auth.py::test_invalid_password_returns_none PASSED                 [100%]

=========================== FAILURES ====================================
_____________ test_valid_credentials_returns_profile ____________________

    def test_valid_credentials_returns_profile():
        users = {
            &quot;alice&quot;: (&quot;secret123&quot;, {&quot;id&quot;: 1, &quot;email&quot;: &quot;alice@example.com&quot;, &quot;role&quot;: &quot;admin&quot;}),
            &quot;bob&quot;: (&quot;password456&quot;, {&quot;id&quot;: 2, &quot;email&quot;: &quot;bob@example.com&quot;, &quot;role&quot;: &quot;user&quot;})
        }
        result = authenticate_user(&quot;alice&quot;, &quot;secret123&quot;, users)
        expected = {&quot;id&quot;: 1, &quot;email&quot;: &quot;alice@example.com&quot;, &quot;role&quot;: &quot;admin&quot;}
&gt;       assert result == expected
E       AssertionError: assert {&#39;id&#39;: 1, &#39;em...role&#39;: &#39;admin&#39;} == {&#39;id&#39;: 1, &#39;em...role&#39;: &#39;admin&#39;}
E         
E         Differing items:
E         {&#39;email&#39;: &#39;alice@wrong.com&#39;} != {&#39;email&#39;: &#39;alice@example.com&#39;}
E         
E         Full diff:
E         - {&#39;email&#39;: &#39;alice@example.com&#39;, &#39;id&#39;: 1, &#39;role&#39;: &#39;admin&#39;}
E         ?            ^^^^^^^
E         
E         + {&#39;email&#39;: &#39;alice@wrong.com&#39;, &#39;id&#39;: 1, &#39;role&#39;: &#39;admin&#39;}
E         ?            ^^^^

test_auth.py:11: AssertionError
======================== short test summary info ========================
FAILED test_auth.py::test_valid_credentials_returns_profile - AssertionError
===================== 1 failed, 1 passed in 0.03s =======================
</code></pre></div>

<h3 id="diagnostic-analysis-reading-dictionary-comparison-failures">Diagnostic Analysis: Reading Dictionary Comparison Failures</h3>
<p><strong>The complete output shows pytest's powerful introspection for complex types</strong>:</p>
<p><strong>1. The summary</strong>: <code>assert {'id': 1, 'em...role': 'admin'} == {'id': 1, 'em...role': 'admin'}</code>
   - Both dictionaries look similar at first glance
   - Pytest truncates the display but shows they're not equal</p>
<p><strong>2. The detailed diff</strong>:</p>
<div class="codehilite"><pre><span></span><code>E         Differing items:
E         {&#39;email&#39;: &#39;alice@wrong.com&#39;} != {&#39;email&#39;: &#39;alice@example.com&#39;}
</code></pre></div>

<p>What this tells us:
- Pytest automatically compares dictionary keys
- It identifies exactly which key has a different value
- It shows both the actual and expected values for that key</p>
<p><strong>3. The visual diff</strong>:</p>
<div class="codehilite"><pre><span></span><code>E         Full diff:
E         - {&#39;email&#39;: &#39;alice@example.com&#39;, &#39;id&#39;: 1, &#39;role&#39;: &#39;admin&#39;}
E         ?            ^^^^^^^
E         
E         + {&#39;email&#39;: &#39;alice@wrong.com&#39;, &#39;id&#39;: 1, &#39;role&#39;: &#39;admin&#39;}
E         ?            ^^^^
</code></pre></div>

<p>What this tells us:
- The <code>-</code> line shows what we expected
- The <code>+</code> line shows what we got
- The <code>?</code> lines with <code>^</code> markers highlight the exact character differences
- The domain changed from <code>example</code> to <code>wrong</code></p>
<p><strong>Root cause identified</strong>: The email domain is being modified incorrectly. The visual diff makes it immediately obvious which characters differ.</p>
<p><strong>Key insight</strong>: Pytest doesn't just say "these dictionaries are different." It shows you:
1. Which keys differ
2. What the expected vs. actual values are
3. A character-by-character diff of string differences</p>
<p>This level of detail eliminates guesswork. You don't need to add print statements or use a debugger‚Äîthe assertion failure tells you exactly what's wrong.</p>
<p>Let's fix the bug and verify:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># auth.py (fixed)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Authenticate a user and return their profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">stored_password</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">users_db</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">stored_password</span> <span class="o">!=</span> <span class="n">password</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">profile</span>  <span class="c1"># Fixed: return profile unchanged</span>
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Tests pass, and we've learned that pytest provides detailed introspection for complex data structures, not just simple values.</p>
<h3 id="iteration-4-testing-collections-and-membership">Iteration 4: Testing Collections and Membership</h3>
<p>What if we need to test that a value is in a collection, or that a collection contains specific items? Let's add a feature that returns a list of user permissions.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># auth.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_permissions</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the list of permissions for a user.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of permission strings, or empty list if user not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">users_db</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;permissions&quot;</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div>

<p>Let's test this:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span><span class="p">,</span> <span class="n">get_user_permissions</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_admin_has_all_permissions</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">]</span>
        <span class="p">})</span>
    <span class="p">}</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">get_user_permissions</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>

    <span class="c1"># Test that specific permissions are present</span>
    <span class="k">assert</span> <span class="s2">&quot;read&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>
    <span class="k">assert</span> <span class="s2">&quot;write&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>
    <span class="k">assert</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_regular_user_has_limited_permissions</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>
        <span class="p">})</span>
    <span class="p">}</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">get_user_permissions</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>

    <span class="c1"># Test that admin permission is NOT present</span>
    <span class="k">assert</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">permissions</span>
    <span class="k">assert</span> <span class="s2">&quot;delete&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">permissions</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py::test_admin_has_all_permissions<span class="w"> </span>-v
pytest<span class="w"> </span>test_auth.py::test_regular_user_has_limited_permissions<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_admin_has_all_permissions PASSED                     [100%]
test_auth.py::test_regular_user_has_limited_permissions PASSED          [100%]

========================== 2 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Key patterns demonstrated</strong>:
- <code>assert item in collection</code> - Tests membership
- <code>assert item not in collection</code> - Tests absence</p>
<p>Let's see what happens when a membership assertion fails:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_user_has_write_permission</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span>  <span class="c1"># Only has read, not write</span>
        <span class="p">})</span>
    <span class="p">}</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">get_user_permissions</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;write&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>  <span class="c1"># This will fail</span>
</code></pre></div>

<p>Run the test:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py::test_user_has_write_permission<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_user_has_write_permission FAILED                     [100%]

=========================== FAILURES ====================================
________________ test_user_has_write_permission _________________________

    def test_user_has_write_permission():
        users = {
            &quot;bob&quot;: (&quot;password456&quot;, {
                &quot;id&quot;: 2,
                &quot;email&quot;: &quot;bob@example.com&quot;,
                &quot;role&quot;: &quot;user&quot;,
                &quot;permissions&quot;: [&quot;read&quot;]
            })
        }
        permissions = get_user_permissions(&quot;bob&quot;, users)
&gt;       assert &quot;write&quot; in permissions
E       AssertionError: assert &#39;write&#39; in [&#39;read&#39;]

test_auth.py:11: AssertionError
======================== short test summary info ========================
FAILED test_auth.py::test_user_has_write_permission - AssertionError
===================== 1 failed, 1 passed in 0.03s =======================
</code></pre></div>

<h3 id="diagnostic-analysis-reading-membership-failures">Diagnostic Analysis: Reading Membership Failures</h3>
<p><strong>The introspection</strong>: <code>assert 'write' in ['read']</code></p>
<p>What this tells us:
- We're looking for the string <code>'write'</code>
- The actual collection is <code>['read']</code>
- The item we're looking for is not in the collection
- We can see the entire collection's contents</p>
<p><strong>Root cause identified</strong>: The user only has <code>read</code> permission, not <code>write</code>. The failure message shows us both what we were looking for and what was actually in the collection.</p>
<h3 id="iteration-5-comparing-collections">Iteration 5: Comparing Collections</h3>
<p>What if we want to test that a collection contains exactly the right items, in any order? Or that it contains at least certain items?</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_admin_permissions_complete</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">]</span>
        <span class="p">})</span>
    <span class="p">}</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">get_user_permissions</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">]</span>

    <span class="c1"># Compare as sets - order doesn&#39;t matter</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">permissions</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
</code></pre></div>

<p>Let's introduce a bug where a permission is missing:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># auth.py (with bug)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_permissions</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the list of permissions for a user.</span>
<span class="sd">    (Buggy version - filters out &#39;delete&#39; permission)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">users_db</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;permissions&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="c1"># Bug: accidentally filtering out delete permission</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">permissions</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s2">&quot;delete&quot;</span><span class="p">]</span>
</code></pre></div>

<p>Run the test:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py::test_admin_permissions_complete<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_admin_permissions_complete FAILED                    [100%]

=========================== FAILURES ====================================
______________ test_admin_permissions_complete __________________________

    def test_admin_permissions_complete():
        users = {
            &quot;alice&quot;: (&quot;secret123&quot;, {
                &quot;id&quot;: 1,
                &quot;email&quot;: &quot;alice@example.com&quot;,
                &quot;role&quot;: &quot;admin&quot;,
                &quot;permissions&quot;: [&quot;read&quot;, &quot;write&quot;, &quot;delete&quot;, &quot;admin&quot;]
            })
        }
        permissions = get_user_permissions(&quot;alice&quot;, users)
        expected = [&quot;read&quot;, &quot;write&quot;, &quot;delete&quot;, &quot;admin&quot;]
&gt;       assert set(permissions) == set(expected)
E       AssertionError: assert {&#39;admin&#39;, &#39;read&#39;, &#39;write&#39;} == {&#39;admin&#39;, &#39;delete&#39;, &#39;read&#39;, &#39;write&#39;}
E         
E         Extra items in the right set:
E         {&#39;delete&#39;}

test_auth.py:11: AssertionError
======================== short test summary info ========================
FAILED test_auth.py::test_admin_permissions_complete - AssertionError
===================== 1 failed, 1 passed in 0.03s =======================
</code></pre></div>

<h3 id="diagnostic-analysis-reading-set-comparison-failures">Diagnostic Analysis: Reading Set Comparison Failures</h3>
<p><strong>The introspection</strong>:</p>
<div class="codehilite"><pre><span></span><code>E       AssertionError: assert {&#39;admin&#39;, &#39;read&#39;, &#39;write&#39;} == {&#39;admin&#39;, &#39;delete&#39;, &#39;read&#39;, &#39;write&#39;}
E         
E         Extra items in the right set:
E         {&#39;delete&#39;}
</code></pre></div>

<p>What this tells us:
- The left set (actual): <code>{'admin', 'read', 'write'}</code>
- The right set (expected): <code>{'admin', 'delete', 'read', 'write'}</code>
- Pytest identifies that <code>'delete'</code> is in the expected set but not in the actual set
- It labels this as "Extra items in the right set" (meaning items we expected but didn't get)</p>
<p><strong>Root cause identified</strong>: The <code>delete</code> permission is missing from the actual permissions. The set comparison makes it immediately clear which items are missing or extra.</p>
<p><strong>Key insight</strong>: When comparing collections:
- Use <code>==</code> for exact equality (order matters for lists)
- Use <code>set()</code> comparison when order doesn't matter
- Pytest shows you exactly which items are missing or extra</p>
<h3 id="common-assertion-patterns-summary">Common Assertion Patterns Summary</h3>
<p>Here are the assertion patterns we've discovered through our authentication system:</p>
<p><strong>Boolean assertions</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">assert</span> <span class="n">result</span>                    <span class="c1"># Result should be truthy</span>
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">True</span>            <span class="c1"># Explicit: result should be True</span>
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">False</span>           <span class="c1"># Explicit: result should be False</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">result</span>                <span class="c1"># Result should be falsy</span>
</code></pre></div>

<p><strong>Equality assertions</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>        <span class="c1"># Values should be equal</span>
<span class="k">assert</span> <span class="n">actual</span> <span class="o">!=</span> <span class="n">unexpected</span>      <span class="c1"># Values should not be equal</span>
</code></pre></div>

<p><strong>Membership assertions</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">assert</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">collection</span>        <span class="c1"># Item should be in collection</span>
<span class="k">assert</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">collection</span>    <span class="c1"># Item should not be in collection</span>
</code></pre></div>

<p><strong>Collection assertions</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">assert</span> <span class="n">list1</span> <span class="o">==</span> <span class="n">list2</span>            <span class="c1"># Lists equal (order matters)</span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span>  <span class="c1"># Same items (order doesn&#39;t matter)</span>
<span class="k">assert</span> <span class="n">dict1</span> <span class="o">==</span> <span class="n">dict2</span>            <span class="c1"># Dictionaries equal</span>
</code></pre></div>

<p><strong>Comparison assertions</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">threshold</span>         <span class="c1"># Greater than</span>
<span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">minimum</span>          <span class="c1"># Greater than or equal</span>
<span class="k">assert</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">maximum</span>           <span class="c1"># Less than</span>
<span class="k">assert</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">limit</span>            <span class="c1"># Less than or equal</span>
</code></pre></div>

<h3 id="why-plain-assert-is-powerful">Why Plain <code>assert</code> Is Powerful</h3>
<p>You might wonder: why does pytest use plain Python <code>assert</code> instead of special assertion methods like <code>assertEqual()</code> or <code>assertTrue()</code> from unittest?</p>
<p><strong>The answer</strong>: Pytest rewrites your assertions at import time to provide detailed introspection. When you write:</p>
<div class="codehilite"><pre><span></span><code><span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>

<p>Pytest transforms this into code that:
1. Evaluates both sides of the comparison
2. Captures the actual values
3. If the assertion fails, formats a detailed error message showing what went wrong</p>
<p>This means you get the simplicity of plain <code>assert</code> with the power of detailed failure messages. You don't need to remember different assertion methods‚Äîjust use Python's natural comparison operators.</p>
<h3 id="when-to-use-multiple-assertions">When to Use Multiple Assertions</h3>
<p>A common question: should a test have one assertion or multiple?</p>
<p><strong>General guideline</strong>: One logical assertion per test, but that can involve multiple <code>assert</code> statements if they're testing the same concept.</p>
<p><strong>Good</strong>: Multiple assertions testing the same concept</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_admin_has_all_permissions</span><span class="p">():</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">get_user_permissions</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="c1"># All these assertions test the same concept: &quot;admin has full permissions&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;read&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>
    <span class="k">assert</span> <span class="s2">&quot;write&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>
    <span class="k">assert</span> <span class="s2">&quot;delete&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>
    <span class="k">assert</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>
</code></pre></div>

<p><strong>Better</strong>: Single assertion that captures the concept</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_admin_has_all_permissions</span><span class="p">():</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">get_user_permissions</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">}</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">permissions</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>

<p><strong>Avoid</strong>: Testing multiple unrelated concepts</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_authentication_and_permissions_and_email</span><span class="p">():</span>
    <span class="c1"># Too many unrelated concepts in one test</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">permissions</span> <span class="o">=</span> <span class="n">get_user_permissions</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="s2">&quot;@example.com&quot;</span> <span class="ow">in</span> <span class="n">email</span>
</code></pre></div>

<p><strong>Why this matters</strong>: If the first assertion fails, pytest stops executing the test. You won't see whether the other assertions would have passed or failed. Separate tests for separate concepts give you more precise failure information.</p>
<h3 id="the-journey-from-simple-to-sophisticated-assertions">The Journey: From Simple to Sophisticated Assertions</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>What We Tested</th>
<th>Assertion Pattern</th>
<th>Key Learning</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Boolean result</td>
<td><code>assert result</code></td>
<td>Ambiguous‚Äîdoesn't state expectation clearly</td>
</tr>
<tr>
<td>1</td>
<td>Explicit boolean</td>
<td><code>assert result == True</code></td>
<td>Clear expectations prevent confusion</td>
</tr>
<tr>
<td>2</td>
<td>Intentional failure</td>
<td>Comparison with introspection</td>
<td>Pytest shows both sides of failed comparisons</td>
</tr>
<tr>
<td>3</td>
<td>Dictionary comparison</td>
<td><code>assert dict1 == dict2</code></td>
<td>Pytest provides detailed diffs for structures</td>
</tr>
<tr>
<td>4</td>
<td>Collection membership</td>
<td><code>assert item in collection</code></td>
<td>Membership tests are clear and readable</td>
</tr>
<tr>
<td>5</td>
<td>Set comparison</td>
<td><code>assert set(a) == set(b)</code></td>
<td>Order-independent comparison when needed</td>
</tr>
</tbody>
</table>
<h3 id="lessons-learned">Lessons Learned</h3>
<p><strong>1. Be explicit</strong>: <code>assert result == True</code> is clearer than <code>assert result</code></p>
<p><strong>2. Trust pytest's introspection</strong>: You don't need print statements or debuggers‚Äîthe failure message shows you exactly what went wrong</p>
<p><strong>3. Use natural Python operators</strong>: <code>==</code>, <code>in</code>, <code>&gt;</code>, <code>&lt;</code> all work and provide detailed failure messages</p>
<p><strong>4. Match the assertion to the concept</strong>: Use set comparison when order doesn't matter, list comparison when it does</p>
<p><strong>5. One concept per test</strong>: Multiple assertions are fine if they test the same logical concept, but separate tests for separate concepts give better failure isolation</p>
<h2 id="test-functions-vs-other-functions">Test Functions vs. Other Functions</h2>
<h2 id="test-functions-vs-other-functions_1">Test Functions vs. Other Functions</h2>
<p>A test function looks like a regular Python function, but pytest treats it specially. Understanding what makes a function a "test" versus a "helper" is crucial for organizing your test code effectively.</p>
<p>Let's continue with our authentication system and explore the distinction through practical examples.</p>
<h3 id="the-reference-problem-expanding-authentication">The Reference Problem: Expanding Authentication</h3>
<p>Our authentication system now needs to handle multiple scenarios: valid credentials, invalid passwords, non-existent users, and edge cases like empty passwords. We'll discover when to write test functions versus helper functions.</p>
<h3 id="iteration-0-everything-in-test-functions">Iteration 0: Everything in Test Functions</h3>
<p>Let's start by writing tests the naive way‚Äîduplicating setup code in every test.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="c1"># Setup</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">})</span>
    <span class="p">}</span>

    <span class="c1"># Test</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_password</span><span class="p">():</span>
    <span class="c1"># Setup (duplicated!)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">})</span>
    <span class="p">}</span>

    <span class="c1"># Test</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong_password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_nonexistent_user</span><span class="p">():</span>
    <span class="c1"># Setup (duplicated again!)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">})</span>
    <span class="p">}</span>

    <span class="c1"># Test</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;charlie&quot;</span><span class="p">,</span> <span class="s2">&quot;any_password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials PASSED                              [ 33%]
test_auth.py::test_invalid_password PASSED                               [ 66%]
test_auth.py::test_nonexistent_user PASSED                               [100%]

========================== 3 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Current limitation</strong>: We're duplicating the same setup code in every test. This violates the DRY (Don't Repeat Yourself) principle and makes maintenance harder. If we need to add a new user to the test database, we'd have to update it in three places.</p>
<p><strong>What we need</strong>: A way to share setup code without making pytest think it's a test.</p>
<h3 id="iteration-1-extracting-a-helper-function">Iteration 1: Extracting a Helper Function</h3>
<p>Let's extract the duplicated setup into a helper function.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_test_users</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to create test user database.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">})</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_test_users</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_test_users</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong_password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_nonexistent_user</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_test_users</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;charlie&quot;</span><span class="p">,</span> <span class="s2">&quot;any_password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials PASSED                              [ 33%]
test_auth.py::test_invalid_password PASSED                               [ 66%]
test_auth.py::test_nonexistent_user PASSED                               [100%]

========================== 3 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: The tests still pass, but now we have a single source of truth for test data. Notice that pytest did NOT try to run <code>create_test_users()</code> as a test.</p>
<p><strong>Why didn't pytest run <code>create_test_users()</code> as a test?</strong></p>
<p>Pytest identifies test functions by their name. By default, pytest looks for:
- Functions that start with <code>test_</code>
- Functions inside classes that start with <code>Test</code></p>
<p>Since <code>create_test_users()</code> doesn't start with <code>test_</code>, pytest ignores it. This is the key distinction: <strong>naming determines whether a function is a test or a helper</strong>.</p>
<h3 id="iteration-2-what-happens-if-we-name-it-wrong">Iteration 2: What Happens If We Name It Wrong?</h3>
<p>Let's see what happens if we accidentally name a helper function like a test.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_create_users</span><span class="p">():</span>  <span class="c1"># Oops! Starts with test_</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to create test user database.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">})</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">test_create_users</span><span class="p">()</span>  <span class="c1"># Calling our &quot;helper&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_create_users PASSED                                   [ 50%]
test_auth.py::test_valid_credentials PASSED                              [100%]

========================== 2 passed in 0.02s ===========================
</code></pre></div>

<h3 id="diagnostic-analysis-the-accidental-test">Diagnostic Analysis: The Accidental Test</h3>
<p><strong>What happened</strong>: Pytest ran <code>test_create_users()</code> as a test!</p>
<p><strong>Why this is a problem</strong>:
1. <code>test_create_users()</code> isn't actually testing anything‚Äîit just returns data
2. It "passes" because it doesn't raise an exception
3. This creates a false positive‚Äîa test that passes but doesn't verify any behavior
4. It pollutes your test count and can hide real issues</p>
<p><strong>The introspection</strong>: Look at the output:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_create_users PASSED                                   [ 50%]
</code></pre></div>

<p>Pytest collected and ran <code>test_create_users()</code> as a test. It passed because:
- The function executed without errors
- It returned a value (which pytest doesn't care about)
- There were no assertions to fail</p>
<p><strong>Root cause identified</strong>: The function name starts with <code>test_</code>, so pytest treats it as a test.</p>
<p><strong>What we need</strong>: Clear naming conventions that distinguish tests from helpers.</p>
<h3 id="iteration-3-proper-naming-conventions">Iteration 3: Proper Naming Conventions</h3>
<p>Let's establish clear naming patterns for different types of functions.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="c1"># Helper functions - don&#39;t start with test_</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_test_users</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a standard test user database.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">})</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_admin_user</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a user with admin privileges.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;admin123&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">999</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;admin@example.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">]</span>
    <span class="p">})</span>

<span class="k">def</span><span class="w"> </span><span class="nf">assert_valid_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper to verify a profile has required fields.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">profile</span>
    <span class="k">assert</span> <span class="s2">&quot;email&quot;</span> <span class="ow">in</span> <span class="n">profile</span>
    <span class="k">assert</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span>

<span class="c1"># Test functions - start with test_</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_test_users</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">assert_valid_profile</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_test_users</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong_password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_admin_authentication</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;admin&quot;</span><span class="p">:</span> <span class="n">create_admin_user</span><span class="p">()}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;admin123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;admin&quot;</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_valid_credentials PASSED                              [ 33%]
test_auth.py::test_invalid_password PASSED                               [ 66%]
test_auth.py::test_admin_authentication PASSED                           [100%]

========================== 3 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Only the three actual test functions ran. The helper functions were ignored by pytest but used by the tests.</p>
<p><strong>Key patterns demonstrated</strong>:
- <code>create_*()</code> - Functions that build test data
- <code>assert_*()</code> - Functions that perform common assertions
- <code>test_*()</code> - Actual test functions that pytest runs</p>
<h3 id="iteration-4-understanding-test-function-signatures">Iteration 4: Understanding Test Function Signatures</h3>
<p>Test functions have special requirements. Let's explore what makes a valid test function signature.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>

<span class="c1"># Valid test function - no parameters</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_simple</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">True</span>

<span class="c1"># Valid test function - will learn about fixtures in Chapter 4</span>
<span class="c1"># For now, just know that pytest can inject parameters</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_with_fixture</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>  <span class="c1"># tmp_path is a built-in pytest fixture</span>
    <span class="c1"># tmp_path is automatically provided by pytest</span>
    <span class="n">test_file</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;test.txt&quot;</span>
    <span class="n">test_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">test_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span>

<span class="c1"># Invalid test function - requires a parameter that pytest doesn&#39;t know about</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_with_required_param</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_test_users</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py::test_with_required_param<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_with_required_param ERROR                            [100%]

=========================== ERRORS =======================================
_____________ ERROR at setup of test_with_required_param ________________

file test_auth.py, line 15
  def test_with_required_param(username):
E       fixture &#39;username&#39; not found
&gt;       available fixtures: cache, capfd, capfdbinary, caplog, capsys, capsysbinary, doctest_namespace, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
&gt;       use &#39;pytest --fixtures [testpath]&#39; for help on them.

test_auth.py:15
======================== 1 error in 0.01s ================================
</code></pre></div>

<h3 id="diagnostic-analysis-understanding-test-function-parameters">Diagnostic Analysis: Understanding Test Function Parameters</h3>
<p><strong>The error</strong>: <code>fixture 'username' not found</code></p>
<p><strong>What this tells us</strong>:
1. Pytest tried to run the test
2. It saw the parameter <code>username</code>
3. It looked for a fixture named <code>username</code> (we'll learn about fixtures in Chapter 4)
4. It couldn't find one, so it failed during setup</p>
<p><strong>Key insight</strong>: Test functions can only have parameters that pytest knows how to provide. These are called "fixtures" and we'll cover them in depth in Chapter 4. For now, remember:
- Test functions with no parameters always work
- Test functions with parameters must use pytest fixtures
- You can't just add arbitrary parameters to test functions</p>
<h3 id="iteration-5-helper-functions-that-return-vs-assert">Iteration 5: Helper Functions That Return vs. Assert</h3>
<p>We've seen two types of helper functions: those that return data and those that perform assertions. Let's understand when to use each.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="c1"># Helper that RETURNS data</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_test_users</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns test data for use in tests.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">})</span>
    <span class="p">}</span>

<span class="c1"># Helper that ASSERTS (performs verification)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">assert_valid_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verifies that a profile has all required fields.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Profile should not be None&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">,</span> <span class="s2">&quot;Profile must have an id&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;email&quot;</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">,</span> <span class="s2">&quot;Profile must have an email&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">],</span> <span class="s2">&quot;Email must be valid&quot;</span>

<span class="c1"># Helper that RETURNS a computed value</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_count</span><span class="p">(</span><span class="n">users_db</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the number of users in the database.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">users_db</span><span class="p">)</span>

<span class="c1"># Test using all three types of helpers</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authentication_with_helpers</span><span class="p">():</span>
    <span class="c1"># Use data-returning helper</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_test_users</span><span class="p">()</span>

    <span class="c1"># Use computation helper</span>
    <span class="n">user_count</span> <span class="o">=</span> <span class="n">get_user_count</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">user_count</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="c1"># Perform authentication</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>

    <span class="c1"># Use assertion helper</span>
    <span class="n">assert_valid_profile</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div>

<p>Run the test:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py::test_authentication_with_helpers<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_authentication_with_helpers PASSED                   [100%]

========================== 1 passed in 0.01s ===========================
</code></pre></div>

<p>Now let's see what happens when an assertion helper fails:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_profile</span><span class="p">():</span>
    <span class="c1"># Create an invalid profile (missing email)</span>
    <span class="n">invalid_profile</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

    <span class="c1"># This will fail in the helper</span>
    <span class="n">assert_valid_profile</span><span class="p">(</span><span class="n">invalid_profile</span><span class="p">)</span>
</code></pre></div>

<p>Run the test:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py::test_invalid_profile<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_invalid_profile FAILED                               [100%]

=========================== FAILURES ====================================
__________________ test_invalid_profile _________________________________

    def test_invalid_profile():
        invalid_profile = {&quot;id&quot;: 1}
&gt;       assert_valid_profile(invalid_profile)

test_auth.py:25: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

profile = {&#39;id&#39;: 1}

    def assert_valid_profile(profile):
        &quot;&quot;&quot;Verifies that a profile has all required fields.&quot;&quot;&quot;
        assert profile is not None, &quot;Profile should not be None&quot;
&gt;       assert &quot;email&quot; in profile, &quot;Profile must have an email&quot;
E       AssertionError: Profile must have an email

test_auth.py:18: AssertionError
======================== short test summary info ========================
FAILED test_auth.py::test_invalid_profile - AssertionError: Profile must have an email
===================== 1 failed, 1 passed in 0.03s =======================
</code></pre></div>

<h3 id="diagnostic-analysis-tracing-through-helper-functions">Diagnostic Analysis: Tracing Through Helper Functions</h3>
<p><strong>The traceback shows two levels</strong>:</p>
<p><strong>1. The test function</strong>:</p>
<div class="codehilite"><pre><span></span><code>def test_invalid_profile():
        invalid_profile = {&quot;id&quot;: 1}
&gt;       assert_valid_profile(invalid_profile)
</code></pre></div>

<p>This shows where in the test we called the helper.</p>
<p><strong>2. The helper function</strong>:</p>
<div class="codehilite"><pre><span></span><code>def assert_valid_profile(profile):
        &quot;&quot;&quot;Verifies that a profile has all required fields.&quot;&quot;&quot;
        assert profile is not None, &quot;Profile should not be None&quot;
&gt;       assert &quot;email&quot; in profile, &quot;Profile must have an email&quot;
E       AssertionError: Profile must have an email
</code></pre></div>

<p>This shows which specific assertion in the helper failed.</p>
<p><strong>Key insight</strong>: Pytest traces through your helper functions and shows you exactly where the failure occurred. The custom message "Profile must have an email" makes it immediately clear what went wrong.</p>
<h3 id="when-to-use-helper-functions-vs-test-functions">When to Use Helper Functions vs. Test Functions</h3>
<p><strong>Use a helper function when</strong>:
- You need to create test data (return values)
- You need to perform common setup operations
- You want to reuse assertion logic across multiple tests
- You need to compute values used in tests</p>
<p><strong>Use a test function when</strong>:
- You're verifying a specific behavior
- You want pytest to discover and run it
- You want it to appear in test reports
- You want it to count toward your test coverage</p>
<h3 id="common-patterns-for-helper-functions">Common Patterns for Helper Functions</h3>
<p><strong>Pattern 1: Data builders</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flexible user builder with defaults.&quot;&quot;&quot;</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@example.com&quot;</span><span class="p">),</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>

<span class="c1"># Usage in tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_with_custom_user</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;admin&quot;</span><span class="p">:</span> <span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">999</span><span class="p">)}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;admin&quot;</span>
</code></pre></div>

<p><strong>Pattern 2: Assertion helpers</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">assert_authentication_failed</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify that authentication fails for given credentials.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected authentication to fail for </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Usage in tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_multiple_invalid_scenarios</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_test_users</span><span class="p">()</span>
    <span class="n">assert_authentication_failed</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">assert_authentication_failed</span><span class="p">(</span><span class="s2">&quot;nonexistent&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">assert_authentication_failed</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
</code></pre></div>

<p><strong>Pattern 3: Setup helpers</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_database_with_users</span><span class="p">(</span><span class="n">user_count</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a database with multiple test users.&quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">user_count</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;user</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>

<span class="c1"># Usage in tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_large_user_database</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">setup_database_with_users</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;user50&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">50</span>
</code></pre></div>

<h3 id="the-journey-from-duplication-to-organization">The Journey: From Duplication to Organization</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Approach</th>
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Duplicate setup in each test</td>
<td>Violates DRY, hard to maintain</td>
<td>Extract to helper function</td>
</tr>
<tr>
<td>1</td>
<td>Helper function</td>
<td>Works, but naming is arbitrary</td>
<td>Establish naming conventions</td>
</tr>
<tr>
<td>2</td>
<td>Accidentally named like test</td>
<td>Helper runs as test, creates confusion</td>
<td>Use <code>test_</code> prefix only for tests</td>
</tr>
<tr>
<td>3</td>
<td>Proper naming conventions</td>
<td>Clear distinction between types</td>
<td><code>create_*</code>, <code>assert_*</code>, <code>test_*</code></td>
</tr>
<tr>
<td>4</td>
<td>Test function parameters</td>
<td>Can't add arbitrary parameters</td>
<td>Use fixtures (Chapter 4) or no params</td>
</tr>
<tr>
<td>5</td>
<td>Different helper types</td>
<td>When to return vs. assert?</td>
<td>Return data, assert for verification</td>
</tr>
</tbody>
</table>
<h3 id="lessons-learned_1">Lessons Learned</h3>
<p><strong>1. Naming determines behavior</strong>: Functions starting with <code>test_</code> are tests; everything else is a helper</p>
<p><strong>2. Test functions are special</strong>: They can only have parameters that pytest provides (fixtures)</p>
<p><strong>3. Helper functions are normal Python</strong>: They can have any parameters, return values, and be called like regular functions</p>
<p><strong>4. Use descriptive prefixes</strong>: <code>create_*</code> for builders, <code>assert_*</code> for verification helpers, <code>setup_*</code> for initialization</p>
<p><strong>5. Helpers improve readability</strong>: Well-named helpers make tests read like documentation</p>
<p><strong>6. Assertion helpers provide context</strong>: Custom error messages in helpers make failures clearer</p>
<p><strong>7. Don't over-abstract</strong>: If a helper is only used once, it might not be worth extracting</p>
<h2 id="test-discovery-how-pytest-finds-your-tests">Test Discovery: How Pytest Finds Your Tests</h2>
<h2 id="test-discovery-how-pytest-finds-your-tests_1">Test Discovery: How Pytest Finds Your Tests</h2>
<p>When you run <code>pytest</code>, it doesn't just execute every Python file in your project. It follows specific rules to discover which files contain tests, which functions are tests, and which classes contain test methods. Understanding these rules is essential for organizing your test suite effectively.</p>
<p>Let's explore test discovery through our authentication system, progressively building a realistic project structure.</p>
<h3 id="the-reference-problem-organizing-a-growing-test-suite">The Reference Problem: Organizing a Growing Test Suite</h3>
<p>Our authentication system is expanding. We now have:
- User authentication
- Permission management
- Session handling
- Password validation</p>
<p>We need to organize these tests so pytest can find them all automatically.</p>
<h3 id="iteration-0-a-single-test-file">Iteration 0: A Single Test File</h3>
<p>Let's start with the simplest case‚Äîa single test file in the same directory as our code.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>auth.py
‚îî‚îÄ‚îÄ<span class="w"> </span>test_auth.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<p>Run pytest from the project directory:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>my_project
pytest
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 1 item

test_auth.py .                                                         [100%]

========================== 1 passed in 0.01s ===========================
</code></pre></div>

<p><strong>What happened</strong>: Pytest automatically found <code>test_auth.py</code> and ran the test function inside it.</p>
<p><strong>Current limitation</strong>: As our project grows, mixing test files with source code becomes messy. We need a better organization strategy.</p>
<h3 id="iteration-1-creating-a-tests-directory">Iteration 1: Creating a Tests Directory</h3>
<p>Let's separate tests from source code by creating a dedicated <code>tests/</code> directory.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># New project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>auth.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_auth.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_auth.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>  <span class="c1"># Temporary hack to import auth</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<p>Run pytest from the project root:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>my_project
pytest
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 1 item

tests/test_auth.py .                                                   [100%]

========================== 1 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Pytest found the test in the <code>tests/</code> directory automatically. But notice we had to add a hack (<code>sys.path.insert</code>) to import our code. This is not ideal.</p>
<p><strong>Current limitation</strong>: The import hack is fragile and doesn't scale. We need a proper project structure.</p>
<h3 id="iteration-2-proper-package-structure">Iteration 2: Proper Package Structure</h3>
<p>Let's create a proper Python package structure.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Proper project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>auth.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_auth.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># src/myapp/__init__.py</span>
<span class="c1"># Empty file to make myapp a package</span>

<span class="c1"># src/myapp/auth.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">users_db</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">users_db</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">stored_password</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">users_db</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">stored_password</span> <span class="o">!=</span> <span class="n">password</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">profile</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/__init__.py</span>
<span class="c1"># Empty file to make tests a package</span>

<span class="c1"># tests/test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<p>Install the package in development mode:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>my_project
pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>src/
</code></pre></div>

<p>Run pytest:</p>
<div class="codehilite"><pre><span></span><code>pytest
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 1 item

tests/test_auth.py .                                                   [100%]

========================== 1 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Now we can import our code cleanly without path hacks. The package structure is professional and maintainable.</p>
<p><strong>Current limitation</strong>: We only have one test file. As we add more tests, we need to understand exactly how pytest discovers them.</p>
<h3 id="iteration-3-understanding-discovery-rules">Iteration 3: Understanding Discovery Rules</h3>
<p>Let's create multiple test files and see which ones pytest finds.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Expanded project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth.py
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>permissions.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_auth.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_permissions.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth_test.py<span class="w">          </span><span class="c1"># Wrong naming!</span>
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_helpers.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_permissions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_permission</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_admin_has_all_permissions</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">check_permission</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_user_has_limited_permissions</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">check_permission</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth_test.py (wrong naming!)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_something</span><span class="p">():</span>
    <span class="c1"># This test won&#39;t be discovered!</span>
    <span class="k">assert</span> <span class="kc">True</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_helpers.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_test_user</span><span class="p">():</span>
    <span class="c1"># Not a test - doesn&#39;t start with test_</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_user_creation</span><span class="p">():</span>
    <span class="c1"># This IS a test</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">create_test_user</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;alice&quot;</span> <span class="ow">in</span> <span class="n">user</span>
</code></pre></div>

<p>Run pytest with verbose output to see what it discovers:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--collect-only
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 5 items

&lt;Module tests/test_auth.py&gt;
  &lt;Function test_valid_credentials&gt;
  &lt;Function test_invalid_password&gt;
&lt;Module tests/test_permissions.py&gt;
  &lt;Function test_admin_has_all_permissions&gt;
  &lt;Function test_user_has_limited_permissions&gt;
&lt;Module tests/test_helpers.py&gt;
  &lt;Function test_user_creation&gt;

==================== 5 tests collected in 0.01s ========================
</code></pre></div>

<h3 id="diagnostic-analysis-what-pytest-found-and-didnt-find">Diagnostic Analysis: What Pytest Found (and Didn't Find)</h3>
<p><strong>What pytest discovered</strong>:
1. <code>tests/test_auth.py</code> - ‚úì Starts with <code>test_</code>
   - <code>test_valid_credentials</code> - ‚úì Starts with <code>test_</code>
   - <code>test_invalid_password</code> - ‚úì Starts with <code>test_</code></p>
<ol>
<li><code>tests/test_permissions.py</code> - ‚úì Starts with <code>test_</code></li>
<li><code>test_admin_has_all_permissions</code> - ‚úì Starts with <code>test_</code></li>
<li>
<p><code>test_user_has_limited_permissions</code> - ‚úì Starts with <code>test_</code></p>
</li>
<li>
<p><code>tests/test_helpers.py</code> - ‚úì Starts with <code>test_</code></p>
</li>
<li><code>create_test_user</code> - ‚úó Doesn't start with <code>test_</code> (correctly ignored as helper)</li>
<li><code>test_user_creation</code> - ‚úì Starts with <code>test_</code></li>
</ol>
<p><strong>What pytest did NOT discover</strong>:
- <code>tests/auth_test.py</code> - ‚úó Doesn't start with <code>test_</code> or end with <code>_test.py</code></p>
<p><strong>Root cause identified</strong>: Pytest follows specific naming conventions. Files must start with <code>test_</code> or end with <code>_test.py</code>. Functions must start with <code>test_</code>.</p>
<p><strong>Key insight</strong>: The <code>--collect-only</code> flag is invaluable for debugging test discovery. It shows you exactly what pytest found without running any tests.</p>
<h3 id="iteration-4-configuring-discovery-patterns">Iteration 4: Configuring Discovery Patterns</h3>
<p>What if you have a different naming convention? You can configure pytest to recognize your patterns.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Project structure with custom naming</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>auth.py
‚îú‚îÄ‚îÄ<span class="w"> </span>tests/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_auth.py
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>auth_test.py
‚îî‚îÄ‚îÄ<span class="w"> </span>pytest.ini
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">python_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">test_*.py *_test.py</span>
<span class="na">python_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Test* *Tests</span>
<span class="na">python_functions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">test_* check_*</span>
</code></pre></div>

<p>Now run collection again:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--collect-only
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 6 items

&lt;Module tests/test_auth.py&gt;
  &lt;Function test_valid_credentials&gt;
  &lt;Function test_invalid_password&gt;
&lt;Module tests/auth_test.py&gt;
  &lt;Function test_something&gt;
&lt;Module tests/test_permissions.py&gt;
  &lt;Function test_admin_has_all_permissions&gt;
  &lt;Function test_user_has_limited_permissions&gt;
&lt;Module tests/test_helpers.py&gt;
  &lt;Function test_user_creation&gt;

==================== 6 tests collected in 0.01s ========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Now <code>auth_test.py</code> is discovered because we configured pytest to recognize the <code>*_test.py</code> pattern.</p>
<p><strong>Configuration options explained</strong>:
- <code>python_files</code>: Patterns for test file names
- <code>python_classes</code>: Patterns for test class names (we'll cover classes in Chapter 10)
- <code>python_functions</code>: Patterns for test function names</p>
<p><strong>Current limitation</strong>: We're discovering tests, but what about organizing them into subdirectories?</p>
<h3 id="iteration-5-organizing-tests-in-subdirectories">Iteration 5: Organizing Tests in Subdirectories</h3>
<p>As your test suite grows, you'll want to organize tests into subdirectories that mirror your source code structure.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Organized project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
‚îÇ<span class="w">       </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>authentication.py
‚îÇ<span class="w">       </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>permissions.py
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>sessions/
‚îÇ<span class="w">           </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">           </span>‚îî‚îÄ‚îÄ<span class="w"> </span>manager.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_authentication.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_permissions.py
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>sessions/
<span class="w">        </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">        </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_manager.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_authentication.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_permissions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_permission</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_admin_permissions</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">check_permission</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/sessions/test_manager.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.sessions.manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_session</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_session_creation</span><span class="p">():</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;alice&quot;</span>
</code></pre></div>

<p>Run pytest with verbose output:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 3 items

tests/auth/test_authentication.py::test_valid_credentials PASSED       [ 33%]
tests/auth/test_permissions.py::test_admin_permissions PASSED          [ 66%]
tests/sessions/test_manager.py::test_session_creation PASSED           [100%]

========================== 3 passed in 0.02s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Pytest recursively discovers tests in subdirectories. The test paths in the output show the directory structure, making it easy to locate tests.</p>
<p><strong>Key insight</strong>: Pytest automatically traverses subdirectories looking for test files. You don't need to configure anything‚Äîjust follow the naming conventions.</p>
<h3 id="iteration-6-understanding-what-pytest-ignores">Iteration 6: Understanding What Pytest Ignores</h3>
<p>Pytest doesn't search everywhere. Let's see what it ignores by default.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Project structure with various directories</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>auth.py
‚îú‚îÄ‚îÄ<span class="w"> </span>tests/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_auth.py
‚îú‚îÄ‚îÄ<span class="w"> </span>.git/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_something.py<span class="w">      </span><span class="c1"># Ignored - hidden directory</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>node_modules/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_something.py<span class="w">      </span><span class="c1"># Ignored - common dependency dir</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>venv/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_something.py<span class="w">      </span><span class="c1"># Ignored - virtual environment</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>build/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_something.py<span class="w">      </span><span class="c1"># Ignored - build directory</span>
‚îî‚îÄ‚îÄ<span class="w"> </span>__pycache__/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_something.py<span class="w">      </span><span class="c1"># Ignored - Python cache</span>
</code></pre></div>

<p>Run pytest with verbose collection:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--collect-only<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 1 item

&lt;Module tests/test_auth.py&gt;
  &lt;Function test_valid_credentials&gt;

==================== 1 test collected in 0.01s =========================
</code></pre></div>

<p><strong>What pytest ignored</strong>:
- <code>.git/</code> - Hidden directories (start with <code>.</code>)
- <code>node_modules/</code> - Common dependency directories
- <code>venv/</code> - Virtual environment directories
- <code>build/</code> - Build output directories
- <code>__pycache__/</code> - Python cache directories</p>
<p><strong>Why this matters</strong>: Pytest is smart about not searching in directories that typically don't contain tests. This makes discovery fast even in large projects.</p>
<p><strong>You can customize this</strong> in <code>pytest.ini</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">norecursedirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">.git node_modules venv build dist *.egg-info</span>
</code></pre></div>

<h3 id="common-discovery-patterns-summary">Common Discovery Patterns Summary</h3>
<p><strong>Default file patterns</strong>:
- <code>test_*.py</code> - Files starting with <code>test_</code>
- <code>*_test.py</code> - Files ending with <code>_test.py</code></p>
<p><strong>Default function patterns</strong>:
- <code>test_*</code> - Functions starting with <code>test_</code></p>
<p><strong>Default class patterns</strong> (covered in Chapter 10):
- <code>Test*</code> - Classes starting with <code>Test</code></p>
<p><strong>Directories pytest searches</strong>:
- Current directory and all subdirectories
- Excludes hidden directories (<code>.something</code>)
- Excludes common dependency/build directories</p>
<p><strong>Directories pytest ignores by default</strong>:
- <code>.git</code>, <code>.tox</code>, <code>.nox</code>, <code>.pytest_cache</code>
- <code>node_modules</code>, <code>venv</code>, <code>env</code>, <code>virtualenv</code>
- <code>build</code>, <code>dist</code>, <code>*.egg-info</code>
- <code>__pycache__</code></p>
<h3 id="debugging-discovery-issues">Debugging Discovery Issues</h3>
<p>When pytest doesn't find your tests, use these commands:</p>
<p><strong>See what pytest collected</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--collect-only
</code></pre></div>

<p><strong>See verbose collection information</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--collect-only<span class="w"> </span>-v
</code></pre></div>

<p><strong>See why pytest is ignoring certain paths</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--collect-only<span class="w"> </span>-v<span class="w"> </span>--debug
</code></pre></div>

<p><strong>Check your configuration</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--version<span class="w"> </span>-v
</code></pre></div>

<p>This shows where pytest is reading configuration from.</p>
<h3 id="the-journey-from-single-file-to-organized-suite">The Journey: From Single File to Organized Suite</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Structure</th>
<th>Discovery Method</th>
<th>Key Learning</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Single test file</td>
<td>Automatic in current directory</td>
<td>Pytest finds <code>test_*.py</code> automatically</td>
</tr>
<tr>
<td>1</td>
<td>Tests directory</td>
<td>Automatic recursive search</td>
<td>Pytest searches subdirectories</td>
</tr>
<tr>
<td>2</td>
<td>Package structure</td>
<td>Import from installed package</td>
<td>Proper structure enables clean imports</td>
</tr>
<tr>
<td>3</td>
<td>Multiple test files</td>
<td>Pattern matching</td>
<td>File and function names must match patterns</td>
</tr>
<tr>
<td>4</td>
<td>Custom naming</td>
<td>Configuration in pytest.ini</td>
<td>Discovery patterns are configurable</td>
</tr>
<tr>
<td>5</td>
<td>Subdirectory organization</td>
<td>Recursive discovery</td>
<td>Mirror source structure in tests</td>
</tr>
<tr>
<td>6</td>
<td>Understanding ignored paths</td>
<td>Default exclusion patterns</td>
<td>Pytest skips common non-test directories</td>
</tr>
</tbody>
</table>
<h3 id="lessons-learned_2">Lessons Learned</h3>
<p><strong>1. Naming is discovery</strong>: Files and functions must match pytest's patterns to be discovered</p>
<p><strong>2. Use <code>--collect-only</code></strong>: This flag is your best friend for debugging discovery issues</p>
<p><strong>3. Mirror your source structure</strong>: Organize tests to match your source code layout</p>
<p><strong>4. Leverage automatic discovery</strong>: Don't fight pytest's conventions‚Äîembrace them</p>
<p><strong>5. Configure when needed</strong>: Use <code>pytest.ini</code> to customize discovery patterns for your project</p>
<p><strong>6. Pytest is smart about exclusions</strong>: It automatically skips directories that typically don't contain tests</p>
<p><strong>7. Package structure matters</strong>: Proper Python packaging makes imports clean and reliable</p>
<h2 id="naming-conventions-that-matter">Naming Conventions That Matter</h2>
<h2 id="naming-conventions-that-matter_1">Naming Conventions That Matter</h2>
<p>Test names are not just labels‚Äîthey're documentation. A well-named test tells you what it tests, what conditions it assumes, and what outcome it expects. A poorly named test forces you to read the code to understand its purpose.</p>
<p>In this section, we'll explore naming conventions through our authentication system, discovering how names impact test readability, maintainability, and debugging.</p>
<h3 id="the-reference-problem-naming-tests-for-clarity">The Reference Problem: Naming Tests for Clarity</h3>
<p>Our authentication system has grown complex. We need to test:
- Valid credentials with various user types
- Invalid credentials in different ways
- Edge cases like empty passwords, special characters
- Error conditions like missing users, database failures</p>
<p>Let's discover how naming conventions help us organize and understand these tests.</p>
<h3 id="iteration-0-generic-names">Iteration 0: Generic Names</h3>
<p>Let's start with poorly named tests and see what problems emerge.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_auth</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_auth2</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_auth3</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_auth PASSED                                          [ 33%]
test_auth.py::test_auth2 PASSED                                         [ 66%]
test_auth.py::test_auth3 PASSED                                         [100%]

========================== 3 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Current limitation</strong>: The test names tell us nothing. What does <code>test_auth2</code> test? What's the difference between <code>test_auth</code> and <code>test_auth3</code>? We have to read the code to understand.</p>
<p>Now let's intentionally break one test to see how the name affects debugging:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py (with bug)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_auth2</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># Bug: should be None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_auth PASSED                                          [ 33%]
test_auth.py::test_auth2 FAILED                                         [ 66%]
test_auth.py::test_auth3 PASSED                                         [100%]

=========================== FAILURES ====================================
__________________________ test_auth2 ___________________________________

    def test_auth2():
        users = {&quot;alice&quot;: (&quot;secret123&quot;, {&quot;id&quot;: 1})}
        result = authenticate_user(&quot;alice&quot;, &quot;wrong&quot;, users)
&gt;       assert result is not None
E       assert None is not None

test_auth.py:11: AssertionError
======================== short test summary info ========================
FAILED test_auth.py::test_auth2 - assert None is not None
===================== 1 failed, 2 passed in 0.03s =======================
</code></pre></div>

<h3 id="diagnostic-analysis-the-cost-of-poor-names">Diagnostic Analysis: The Cost of Poor Names</h3>
<p><strong>The failure message</strong>: <code>FAILED test_auth.py::test_auth2 - assert None is not None</code></p>
<p><strong>What we know</strong>:
- A test named <code>test_auth2</code> failed
- The assertion <code>assert None is not None</code> failed</p>
<p><strong>What we don't know</strong>:
- What scenario was being tested?
- What was the expected behavior?
- Is this testing valid or invalid credentials?
- What user was involved?</p>
<p><strong>Root cause of confusion</strong>: The name <code>test_auth2</code> provides zero context. We must read the test code to understand what failed.</p>
<p><strong>What we need</strong>: Descriptive names that document the test's purpose.</p>
<h3 id="iteration-1-descriptive-names">Iteration 1: Descriptive Names</h3>
<p>Let's rename our tests to describe what they actually test.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_invalid_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_nonexistent_username</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_authenticate_user_with_valid_credentials PASSED      [ 33%]
test_auth.py::test_authenticate_user_with_invalid_password PASSED       [ 66%]
test_auth.py::test_authenticate_user_with_nonexistent_username PASSED   [100%]

========================== 3 passed in 0.01s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Now the test names tell a story. We can see at a glance:
- What function is being tested (<code>authenticate_user</code>)
- What scenario is being tested (<code>with_valid_credentials</code>, <code>with_invalid_password</code>)
- What the expected outcome is (implied by the scenario)</p>
<p>Let's introduce the same bug and see how the name helps:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py (with bug)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_invalid_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># Bug: should be None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_authenticate_user_with_valid_credentials PASSED      [ 33%]
test_auth.py::test_authenticate_user_with_invalid_password FAILED       [ 66%]
test_auth.py::test_authenticate_user_with_nonexistent_username PASSED   [100%]

=========================== FAILURES ====================================
__________ test_authenticate_user_with_invalid_password _________________

    def test_authenticate_user_with_invalid_password():
        users = {&quot;alice&quot;: (&quot;secret123&quot;, {&quot;id&quot;: 1})}
        result = authenticate_user(&quot;alice&quot;, &quot;wrong&quot;, users)
&gt;       assert result is not None
E       assert None is not None

test_auth.py:11: AssertionError
======================== short test summary info ========================
FAILED test_auth.py::test_authenticate_user_with_invalid_password
===================== 1 failed, 2 passed in 0.03s =======================
</code></pre></div>

<h3 id="diagnostic-analysis-the-value-of-descriptive-names">Diagnostic Analysis: The Value of Descriptive Names</h3>
<p><strong>The failure message</strong>: <code>FAILED test_auth.py::test_authenticate_user_with_invalid_password</code></p>
<p><strong>What we now know immediately</strong>:
- The test is about authenticating a user
- The scenario involves an invalid password
- The test failed, meaning authentication didn't behave as expected for invalid passwords</p>
<p><strong>Root cause is clearer</strong>: The name tells us this test is specifically about invalid passwords. We can immediately hypothesize that either:
1. The test expectation is wrong, or
2. The authentication function isn't properly rejecting invalid passwords</p>
<p><strong>Key insight</strong>: A descriptive name acts as inline documentation. When a test fails in CI, you can often diagnose the issue from the name alone, without reading the code.</p>
<h3 id="iteration-2-naming-patterns-for-different-scenarios">Iteration 2: Naming Patterns for Different Scenarios</h3>
<p>Let's expand our test suite to cover more scenarios and establish naming patterns.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="c1"># Pattern: test_&lt;function&gt;_&lt;scenario&gt;_&lt;expected_outcome&gt;</span>

<span class="c1"># Valid scenarios</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials_returns_profile</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_admin_credentials_returns_admin_profile</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;admin&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;admin123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">999</span><span class="p">,</span> <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;admin123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;admin&quot;</span>

<span class="c1"># Invalid scenarios</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_invalid_password_returns_none</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_nonexistent_user_returns_none</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="c1"># Edge cases</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_empty_password_returns_none</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_empty_username_returns_none</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_case_sensitive_password_returns_none</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;SECRET123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_authenticate_user_with_valid_credentials_returns_profile PASSED [ 14%]
test_auth.py::test_authenticate_user_with_admin_credentials_returns_admin_profile PASSED [ 28%]
test_auth.py::test_authenticate_user_with_invalid_password_returns_none PASSED [ 42%]
test_auth.py::test_authenticate_user_with_nonexistent_user_returns_none PASSED [ 57%]
test_auth.py::test_authenticate_user_with_empty_password_returns_none PASSED [ 71%]
test_auth.py::test_authenticate_user_with_empty_username_returns_none PASSED [ 85%]
test_auth.py::test_authenticate_user_with_case_sensitive_password_returns_none PASSED [100%]

========================== 7 passed in 0.02s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: The test names now form a specification. Reading the test list tells you:
- What the function does
- What scenarios it handles
- What the expected behavior is in each case</p>
<p><strong>Naming pattern established</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_&lt;function_name&gt;_&lt;scenario_description&gt;_&lt;expected_outcome&gt;
</code></pre></div>

<p><strong>Current limitation</strong>: These names are getting long. Is there a balance between descriptiveness and brevity?</p>
<h3 id="iteration-3-balancing-descriptiveness-and-brevity">Iteration 3: Balancing Descriptiveness and Brevity</h3>
<p>Long names are good for clarity, but they can become unwieldy. Let's explore when to abbreviate and when to be verbose.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py</span>

<span class="c1"># Too verbose - the outcome is implied by the scenario</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials_returns_profile_successfully</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="c1"># Better - outcome is clear from context</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="c1"># Too brief - what&#39;s being tested?</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="c1"># Better - specific about what&#39;s invalid</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="c1"># Good balance - clear scenario, implied outcome</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_empty_password</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
</code></pre></div>

<p><strong>Guidelines for balancing length</strong>:</p>
<ol>
<li><strong>Always include the function name</strong> (unless it's obvious from the file name)</li>
<li><strong>Always include the scenario</strong> (what conditions are being tested)</li>
<li><strong>Include the outcome</strong> only if it's not obvious from the scenario</li>
<li><strong>Use action verbs</strong> for clarity: <code>rejects</code>, <code>accepts</code>, <code>returns</code>, <code>raises</code></li>
</ol>
<p><strong>Examples of good balance</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Clear and concise</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_nonexistent_user</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># When outcome needs emphasis</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_returns_full_profile</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_raises_error_on_database_failure</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<h3 id="iteration-4-naming-for-different-test-types">Iteration 4: Naming for Different Test Types</h3>
<p>Different types of tests benefit from different naming patterns. Let's explore patterns for various test categories.</p>
<p><strong>Unit tests</strong> (testing a single function):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Pattern: test_&lt;function&gt;_&lt;scenario&gt;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p><strong>Integration tests</strong> (testing multiple components):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Pattern: test_&lt;workflow&gt;_&lt;scenario&gt;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_login_workflow_with_valid_credentials</span><span class="p">():</span>
    <span class="c1"># Tests authentication + session creation + redirect</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_login_workflow_with_invalid_credentials</span><span class="p">():</span>
    <span class="c1"># Tests authentication failure + error message + no session</span>
    <span class="k">pass</span>
</code></pre></div>

<p><strong>Edge case tests</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Pattern: test_&lt;function&gt;_&lt;edge_case&gt;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_unicode_password</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_very_long_username</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_sql_injection_attempt</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p><strong>Error condition tests</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Pattern: test_&lt;function&gt;_raises_&lt;error&gt;_when_&lt;condition&gt;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_raises_value_error_when_username_is_none</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_raises_database_error_when_connection_fails</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p><strong>Performance tests</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Pattern: test_&lt;function&gt;_&lt;performance_aspect&gt;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_completes_within_100ms</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_handles_1000_concurrent_requests</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<h3 id="iteration-5-using-test-names-for-documentation">Iteration 5: Using Test Names for Documentation</h3>
<p>Test names can serve as living documentation. Let's see how well-named tests document behavior.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_auth.py - Authentication Behavior Documentation</span>

<span class="c1"># Basic authentication</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Valid username and password return user profile.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Invalid password returns None.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_nonexistent_user</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Non-existent username returns None.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c1"># Password requirements</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_empty_password</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Empty password is not allowed.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_accepts_password_with_special_characters</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Passwords can contain special characters.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_password_is_case_sensitive</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Password matching is case-sensitive.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c1"># Username requirements</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_empty_username</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Empty username is not allowed.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_username_is_case_sensitive</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Username matching is case-sensitive.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c1"># Security</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_prevents_timing_attacks</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Authentication timing is constant regardless of username validity.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_does_not_leak_user_existence</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error messages don&#39;t reveal whether username exists.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Run pytest with verbose output:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_auth.py::test_authenticate_user_with_valid_credentials PASSED
test_auth.py::test_authenticate_user_rejects_invalid_password PASSED
test_auth.py::test_authenticate_user_rejects_nonexistent_user PASSED
test_auth.py::test_authenticate_user_rejects_empty_password PASSED
test_auth.py::test_authenticate_user_accepts_password_with_special_characters PASSED
test_auth.py::test_authenticate_user_password_is_case_sensitive PASSED
test_auth.py::test_authenticate_user_rejects_empty_username PASSED
test_auth.py::test_authenticate_user_username_is_case_sensitive PASSED
test_auth.py::test_authenticate_user_prevents_timing_attacks PASSED
test_auth.py::test_authenticate_user_does_not_leak_user_existence PASSED

========================== 10 passed in 0.03s ==========================
</code></pre></div>

<p><strong>Key insight</strong>: Reading the test names is like reading a specification. A new developer can understand the authentication requirements without reading any code.</p>
<h3 id="common-naming-anti-patterns-to-avoid">Common Naming Anti-Patterns to Avoid</h3>
<p><strong>Anti-pattern 1: Numbered tests</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Bad</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_auth1</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_auth2</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># Good</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p><strong>Anti-pattern 2: Vague names</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Bad</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_works</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_fails</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># Good</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_succeeds_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_fails_with_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p><strong>Anti-pattern 3: Implementation details in names</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Bad - tied to implementation</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_queries_database_and_compares_hashes</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># Good - describes behavior</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_verifies_password_against_stored_credentials</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p><strong>Anti-pattern 4: Testing multiple things</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Bad - tests multiple scenarios</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authentication_and_permissions_and_sessions</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># Good - separate tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_check_user_permissions_after_authentication</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_create_session_after_successful_authentication</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<h3 id="naming-conventions-summary">Naming Conventions Summary</h3>
<p><strong>General pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_&lt;function_name&gt;_&lt;scenario&gt;_&lt;optional_outcome&gt;
</code></pre></div>

<p><strong>Action verbs to use</strong>:
- <code>accepts</code>, <code>rejects</code> - For validation
- <code>returns</code>, <code>raises</code> - For outcomes
- <code>handles</code>, <code>processes</code> - For operations
- <code>prevents</code>, <code>allows</code> - For security/permissions
- <code>creates</code>, <code>updates</code>, <code>deletes</code> - For CRUD operations</p>
<p><strong>Scenario descriptors</strong>:
- <code>with_valid_&lt;thing&gt;</code> - Valid input
- <code>with_invalid_&lt;thing&gt;</code> - Invalid input
- <code>with_empty_&lt;thing&gt;</code> - Empty/null input
- <code>with_missing_&lt;thing&gt;</code> - Absent input
- <code>when_&lt;condition&gt;</code> - Conditional scenarios</p>
<p><strong>Outcome descriptors</strong> (when needed):
- <code>returns_&lt;value&gt;</code> - Specific return value
- <code>raises_&lt;error&gt;</code> - Exception raised
- <code>succeeds</code> - Successful operation
- <code>fails</code> - Failed operation</p>
<h3 id="the-journey-from-generic-to-descriptive">The Journey: From Generic to Descriptive</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Naming Approach</th>
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Generic names</td>
<td>No context, hard to debug</td>
<td>Use descriptive names</td>
</tr>
<tr>
<td>1</td>
<td>Descriptive names</td>
<td>Clear but potentially verbose</td>
<td>Establish naming patterns</td>
</tr>
<tr>
<td>2</td>
<td>Naming patterns</td>
<td>Need to cover different scenarios</td>
<td>Pattern: function_scenario_outcome</td>
</tr>
<tr>
<td>3</td>
<td>Balancing length</td>
<td>Names getting too long</td>
<td>Include function and scenario, outcome optional</td>
</tr>
<tr>
<td>4</td>
<td>Different test types</td>
<td>One pattern doesn't fit all</td>
<td>Adapt pattern to test type</td>
</tr>
<tr>
<td>5</td>
<td>Documentation value</td>
<td>Tests as specification</td>
<td>Names document behavior</td>
</tr>
</tbody>
</table>
<h3 id="lessons-learned_3">Lessons Learned</h3>
<p><strong>1. Names are documentation</strong>: A well-named test tells you what it tests without reading the code</p>
<p><strong>2. Be specific about scenarios</strong>: "invalid password" is better than "invalid input"</p>
<p><strong>3. Use action verbs</strong>: "rejects", "accepts", "returns" make behavior clear</p>
<p><strong>4. Balance length and clarity</strong>: Include function and scenario, outcome only when needed</p>
<p><strong>5. Adapt to test type</strong>: Unit tests, integration tests, and edge cases benefit from different patterns</p>
<p><strong>6. Avoid implementation details</strong>: Name tests by behavior, not by how they work internally</p>
<p><strong>7. Test names are specifications</strong>: Reading test names should reveal the system's requirements</p>
<p><strong>8. Consistency matters</strong>: Use the same patterns across your test suite for predictability</p>
<h2 id="organizing-tests-in-your-project">Organizing Tests in Your Project</h2>
<h2 id="organizing-tests-in-your-project_1">Organizing Tests in Your Project</h2>
<p>As your test suite grows from a handful of tests to hundreds or thousands, organization becomes critical. A well-organized test suite is easy to navigate, maintain, and run selectively. A poorly organized one becomes a maintenance burden that slows development.</p>
<p>Let's explore test organization through our authentication system as it scales from a simple module to a complex application.</p>
<h3 id="the-reference-problem-scaling-from-simple-to-complex">The Reference Problem: Scaling from Simple to Complex</h3>
<p>Our authentication system has evolved into a full application with:
- User authentication (login, logout, password reset)
- Authorization (permissions, roles, access control)
- Session management (creation, validation, expiration)
- User management (registration, profile updates, deletion)</p>
<p>We need to organize hundreds of tests so they're easy to find, run, and maintain.</p>
<h3 id="iteration-0-everything-in-one-file">Iteration 0: Everything in One File</h3>
<p>Let's start with the naive approach‚Äîall tests in a single file.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>permissions.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>sessions.py
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>users.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_everything.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_everything.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span><span class="p">,</span> <span class="n">logout_user</span><span class="p">,</span> <span class="n">reset_password</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_permission</span><span class="p">,</span> <span class="n">grant_permission</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.sessions</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_session</span><span class="p">,</span> <span class="n">validate_session</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.users</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_user</span><span class="p">,</span> <span class="n">update_profile</span><span class="p">,</span> <span class="n">delete_user</span>

<span class="c1"># Authentication tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_logout_user_invalidates_session</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_reset_password_sends_email</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># Permission tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_check_permission_for_admin</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_check_permission_for_regular_user</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_grant_permission_to_user</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># Session tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_create_session_for_authenticated_user</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_session_with_valid_token</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_session_rejects_expired_token</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># User management tests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_register_user_with_valid_data</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_register_user_rejects_duplicate_email</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_update_profile_changes_email</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_delete_user_removes_all_data</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># ... 50 more tests ...</span>
</code></pre></div>

<p>Run the tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/test_everything.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong> (truncated):</p>
<div class="codehilite"><pre><span></span><code>tests/test_everything.py::test_authenticate_user_with_valid_credentials PASSED
tests/test_everything.py::test_authenticate_user_rejects_invalid_password PASSED
tests/test_everything.py::test_logout_user_invalidates_session PASSED
...
tests/test_everything.py::test_delete_user_removes_all_data PASSED

========================== 14 passed in 0.05s ==========================
</code></pre></div>

<p><strong>Current limitation</strong>: This file is becoming unwieldy. Problems:
1. Hard to find specific tests (must scroll through hundreds of lines)
2. Can't run just authentication tests without running everything
3. Merge conflicts when multiple developers edit the same file
4. No clear organization‚Äîtests are just listed sequentially</p>
<p><strong>What we need</strong>: A way to group related tests into separate files.</p>
<h3 id="iteration-1-splitting-by-module">Iteration 1: Splitting by Module</h3>
<p>Let's organize tests to mirror our source code structure.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Organized project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>permissions.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>sessions.py
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>users.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_auth.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_permissions.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_sessions.py
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_users.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_auth.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span><span class="p">,</span> <span class="n">logout_user</span><span class="p">,</span> <span class="n">reset_password</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_logout_user_invalidates_session</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_reset_password_sends_email</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_permissions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_permission</span><span class="p">,</span> <span class="n">grant_permission</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_check_permission_for_admin</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_check_permission_for_regular_user</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_grant_permission_to_user</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_sessions.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.sessions</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_session</span><span class="p">,</span> <span class="n">validate_session</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_create_session_for_authenticated_user</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_session_with_valid_token</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_session_rejects_expired_token</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/test_users.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.users</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_user</span><span class="p">,</span> <span class="n">update_profile</span><span class="p">,</span> <span class="n">delete_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_register_user_with_valid_data</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_register_user_rejects_duplicate_email</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_update_profile_changes_email</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_delete_user_removes_all_data</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Run all tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>tests/test_auth.py::test_authenticate_user_with_valid_credentials PASSED
tests/test_auth.py::test_authenticate_user_rejects_invalid_password PASSED
tests/test_auth.py::test_logout_user_invalidates_session PASSED
tests/test_auth.py::test_reset_password_sends_email PASSED
tests/test_permissions.py::test_check_permission_for_admin PASSED
tests/test_permissions.py::test_check_permission_for_regular_user PASSED
tests/test_permissions.py::test_grant_permission_to_user PASSED
tests/test_sessions.py::test_create_session_for_authenticated_user PASSED
tests/test_sessions.py::test_validate_session_with_valid_token PASSED
tests/test_sessions.py::test_validate_session_rejects_expired_token PASSED
tests/test_users.py::test_register_user_with_valid_data PASSED
tests/test_users.py::test_register_user_rejects_duplicate_email PASSED
tests/test_users.py::test_update_profile_changes_email PASSED
tests/test_users.py::test_delete_user_removes_all_data PASSED

========================== 14 passed in 0.05s ==========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Tests are now organized by module. We can:
- Find authentication tests in <code>test_auth.py</code>
- Run only authentication tests: <code>pytest tests/test_auth.py</code>
- See which module a test belongs to from the output</p>
<p>Now let's run just the authentication tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/test_auth.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>tests/test_auth.py::test_authenticate_user_with_valid_credentials PASSED
tests/test_auth.py::test_authenticate_user_rejects_invalid_password PASSED
tests/test_auth.py::test_logout_user_invalidates_session PASSED
tests/test_auth.py::test_reset_password_sends_email PASSED

========================== 4 passed in 0.02s ==========================
</code></pre></div>

<p><strong>Key insight</strong>: Organizing tests by module makes selective test execution trivial. This is crucial for fast development cycles‚Äîyou can run just the tests relevant to your current work.</p>
<p><strong>Current limitation</strong>: Each test file is still growing large. What if <code>test_auth.py</code> has 50 tests covering different aspects of authentication?</p>
<h3 id="iteration-2-organizing-by-feature-within-modules">Iteration 2: Organizing by Feature Within Modules</h3>
<p>Let's further organize tests by creating subdirectories for complex modules.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Hierarchical project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
‚îÇ<span class="w">       </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
‚îÇ<span class="w">       </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>authentication.py
‚îÇ<span class="w">       </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>password_reset.py
‚îÇ<span class="w">       </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>logout.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>permissions.py
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>sessions.py
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>users.py
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_authentication.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_password_reset.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_logout.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_permissions.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_sessions.py
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_users.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_authentication.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span><span class="p">,</span> <span class="n">verify_credentials</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_nonexistent_user</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_verify_credentials_with_hashed_password</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_password_reset.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.password_reset</span><span class="w"> </span><span class="kn">import</span> <span class="n">request_reset</span><span class="p">,</span> <span class="n">validate_reset_token</span><span class="p">,</span> <span class="n">reset_password</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_request_reset_sends_email</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_request_reset_generates_token</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_reset_token_accepts_valid_token</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_reset_token_rejects_expired_token</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_reset_password_updates_credentials</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_logout.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.logout</span><span class="w"> </span><span class="kn">import</span> <span class="n">logout_user</span><span class="p">,</span> <span class="n">invalidate_all_sessions</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_logout_user_invalidates_current_session</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_logout_user_preserves_other_sessions</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invalidate_all_sessions_removes_all_user_sessions</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Run all tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>tests/auth/test_authentication.py::test_authenticate_user_with_valid_credentials PASSED
tests/auth/test_authentication.py::test_authenticate_user_rejects_invalid_password PASSED
tests/auth/test_authentication.py::test_authenticate_user_rejects_nonexistent_user PASSED
tests/auth/test_authentication.py::test_verify_credentials_with_hashed_password PASSED
tests/auth/test_password_reset.py::test_request_reset_sends_email PASSED
tests/auth/test_password_reset.py::test_request_reset_generates_token PASSED
tests/auth/test_password_reset.py::test_validate_reset_token_accepts_valid_token PASSED
tests/auth/test_password_reset.py::test_validate_reset_token_rejects_expired_token PASSED
tests/auth/test_password_reset.py::test_reset_password_updates_credentials PASSED
tests/auth/test_logout.py::test_logout_user_invalidates_current_session PASSED
tests/auth/test_logout.py::test_logout_user_preserves_other_sessions PASSED
tests/auth/test_logout.py::test_invalidate_all_sessions_removes_all_user_sessions PASSED
tests/test_permissions.py::test_check_permission_for_admin PASSED
tests/test_permissions.py::test_check_permission_for_regular_user PASSED
tests/test_permissions.py::test_grant_permission_to_user PASSED
tests/test_sessions.py::test_create_session_for_authenticated_user PASSED
tests/test_sessions.py::test_validate_session_with_valid_token PASSED
tests/test_sessions.py::test_validate_session_rejects_expired_token PASSED
tests/test_users.py::test_register_user_with_valid_data PASSED
tests/test_users.py::test_register_user_rejects_duplicate_email PASSED
tests/test_users.py::test_update_profile_changes_email PASSED
tests/test_users.py::test_delete_user_removes_all_data PASSED

========================== 22 passed in 0.08s ==========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Now we can run tests at different levels of granularity:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all tests</span>
pytest<span class="w"> </span>tests/

<span class="c1"># Run all auth tests</span>
pytest<span class="w"> </span>tests/auth/

<span class="c1"># Run only authentication tests</span>
pytest<span class="w"> </span>tests/auth/test_authentication.py

<span class="c1"># Run only password reset tests</span>
pytest<span class="w"> </span>tests/auth/test_password_reset.py
</code></pre></div>

<p><strong>Key insight</strong>: Hierarchical organization mirrors your source code structure and enables precise test selection. This is essential for large projects where running the entire suite takes minutes or hours.</p>
<h3 id="iteration-3-organizing-by-test-type">Iteration 3: Organizing by Test Type</h3>
<p>Sometimes you want to organize tests by type rather than by module. Let's add integration tests and performance tests.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Project structure with test types</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>...
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>unit/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_authentication.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_password_reset.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_permissions.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_sessions.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>integration/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_login_workflow.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_registration_workflow.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_password_reset_workflow.py
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>performance/
<span class="w">        </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">        </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_authentication_performance.py
<span class="w">        </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_session_performance.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/unit/auth/test_authentication.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unit test: tests authentication function in isolation.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/integration/test_login_workflow.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.sessions</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_session</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.permissions</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_user_permissions</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_complete_login_workflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integration test: tests authentication + session + permissions.&quot;&quot;&quot;</span>
    <span class="c1"># Authenticate</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">users_db</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="c1"># Create session</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">create_session</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

    <span class="c1"># Load permissions</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">load_user_permissions</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;read&quot;</span> <span class="ow">in</span> <span class="n">permissions</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/performance/test_authentication_performance.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authentication_completes_within_100ms</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performance test: verifies authentication speed.&quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">create_large_user_database</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;user5000&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

    <span class="k">assert</span> <span class="n">duration</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Authentication took </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">s, expected &lt; 0.1s&quot;</span>
</code></pre></div>

<p>Now we can run tests by type:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run only unit tests (fast)</span>
pytest<span class="w"> </span>tests/unit/<span class="w"> </span>-v

<span class="c1"># Run only integration tests (slower)</span>
pytest<span class="w"> </span>tests/integration/<span class="w"> </span>-v

<span class="c1"># Run only performance tests (slowest)</span>
pytest<span class="w"> </span>tests/performance/<span class="w"> </span>-v

<span class="c1"># Run unit and integration tests, skip performance</span>
pytest<span class="w"> </span>tests/unit/<span class="w"> </span>tests/integration/<span class="w"> </span>-v
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Organizing by test type enables:
- Running fast unit tests during development
- Running integration tests before committing
- Running performance tests only in CI or before releases</p>
<p><strong>When to use this organization</strong>:
- When you have tests with significantly different execution times
- When you want to run different test types in different CI stages
- When you have tests that require different environments (e.g., performance tests need production-like hardware)</p>
<h3 id="iteration-4-sharing-test-utilities-with-conftestpy">Iteration 4: Sharing Test Utilities with conftest.py</h3>
<p>As tests grow, you'll need to share fixtures and utilities. Pytest provides <code>conftest.py</code> for this purpose.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Project structure with conftest.py</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>...
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>conftest.py<span class="w">              </span><span class="c1"># Shared across all tests</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>conftest.py<span class="w">          </span><span class="c1"># Shared across auth tests</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_authentication.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_password_reset.py
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_permissions.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/conftest.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sample_users</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fixture available to all tests.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}),</span>
        <span class="s2">&quot;bob&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;password456&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">})</span>
    <span class="p">}</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">admin_user</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fixture for admin user, available to all tests.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;admin123&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">999</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;admin@example.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">]</span>
    <span class="p">})</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/conftest.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">authenticated_session</span><span class="p">(</span><span class="n">sample_users</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fixture available only to auth tests.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">myapp.sessions</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_session</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">sample_users</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">create_session</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_authentication.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">(</span><span class="n">sample_users</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses fixture from tests/conftest.py.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate_user</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">,</span> <span class="n">sample_users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_logout_invalidates_session</span><span class="p">(</span><span class="n">authenticated_session</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses fixture from tests/auth/conftest.py.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">myapp.auth.logout</span><span class="w"> </span><span class="kn">import</span> <span class="n">logout_user</span>
    <span class="n">logout_user</span><span class="p">(</span><span class="n">authenticated_session</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">authenticated_session</span><span class="p">[</span><span class="s2">&quot;valid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span>
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: <code>conftest.py</code> files provide:
- Shared fixtures without explicit imports
- Hierarchical fixture scope (directory-level fixtures)
- Centralized test utilities</p>
<p><strong>Key insight</strong>: Fixtures in <code>conftest.py</code> are automatically discovered and available to tests in the same directory and subdirectories. We'll explore fixtures in depth in Chapter 4.</p>
<h3 id="iteration-5-organizing-for-large-projects">Iteration 5: Organizing for Large Projects</h3>
<p>For very large projects, you might need additional organization strategies.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Large project structure</span>
my_project/
‚îú‚îÄ‚îÄ<span class="w"> </span>src/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>myapp/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>api/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>database/
‚îÇ<span class="w">       </span>‚îú‚îÄ‚îÄ<span class="w"> </span>services/
‚îÇ<span class="w">       </span>‚îî‚îÄ‚îÄ<span class="w"> </span>utils/
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>conftest.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>fixtures/<span class="w">                </span><span class="c1"># Shared test data</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>users.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>sessions.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>permissions.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>helpers/<span class="w">                 </span><span class="c1"># Test utilities</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>__init__.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>assertions.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>builders.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>mocks.py
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>unit/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>conftest.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>api/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>database/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>services/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>utils/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>integration/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>conftest.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_api_workflows.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_auth_workflows.py
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_database_workflows.py
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>e2e/<span class="w">                     </span><span class="c1"># End-to-end tests</span>
<span class="w">        </span>‚îú‚îÄ‚îÄ<span class="w"> </span>conftest.py
<span class="w">        </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_user_registration.py
<span class="w">        </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_user_login.py
<span class="w">        </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_user_profile.py
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/fixtures/users.py</span>
<span class="sd">&quot;&quot;&quot;Shared user fixtures for all tests.&quot;&quot;&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_test_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builder function for test users.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@example.com&quot;</span><span class="p">),</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">)</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_admin_user</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builder function for admin users.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">create_test_user</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/helpers/assertions.py</span>
<span class="sd">&quot;&quot;&quot;Custom assertion helpers.&quot;&quot;&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">assert_valid_user_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify a user profile has all required fields.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">profile</span>
    <span class="k">assert</span> <span class="s2">&quot;email&quot;</span> <span class="ow">in</span> <span class="n">profile</span>
    <span class="k">assert</span> <span class="s2">&quot;username&quot;</span> <span class="ow">in</span> <span class="n">profile</span>
    <span class="k">assert</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">assert_authentication_failed</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify authentication failed as expected.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Expected authentication to fail&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># tests/unit/auth/test_authentication.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tests.fixtures.users</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_test_user</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tests.helpers.assertions</span><span class="w"> </span><span class="kn">import</span> <span class="n">assert_valid_user_profile</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">create_test_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">)</span>
    <span class="c1"># ... test code ...</span>
    <span class="n">assert_valid_user_profile</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: This structure provides:
- Clear separation of test types (unit, integration, e2e)
- Centralized test utilities (fixtures, helpers)
- Scalability for hundreds or thousands of tests</p>
<h3 id="organization-strategies-summary">Organization Strategies Summary</h3>
<p><strong>By module</strong> (mirrors source code):</p>
<div class="codehilite"><pre><span></span><code>tests/
‚îú‚îÄ‚îÄ<span class="w"> </span>test_auth.py
‚îú‚îÄ‚îÄ<span class="w"> </span>test_permissions.py
‚îî‚îÄ‚îÄ<span class="w"> </span>test_sessions.py
</code></pre></div>

<p><strong>By feature</strong> (hierarchical):</p>
<div class="codehilite"><pre><span></span><code>tests/
‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_authentication.py
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_password_reset.py
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_logout.py
‚îú‚îÄ‚îÄ<span class="w"> </span>test_permissions.py
‚îî‚îÄ‚îÄ<span class="w"> </span>test_sessions.py
</code></pre></div>

<p><strong>By test type</strong>:</p>
<div class="codehilite"><pre><span></span><code>tests/
‚îú‚îÄ‚îÄ<span class="w"> </span>unit/
‚îú‚îÄ‚îÄ<span class="w"> </span>integration/
‚îî‚îÄ‚îÄ<span class="w"> </span>performance/
</code></pre></div>

<p><strong>Hybrid approach</strong> (recommended for large projects):</p>
<div class="codehilite"><pre><span></span><code>tests/
‚îú‚îÄ‚îÄ<span class="w"> </span>fixtures/<span class="w">          </span><span class="c1"># Shared test data</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>helpers/<span class="w">           </span><span class="c1"># Test utilities</span>
‚îú‚îÄ‚îÄ<span class="w"> </span>unit/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>permissions/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>sessions/
‚îú‚îÄ‚îÄ<span class="w"> </span>integration/
‚îî‚îÄ‚îÄ<span class="w"> </span>e2e/
</code></pre></div>

<h3 id="best-practices-for-test-organization">Best Practices for Test Organization</h3>
<p><strong>1. Mirror your source structure</strong>: Tests should be easy to find by matching source code organization</p>
<p><strong>2. Use conftest.py for shared fixtures</strong>: Don't duplicate fixture code across test files</p>
<p><strong>3. Separate by test type when execution time varies</strong>: Fast unit tests separate from slow integration tests</p>
<p><strong>4. Keep test files focused</strong>: Each test file should test one module or feature</p>
<p><strong>5. Use subdirectories for complex modules</strong>: Don't let test files grow beyond ~500 lines</p>
<p><strong>6. Create helper modules for common utilities</strong>: Centralize assertion helpers, builders, and mocks</p>
<p><strong>7. Document your organization</strong>: Add a README in your tests directory explaining the structure</p>
<h3 id="the-journey-from-chaos-to-structure">The Journey: From Chaos to Structure</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Organization Approach</th>
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Single file</td>
<td>Hard to navigate, can't run selectively</td>
<td>Split by module</td>
</tr>
<tr>
<td>1</td>
<td>Split by module</td>
<td>Large modules still unwieldy</td>
<td>Create subdirectories for features</td>
</tr>
<tr>
<td>2</td>
<td>Hierarchical by feature</td>
<td>Can't separate fast/slow tests</td>
<td>Organize by test type</td>
</tr>
<tr>
<td>3</td>
<td>Organize by test type</td>
<td>Duplicated fixtures and utilities</td>
<td>Use conftest.py for sharing</td>
</tr>
<tr>
<td>4</td>
<td>Shared utilities</td>
<td>Large projects need more structure</td>
<td>Hybrid approach with fixtures/helpers dirs</td>
</tr>
<tr>
<td>5</td>
<td>Large project structure</td>
<td>Scalable organization</td>
<td>Clear separation of concerns</td>
</tr>
</tbody>
</table>
<h3 id="lessons-learned_4">Lessons Learned</h3>
<p><strong>1. Start simple, evolve as needed</strong>: Begin with one test file per module, add structure as complexity grows</p>
<p><strong>2. Organization enables selective execution</strong>: Good structure lets you run just the tests you need</p>
<p><strong>3. Mirror source code structure</strong>: Tests are easier to find when they match source organization</p>
<p><strong>4. Separate by execution time</strong>: Fast tests in one place, slow tests in another</p>
<p><strong>5. Share fixtures via conftest.py</strong>: Avoid duplication, maintain consistency</p>
<p><strong>6. Create helper modules</strong>: Centralize common test utilities</p>
<p><strong>7. Document your structure</strong>: Help new developers understand your organization</p>
<p><strong>8. Consistency matters</strong>: Use the same patterns across your entire test suite</p>
<h2 id="running-specific-tests">Running Specific Tests</h2>
<h2 id="running-specific-tests_1">Running Specific Tests</h2>
<p>Running your entire test suite every time you make a change is slow and inefficient. Pytest provides powerful mechanisms for running exactly the tests you need‚Äîwhether that's a single test, a group of related tests, or tests matching specific criteria.</p>
<p>Let's explore test selection through our authentication system, discovering how to run tests efficiently during development.</p>
<h3 id="the-reference-problem-selective-test-execution">The Reference Problem: Selective Test Execution</h3>
<p>Our authentication system now has:
- 50+ unit tests across multiple modules
- 20+ integration tests
- 10+ performance tests
- Tests that take milliseconds and tests that take seconds</p>
<p>We need to run tests selectively to maintain fast development cycles.</p>
<h3 id="iteration-0-running-everything">Iteration 0: Running Everything</h3>
<p>Let's start with the default‚Äîrunning all tests.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Project structure</span>
my_project/
‚îî‚îÄ‚îÄ<span class="w"> </span>tests/
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>auth/
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_authentication.py<span class="w">  </span><span class="o">(</span><span class="m">10</span><span class="w"> </span>tests<span class="o">)</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_password_reset.py<span class="w">  </span><span class="o">(</span><span class="m">8</span><span class="w"> </span>tests<span class="o">)</span>
<span class="w">    </span>‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_logout.py<span class="w">          </span><span class="o">(</span><span class="m">5</span><span class="w"> </span>tests<span class="o">)</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_permissions.py<span class="w">         </span><span class="o">(</span><span class="m">12</span><span class="w"> </span>tests<span class="o">)</span>
<span class="w">    </span>‚îú‚îÄ‚îÄ<span class="w"> </span>test_sessions.py<span class="w">            </span><span class="o">(</span><span class="m">15</span><span class="w"> </span>tests<span class="o">)</span>
<span class="w">    </span>‚îî‚îÄ‚îÄ<span class="w"> </span>test_users.py<span class="w">               </span><span class="o">(</span><span class="m">10</span><span class="w"> </span>tests<span class="o">)</span>
</code></pre></div>

<p>Run all tests:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>my_project
pytest
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 60 items

tests/auth/test_authentication.py ..........                           [ 16%]
tests/auth/test_password_reset.py ........                             [ 30%]
tests/auth/test_logout.py .....                                        [ 38%]
tests/test_permissions.py ............                                 [ 58%]
tests/test_sessions.py ...............                                 [ 83%]
tests/test_users.py ..........                                         [100%]

========================== 60 passed in 2.45s ===========================
</code></pre></div>

<p><strong>Current limitation</strong>: Running all 60 tests takes 2.45 seconds. During development, we're only working on authentication‚Äîwe don't need to run permission, session, and user tests. We need faster feedback.</p>
<p><strong>What we need</strong>: Ways to run subsets of tests.</p>
<h3 id="iteration-1-running-tests-by-file">Iteration 1: Running Tests by File</h3>
<p>The simplest way to run specific tests is to specify the file.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run only authentication tests</span>
pytest<span class="w"> </span>tests/auth/test_authentication.py
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 10 items

tests/auth/test_authentication.py ..........                           [100%]

========================== 10 passed in 0.42s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Running just the authentication tests takes 0.42s instead of 2.45s‚Äînearly 6x faster. This is the most common way to run specific tests during development.</p>
<p>You can also run multiple files:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run authentication and password reset tests</span>
pytest<span class="w"> </span>tests/auth/test_authentication.py<span class="w"> </span>tests/auth/test_password_reset.py
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 18 items

tests/auth/test_authentication.py ..........                           [ 55%]
tests/auth/test_password_reset.py ........                             [100%]

========================== 18 passed in 0.78s ===========================
</code></pre></div>

<p><strong>Current limitation</strong>: What if we want to run just one specific test function, not the entire file?</p>
<h3 id="iteration-2-running-a-specific-test-function">Iteration 2: Running a Specific Test Function</h3>
<p>Pytest allows you to specify individual test functions using the <code>::</code> syntax.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_authentication.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_nonexistent_user</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Run just one test:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/auth/test_authentication.py::test_authenticate_user_with_valid_credentials
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 1 item

tests/auth/test_authentication.py::test_authenticate_user_with_valid_credentials PASSED [100%]

========================== 1 passed in 0.08s ============================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Running a single test takes only 0.08s. This is perfect for rapid iteration when fixing a specific bug.</p>
<p><strong>Syntax</strong>: <code>&lt;file_path&gt;::&lt;test_function_name&gt;</code></p>
<p>You can also run multiple specific tests:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/auth/test_authentication.py::test_authenticate_user_with_valid_credentials<span class="w"> </span><span class="se">\</span>
<span class="w">       </span>tests/auth/test_authentication.py::test_authenticate_user_rejects_invalid_password
</code></pre></div>

<p><strong>Current limitation</strong>: Typing out full test paths is tedious. Is there a way to select tests by pattern?</p>
<h3 id="iteration-3-running-tests-by-name-pattern">Iteration 3: Running Tests by Name Pattern</h3>
<p>Pytest's <code>-k</code> flag lets you run tests matching a name pattern.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_authentication.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_nonexistent_user</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_verify_password_hash</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Run all tests with "invalid" in the name:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;invalid&quot;</span>
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 60 items / 58 deselected / 2 selected

tests/auth/test_authentication.py::test_authenticate_user_rejects_invalid_password PASSED [ 50%]
tests/test_permissions.py::test_check_permission_rejects_invalid_permission PASSED [100%]

==================== 2 passed, 58 deselected in 0.15s ===================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: The <code>-k</code> flag found all tests with "invalid" in their name across all files. Notice:
- <code>collected 60 items</code> - Pytest found all tests
- <code>58 deselected / 2 selected</code> - It filtered to just the matching ones
- Only 2 tests ran</p>
<p><strong>Pattern matching examples</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run tests with &quot;password&quot; in the name</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;password&quot;</span>

<span class="c1"># Run tests with &quot;authenticate&quot; OR &quot;verify&quot; in the name</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;authenticate or verify&quot;</span>

<span class="c1"># Run tests with &quot;user&quot; AND &quot;valid&quot; in the name</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;user and valid&quot;</span>

<span class="c1"># Run tests with &quot;user&quot; but NOT &quot;invalid&quot; in the name</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;user and not invalid&quot;</span>
</code></pre></div>

<p>Let's see a more complex example:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;authenticate and (valid or invalid)&quot;</span>
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 60 items / 57 deselected / 3 selected

tests/auth/test_authentication.py::test_authenticate_user_with_valid_credentials PASSED [ 33%]
tests/auth/test_authentication.py::test_authenticate_user_rejects_invalid_password PASSED [ 66%]
tests/auth/test_authentication.py::test_authenticate_user_with_invalid_token PASSED [100%]

==================== 3 passed, 57 deselected in 0.18s ===================
</code></pre></div>

<p><strong>Key insight</strong>: The <code>-k</code> flag is incredibly powerful for running related tests without specifying exact paths. It's perfect for:
- Running all tests related to a feature ("password", "session", "permission")
- Running all tests for a specific scenario ("valid", "invalid", "expired")
- Excluding certain tests ("not slow", "not integration")</p>
<p><strong>Current limitation</strong>: What if we want to run tests in a specific directory without typing the full path?</p>
<h3 id="iteration-4-running-tests-by-directory">Iteration 4: Running Tests by Directory</h3>
<p>You can run all tests in a directory by specifying the directory path.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all auth tests</span>
pytest<span class="w"> </span>tests/auth/
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 23 items

tests/auth/test_authentication.py ..........                           [ 43%]
tests/auth/test_password_reset.py ........                             [ 78%]
tests/auth/test_logout.py .....                                        [100%]

========================== 23 passed in 0.95s ===========================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Running all tests in the <code>auth/</code> directory is simple and fast. This is useful when working on a specific module.</p>
<p>You can combine directory paths with other selection methods:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run tests in auth/ directory that match &quot;invalid&quot;</span>
pytest<span class="w"> </span>tests/auth/<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;invalid&quot;</span>
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 23 items / 22 deselected / 1 selected

tests/auth/test_authentication.py::test_authenticate_user_rejects_invalid_password PASSED [100%]

==================== 1 passed, 22 deselected in 0.12s ===================
</code></pre></div>

<p><strong>Current limitation</strong>: What if we want to run tests that failed in the last run?</p>
<h3 id="iteration-5-running-failed-tests">Iteration 5: Running Failed Tests</h3>
<p>Pytest can remember which tests failed and rerun only those.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_authentication.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_with_valid_credentials</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">True</span>  <span class="c1"># Passes</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_invalid_password</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">False</span>  <span class="c1"># Fails!</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_rejects_nonexistent_user</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">True</span>  <span class="c1"># Passes</span>
</code></pre></div>

<p>First, run all tests to see which fail:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/auth/test_authentication.py
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 3 items

tests/auth/test_authentication.py .F.                                  [100%]

=========================== FAILURES ====================================
________ test_authenticate_user_rejects_invalid_password ________________

    def test_authenticate_user_rejects_invalid_password():
&gt;       assert False
E       assert False

tests/auth/test_authentication.py:5: AssertionError
==================== 1 failed, 2 passed in 0.12s ========================
</code></pre></div>

<p>Now run only the failed test:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--lf<span class="w">  </span><span class="c1"># --lf means &quot;last failed&quot;</span>
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 3 items / 2 deselected / 1 selected
run-last-failure: rerun previous 1 failure

tests/auth/test_authentication.py F                                    [100%]

=========================== FAILURES ====================================
________ test_authenticate_user_rejects_invalid_password ________________

    def test_authenticate_user_rejects_invalid_password():
&gt;       assert False
E       assert False

tests/auth/test_authentication.py:5: AssertionError
==================== 1 failed, 2 deselected in 0.08s ====================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Pytest remembered which test failed and ran only that one. Notice:
- <code>collected 3 items / 2 deselected / 1 selected</code> - Found all tests but ran only the failed one
- <code>run-last-failure: rerun previous 1 failure</code> - Explicit confirmation</p>
<p><strong>Related flags</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run last failed tests first, then the rest</span>
pytest<span class="w"> </span>--ff<span class="w">  </span><span class="c1"># --ff means &quot;failed first&quot;</span>

<span class="c1"># Run only tests that failed, then stop</span>
pytest<span class="w"> </span>--lf<span class="w"> </span>--exitfirst<span class="w">  </span><span class="c1"># Stop after first failure</span>
</code></pre></div>

<p>Let's see <code>--ff</code> in action:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--ff<span class="w"> </span>tests/auth/test_authentication.py
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 3 items
run-last-failure: rerun previous 1 failure first

tests/auth/test_authentication.py F..                                  [100%]

=========================== FAILURES ====================================
________ test_authenticate_user_rejects_invalid_password ________________

    def test_authenticate_user_rejects_invalid_password():
&gt;       assert False
E       assert False

tests/auth/test_authentication.py:5: AssertionError
==================== 1 failed, 2 passed in 0.12s ========================
</code></pre></div>

<p><strong>Key insight</strong>: The failed test ran first (F), then the passing tests (..). This is useful when you want to verify your fix works before running the full suite.</p>
<h3 id="iteration-6-stopping-on-first-failure">Iteration 6: Stopping on First Failure</h3>
<p>When debugging, you often want to stop as soon as a test fails.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># tests/auth/test_authentication.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_1</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">False</span>  <span class="c1"># Fails</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_2</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">False</span>  <span class="c1"># Would fail, but won&#39;t run</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_3</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">True</span>   <span class="c1"># Would pass, but won&#39;t run</span>
</code></pre></div>

<p>Run with <code>--exitfirst</code> (or <code>-x</code>):</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/auth/test_authentication.py<span class="w"> </span>-x
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>========================== test session starts ==========================
collected 3 items

tests/auth/test_authentication.py F

=========================== FAILURES ====================================
__________________________ test_1 _______________________________________

    def test_1():
&gt;       assert False
E       assert False

tests/auth/test_authentication.py:2: AssertionError
==================== 1 failed in 0.08s ==================================
</code></pre></div>

<p><strong>Expected vs. Actual improvement</strong>: Pytest stopped after the first failure. Only <code>test_1</code> ran; <code>test_2</code> and <code>test_3</code> were never executed.</p>
<p><strong>Why this matters</strong>: When debugging, you want immediate feedback on the first failure. Running subsequent tests wastes time and clutters the output.</p>
<p>You can also limit the number of failures:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Stop after 3 failures</span>
pytest<span class="w"> </span>--maxfail<span class="o">=</span><span class="m">3</span>
</code></pre></div>

<h3 id="iteration-7-running-tests-modified-since-last-commit">Iteration 7: Running Tests Modified Since Last Commit</h3>
<p>Pytest can run only tests in files that have changed since the last git commit.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Modify a test file</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;def test_new(): pass&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>tests/auth/test_authentication.py

<span class="c1"># Run only tests in modified files</span>
pytest<span class="w"> </span>--testmon
</code></pre></div>

<p><strong>Note</strong>: This requires the <code>pytest-testmon</code> plugin:</p>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pytest-testmon
</code></pre></div>

<p><strong>Alternative</strong>: Use git to find modified files and run their tests:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run tests in files modified since last commit</span>
pytest<span class="w"> </span><span class="k">$(</span>git<span class="w"> </span>diff<span class="w"> </span>--name-only<span class="w"> </span>HEAD<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>test_<span class="k">)</span>
</code></pre></div>

<h3 id="common-test-selection-patterns">Common Test Selection Patterns</h3>
<p><strong>By file</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/test_auth.py
pytest<span class="w"> </span>tests/auth/test_authentication.py<span class="w"> </span>tests/auth/test_logout.py
</code></pre></div>

<p><strong>By directory</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/auth/
pytest<span class="w"> </span>tests/unit/<span class="w"> </span>tests/integration/
</code></pre></div>

<p><strong>By function</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/test_auth.py::test_authenticate_user_with_valid_credentials
</code></pre></div>

<p><strong>By name pattern</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;password&quot;</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;authenticate and valid&quot;</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;not slow&quot;</span>
</code></pre></div>

<p><strong>By failure status</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--lf<span class="w">              </span><span class="c1"># Last failed</span>
pytest<span class="w"> </span>--ff<span class="w">              </span><span class="c1"># Failed first</span>
pytest<span class="w"> </span>--lf<span class="w"> </span>-x<span class="w">           </span><span class="c1"># Last failed, stop on first failure</span>
</code></pre></div>

<p><strong>Combining selections</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>tests/auth/<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;invalid&quot;</span><span class="w"> </span>--lf
<span class="c1"># Run tests in auth/ directory, matching &quot;invalid&quot;, that failed last time</span>
</code></pre></div>

<h3 id="useful-flags-for-test-selection">Useful Flags for Test Selection</h3>
<p><strong>Verbosity</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>-v<span class="w">                </span><span class="c1"># Verbose: show each test name</span>
pytest<span class="w"> </span>-vv<span class="w">               </span><span class="c1"># Extra verbose: show more details</span>
pytest<span class="w"> </span>-q<span class="w">                </span><span class="c1"># Quiet: minimal output</span>
</code></pre></div>

<p><strong>Collection</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>--collect-only<span class="w">    </span><span class="c1"># Show what would run, don&#39;t run tests</span>
pytest<span class="w"> </span>--co<span class="w">              </span><span class="c1"># Short form of --collect-only</span>
</code></pre></div>

<p><strong>Execution control</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>-x<span class="w">                </span><span class="c1"># Stop on first failure</span>
pytest<span class="w"> </span>--maxfail<span class="o">=</span><span class="m">3</span><span class="w">       </span><span class="c1"># Stop after 3 failures</span>
pytest<span class="w"> </span>--lf<span class="w">              </span><span class="c1"># Run last failed tests</span>
pytest<span class="w"> </span>--ff<span class="w">              </span><span class="c1"># Run failed tests first</span>
</code></pre></div>

<p><strong>Output control</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>-s<span class="w">                </span><span class="c1"># Show print statements (don&#39;t capture output)</span>
pytest<span class="w"> </span>--tb<span class="o">=</span>short<span class="w">        </span><span class="c1"># Short traceback format</span>
pytest<span class="w"> </span>--tb<span class="o">=</span>no<span class="w">           </span><span class="c1"># No traceback, just summary</span>
</code></pre></div>

<h3 id="development-workflow-examples">Development Workflow Examples</h3>
<p><strong>Rapid iteration on a single test</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Edit test, run it, repeat</span>
pytest<span class="w"> </span>tests/auth/test_authentication.py::test_authenticate_user_with_valid_credentials<span class="w"> </span>-v
</code></pre></div>

<p><strong>Fix a failing test</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all tests to see what fails</span>
pytest

<span class="c1"># Run only failed tests</span>
pytest<span class="w"> </span>--lf<span class="w"> </span>-x

<span class="c1"># Fix the code, rerun failed test</span>
pytest<span class="w"> </span>--lf

<span class="c1"># Once it passes, run all tests</span>
pytest
</code></pre></div>

<p><strong>Work on a feature</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run tests related to the feature</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;password_reset&quot;</span>

<span class="c1"># Run tests in the feature&#39;s directory</span>
pytest<span class="w"> </span>tests/auth/

<span class="c1"># Run fast, then slow tests</span>
pytest<span class="w"> </span>tests/unit/auth/
pytest<span class="w"> </span>tests/integration/
</code></pre></div>

<p><strong>Pre-commit check</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all tests, stop on first failure</span>
pytest<span class="w"> </span>-x

<span class="c1"># Or run all tests, show summary</span>
pytest<span class="w"> </span>-v
</code></pre></div>

<h3 id="the-journey-from-all-to-specific">The Journey: From All to Specific</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Selection Method</th>
<th>Use Case</th>
<th>Speed Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Run all tests</td>
<td>Full validation</td>
<td>Baseline (2.45s)</td>
</tr>
<tr>
<td>1</td>
<td>Run by file</td>
<td>Working on specific module</td>
<td>6x faster (0.42s)</td>
</tr>
<tr>
<td>2</td>
<td>Run specific function</td>
<td>Fixing specific bug</td>
<td>30x faster (0.08s)</td>
</tr>
<tr>
<td>3</td>
<td>Run by name pattern</td>
<td>Testing related functionality</td>
<td>Variable</td>
</tr>
<tr>
<td>4</td>
<td>Run by directory</td>
<td>Working on module group</td>
<td>2-3x faster</td>
</tr>
<tr>
<td>5</td>
<td>Run failed tests</td>
<td>Iterating on fixes</td>
<td>Variable</td>
</tr>
<tr>
<td>6</td>
<td>Stop on first failure</td>
<td>Debugging</td>
<td>Immediate feedback</td>
</tr>
<tr>
<td>7</td>
<td>Run modified tests</td>
<td>Pre-commit check</td>
<td>Variable</td>
</tr>
</tbody>
</table>
<h3 id="lessons-learned_5">Lessons Learned</h3>
<p><strong>1. Selective execution is essential</strong>: Running all tests every time is too slow for development</p>
<p><strong>2. Use file paths for precision</strong>: Most specific and predictable selection method</p>
<p><strong>3. Use <code>-k</code> for flexibility</strong>: Pattern matching is powerful for related tests</p>
<p><strong>4. Use <code>--lf</code> when debugging</strong>: Focus on failed tests until they pass</p>
<p><strong>5. Use <code>-x</code> to stop early</strong>: Get immediate feedback on first failure</p>
<p><strong>6. Combine selection methods</strong>: Directory + pattern + failure status = precise control</p>
<p><strong>7. Learn the shortcuts</strong>: <code>-v</code>, <code>-x</code>, <code>--lf</code>, <code>-k</code> are your daily tools</p>
<p><strong>8. Optimize your workflow</strong>: Fast feedback loops make development more productive</p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 10:36:58 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>