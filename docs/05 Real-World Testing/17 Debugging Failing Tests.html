<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17 Debugging Failing Tests</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">05 Real-World Testing</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-17-debugging-failing-tests">Chapter 17: Debugging Failing Tests</h1>
<h2 id="reading-test-output">Reading Test Output</h2>
<h2 id="the-debugging-mindset">The Debugging Mindset</h2>
<p>A failing test is not a roadblock; it's a roadmap. Pytest provides a wealth of information when a test fails, and learning to read this output systematically is the most critical debugging skill you can develop. A test failure provides three key pieces of information: <strong>what</strong> failed, <strong>where</strong> it failed, and <strong>why</strong> it failed.</p>
<p>In this chapter, we will adopt the role of a detective. We'll start with a buggy piece of code and a failing test. With each new tool pytest offers, we will uncover more clues, moving from a simple crash report to a full interactive investigation.</p>
<h3 id="phase-1-establish-the-reference-implementation">Phase 1: Establish the Reference Implementation</h3>
<p>Our anchor example for this chapter will be a function designed to perform simple analytics on a list of user data. It's a common type of data-processing task, and we've introduced a few subtle bugs that are typical of real-world code.</p>
<p>This function, <code>analyze_user_ages</code>, is intended to:
1.  Calculate the average age of all users.
2.  Count how many users are adults (age 18 or over).
3.  Return a sorted list of user names formatted as "Last, First".</p>
<p>Here is the initial, buggy implementation.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_analytics.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes a list of user data, returning statistics.</span>
<span class="sd">    - Calculates average age.</span>
<span class="sd">    - Counts number of adults (age &gt;= 18).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_age</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">num_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="n">average_age</span> <span class="o">=</span> <span class="n">total_age</span> <span class="o">/</span> <span class="n">num_users</span>

    <span class="c1"># Bug: Logic is incorrect for counting adults (should be &gt;= 18)</span>
    <span class="n">adult_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">:</span>
            <span class="n">adult_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Bug: Assumes &#39;first&#39; and &#39;last&#39; keys will always exist</span>
    <span class="n">user_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;last&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;average_age&quot;</span><span class="p">:</span> <span class="n">average_age</span><span class="p">,</span>
        <span class="s2">&quot;adult_count&quot;</span><span class="p">:</span> <span class="n">adult_count</span><span class="p">,</span>
        <span class="s2">&quot;user_names&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">user_names</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div>

<h3 id="iteration-1-the-crash">Iteration 1: The Crash</h3>
<p>Let's write our first test. We'll test the basic functionality with a valid list of users. However, to trigger our first bug, we'll include a user record that is missing the <code>first</code> name key. This is a common issue when dealing with inconsistent data sources.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_analytics_v1.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_analytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_user_ages</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_analyze_user_ages_missing_key</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the function with data that is missing an expected key.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Smith&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">45</span><span class="p">},</span>  <span class="c1"># Missing &#39;first&#39; name</span>
        <span class="p">{</span><span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">},</span>
    <span class="p">]</span>
    <span class="c1"># This test will crash before the assertion is ever reached.</span>
    <span class="n">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
</code></pre></div>

<p>Now, let's run pytest and see what happens.</p>
<h3 id="failure-demonstration-the-keyerror">Failure Demonstration: The <code>KeyError</code></h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_analytics_v1.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.11.4,<span class="w"> </span>pytest-7.4.0,<span class="w"> </span>pluggy-1.2.0
rootdir:<span class="w"> </span>/path/to/project
plugins:<span class="w"> </span>anyio-3.7.1
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_analytics_v1.py<span class="w"> </span>F<span class="w">                                               </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
_____________________<span class="w"> </span>test_analyze_user_ages_missing_key<span class="w"> </span>_____________________

<span class="w">    </span>def<span class="w"> </span>test_analyze_user_ages_missing_key<span class="o">()</span>:
<span class="w">        </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Tests the function with data that is missing an expected key.</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="w">        </span><span class="nv">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">            </span><span class="o">{</span><span class="s2">&quot;first&quot;</span>:<span class="w"> </span><span class="s2">&quot;John&quot;</span>,<span class="w"> </span><span class="s2">&quot;last&quot;</span>:<span class="w"> </span><span class="s2">&quot;Doe&quot;</span>,<span class="w"> </span><span class="s2">&quot;age&quot;</span>:<span class="w"> </span><span class="m">30</span><span class="o">}</span>,
<span class="w">            </span><span class="o">{</span><span class="s2">&quot;last&quot;</span>:<span class="w"> </span><span class="s2">&quot;Smith&quot;</span>,<span class="w"> </span><span class="s2">&quot;age&quot;</span>:<span class="w"> </span><span class="m">45</span><span class="o">}</span>,<span class="w">  </span><span class="c1"># Missing &#39;first&#39; name</span>
<span class="w">            </span><span class="o">{</span><span class="s2">&quot;first&quot;</span>:<span class="w"> </span><span class="s2">&quot;Jane&quot;</span>,<span class="w"> </span><span class="s2">&quot;last&quot;</span>:<span class="w"> </span><span class="s2">&quot;Doe&quot;</span>,<span class="w"> </span><span class="s2">&quot;age&quot;</span>:<span class="w"> </span><span class="m">25</span><span class="o">}</span>,
<span class="w">        </span><span class="o">]</span>
<span class="w">        </span><span class="c1"># This test will crash before the assertion is ever reached.</span>
&gt;<span class="w">       </span>analyze_user_ages<span class="o">(</span>users<span class="o">)</span>

test_analytics_v1.py:12:
_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_

<span class="nv">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[{</span><span class="s1">&#39;first&#39;</span>:<span class="w"> </span><span class="s1">&#39;John&#39;</span>,<span class="w"> </span><span class="s1">&#39;last&#39;</span>:<span class="w"> </span><span class="s1">&#39;Doe&#39;</span>,<span class="w"> </span><span class="s1">&#39;age&#39;</span>:<span class="w"> </span><span class="m">30</span><span class="o">}</span>,<span class="w"> </span><span class="o">{</span><span class="s1">&#39;last&#39;</span>:<span class="w"> </span><span class="s1">&#39;Smith&#39;</span>,<span class="w"> </span><span class="s1">&#39;age&#39;</span>:<span class="w"> </span><span class="m">45</span><span class="o">}</span>,<span class="w"> </span><span class="o">{</span><span class="s1">&#39;first&#39;</span>:<span class="w"> </span><span class="s1">&#39;Jane&#39;</span>,<span class="w"> </span><span class="s1">&#39;last&#39;</span>:<span class="w"> </span><span class="s1">&#39;Doe&#39;</span>,<span class="w"> </span><span class="s1">&#39;age&#39;</span>:<span class="w"> </span><span class="m">25</span><span class="o">}]</span>

<span class="w">    </span>def<span class="w"> </span>analyze_user_ages<span class="o">(</span>users:<span class="w"> </span>list<span class="o">[</span>dict<span class="o">])</span><span class="w"> </span>-&gt;<span class="w"> </span>dict:
<span class="w">        </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Analyzes a list of user data, returning statistics.</span>
<span class="s2">        - Calculates average age.</span>
<span class="s2">        - Counts number of adults (age &gt;= 18).</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="w">        </span><span class="nv">total_age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>sum<span class="o">(</span>user<span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span>users<span class="o">)</span>
<span class="w">        </span><span class="nv">num_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>len<span class="o">(</span>users<span class="o">)</span>
<span class="w">        </span><span class="nv">average_age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>total_age<span class="w"> </span>/<span class="w"> </span>num_users

<span class="w">        </span><span class="c1"># Bug: Logic is incorrect for counting adults (should be &gt;= 18)</span>
<span class="w">        </span><span class="nv">adult_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span>users:
<span class="w">            </span><span class="k">if</span><span class="w"> </span>user<span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">18</span>:
<span class="w">                </span><span class="nv">adult_count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m">1</span>

<span class="w">        </span><span class="c1"># Bug: Assumes &#39;first&#39; and &#39;last&#39; keys will always exist</span>
&gt;<span class="w">       </span><span class="nv">user_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>f<span class="s2">&quot;{user[&#39;last&#39;]}, {user[&#39;first&#39;]}&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span>users<span class="o">]</span>
E<span class="w">       </span>KeyError:<span class="w"> </span><span class="s1">&#39;first&#39;</span>

user_analytics.py:19:<span class="w"> </span><span class="nv">KeyError</span>
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
FAILED<span class="w"> </span>test_analytics_v1.py::test_analyze_user_ages_missing_key<span class="w"> </span>-<span class="w"> </span>KeyError:<span class="w"> </span><span class="s1">&#39;first&#39;</span>
<span class="o">============================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.12s<span class="w"> </span><span class="o">=============================</span>
</code></pre></div>

<h3 id="diagnostic-analysis-reading-the-failure">Diagnostic Analysis: Reading the Failure</h3>
<p>This output is dense, but it's a structured narrative of the error. Let's parse it section by section.</p>
<p><strong>1. The summary line</strong>:</p>
<div class="codehilite"><pre><span></span><code>FAILED test_analytics_v1.py::test_analyze_user_ages_missing_key - KeyError: &#39;first&#39;
</code></pre></div>

<ul>
<li><strong>What this tells us</strong>: The test named <code>test_analyze_user_ages_missing_key</code> in the file <code>test_analytics_v1.py</code> failed. The reason for the failure was a <code>KeyError</code> because the key <code>'first'</code> could not be found in a dictionary. This is our high-level summary.</li>
</ul>
<p><strong>2. The traceback</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">_____________________</span><span class="w"> </span><span class="n">test_analyze_user_ages_missing_key</span><span class="w"> </span><span class="n">_____________________</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">test_analyze_user_ages_missing_key</span><span class="p">()</span><span class="err">:</span>
<span class="p">...</span>
<span class="o">&gt;</span><span class="w">       </span><span class="n">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>

<span class="n">test_analytics_v1</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="mi">12</span><span class="err">:</span>
<span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="n">_</span>

<span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">...</span><span class="o">]</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">analyze_user_ages</span><span class="p">(</span><span class="nl">users</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="o">[</span><span class="n">dict</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">dict</span><span class="p">:</span>
<span class="p">...</span>
<span class="o">&gt;</span><span class="w">       </span><span class="n">user_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">f&quot;{user[&#39;last&#39;</span><span class="o">]</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="k">user</span><span class="o">[</span><span class="n">&#39;first&#39;</span><span class="o">]</span><span class="err">}&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">users</span><span class="err">]</span>
<span class="n">E</span><span class="w">       </span><span class="nl">KeyError</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;first&#39;</span>

<span class="n">user_analytics</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="mi">19</span><span class="err">:</span><span class="w"> </span><span class="n">KeyError</span>
</code></pre></div>

<ul>
<li><strong>What this tells us</strong>: This is the call stack, read from top to bottom. It shows the path the code took to arrive at the error.</li>
<li>The first block shows our test code. The <code>&gt;</code> points to the exact line in our test file that triggered the error: <code>analyze_user_ages(users)</code>.</li>
<li>The second block takes us <em>inside</em> the <code>analyze_user_ages</code> function. The <code>&gt;</code> here points to the line of code that actually crashed: <code>user_names = [f"{user['last']}, {user['first']}" for user in users]</code>.</li>
<li><strong>Key line</strong>: The line marked with <code>E</code> (for Error) gives us the specific exception: <code>E       KeyError: 'first'</code>. This is the final, most specific piece of information.</li>
</ul>
<p><strong>3. Assertion Introspection</strong>:
-   In this case, there is no assertion introspection section. This is a crucial clue! The test didn't fail because an <code>assert</code> statement was false; it failed because the code crashed with an unhandled exception <em>before</em> it even reached an assertion.</p>
<p><strong>Root cause identified</strong>: The function <code>analyze_user_ages</code> attempts to access the dictionary key <code>'first'</code> on every user dictionary, but the second user in our test data does not have this key.</p>
<p><strong>Why the current approach can't solve this</strong>: Our code makes an unsafe assumption about the structure of its input data.</p>
<p><strong>What we need</strong>: A way to handle potentially missing keys gracefully. For now, let's fix the bug so we can explore other failure modes. We'll use the <code>.get()</code> dictionary method, which allows providing a default value if a key is missing.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_analytics.py (fixed version 1)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes a list of user data, returning statistics.</span>
<span class="sd">    - Calculates average age.</span>
<span class="sd">    - Counts number of adults (age &gt;= 18).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_age</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">num_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="n">average_age</span> <span class="o">=</span> <span class="n">total_age</span> <span class="o">/</span> <span class="n">num_users</span>

    <span class="c1"># Bug: Logic is incorrect for counting adults (should be &gt;= 18)</span>
    <span class="n">adult_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">:</span>
            <span class="n">adult_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># FIX: Use .get() to handle missing keys gracefully</span>
    <span class="n">user_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;average_age&quot;</span><span class="p">:</span> <span class="n">average_age</span><span class="p">,</span>
        <span class="s2">&quot;adult_count&quot;</span><span class="p">:</span> <span class="n">adult_count</span><span class="p">,</span>
        <span class="s2">&quot;user_names&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">user_names</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div>

<p>With this fix, the <code>KeyError</code> is resolved. But our function still has other bugs. Reading the traceback is the first and most fundamental step in debugging any failing test.</p>
<h3 id="limitation-preview">Limitation Preview</h3>
<p>We've fixed a crash, but what about errors that are more subtle? Our function can still produce the wrong <em>answer</em> without crashing. These are often harder to find. To diagnose them, we'll need to see more detail about which tests are running and what their results are.</p>
<h2 id="using-pytests-verbose-and-extra-verbose-modes">Using pytest's Verbose and Extra-Verbose Modes</h2>
<h2 id="iteration-2-the-logical-error">Iteration 2: The Logical Error</h2>
<p>Our code no longer crashes on malformed data, but does it produce the correct results? Let's write a new test that checks the logic of our <code>adult_count</code>. We'll include a user who is exactly 18 years old. According to our requirements, they should be counted as an adult.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_analytics_v2.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_analytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_user_ages</span>

<span class="c1"># NOTE: We are using the version of user_analytics with the KeyError fix.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_analyze_user_ages_adult_count_logic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests that the adult count logic is correct, especially for the edge case of age 18.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>    <span class="c1"># Adult</span>
        <span class="p">{</span><span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Smith&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">},</span>  <span class="c1"># Minor</span>
        <span class="p">{</span><span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="s2">&quot;Sam&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Jones&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">},</span>   <span class="c1"># Adult (edge case)</span>
    <span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="c1"># The bug is `&gt; 18` instead of `&gt;= 18`, so this will fail.</span>
    <span class="c1"># Expected adult_count is 2, but the function will return 1.</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;adult_count&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
</code></pre></div>

<h3 id="failure-demonstration-the-silent-logic-bug">Failure Demonstration: The Silent Logic Bug</h3>
<p>Let's run this new test.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_analytics_v2.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.11.4,<span class="w"> </span>pytest-7.4.0,<span class="w"> </span>pluggy-1.2.0
rootdir:<span class="w"> </span>/path/to/project
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_analytics_v2.py<span class="w"> </span>F<span class="w">                                               </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
__________________<span class="w"> </span>test_analyze_user_ages_adult_count_logic<span class="w"> </span>__________________

<span class="w">    </span>def<span class="w"> </span>test_analyze_user_ages_adult_count_logic<span class="o">()</span>:
<span class="w">        </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Tests that the adult count logic is correct, especially for the edge case of age 18.</span>
<span class="s2">        &quot;&quot;&quot;</span>
<span class="w">        </span><span class="nv">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">            </span><span class="o">{</span><span class="s2">&quot;first&quot;</span>:<span class="w"> </span><span class="s2">&quot;John&quot;</span>,<span class="w"> </span><span class="s2">&quot;last&quot;</span>:<span class="w"> </span><span class="s2">&quot;Doe&quot;</span>,<span class="w"> </span><span class="s2">&quot;age&quot;</span>:<span class="w"> </span><span class="m">30</span><span class="o">}</span>,<span class="w">    </span><span class="c1"># Adult</span>
<span class="w">            </span><span class="o">{</span><span class="s2">&quot;first&quot;</span>:<span class="w"> </span><span class="s2">&quot;Jane&quot;</span>,<span class="w"> </span><span class="s2">&quot;last&quot;</span>:<span class="w"> </span><span class="s2">&quot;Smith&quot;</span>,<span class="w"> </span><span class="s2">&quot;age&quot;</span>:<span class="w"> </span><span class="m">17</span><span class="o">}</span>,<span class="w">  </span><span class="c1"># Minor</span>
<span class="w">            </span><span class="o">{</span><span class="s2">&quot;first&quot;</span>:<span class="w"> </span><span class="s2">&quot;Sam&quot;</span>,<span class="w"> </span><span class="s2">&quot;last&quot;</span>:<span class="w"> </span><span class="s2">&quot;Jones&quot;</span>,<span class="w"> </span><span class="s2">&quot;age&quot;</span>:<span class="w"> </span><span class="m">18</span><span class="o">}</span>,<span class="w">   </span><span class="c1"># Adult (edge case)</span>
<span class="w">        </span><span class="o">]</span>
<span class="w">        </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>analyze_user_ages<span class="o">(</span>users<span class="o">)</span>
<span class="w">        </span><span class="c1"># The bug is `&gt; 18` instead of `&gt;= 18`, so this will fail.</span>
<span class="w">        </span><span class="c1"># Expected adult_count is 2, but the function will return 1.</span>
&gt;<span class="w">       </span>assert<span class="w"> </span>result<span class="o">[</span><span class="s2">&quot;adult_count&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span>
E<span class="w">       </span>assert<span class="w"> </span><span class="nv">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span>
E<span class="w">        </span>+<span class="w">  </span>where<span class="w"> </span><span class="nv">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="s1">&#39;average_age&#39;</span>:<span class="w"> </span><span class="m">21</span>.666666666666668,<span class="w"> </span><span class="s1">&#39;adult_count&#39;</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="s1">&#39;user_names&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;Doe, John&#39;</span>,<span class="w"> </span><span class="s1">&#39;Jones, Sam&#39;</span>,<span class="w"> </span><span class="s1">&#39;Smith, Jane&#39;</span><span class="o">]}[</span><span class="s1">&#39;adult_count&#39;</span><span class="o">]</span>

test_analytics_v2.py:15:<span class="w"> </span><span class="nv">AssertionError</span>
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
FAILED<span class="w"> </span>test_analytics_v2.py::test_analyze_user_ages_adult_count_logic<span class="w"> </span>-<span class="w"> </span>assert<span class="w"> </span><span class="nv">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">2</span>
<span class="o">============================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.12s<span class="w"> </span><span class="o">=============================</span>
</code></pre></div>

<h3 id="diagnostic-analysis-a-failed-assertion">Diagnostic Analysis: A Failed Assertion</h3>
<p>This failure output looks different from the last one.</p>
<ol>
<li><strong>The summary line</strong>: <code>FAILED ... - assert 1 == 2</code>. It tells us the failure was an <code>AssertionError</code>.</li>
<li><strong>The traceback</strong>: It points directly to the <code>assert</code> line in our test.</li>
<li><strong>The assertion introspection</strong>: This is the new, critical section.
    <code>&gt;       assert result["adult_count"] == 2
    E       assert 1 == 2
    E        +  where 1 = {'average_age': ..., 'adult_count': 1, ...}['adult_count']</code><ul>
<li>Pytest re-writes the <code>assert</code> statement to show us the <em>actual values</em> involved at the time of failure.</li>
<li><code>assert 1 == 2</code> is the simplified comparison. It's immediately clear what went wrong.</li>
<li>The <code>where</code> clause is even more helpful. It shows us that the <code>1</code> came from <code>result["adult_count"]</code>, and it even shows us the <em>entire</em> <code>result</code> dictionary. This is incredibly powerful context.</li>
</ul>
</li>
</ol>
<p><strong>Root cause identified</strong>: The function returned <code>adult_count: 1</code> when we expected <code>2</code>. The user aged 18 was not counted.</p>
<h3 id="technique-introduced-verbose-v-and-extra-verbose-vv">Technique Introduced: Verbose (<code>-v</code>) and Extra-Verbose (<code>-vv</code>)</h3>
<p>The default output is great for failures, but when you have many tests, the progress indicator (<code>.F.s.</code>) can be terse. The <code>-v</code> (verbose) flag gives more readable output.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_analytics_v2.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.11.4,<span class="w"> </span>pytest-7.4.0,<span class="w"> </span>pluggy-1.2.0
rootdir:<span class="w"> </span>/path/to/project
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_analytics_v2.py::test_analyze_user_ages_adult_count_logic<span class="w"> </span>FAILED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
__________________<span class="w"> </span>test_analyze_user_ages_adult_count_logic<span class="w"> </span>__________________
...<span class="w"> </span><span class="o">(</span>failure<span class="w"> </span>details<span class="w"> </span>are<span class="w"> </span>the<span class="w"> </span>same<span class="o">)</span><span class="w"> </span>...
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
FAILED<span class="w"> </span>test_analytics_v2.py::test_analyze_user_ages_adult_count_logic<span class="w"> </span>-<span class="w"> </span>assert<span class="w"> </span><span class="nv">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">2</span>
<span class="o">============================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.12s<span class="w"> </span><span class="o">=============================</span>
</code></pre></div>

<p>The key difference is in the progress report:
-   <strong>Default</strong>: <code>test_analytics_v2.py F</code>
-   <strong>Verbose (<code>-v</code>)</strong>: <code>test_analytics_v2.py::test_analyze_user_ages_adult_count_logic FAILED</code></p>
<p>With <code>-v</code>, pytest prints the full node ID of each test and its status (<code>PASSED</code>, <code>FAILED</code>, <code>SKIPPED</code>), which is much easier to read, especially in a large test suite.</p>
<p>The <code>-vv</code> (extra-verbose) flag adds even more detail, including the docstrings of your test functions. This is useful if you follow a convention of writing detailed explanations in your docstrings.</p>
<h3 id="when-to-apply-this-solution">When to Apply This Solution</h3>
<ul>
<li><strong>What it optimizes for</strong>: Readability of the test run, especially the progress and summary sections.</li>
<li><strong>When to choose this approach</strong>: Almost always use <code>-v</code> for local development. It provides a better signal-to-noise ratio than the default dot output. Use <code>-vv</code> if your docstrings contain critical information for understanding a test's purpose.</li>
<li><strong>When to avoid this approach</strong>: In CI systems where logs are already verbose, the default output might be preferred to keep logs concise.</li>
</ul>
<p>Let's apply the fix for the logical error.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_analytics.py (fixed version 2)</span>
<span class="o">...</span>
    <span class="c1"># FIX: Logic is now correct for counting adults (&gt;= 18)</span>
    <span class="n">adult_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">:</span> <span class="c1"># Changed from &gt; to &gt;=</span>
            <span class="n">adult_count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="o">...</span>
</code></pre></div>

<h3 id="limitation-preview_1">Limitation Preview</h3>
<p>Verbose mode helps us see <em>what</em> failed more clearly, but when we have a cascade of failures, the sheer volume of output can be overwhelming. We need a way to focus on one problem at a time.</p>
<h2 id="the-x-flag-stop-on-first-failure">The -x Flag (Stop on First Failure)</h2>
<h2 id="iteration-3-the-error-cascade">Iteration 3: The Error Cascade</h2>
<p>In a real project, a single bug can cause many tests to fail. This creates a lot of noise in the test report, making it hard to know where to start debugging.</p>
<p>Let's create a test file that will trigger multiple failures in our original buggy code. We will revert <code>user_analytics.py</code> to its initial state (with both the <code>KeyError</code> and the logic bug) and add a new test for a <code>ZeroDivisionError</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_analytics.py (reverted to initial buggy version)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">total_age</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">num_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="n">average_age</span> <span class="o">=</span> <span class="n">total_age</span> <span class="o">/</span> <span class="n">num_users</span> <span class="c1"># Potential ZeroDivisionError</span>

    <span class="n">adult_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">:</span> <span class="c1"># Bug 1: Incorrect logic</span>
            <span class="n">adult_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">user_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;last&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span> <span class="c1"># Bug 2: Potential KeyError</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;average_age&quot;</span><span class="p">:</span> <span class="n">average_age</span><span class="p">,</span>
        <span class="s2">&quot;adult_count&quot;</span><span class="p">:</span> <span class="n">adult_count</span><span class="p">,</span>
        <span class="s2">&quot;user_names&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">user_names</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># test_analytics_v3.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_analytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_user_ages</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_logic_error_adult_count</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Triggers the adult count logic error.&quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="s2">&quot;Sam&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Jones&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">}]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;adult_count&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_crash_on_missing_key</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Triggers the KeyError.&quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Smith&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">45</span><span class="p">}]</span>
    <span class="n">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_crash_on_empty_list</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Triggers the ZeroDivisionError.&quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
</code></pre></div>

<h3 id="failure-demonstration-too-much-information">Failure Demonstration: Too Much Information</h3>
<p>Running this file produces a long, intimidating report with three distinct failures.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_analytics_v3.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">3</span><span class="w"> </span>items

test_analytics_v3.py::test_logic_error_adult_count<span class="w"> </span>FAILED<span class="w">             </span><span class="o">[</span><span class="w"> </span><span class="m">33</span>%<span class="o">]</span>
test_analytics_v3.py::test_crash_on_missing_key<span class="w"> </span>FAILED<span class="w">                </span><span class="o">[</span><span class="w"> </span><span class="m">66</span>%<span class="o">]</span>
test_analytics_v3.py::test_crash_on_empty_list<span class="w"> </span>FAILED<span class="w">                 </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
_______________________<span class="w"> </span>test_logic_error_adult_count<span class="w"> </span>_______________________
...<span class="w"> </span><span class="o">(</span>AssertionError<span class="w"> </span>details<span class="o">)</span><span class="w"> </span>...
________________________<span class="w"> </span>test_crash_on_missing_key<span class="w"> </span>_________________________
...<span class="w"> </span><span class="o">(</span>KeyError<span class="w"> </span>details<span class="o">)</span><span class="w"> </span>...
________________________<span class="w"> </span>test_crash_on_empty_list<span class="w"> </span>__________________________
...<span class="w"> </span><span class="o">(</span>ZeroDivisionError<span class="w"> </span>details<span class="o">)</span><span class="w"> </span>...
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
FAILED<span class="w"> </span>test_analytics_v3.py::test_logic_error_adult_count<span class="w"> </span>-<span class="w"> </span>assert<span class="w"> </span><span class="nv">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span>
FAILED<span class="w"> </span>test_analytics_v3.py::test_crash_on_missing_key<span class="w"> </span>-<span class="w"> </span>KeyError:<span class="w"> </span><span class="s1">&#39;first&#39;</span>
FAILED<span class="w"> </span>test_analytics_v3.py::test_crash_on_empty_list<span class="w"> </span>-<span class="w"> </span>ZeroDivisionError:<span class="w"> </span>division<span class="w"> </span>by<span class="w"> </span><span class="nv">zero</span>
<span class="o">============================</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.13s<span class="w"> </span><span class="o">=============================</span>
</code></pre></div>

<h3 id="diagnostic-analysis">Diagnostic Analysis</h3>
<p>When faced with multiple failures, the best strategy is often to <strong>fix the first one and rerun</strong>. A single root cause can trigger failures in seemingly unrelated tests. The noise from subsequent failures can distract from the real issue.</p>
<p><strong>Root cause identified</strong>: We have at least three separate bugs.
<strong>Why the current approach can't solve this</strong>: Looking at all three failures at once is inefficient. We need to focus our attention.</p>
<h3 id="technique-introduced-x-stop-on-first-failure">Technique Introduced: <code>-x</code> (Stop on First Failure)</h3>
<p>Pytest provides the <code>-x</code> flag (or its long-form alias <code>--exitfirst</code>) to address this exact problem. When you run pytest with <code>-x</code>, the test session will stop immediately after the first test fails.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>-x<span class="w"> </span>test_analytics_v3.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">3</span><span class="w"> </span>items

test_analytics_v3.py::test_logic_error_adult_count<span class="w"> </span>FAILED<span class="w">             </span><span class="o">[</span><span class="w"> </span><span class="m">33</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
_______________________<span class="w"> </span>test_logic_error_adult_count<span class="w"> </span>_______________________

<span class="w">    </span>def<span class="w"> </span>test_logic_error_adult_count<span class="o">()</span>:
<span class="w">        </span><span class="s2">&quot;&quot;&quot;Triggers the adult count logic error.&quot;&quot;&quot;</span>
<span class="w">        </span><span class="nv">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[{</span><span class="s2">&quot;first&quot;</span>:<span class="w"> </span><span class="s2">&quot;Sam&quot;</span>,<span class="w"> </span><span class="s2">&quot;last&quot;</span>:<span class="w"> </span><span class="s2">&quot;Jones&quot;</span>,<span class="w"> </span><span class="s2">&quot;age&quot;</span>:<span class="w"> </span><span class="m">18</span><span class="o">}]</span>
<span class="w">        </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>analyze_user_ages<span class="o">(</span>users<span class="o">)</span>
&gt;<span class="w">       </span>assert<span class="w"> </span>result<span class="o">[</span><span class="s2">&quot;adult_count&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span>
E<span class="w">       </span>assert<span class="w"> </span><span class="nv">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span>
E<span class="w">        </span>+<span class="w">  </span>where<span class="w"> </span><span class="nv">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="s1">&#39;average_age&#39;</span>:<span class="w"> </span><span class="m">18</span>.0,<span class="w"> </span><span class="s1">&#39;adult_count&#39;</span>:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="s1">&#39;user_names&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;Jones, Sam&#39;</span><span class="o">]}[</span><span class="s1">&#39;adult_count&#39;</span><span class="o">]</span>

test_analytics_v3.py:7:<span class="w"> </span><span class="nv">AssertionError</span>
<span class="o">==================</span><span class="w"> </span>stopping<span class="w"> </span>after<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nv">failures</span><span class="w"> </span><span class="o">===================</span>
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
FAILED<span class="w"> </span>test_analytics_v3.py::test_logic_error_adult_count<span class="w"> </span>-<span class="w"> </span>assert<span class="w"> </span><span class="nv">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">1</span>
<span class="o">=======================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed,<span class="w"> </span><span class="m">2</span><span class="w"> </span>deselected<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.12s<span class="w"> </span><span class="o">====================</span>
</code></pre></div>

<h3 id="expected-vs-actual-improvement">Expected vs. Actual Improvement</h3>
<p>The output is now much cleaner.
-   Pytest ran the first test, <code>test_logic_error_adult_count</code>, which failed.
-   It immediately stopped the session, as indicated by the <code>stopping after 1 failures</code> message.
-   The summary shows that one test failed and two were <code>deselected</code> (meaning they were discovered but never run).</p>
<p>This allows us to focus all our attention on fixing the first bug. Once it's fixed, we can rerun the suite and see what the <em>next</em> failure is. This creates a methodical, one-at-a-time debugging workflow.</p>
<h3 id="when-to-apply-this-solution_1">When to Apply This Solution</h3>
<ul>
<li><strong>What it optimizes for</strong>: Developer focus and a clean signal during debugging.</li>
<li><strong>When to choose this approach</strong>:<ul>
<li>During local development, when you've made a change that caused many tests to fail.</li>
<li>In a CI/CD pipeline to get faster feedback. If a fundamental test fails, there's no point in wasting time and resources running hundreds of other tests that are also likely to fail.</li>
</ul>
</li>
<li><strong>When to avoid this approach</strong>: When you are trying to get a complete picture of the health of your test suite and want to see <em>all</em> current failures.</li>
</ul>
<h3 id="limitation-preview_2">Limitation Preview</h3>
<p>Stopping at the first failure is great for focus, but reading the traceback only tells us what happened <em>after the fact</em>. What if we need to inspect the program's state‚Äîthe values of all the variables‚Äîat the exact moment of the crash? For that, we need an interactive debugger.</p>
<h2 id="the-pdb-flag-drop-into-debugger">The --pdb Flag (Drop into Debugger)</h2>
<h2 id="iteration-4-post-mortem-debugging">Iteration 4: Post-Mortem Debugging</h2>
<p>So far, we've been analyzing static reports. The <code>--pdb</code> flag transforms a test failure from a static report into a live, interactive investigation. When a test fails with an exception or a failed assertion, <code>--pdb</code> automatically drops you into the Python Debugger (<code>pdb</code>) at the exact point of failure.</p>
<p>Let's focus on the <code>ZeroDivisionError</code> from our test suite.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_analytics_v4.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_analytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_user_ages</span>

<span class="c1"># Using the buggy version of analyze_user_ages</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_crash_on_empty_list</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Triggers the ZeroDivisionError.&quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
</code></pre></div>

<h3 id="failure-demonstration-dropping-into-pdb">Failure Demonstration: Dropping into PDB</h3>
<p>We'll run this single test with the <code>--pdb</code> flag.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>--pdb<span class="w"> </span>test_analytics_v4.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_analytics_v4.py<span class="w"> </span>F<span class="w">                                               </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
________________________<span class="w"> </span>test_crash_on_empty_list<span class="w"> </span>__________________________

<span class="w">    </span>def<span class="w"> </span>test_crash_on_empty_list<span class="o">()</span>:
<span class="w">        </span><span class="s2">&quot;&quot;&quot;Triggers the ZeroDivisionError.&quot;&quot;&quot;</span>
<span class="w">        </span><span class="nv">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[]</span>
&gt;<span class="w">       </span>analyze_user_ages<span class="o">(</span>users<span class="o">)</span>

test_analytics_v4.py:8:
_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_<span class="w"> </span>_
user_analytics.py:6:<span class="w"> </span><span class="k">in</span><span class="w"> </span>analyze_user_ages
<span class="w">    </span><span class="nv">average_age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>total_age<span class="w"> </span>/<span class="w"> </span>num_users
E<span class="w">   </span>ZeroDivisionError:<span class="w"> </span>division<span class="w"> </span>by<span class="w"> </span>zero

&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="w"> </span>entering<span class="w"> </span>PDB<span class="w"> </span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;<span class="w"> </span>/path/to/project/user_analytics.py<span class="o">(</span><span class="m">6</span><span class="o">)</span>analyze_user_ages<span class="o">()</span>
-&gt;<span class="w"> </span><span class="nv">average_age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>total_age<span class="w"> </span>/<span class="w"> </span>num_users
<span class="o">(</span>Pdb<span class="o">)</span>
</code></pre></div>

<h3 id="diagnostic-analysis-an-interactive-session">Diagnostic Analysis: An Interactive Session</h3>
<p>Notice that the test run has paused. The <code>(Pdb)</code> prompt indicates we are now in an interactive debugging session, stopped on the very line that caused the <code>ZeroDivisionError</code>.</p>
<p>We can now inspect the state of the program. Here are the most common <code>pdb</code> commands:
-   <code>p &lt;expression&gt;</code>: Print the value of an expression.
-   <code>pp &lt;expression&gt;</code>: Pretty-print the value of an expression.
-   <code>l</code> (list): Show the source code around the current line.
-   <code>w</code> (where): Print the full traceback or call stack.
-   <code>up</code> / <code>down</code>: Move up or down the call stack to inspect variables in other functions.
-   <code>c</code> (continue): Resume execution.
-   <code>q</code> (quit): Exit the debugger and the test session.</p>
<p>Let's use these commands to investigate our crash.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>num_users
<span class="m">0</span>
<span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>total_age
<span class="m">0</span>
<span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>users
<span class="o">[]</span>
</code></pre></div>

<p>Instantly, we see the problem. We are trying to divide by <code>num_users</code>, which is <code>0</code>.</p>
<p>Now let's move up the call stack to see where the empty list came from.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>w
<span class="w">  </span>/path/to/project/test_analytics_v4.py<span class="o">(</span><span class="m">8</span><span class="o">)</span>test_crash_on_empty_list<span class="o">()</span>
-&gt;<span class="w"> </span>analyze_user_ages<span class="o">(</span>users<span class="o">)</span>
&gt;<span class="w"> </span>/path/to/project/user_analytics.py<span class="o">(</span><span class="m">6</span><span class="o">)</span>analyze_user_ages<span class="o">()</span>
-&gt;<span class="w"> </span><span class="nv">average_age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>total_age<span class="w"> </span>/<span class="w"> </span>num_users
<span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>up
&gt;<span class="w"> </span>/path/to/project/test_analytics_v4.py<span class="o">(</span><span class="m">8</span><span class="o">)</span>test_crash_on_empty_list<span class="o">()</span>
-&gt;<span class="w"> </span>analyze_user_ages<span class="o">(</span>users<span class="o">)</span>
<span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>users
<span class="o">[]</span>
</code></pre></div>

<p>By using <code>up</code>, we've moved from the <code>analyze_user_ages</code> function back into our test function, <code>test_crash_on_empty_list</code>. Printing <code>users</code> here confirms that we passed an empty list into the function, which is the ultimate source of the error.</p>
<p><strong>Root cause identified</strong>: The function does not handle an empty <code>users</code> list, leading to division by zero.</p>
<h3 id="when-to-apply-this-solution_2">When to Apply This Solution</h3>
<ul>
<li><strong>What it optimizes for</strong>: Deep, interactive inspection of program state at the moment of failure.</li>
<li><strong>When to choose this approach</strong>: When a traceback isn't enough to understand <em>why</em> a variable has a certain value. It's the go-to tool for complex bugs that cause crashes or assertion failures.</li>
<li><strong>When to avoid this approach</strong>: In non-interactive environments like a CI/CD pipeline. This tool is for local, hands-on debugging.</li>
</ul>
<h3 id="limitation-preview_3">Limitation Preview</h3>
<p>The <code>--pdb</code> flag is a "post-mortem" tool‚Äîit only activates <em>after</em> an error has occurred. But what if a test fails a simple assertion, and the problem actually happened much earlier, like inside a loop? We need a way to pause execution <em>before</em> the failure, at a location of our choosing.</p>
<h2 id="using-breakpoints-in-tests">Using Breakpoints in Tests</h2>
<h2 id="iteration-5-proactive-debugging-with-breakpoint">Iteration 5: Proactive Debugging with <code>breakpoint()</code></h2>
<p>Sometimes, the line that fails is not the line with the bug. The bug might be a subtle logic error inside a loop that corrupts a value, with the assertion failure only happening much later. For these cases, we need to set a trap‚Äîa breakpoint‚Äîto pause execution at a specific line we want to investigate.</p>
<p>Let's return to our <code>adult_count</code> logical error. The assertion <code>assert result["adult_count"] == 1</code> fails, but the real bug is inside the <code>for</code> loop in the <code>analyze_user_ages</code> function. Using <code>--pdb</code> would just drop us at the <code>assert</code> line, which is too late. We want to see what's happening <em>inside the loop</em>.</p>
<h3 id="technique-introduced-breakpoint">Technique Introduced: <code>breakpoint()</code></h3>
<p>Since Python 3.7, the built-in <code>breakpoint()</code> function is the standard way to set a debugger breakpoint. (In older versions, you would use <code>import pdb; pdb.set_trace()</code>). When the Python interpreter encounters this function, it pauses execution and starts a <code>pdb</code> session, just like <code>--pdb</code>, but at the exact location you specified.</p>
<p>Let's add a breakpoint to our application code to inspect the loop.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_analytics.py (with breakpoint)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="n">adult_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="nb">breakpoint</span><span class="p">()</span> <span class="c1"># Pause execution here on every iteration</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">:</span>
            <span class="n">adult_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># test_analytics_v5.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_analytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">analyze_user_ages</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_logic_error_with_breakpoint</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses a breakpoint in the source code to debug the adult count logic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="s2">&quot;Jane&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Smith&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="s2">&quot;Sam&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="s2">&quot;Jones&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">},</span>
    <span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;adult_count&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div>

<h3 id="failure-demonstration-stepping-through-code">Failure Demonstration: Stepping Through Code</h3>
<p>Now, run the test. Pytest will start the test, and execution will pause as soon as it hits our <code>breakpoint()</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_analytics_v5.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_analytics_v5.py
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="w"> </span>PDB<span class="w"> </span>set_trace<span class="w"> </span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;<span class="w"> </span>/path/to/project/user_analytics.py<span class="o">(</span><span class="m">13</span><span class="o">)</span>analyze_user_ages<span class="o">()</span>
-&gt;<span class="w"> </span><span class="k">if</span><span class="w"> </span>user<span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">18</span>:
<span class="o">(</span>Pdb<span class="o">)</span>
</code></pre></div>

<p>We are now paused at the beginning of the first loop iteration. Let's inspect the state.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>user
<span class="o">{</span><span class="s1">&#39;first&#39;</span>:<span class="w"> </span><span class="s1">&#39;Jane&#39;</span>,<span class="w"> </span><span class="s1">&#39;last&#39;</span>:<span class="w"> </span><span class="s1">&#39;Smith&#39;</span>,<span class="w"> </span><span class="s1">&#39;age&#39;</span>:<span class="w"> </span><span class="m">17</span><span class="o">}</span>
<span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>adult_count
<span class="m">0</span>
</code></pre></div>

<p>This looks correct. The user is 17, and the count is 0. Let's type <code>c</code> (continue) to proceed to the next iteration. The code will run through the loop once and stop at the <code>breakpoint()</code> again.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>c
&gt;<span class="w"> </span>/path/to/project/user_analytics.py<span class="o">(</span><span class="m">13</span><span class="o">)</span>analyze_user_ages<span class="o">()</span>
-&gt;<span class="w"> </span><span class="k">if</span><span class="w"> </span>user<span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">18</span>:
<span class="o">(</span>Pdb<span class="o">)</span>
</code></pre></div>

<p>Now we're in the second iteration. Let's inspect again.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>user
<span class="o">{</span><span class="s1">&#39;first&#39;</span>:<span class="w"> </span><span class="s1">&#39;Sam&#39;</span>,<span class="w"> </span><span class="s1">&#39;last&#39;</span>:<span class="w"> </span><span class="s1">&#39;Jones&#39;</span>,<span class="w"> </span><span class="s1">&#39;age&#39;</span>:<span class="w"> </span><span class="m">18</span><span class="o">}</span>
<span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>adult_count
<span class="m">0</span>
</code></pre></div>

<p>Here is our "Aha!" moment. The current user is 18, but <code>adult_count</code> is still 0 from the previous iteration. We can now execute the <em>next</em> line of code using the <code>n</code> (next) command to see what happens.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>n
&gt;<span class="w"> </span>/path/to/project/user_analytics.py<span class="o">(</span><span class="m">14</span><span class="o">)</span>analyze_user_ages<span class="o">()</span>
-&gt;<span class="w"> </span><span class="nv">adult_count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m">1</span>
<span class="o">(</span>Pdb<span class="o">)</span>
</code></pre></div>

<p>Wait, that's not right. The debugger prompt shows that the next line to be executed is <code>adult_count += 1</code>. But the condition <code>if user['age'] &gt; 18</code> should have been false! Let's re-check the condition ourselves.</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span>Pdb<span class="o">)</span><span class="w"> </span>p<span class="w"> </span>user<span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">18</span>
False
</code></pre></div>

<p>Ah, the debugger stepped <em>over</em> the <code>if</code> block because the condition was false. This is the moment we realize our logic is wrong. The condition <code>user['age'] &gt; 18</code> evaluates to <code>False</code> for the 18-year-old user, so <code>adult_count</code> is never incremented. The logic should have been <code>user['age'] &gt;= 18</code>.</p>
<p><strong>Root cause identified</strong>: By stepping through the code line-by-line and inspecting variables, we proved that our conditional logic was incorrect for the edge case.</p>
<h3 id="limitation-preview_4">Limitation Preview</h3>
<p>Interactive debugging is the most powerful tool in our arsenal, but it can be slow and cumbersome. For simpler problems, or to get a high-level overview of a function's execution, it's often overkill. Sometimes, all we need is a simple log of what happened, without having to manually step through the code.</p>
<h2 id="logging-and-debugging-information">Logging and Debugging Information</h2>
<h2 id="iteration-6-tracing-execution-with-logs-and-prints">Iteration 6: Tracing Execution with Logs and Prints</h2>
<p>The final debugging technique is often the simplest: printing or logging information as your code executes. This is less interactive than a debugger but provides a quick and easy way to trace a program's flow and inspect variable values at different points in time.</p>
<p>Pytest has special handling for both <code>print()</code> statements and Python's built-in <code>logging</code> module.</p>
<h3 id="technique-introduced-capturing-output">Technique Introduced: Capturing Output</h3>
<p>By default, pytest captures any output sent to <code>stdout</code> (like from <code>print()</code>) and <code>stderr</code>. It will only display this captured output for <em>failing</em> tests. This keeps your test runs clean when everything is passing.</p>
<p>Let's add some <code>print</code> statements to our function to see what's going on.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_analytics.py (with print statements)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analyzing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span><span class="si">}</span><span class="s2"> users...&quot;</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="n">adult_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">is_adult</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">18</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Processing </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: age </span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, is_adult: </span><span class="si">{</span><span class="n">is_adult</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_adult</span><span class="p">:</span>
            <span class="n">adult_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="o">...</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysis complete. Found </span><span class="si">{</span><span class="n">adult_count</span><span class="si">}</span><span class="s2"> adults.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div>

<p>Now, let's rerun our failing test for the logic error (<code>test_analytics_v5.py</code>).</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_analytics_v5.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_analytics_v5.py<span class="w"> </span>F<span class="w">                                               </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
______________________<span class="w"> </span>test_logic_error_with_breakpoint<span class="w"> </span>______________________
...<span class="w"> </span><span class="o">(</span>traceback<span class="w"> </span>and<span class="w"> </span>assertion<span class="w"> </span>introspection<span class="o">)</span><span class="w"> </span>...
--------------------------<span class="w"> </span>Captured<span class="w"> </span>stdout<span class="w"> </span>call<span class="w"> </span>---------------------------
Analyzing<span class="w"> </span><span class="m">2</span><span class="w"> </span>users...
<span class="w">  </span>-<span class="w"> </span>Processing<span class="w"> </span>Jane:<span class="w"> </span>age<span class="w"> </span><span class="m">17</span>,<span class="w"> </span>is_adult:<span class="w"> </span>False
<span class="w">  </span>-<span class="w"> </span>Processing<span class="w"> </span>Sam:<span class="w"> </span>age<span class="w"> </span><span class="m">18</span>,<span class="w"> </span>is_adult:<span class="w"> </span>True
Analysis<span class="w"> </span>complete.<span class="w"> </span>Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>adults.
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
...
</code></pre></div>

<p>The output from our <code>print</code> statements appears in a dedicated <code>Captured stdout call</code> section for the failing test. This log clearly shows the intermediate state and can often be enough to spot the bug without a full debugger session.</p>
<h3 id="displaying-output-for-passing-tests-with-s">Displaying Output for Passing Tests with <code>-s</code></h3>
<p>If you want to see the output even for passing tests, you can use the <code>-s</code> flag (or <code>--capture=no</code>). This disables all output capturing and prints directly to the console.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-s<span class="w"> </span>test_analytics_v5.py<span class="w"> </span><span class="c1"># Assuming the test now passes</span>
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_analytics_v5.py
Analyzing<span class="w"> </span><span class="m">2</span><span class="w"> </span>users...
<span class="w">  </span>-<span class="w"> </span>Processing<span class="w"> </span>Jane:<span class="w"> </span>age<span class="w"> </span><span class="m">17</span>,<span class="w"> </span>is_adult:<span class="w"> </span>False
<span class="w">  </span>-<span class="w"> </span>Processing<span class="w"> </span>Sam:<span class="w"> </span>age<span class="w"> </span><span class="m">18</span>,<span class="w"> </span>is_adult:<span class="w"> </span>True
Analysis<span class="w"> </span>complete.<span class="w"> </span>Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>adults.
.<span class="w">                                                                    </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">============================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01s<span class="w"> </span><span class="o">=============================</span>
</code></pre></div>

<h3 id="using-the-logging-module">Using the <code>logging</code> Module</h3>
<p>While <code>print</code> is easy, Python's <code>logging</code> module is more powerful and configurable. Pytest also captures log messages and can display them based on a specified log level.</p>
<p>To use it, you configure a logger and use it instead of <code>print</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_analytics.py (with logging)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analyzing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span><span class="si">}</span><span class="s2"> users...&quot;</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">is_adult</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">18</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Processing </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: age </span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, is_adult: </span><span class="si">{</span><span class="n">is_adult</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="o">...</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analysis complete. Found </span><span class="si">{</span><span class="n">adult_count</span><span class="si">}</span><span class="s2"> adults.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div>

<p>To see these logs, you need to tell pytest the minimum level to display.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Show logs at INFO level and above</span>
$<span class="w"> </span>pytest<span class="w"> </span>--log-cli-level<span class="o">=</span>INFO

<span class="c1"># Show all logs, including DEBUG level</span>
$<span class="w"> </span>pytest<span class="w"> </span>--log-cli-level<span class="o">=</span>DEBUG
</code></pre></div>

<p>This will produce a <code>Captured log call</code> section in the report for failing tests, similar to the one for <code>stdout</code>.</p>
<h3 id="when-to-apply-this-solution_3">When to Apply This Solution</h3>
<ul>
<li><strong><code>print</code> with <code>-s</code></strong>: Best for quick, temporary debugging. It's simple and effective for tracing values.</li>
<li><strong><code>logging</code> with <code>--log-cli-level</code></strong>: A more robust, permanent solution. It allows you to have different levels of verbosity (e.g., <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>) and to enable them in tests without modifying the application code. This is the preferred method for libraries or long-lived applications.</li>
</ul>
<h2 id="synthesis-the-complete-journey">Synthesis: The Complete Journey</h2>
<p>We started with a buggy function and systematically used pytest's debugging tools to find and fix three distinct types of errors: a crash (<code>KeyError</code>), a silent logical error, and another crash (<code>ZeroDivisionError</code>).</p>
<h3 id="the-journey-from-problem-to-solution">The Journey: From Problem to Solution</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">Iteration</th>
<th style="text-align: left;">Failure Mode</th>
<th style="text-align: left;">Technique Applied</th>
<th style="text-align: left;">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: left;"><code>KeyError</code> crash</td>
<td style="text-align: left;">Reading the traceback</td>
<td style="text-align: left;">Identified the exact line causing the crash due to missing data.</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Incorrect <code>adult_count</code></td>
<td style="text-align: left;">Assertion introspection &amp; <code>-v</code></td>
<td style="text-align: left;">Pinpointed a logical error by comparing expected vs. actual values.</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Multiple cascading errors</td>
<td style="text-align: left;"><code>-x</code> (stop on first failure)</td>
<td style="text-align: left;">Focused the debugging effort by isolating the first failure.</td>
</tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: left;"><code>ZeroDivisionError</code> crash</td>
<td style="text-align: left;"><code>--pdb</code> (post-mortem debugger)</td>
<td style="text-align: left;">Interactively inspected variables at the crash site to find cause.</td>
</tr>
<tr>
<td style="text-align: left;">5</td>
<td style="text-align: left;">Hard-to-find logic error</td>
<td style="text-align: left;"><code>breakpoint()</code> (proactive debugging)</td>
<td style="text-align: left;">Paused execution inside a loop to observe state changes over time.</td>
</tr>
<tr>
<td style="text-align: left;">6</td>
<td style="text-align: left;">Need for execution trace</td>
<td style="text-align: left;"><code>print()</code>/<code>logging</code> with pytest capture options</td>
<td style="text-align: left;">Generated a persistent trace of the function's execution path.</td>
</tr>
</tbody>
</table>
<h3 id="final-implementation">Final Implementation</h3>
<p>Here is the final, corrected version of our function, ready for production.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_analytics.py (final version)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_user_ages</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyzes a list of user data, returning statistics.</span>
<span class="sd">    - Calculates average age.</span>
<span class="sd">    - Counts number of adults (age &gt;= 18).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">num_users</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;analyze_user_ages called with an empty list.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;average_age&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;adult_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;user_names&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="n">total_age</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">)</span>
    <span class="n">average_age</span> <span class="o">=</span> <span class="n">total_age</span> <span class="o">/</span> <span class="n">num_users</span>

    <span class="n">adult_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">:</span>
            <span class="n">adult_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">user_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;average_age&quot;</span><span class="p">:</span> <span class="n">average_age</span><span class="p">,</span>
        <span class="s2">&quot;adult_count&quot;</span><span class="p">:</span> <span class="n">adult_count</span><span class="p">,</span>
        <span class="s2">&quot;user_names&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">user_names</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div>

<h3 id="decision-framework-which-debugging-tool-when">Decision Framework: Which Debugging Tool When?</h3>
<p>When a test fails, use this mental flowchart to choose the right tool for the job.</p>
<ol>
<li>
<p><strong>Start Here: A test fails.</strong></p>
<ul>
<li><strong>Action</strong>: Read the full pytest output carefully.</li>
<li><strong>Question</strong>: Is the problem obvious from the traceback and assertion introspection?<ul>
<li><strong>Yes</strong>: Fix the bug. You're done!</li>
<li><strong>No</strong>: Proceed to step 2.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Problem: The output is overwhelming with many failures.</strong></p>
<ul>
<li><strong>Tool</strong>: <code>pytest -x</code></li>
<li><strong>Action</strong>: Rerun tests to stop at the very first failure. Focus on fixing that one.</li>
</ul>
</li>
<li>
<p><strong>Problem: The test crashes with an exception, and the traceback isn't enough to understand why.</strong></p>
<ul>
<li><strong>Tool</strong>: <code>pytest --pdb</code></li>
<li><strong>Action</strong>: Rerun the test. At the <code>(Pdb)</code> prompt, inspect variables (<code>p var_name</code>) to understand the program's state at the moment of the crash.</li>
</ul>
</li>
<li>
<p><strong>Problem: The test fails an assertion (the result is wrong), but doesn't crash.</strong></p>
<ul>
<li><strong>Tool</strong>: <code>breakpoint()</code></li>
<li><strong>Action</strong>: Add <code>breakpoint()</code> to your application code just before the section you suspect is buggy. Rerun the test and step through the code (<code>n</code>), inspecting variables (<code>p var_name</code>) along the way.</li>
</ul>
</li>
<li>
<p><strong>Problem: You just need a quick trace of values without an interactive session.</strong></p>
<ul>
<li><strong>Tool</strong>: <code>print()</code> statements and <code>pytest -s</code>.</li>
<li><strong>Action</strong>: Add <code>print()</code> calls at key points in your code. Rerun with <code>-s</code> to see the output. This is great for "printf debugging."</li>
</ul>
</li>
<li>
<p><strong>Problem: You want to add permanent, configurable tracing to your application.</strong></p>
<ul>
<li><strong>Tool</strong>: Python's <code>logging</code> module and <code>pytest --log-cli-level=...</code>.</li>
<li><strong>Action</strong>: Add <code>log.info()</code> or <code>log.debug()</code> calls. Control their visibility in tests using pytest's command-line flags.</li>
</ul>
</li>
</ol>
<p>By mastering this toolkit, you can systematically and efficiently diagnose any test failure, turning bugs from frustrating mysteries into solvable puzzles.</p>
        </div>
        <div class="footer">
            Generated on 2025-11-24 14:31:16 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>