<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17 Debugging Failing Tests</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">05 Real-World Testing</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-17-debugging-failing-tests">Chapter 17: Debugging Failing Tests</h1>
<h2 id="reading-test-output">Reading Test Output</h2>
<h2 id="the-anatomy-of-a-test-failure">The Anatomy of a Test Failure</h2>
<p>When a test fails, pytest doesn't just tell you "something broke"‚Äîit provides a detailed narrative of exactly what happened, where it happened, and why it happened. Learning to read this output systematically transforms debugging from guesswork into detective work.</p>
<p>Let's establish our reference implementation: a payment processing system that we'll use throughout this chapter to demonstrate debugging techniques.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payment_processor.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PaymentProcessor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_client</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span> <span class="o">=</span> <span class="n">api_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">card_number</span><span class="p">,</span> <span class="n">cvv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a payment and return transaction ID.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Amount must be positive&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">card_number</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid card number&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cvv</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid CVV&quot;</span><span class="p">)</span>

        <span class="c1"># Simulate API call</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
            <span class="n">card</span><span class="o">=</span><span class="n">card_number</span><span class="p">,</span>
            <span class="n">cvv</span><span class="o">=</span><span class="n">cvv</span>
        <span class="p">)</span>

        <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;transaction_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">transaction_id</span><span class="p">,</span>
            <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">transaction_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a transaction by ID.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">transaction_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">transaction</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MockAPIClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">should_fail</span> <span class="o">=</span> <span class="n">should_fail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">cvv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_fail</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;API unavailable&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;transaction_id&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;TXN_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">call_count</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span>
        <span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># test_payment_processor.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_successful_payment</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that a valid payment is processed correctly.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction_id</span> <span class="o">==</span> <span class="s1">&#39;TXN_1&#39;</span>
    <span class="k">assert</span> <span class="n">api_client</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="c1"># Verify transaction was logged</span>
    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">100.00</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;completed&#39;</span>
</code></pre></div>

<p>This test passes. Now let's introduce a realistic bug and examine the failure output in detail.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_payment_processor.py (continued)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_decimal_amount</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test payment with precise decimal amount.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">99.99</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
    <span class="c1"># Bug: We expect exact decimal match, but floating point arithmetic might fail</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">99.99</span>
</code></pre></div>

<p>Let's run this test and capture the complete output:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_processor.py::test_payment_with_decimal_amount<span class="w"> </span>-v
</code></pre></div>

<p><strong>The complete output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
platform linux -- Python 3.11.0, pytest-7.4.3, pluggy-1.3.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/user/project
collected 1 item

test_payment_processor.py::test_payment_with_decimal_amount PASSED      [100%]

============================== 1 passed in 0.02s ===============================
</code></pre></div>

<p>Wait‚Äîthis test passed! That's because our simple implementation doesn't have the floating-point bug yet. Let's introduce a more realistic scenario where the bug manifests.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payment_processor.py (modified)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PaymentProcessor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_client</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span> <span class="o">=</span> <span class="n">api_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fee_percentage</span> <span class="o">=</span> <span class="mf">0.029</span>  <span class="c1"># 2.9% processing fee</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">card_number</span><span class="p">,</span> <span class="n">cvv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a payment and return transaction ID.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Amount must be positive&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">card_number</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid card number&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cvv</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid CVV&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate fee and net amount</span>
        <span class="n">fee</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fee_percentage</span>
        <span class="n">net_amount</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">fee</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
            <span class="n">card</span><span class="o">=</span><span class="n">card_number</span><span class="p">,</span>
            <span class="n">cvv</span><span class="o">=</span><span class="n">cvv</span>
        <span class="p">)</span>

        <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;transaction_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">transaction_id</span><span class="p">,</span>
            <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
            <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="n">fee</span><span class="p">,</span>
            <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="n">net_amount</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">transaction_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a transaction by ID.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">transaction_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">transaction</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># test_payment_processor.py (updated test)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_fee_calculation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that processing fees are calculated correctly.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

    <span class="c1"># Expected: 2.9% of $100.00 = $2.90</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">2.90</span>
    <span class="c1"># Expected: $100.00 - $2.90 = $97.10</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;net_amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">97.10</span>
</code></pre></div>

<p>Now let's run this test:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_processor.py::test_payment_fee_calculation<span class="w"> </span>-v
</code></pre></div>

<p><strong>The complete output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
platform linux -- Python 3.11.0, pytest-7.4.3, pluggy-1.3.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/user/project
collected 1 item

test_payment_processor.py::test_payment_fee_calculation FAILED          [100%]

=================================== FAILURES ===================================
___________________________ test_payment_fee_calculation _______________________

    def test_payment_fee_calculation():
        &quot;&quot;&quot;Test that processing fees are calculated correctly.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        transaction_id = processor.process_payment(
            amount=100.00,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

        transaction = processor.get_transaction(transaction_id)

        # Expected: 2.9% of $100.00 = $2.90
<span class="k">&gt; </span><span class="ge">      assert transaction[&#39;fee&#39;] == 2.90</span>
E       AssertionError: assert 2.8999999999999995 == 2.90
E        +  where 2.8999999999999995 = {&#39;id&#39;: &#39;TXN_1&#39;, &#39;amount&#39;: 100.0, &#39;fee&#39;: 2.8999999999999995, &#39;net_amount&#39;: 97.10000000000001, &#39;status&#39;: &#39;completed&#39;}[&#39;fee&#39;]

test_payment_processor.py:25: AssertionError
=========================== 1 passed, 1 failed in 0.03s =======================
</code></pre></div>

<p>Perfect! Now we have a real failure to dissect.</p>
<h3 id="diagnostic-analysis-reading-the-failure">Diagnostic Analysis: Reading the Failure</h3>
<p>Let's parse this output section by section to extract every piece of information pytest provides.</p>
<p><strong>Section 1: The Test Session Header</strong></p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
platform linux -- Python 3.11.0, pytest-7.4.3, pluggy-1.3.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/user/project
collected 1 item
</code></pre></div>

<p><strong>What this tells us</strong>:
- <strong>Platform and versions</strong>: We're running on Linux with Python 3.11.0 and pytest 7.4.3
- <strong>Cache location</strong>: Pytest stores test results in <code>.pytest_cache</code> for features like <code>--lf</code> (last failed)
- <strong>Root directory</strong>: The project root is <code>/home/user/project</code>
- <strong>Collection count</strong>: Pytest found exactly 1 test to run</p>
<p><strong>Why this matters</strong>: Version information helps reproduce issues. If a test passes on your machine but fails in CI, version differences are the first suspect.</p>
<p><strong>Section 2: The Test Execution Line</strong></p>
<div class="codehilite"><pre><span></span><code>test_payment_processor.py::test_payment_fee_calculation FAILED          [100%]
</code></pre></div>

<p><strong>What this tells us</strong>:
- <strong>File location</strong>: <code>test_payment_processor.py</code>
- <strong>Test name</strong>: <code>test_payment_fee_calculation</code>
- <strong>Result</strong>: <code>FAILED</code>
- <strong>Progress</strong>: <code>[100%]</code> means this was the only test (or the last of multiple tests)</p>
<p><strong>Why this matters</strong>: The <code>::</code> syntax shows you exactly how to re-run just this test: <code>pytest test_payment_processor.py::test_payment_fee_calculation</code></p>
<p><strong>Section 3: The Failures Section Header</strong></p>
<div class="codehilite"><pre><span></span><code>=================================== FAILURES ===================================
___________________________ test_payment_fee_calculation _______________________
</code></pre></div>

<p><strong>What this tells us</strong>:
- This section contains detailed information about all failed tests
- The underscored line shows which specific test failed</p>
<p><strong>Section 4: The Traceback</strong></p>
<div class="codehilite"><pre><span></span><code>    def test_payment_fee_calculation():
        &quot;&quot;&quot;Test that processing fees are calculated correctly.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        transaction_id = processor.process_payment(
            amount=100.00,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

        transaction = processor.get_transaction(transaction_id)

        # Expected: 2.9% of $100.00 = $2.90
<span class="k">&gt; </span><span class="ge">      assert transaction[&#39;fee&#39;] == 2.90</span>
</code></pre></div>

<p><strong>What this tells us</strong>:
- The <code>&gt;</code> marker points to the exact line that failed
- We can see the full context of the test function
- The failure occurred at line 25 in the test file</p>
<p><strong>Why this matters</strong>: The traceback shows you the execution path. For complex tests with multiple assertions, this pinpoints exactly which assertion failed.</p>
<p><strong>Section 5: The Assertion Introspection</strong></p>
<div class="codehilite"><pre><span></span><code>E       AssertionError: assert 2.8999999999999995 == 2.90
E        +  where 2.8999999999999995 = {&#39;id&#39;: &#39;TXN_1&#39;, &#39;amount&#39;: 100.0, &#39;fee&#39;: 2.8999999999999995, &#39;net_amount&#39;: 97.10000000000001, &#39;status&#39;: &#39;completed&#39;}[&#39;fee&#39;]
</code></pre></div>

<p><strong>What this tells us</strong>:
- <strong>The comparison</strong>: <code>2.8999999999999995 == 2.90</code> (False)
- <strong>The actual value</strong>: <code>2.8999999999999995</code>
- <strong>The expected value</strong>: <code>2.90</code>
- <strong>The source</strong>: The value came from <code>transaction['fee']</code>
- <strong>The full object</strong>: We can see the entire transaction dictionary</p>
<p><strong>Why this matters</strong>: This is pytest's "assertion introspection"‚Äîit shows you not just that the assertion failed, but the actual values involved and where they came from. Notice how pytest automatically expanded <code>transaction['fee']</code> to show us the full dictionary.</p>
<p><strong>Section 6: The Location Reference</strong></p>
<div class="codehilite"><pre><span></span><code>test_payment_processor.py:25: AssertionError
</code></pre></div>

<p><strong>What this tells us</strong>:
- The exact file and line number where the assertion failed
- The exception type: <code>AssertionError</code></p>
<p><strong>Section 7: The Summary Line</strong></p>
<div class="codehilite"><pre><span></span><code>=========================== 1 passed, 1 failed in 0.03s =======================
</code></pre></div>

<p><strong>What this tells us</strong>:
- <strong>Total results</strong>: 1 test passed (from earlier), 1 test failed
- <strong>Execution time</strong>: 0.03 seconds
- <strong>Overall status</strong>: The test suite failed</p>
<h3 id="root-cause-identified">Root Cause Identified</h3>
<p>The failure reveals a <strong>floating-point precision issue</strong>. When we calculate <code>100.00 * 0.029</code>, Python's floating-point arithmetic produces <code>2.8999999999999995</code> instead of the exact decimal <code>2.90</code>.</p>
<h3 id="why-the-current-approach-cant-solve-this">Why the Current Approach Can't Solve This</h3>
<p>Using exact equality (<code>==</code>) for floating-point comparisons is fundamentally flawed because:
1. Binary floating-point cannot represent most decimal fractions exactly
2. Arithmetic operations accumulate rounding errors
3. The error is mathematically unavoidable in IEEE 754 floating-point</p>
<h3 id="what-we-need">What We Need</h3>
<p>A comparison method that allows for acceptable tolerance in floating-point assertions. This is where <code>pytest.approx()</code> becomes essential.</p>
<h2 id="reading-output-systematically-a-checklist">Reading Output Systematically: A Checklist</h2>
<p>When a test fails, read the output in this order:</p>
<h3 id="1-start-with-the-summary-line-bottom">1. Start with the Summary Line (Bottom)</h3>
<ul>
<li>How many tests failed?</li>
<li>How many passed?</li>
<li>Is this an isolated failure or part of a larger pattern?</li>
</ul>
<h3 id="2-identify-the-failed-test-failures-section">2. Identify the Failed Test (Failures Section)</h3>
<ul>
<li>Which test failed?</li>
<li>What file is it in?</li>
<li>Can you run just this test in isolation?</li>
</ul>
<h3 id="3-locate-the-failure-point-traceback">3. Locate the Failure Point (Traceback)</h3>
<ul>
<li>Which line has the <code>&gt;</code> marker?</li>
<li>What assertion failed?</li>
<li>What was the test trying to verify?</li>
</ul>
<h3 id="4-understand-the-values-assertion-introspection">4. Understand the Values (Assertion Introspection)</h3>
<ul>
<li>What was the actual value?</li>
<li>What was the expected value?</li>
<li>How do they differ?</li>
<li>Can you see the full objects involved?</li>
</ul>
<h3 id="5-check-the-context-full-traceback">5. Check the Context (Full Traceback)</h3>
<ul>
<li>What code ran before the failure?</li>
<li>Are there any clues in the setup?</li>
<li>Did the test get as far as you expected?</li>
</ul>
<h3 id="6-look-for-patterns-multiple-failures">6. Look for Patterns (Multiple Failures)</h3>
<ul>
<li>If multiple tests failed, do they share common characteristics?</li>
<li>Are they all in the same module?</li>
<li>Do they all test the same functionality?</li>
</ul>
<h2 id="common-output-patterns-and-what-they-mean">Common Output Patterns and What They Mean</h2>
<h3 id="pattern-1-assertionerror-with-value-comparison">Pattern 1: AssertionError with Value Comparison</h3>
<div class="codehilite"><pre><span></span><code>E       AssertionError: assert 2.8999999999999995 == 2.90
</code></pre></div>

<p><strong>Diagnosis</strong>: The assertion compared two values and they didn't match.
<strong>Common causes</strong>: 
- Floating-point precision issues
- Off-by-one errors
- Incorrect expected values
- Logic bugs in the code under test</p>
<h3 id="pattern-2-attributeerror">Pattern 2: AttributeError</h3>
<div class="codehilite"><pre><span></span><code>E       AttributeError: &#39;NoneType&#39; object has no attribute &#39;fee&#39;
</code></pre></div>

<p><strong>Diagnosis</strong>: You tried to access an attribute on <code>None</code>.
<strong>Common causes</strong>:
- A function returned <code>None</code> instead of an object
- A lookup failed (like <code>get_transaction()</code> returning <code>None</code>)
- Initialization didn't happen</p>
<h3 id="pattern-3-keyerror">Pattern 3: KeyError</h3>
<div class="codehilite"><pre><span></span><code>E       KeyError: &#39;transaction_id&#39;
</code></pre></div>

<p><strong>Diagnosis</strong>: You tried to access a dictionary key that doesn't exist.
<strong>Common causes</strong>:
- Typo in the key name
- The API response structure changed
- The dictionary wasn't populated as expected</p>
<h3 id="pattern-4-typeerror">Pattern 4: TypeError</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">E</span><span class="w">       </span><span class="nx">TypeError</span><span class="p">:</span><span class="w"> </span><span class="nx">unsupported</span><span class="w"> </span><span class="nx">operand</span><span class="w"> </span><span class="k">type</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">-</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">str</span><span class="err">&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">float</span><span class="err">&#39;</span>
</code></pre></div>

<p><strong>Diagnosis</strong>: You tried to perform an operation on incompatible types.
<strong>Common causes</strong>:
- Data wasn't converted to the expected type
- API returned strings instead of numbers
- Missing type validation</p>
<h3 id="pattern-5-indexerror">Pattern 5: IndexError</h3>
<div class="codehilite"><pre><span></span><code>E       IndexError: list index out of range
</code></pre></div>

<p><strong>Diagnosis</strong>: You tried to access a list element that doesn't exist.
<strong>Common causes</strong>:
- Empty list when you expected items
- Off-by-one error in indexing
- Loop logic error</p>
<h2 id="the-power-of-assertion-introspection">The Power of Assertion Introspection</h2>
<p>Pytest's assertion introspection is one of its most powerful features. Let's see it in action with different types of comparisons.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_introspection_examples.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_list_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate introspection for list comparison.&quot;&quot;&quot;</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_dict_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate introspection for dictionary comparison.&quot;&quot;&quot;</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span>
        <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;alice@example.com&#39;</span>
    <span class="p">}</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span>
        <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;alice@example.com&#39;</span>
    <span class="p">}</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_string_comparison</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate introspection for string comparison.&quot;&quot;&quot;</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="s2">&quot;The quick brown fox jumps over the lazy dog&quot;</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="s2">&quot;The quick brown fox jumps over the lazy cat&quot;</span>
    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>

<p>Running these tests produces detailed output showing exactly where the differences are:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_introspection_examples.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output for list comparison</strong>:</p>
<div class="codehilite"><pre><span></span><code>E       AssertionError: assert [1, 2, 3, 4, 6] == [1, 2, 3, 4, 5]
E         At index 4 diff: 6 != 5
E         Use -v to get more diff
</code></pre></div>

<p><strong>What this tells us</strong>: Pytest identified that the lists differ at index 4, where we have <code>6</code> instead of <code>5</code>.</p>
<p><strong>Output for dictionary comparison</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">E</span><span class="w">       </span><span class="nl">AssertionError</span><span class="p">:</span><span class="w"> </span><span class="n">assert</span><span class="w"> </span><span class="err">{</span><span class="s1">&#39;age&#39;</span><span class="err">:</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;...e@example.com&#39;</span><span class="err">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">{</span><span class="s1">&#39;age&#39;</span><span class="err">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;...e@example.com&#39;</span><span class="err">}</span>
<span class="n">E</span><span class="w">         </span><span class="n">Omitting</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">identical</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="o">-</span><span class="n">vv</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">show</span>
<span class="n">E</span><span class="w">         </span><span class="n">Differing</span><span class="w"> </span><span class="nl">items</span><span class="p">:</span>
<span class="n">E</span><span class="w">         </span><span class="err">{</span><span class="s1">&#39;age&#39;</span><span class="err">:</span><span class="w"> </span><span class="mi">31</span><span class="err">}</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="err">{</span><span class="s1">&#39;age&#39;</span><span class="err">:</span><span class="w"> </span><span class="mi">30</span><span class="err">}</span>
</code></pre></div>

<p><strong>What this tells us</strong>: Pytest shows only the differing keys, omitting the identical ones. The <code>age</code> field is <code>31</code> but should be <code>30</code>.</p>
<p><strong>Output for string comparison</strong>:</p>
<div class="codehilite"><pre><span></span><code>E       AssertionError: assert &#39;The quick br...r the lazy cat&#39; == &#39;The quick br...r the lazy dog&#39;
E         - The quick brown fox jumps over the lazy dog
E         ?                                         ^^^
E         + The quick brown fox jumps over the lazy cat
E         ?                                         ^^^
</code></pre></div>

<p><strong>What this tells us</strong>: Pytest shows a diff-style comparison with <code>?</code> markers pointing to the exact characters that differ.</p>
<h2 id="practical-exercise-reading-real-failure-output">Practical Exercise: Reading Real Failure Output</h2>
<p>Let's create a more complex scenario that demonstrates multiple types of failures.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_complex_scenario.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_multiple_payments_tracking</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that multiple payments are tracked correctly.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Process three payments</span>
    <span class="n">txn1</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="mf">100.00</span><span class="p">,</span> <span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">)</span>
    <span class="n">txn2</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="mf">200.00</span><span class="p">,</span> <span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">)</span>
    <span class="n">txn3</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="mf">300.00</span><span class="p">,</span> <span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">)</span>

    <span class="c1"># Verify all transactions are logged</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>

    <span class="c1"># Verify transaction IDs are unique</span>
    <span class="n">transaction_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">txn1</span><span class="p">,</span> <span class="n">txn2</span><span class="p">,</span> <span class="n">txn3</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">transaction_ids</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span>

    <span class="c1"># Verify we can retrieve each transaction</span>
    <span class="k">for</span> <span class="n">txn_id</span> <span class="ow">in</span> <span class="n">transaction_ids</span><span class="p">:</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">txn_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">transaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;completed&#39;</span>

    <span class="c1"># Verify total amount processed</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">total</span> <span class="o">==</span> <span class="mf">600.00</span>

    <span class="c1"># Verify API was called correct number of times</span>
    <span class="k">assert</span> <span class="n">api_client</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="mi">3</span>
</code></pre></div>

<p>This test passes. Now let's introduce a bug in the <code>get_transaction</code> method:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payment_processor.py (with bug)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a transaction by ID.&quot;&quot;&quot;</span>
    <span class="c1"># Bug: Using &#39;is&#39; instead of &#39;==&#39; for string comparison</span>
    <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">transaction_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">transaction</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>

<p>Now when we run the test:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_complex_scenario.py::test_multiple_payments_tracking<span class="w"> </span>-v
</code></pre></div>

<p><strong>The output</strong>:</p>
<div class="codehilite"><pre><span></span><code>=================================== FAILURES ===================================
________________________ test_multiple_payments_tracking _______________________

    def test_multiple_payments_tracking():
        &quot;&quot;&quot;Test that multiple payments are tracked correctly.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        # Process three payments
        txn1 = processor.process_payment(100.00, &#39;1234567890123456&#39;, &#39;123&#39;)
        txn2 = processor.process_payment(200.00, &#39;1234567890123456&#39;, &#39;123&#39;)
        txn3 = processor.process_payment(300.00, &#39;1234567890123456&#39;, &#39;123&#39;)

        # Verify all transactions are logged
        assert len(processor.transaction_log) == 3

        # Verify transaction IDs are unique
        transaction_ids = [txn1, txn2, txn3]
        assert len(set(transaction_ids)) == 3

        # Verify we can retrieve each transaction
        for txn_id in transaction_ids:
            transaction = processor.get_transaction(txn_id)
<span class="k">&gt; </span><span class="ge">          assert transaction is not None</span>
E           AssertionError: assert None is not None

test_complex_scenario.py:20: AssertionError
</code></pre></div>

<h3 id="diagnostic-analysis-the-identity-comparison-bug">Diagnostic Analysis: The Identity Comparison Bug</h3>
<p><strong>The failure point</strong>: <code>assert transaction is not None</code></p>
<p><strong>What this tells us</strong>:
- <code>get_transaction()</code> returned <code>None</code>
- This happened inside a loop, so at least one transaction lookup failed
- The transaction IDs exist (we just created them), so the lookup logic must be broken</p>
<p><strong>The root cause</strong>: Using <code>is</code> for string comparison instead of <code>==</code>. The <code>is</code> operator checks object identity (same memory location), not value equality. String literals might be interned, but dynamically created strings won't be.</p>
<p><strong>The fix</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payment_processor.py (fixed)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a transaction by ID.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">transaction_id</span><span class="p">:</span>  <span class="c1"># Use == for value comparison</span>
            <span class="k">return</span> <span class="n">transaction</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>

<h2 id="key-takeaways-reading-test-output">Key Takeaways: Reading Test Output</h2>
<h3 id="1-output-is-structured-information-not-noise">1. Output is Structured Information, Not Noise</h3>
<p>Every section of pytest's output serves a specific purpose. Learn to scan for the information you need.</p>
<h3 id="2-start-from-the-bottom-work-up">2. Start from the Bottom, Work Up</h3>
<p>The summary line tells you the scope of the problem. The traceback tells you the location. The introspection tells you the cause.</p>
<h3 id="3-assertion-introspection-is-your-best-friend">3. Assertion Introspection is Your Best Friend</h3>
<p>Pytest automatically shows you the values involved in failed assertions. Use this to understand what went wrong without adding print statements.</p>
<h3 id="4-the-marker-is-your-target">4. The <code>&gt;</code> Marker is Your Target</h3>
<p>This shows you exactly which line failed. Everything else is context.</p>
<h3 id="5-read-the-full-object-not-just-the-comparison">5. Read the Full Object, Not Just the Comparison</h3>
<p>When pytest shows <code>where X = {...}</code>, read the entire object. Often the bug is in a related field, not the one you're comparing.</p>
<h3 id="6-version-information-matters">6. Version Information Matters</h3>
<p>The test session header shows Python and pytest versions. When debugging environment-specific failures, this is your first clue.</p>
<h3 id="7-file-and-line-numbers-are-clickable">7. File and Line Numbers are Clickable</h3>
<p>Most IDEs and terminals make file paths clickable. Use this to jump directly to the failure point.</p>
<p>In the next section, we'll explore how pytest's verbose modes can provide even more detailed information when you need it.</p>
<h2 id="using-pytests-verbose-and-extra-verbose-modes">Using pytest's Verbose and Extra-Verbose Modes</h2>
<h2 id="controlling-output-detail">Controlling Output Detail</h2>
<p>Pytest provides multiple verbosity levels to control how much information you see. By default, pytest shows a minimal summary. When debugging, you often need more detail.</p>
<h3 id="the-verbosity-spectrum">The Verbosity Spectrum</h3>
<ul>
<li><strong>Default mode</strong> (<code>pytest</code>): Minimal output, dots for passing tests</li>
<li><strong>Verbose mode</strong> (<code>pytest -v</code>): Show test names and outcomes</li>
<li><strong>Extra-verbose mode</strong> (<code>pytest -vv</code>): Show detailed assertion comparisons</li>
<li><strong>Super-verbose mode</strong> (<code>pytest -vvv</code>): Show even more internal details</li>
</ul>
<p>Let's see each mode in action using our payment processor.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_verbosity_demo.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_validation_positive_amount</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that positive amounts are accepted.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">50.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_validation_zero_amount</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that zero amount is rejected.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Amount must be positive&quot;</span><span class="p">):</span>
        <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span>
            <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
            <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
        <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_validation_negative_amount</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that negative amount is rejected.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Amount must be positive&quot;</span><span class="p">):</span>
        <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=-</span><span class="mf">10.00</span><span class="p">,</span>
            <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
            <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
        <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_validation_invalid_card</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that invalid card number is rejected.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Invalid card number&quot;</span><span class="p">):</span>
        <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="mf">50.00</span><span class="p">,</span>
            <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;12345&#39;</span><span class="p">,</span>  <span class="c1"># Too short</span>
            <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
        <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_validation_invalid_cvv</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that invalid CVV is rejected.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;Invalid CVV&quot;</span><span class="p">):</span>
        <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="mf">50.00</span><span class="p">,</span>
            <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
            <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;12&#39;</span>  <span class="c1"># Too short</span>
        <span class="p">)</span>
</code></pre></div>

<h3 id="default-mode-minimal-output">Default Mode: Minimal Output</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_verbosity_demo.py
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
platform linux -- Python 3.11.0, pytest-7.4.3, pluggy-1.3.0
rootdir: /home/user/project
collected 5 items

test_verbosity_demo.py .....                                             [100%]

============================== 5 passed in 0.02s ===============================
</code></pre></div>

<p><strong>What you see</strong>:
- Five dots (<code>.....</code>) representing five passing tests
- Total count and execution time
- No test names, no details</p>
<p><strong>When to use</strong>: Quick smoke tests, CI pipelines where you only care about pass/fail.</p>
<h3 id="verbose-mode-v-show-test-names">Verbose Mode (-v): Show Test Names</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_verbosity_demo.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
platform linux -- Python 3.11.0, pytest-7.4.3, pluggy-1.3.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/user/project
collected 5 items

test_verbosity_demo.py::test_payment_validation_positive_amount PASSED   [ 20%]
test_verbosity_demo.py::test_payment_validation_zero_amount PASSED       [ 40%]
test_verbosity_demo.py::test_payment_validation_negative_amount PASSED   [ 60%]
test_verbosity_demo.py::test_payment_validation_invalid_card PASSED      [ 80%]
test_verbosity_demo.py::test_payment_validation_invalid_cvv PASSED       [100%]

============================== 5 passed in 0.02s ===============================
</code></pre></div>

<p><strong>What you see</strong>:
- Full test names with file paths
- Individual pass/fail status for each test
- Progress percentage
- Execution order</p>
<p><strong>When to use</strong>: 
- Debugging to see which specific test failed
- Verifying test discovery found the right tests
- Monitoring test execution order
- Most development work</p>
<h3 id="extra-verbose-mode-vv-detailed-comparisons">Extra-Verbose Mode (-vv): Detailed Comparisons</h3>
<p>Now let's introduce a failing test to see the difference <code>-vv</code> makes:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_verbosity_demo.py (add this test)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_transaction_details_match</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that transaction details are recorded accurately.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">150.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXN_1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">150.00</span><span class="p">,</span>
        <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="mf">4.35</span><span class="p">,</span>  <span class="c1"># 2.9% of 150.00</span>
        <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="mf">145.65</span><span class="p">,</span>
        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span>
    <span class="p">}</span>

    <span class="k">assert</span> <span class="n">transaction</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>

<p>First, run with <code>-v</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_verbosity_demo.py::test_transaction_details_match<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output with -v</strong>:</p>
<div class="codehilite"><pre><span></span><code>=================================== FAILURES ===================================
_________________________ test_transaction_details_match _______________________

    def test_transaction_details_match():
        &quot;&quot;&quot;Test that transaction details are recorded accurately.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        transaction_id = processor.process_payment(
            amount=150.00,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

        transaction = processor.get_transaction(transaction_id)

        expected = {
            &#39;id&#39;: &#39;TXN_1&#39;,
            &#39;amount&#39;: 150.00,
            &#39;fee&#39;: 4.35,  # 2.9% of 150.00
            &#39;net_amount&#39;: 145.65,
            &#39;status&#39;: &#39;completed&#39;
        }

<span class="k">&gt; </span><span class="ge">      assert transaction == expected</span>
E       AssertionError: assert {&#39;amount&#39;: 15...completed&#39;} == {&#39;amount&#39;: 15...completed&#39;}
E         Omitting 3 identical items, use -vv to show
E         Differing items:
E         {&#39;fee&#39;: 4.3499999999999996} != {&#39;fee&#39;: 4.35}
E         {&#39;net_amount&#39;: 145.65000000000003} != {&#39;net_amount&#39;: 145.65}

test_verbosity_demo.py:25: AssertionError
</code></pre></div>

<p><strong>What you see</strong>:
- Pytest tells you there are 3 identical items but doesn't show them
- Shows only the differing items
- Suggests using <code>-vv</code> for more detail</p>
<p>Now run with <code>-vv</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_verbosity_demo.py::test_transaction_details_match<span class="w"> </span>-vv
</code></pre></div>

<p><strong>Output with -vv</strong>:</p>
<div class="codehilite"><pre><span></span><code>=================================== FAILURES ===================================
_________________________ test_transaction_details_match _______________________

    def test_transaction_details_match():
        &quot;&quot;&quot;Test that transaction details are recorded accurately.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        transaction_id = processor.process_payment(
            amount=150.00,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

        transaction = processor.get_transaction(transaction_id)

        expected = {
            &#39;id&#39;: &#39;TXN_1&#39;,
            &#39;amount&#39;: 150.00,
            &#39;fee&#39;: 4.35,  # 2.9% of 150.00
            &#39;net_amount&#39;: 145.65,
            &#39;status&#39;: &#39;completed&#39;
        }

<span class="k">&gt; </span><span class="ge">      assert transaction == expected</span>
E       AssertionError: assert {&#39;amount&#39;: 150.0,
E        &#39;fee&#39;: 4.3499999999999996,
E        &#39;id&#39;: &#39;TXN_1&#39;,
E        &#39;net_amount&#39;: 145.65000000000003,
E        &#39;status&#39;: &#39;completed&#39;} == {&#39;amount&#39;: 150.0,
E        &#39;fee&#39;: 4.35,
E        &#39;id&#39;: &#39;TXN_1&#39;,
E        &#39;net_amount&#39;: 145.65,
E        &#39;status&#39;: &#39;completed&#39;}
E       
E       Differing items:
E       {&#39;fee&#39;: 4.3499999999999996} != {&#39;fee&#39;: 4.35}
E       {&#39;net_amount&#39;: 145.65000000000003} != {&#39;net_amount&#39;: 145.65}

test_verbosity_demo.py:25: AssertionError
</code></pre></div>

<p><strong>What you see</strong>:
- Full dictionary contents for both actual and expected
- Pretty-printed formatting showing structure
- All items, not just differing ones
- Easier to see the complete context</p>
<p><strong>When to use <code>-vv</code></strong>:
- Debugging complex data structure comparisons
- When you need to see all fields, not just differences
- Investigating why two "similar" objects aren't equal
- Understanding the full state of objects in assertions</p>
<h3 id="super-verbose-mode-vvv-internal-details">Super-Verbose Mode (-vvv): Internal Details</h3>
<p>The <code>-vvv</code> flag shows pytest's internal operations:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_verbosity_demo.py<span class="w"> </span>-vvv
</code></pre></div>

<p><strong>Additional output with -vvv</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
platform linux -- Python 3.11.0, pytest-7.4.3, pluggy-1.3.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/user/project
plugins: asyncio-0.21.0, cov-4.1.0
collected 6 items

test_verbosity_demo.py::test_payment_validation_positive_amount 
PASSED                                                                   [ 16%]
test_verbosity_demo.py::test_payment_validation_zero_amount 
PASSED                                                                   [ 33%]
test_verbosity_demo.py::test_payment_validation_negative_amount 
PASSED                                                                   [ 50%]
test_verbosity_demo.py::test_payment_validation_invalid_card 
PASSED                                                                   [ 66%]
test_verbosity_demo.py::test_payment_validation_invalid_cvv 
PASSED                                                                   [ 83%]
test_verbosity_demo.py::test_transaction_details_match 
FAILED                                                                   [100%]
</code></pre></div>

<p><strong>What you see</strong>:
- Loaded plugins listed
- Each test on its own line
- More spacing for readability</p>
<p><strong>When to use <code>-vvv</code></strong>:
- Debugging pytest plugin issues
- Understanding test collection problems
- Investigating fixture execution order
- Rarely needed for normal debugging</p>
<h2 id="combining-verbosity-with-other-flags">Combining Verbosity with Other Flags</h2>
<p>Verbosity flags work well with other pytest options:</p>
<h3 id="show-local-variables-on-failure-l-or-showlocals">Show Local Variables on Failure: <code>-l</code> or <code>--showlocals</code></h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_verbosity_demo.py::test_transaction_details_match<span class="w"> </span>-vv<span class="w"> </span>-l
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>=================================== FAILURES ===================================
_________________________ test_transaction_details_match _______________________

    def test_transaction_details_match():
        &quot;&quot;&quot;Test that transaction details are recorded accurately.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        transaction_id = processor.process_payment(
            amount=150.00,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

        transaction = processor.get_transaction(transaction_id)

        expected = {
            &#39;id&#39;: &#39;TXN_1&#39;,
            &#39;amount&#39;: 150.00,
            &#39;fee&#39;: 4.35,
            &#39;net_amount&#39;: 145.65,
            &#39;status&#39;: &#39;completed&#39;
        }

<span class="k">&gt; </span><span class="ge">      assert transaction == expected</span>
E       AssertionError: assert {&#39;amount&#39;: 150.0,
E        &#39;fee&#39;: 4.3499999999999996,
E        &#39;id&#39;: &#39;TXN_1&#39;,
E        &#39;net_amount&#39;: 145.65000000000003,
E        &#39;status&#39;: &#39;completed&#39;} == {&#39;amount&#39;: 150.0,
E        &#39;fee&#39;: 4.35,
E        &#39;id&#39;: &#39;TXN_1&#39;,
E        &#39;net_amount&#39;: 145.65,
E        &#39;status&#39;: &#39;completed&#39;}
E       
E       Differing items:
E       {&#39;fee&#39;: 4.3499999999999996} != {&#39;fee&#39;: 4.35}
E       {&#39;net_amount&#39;: 145.65000000000003} != {&#39;net_amount&#39;: 145.65}

api_client = &lt;payment_processor.MockAPIClient object at 0x7f8b3c4d5e90&gt;
expected   = {&#39;amount&#39;: 150.0, &#39;fee&#39;: 4.35, &#39;id&#39;: &#39;TXN_1&#39;, &#39;net_amount&#39;: 145.65, &#39;status&#39;: &#39;completed&#39;}
processor  = &lt;payment_processor.PaymentProcessor object at 0x7f8b3c4d5f10&gt;
transaction = {&#39;amount&#39;: 150.0, &#39;fee&#39;: 4.3499999999999996, &#39;id&#39;: &#39;TXN_1&#39;, &#39;net_amount&#39;: 145.65000000000003, ...}
transaction_id = &#39;TXN_1&#39;

test_verbosity_demo.py:25: AssertionError
</code></pre></div>

<p><strong>What you see</strong>:
- All local variables at the point of failure
- Their values and types
- Memory addresses for objects</p>
<p><strong>When to use</strong>: When you need to see the state of all variables, not just those in the assertion.</p>
<h3 id="show-full-traceback-tblong">Show Full Traceback: <code>--tb=long</code></h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_verbosity_demo.py::test_transaction_details_match<span class="w"> </span>-vv<span class="w"> </span>--tb<span class="o">=</span>long
</code></pre></div>

<p><strong>What you see</strong>:
- Complete traceback including all function calls
- Full source code for each frame
- More context about the execution path</p>
<p><strong>Traceback styles</strong>:
- <code>--tb=auto</code> (default): Intelligent selection based on failure type
- <code>--tb=long</code>: Full traceback with source code
- <code>--tb=short</code>: Shorter traceback without source
- <code>--tb=line</code>: Single line per failure
- <code>--tb=native</code>: Python's standard traceback format
- <code>--tb=no</code>: No traceback at all</p>
<h3 id="show-captured-output-s-or-captureno">Show Captured Output: <code>-s</code> or <code>--capture=no</code></h3>
<p>By default, pytest captures stdout and stderr. Use <code>-s</code> to see print statements in real-time:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_verbosity_demo.py (add this test)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_with_debug_output</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with debug print statements.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting payment processing...&quot;</span><span class="p">)</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transaction ID: </span><span class="si">{</span><span class="n">transaction_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transaction details: </span><span class="si">{</span><span class="n">transaction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">100.00</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_verbosity_demo.py::test_with_debug_output<span class="w"> </span>-v<span class="w"> </span>-s
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_verbosity_demo.py::test_with_debug_output Starting payment processing...
Transaction ID: TXN_1
Transaction details: {&#39;id&#39;: &#39;TXN_1&#39;, &#39;amount&#39;: 100.0, &#39;fee&#39;: 2.8999999999999995, &#39;net_amount&#39;: 97.10000000000001, &#39;status&#39;: &#39;completed&#39;}
PASSED
</code></pre></div>

<p><strong>What you see</strong>:
- Print statements appear in real-time
- Output is interleaved with test execution
- Useful for debugging test flow</p>
<h2 id="practical-verbosity-strategies">Practical Verbosity Strategies</h2>
<h3 id="strategy-1-start-minimal-increase-as-needed">Strategy 1: Start Minimal, Increase as Needed</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># First run: Quick check</span>
$<span class="w"> </span>pytest

<span class="c1"># If failures: See which tests failed</span>
$<span class="w"> </span>pytest<span class="w"> </span>-v

<span class="c1"># If complex data: See full comparisons</span>
$<span class="w"> </span>pytest<span class="w"> </span>-vv

<span class="c1"># If still stuck: See local variables</span>
$<span class="w"> </span>pytest<span class="w"> </span>-vv<span class="w"> </span>-l

<span class="c1"># If really stuck: See everything</span>
$<span class="w"> </span>pytest<span class="w"> </span>-vvv<span class="w"> </span>-l<span class="w"> </span>--tb<span class="o">=</span>long<span class="w"> </span>-s
</code></pre></div>

<h3 id="strategy-2-use-configuration-for-default-verbosity">Strategy 2: Use Configuration for Default Verbosity</h3>
<p>In <code>pytest.ini</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">[pytest]</span>
<span class="c1"># Always use verbose mode</span>
<span class="na">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">-v</span>

<span class="c1"># Or for extra detail</span>
<span class="na">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">-vv --tb=short</span>
</code></pre></div>

<h3 id="strategy-3-verbosity-for-specific-test-runs">Strategy 3: Verbosity for Specific Test Runs</h3>
<p>Use different verbosity for different scenarios:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Quick smoke test (minimal output)</span>
$<span class="w"> </span>pytest<span class="w"> </span>-q

<span class="c1"># Development (verbose)</span>
$<span class="w"> </span>pytest<span class="w"> </span>-v

<span class="c1"># Debugging specific failure (maximum detail)</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_file.py::test_name<span class="w"> </span>-vv<span class="w"> </span>-l<span class="w"> </span>--tb<span class="o">=</span>long<span class="w"> </span>-s

<span class="c1"># CI pipeline (verbose but compact)</span>
$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>--tb<span class="o">=</span>short
</code></pre></div>

<h3 id="strategy-4-quiet-mode-for-clean-output">Strategy 4: Quiet Mode for Clean Output</h3>
<p>Use <code>-q</code> or <code>--quiet</code> for minimal output:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-q
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">.....</span><span class="n">F</span><span class="w">                                                                   </span><span class="p">[</span><span class="mi">100</span><span class="o">%</span><span class="p">]</span>
<span class="o">===================================</span><span class="w"> </span><span class="n">FAILURES</span><span class="w"> </span><span class="o">===================================</span>
<span class="p">[</span><span class="n">failure</span><span class="w"> </span><span class="n">details</span><span class="p">]</span>
<span class="mi">1</span><span class="w"> </span><span class="n">failed</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.02</span><span class="n">s</span>
</code></pre></div>

<p><strong>When to use</strong>: 
- CI pipelines where you only need failure details
- Running large test suites where dots are sufficient
- Scripts that parse pytest output</p>
<h2 id="decision-framework-which-verbosity-level">Decision Framework: Which Verbosity Level?</h2>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Recommended Flags</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td>Quick smoke test</td>
<td><code>pytest</code> or <code>pytest -q</code></td>
<td>Minimal noise, just pass/fail</td>
</tr>
<tr>
<td>Development work</td>
<td><code>pytest -v</code></td>
<td>See test names, track progress</td>
</tr>
<tr>
<td>Debugging data structures</td>
<td><code>pytest -vv</code></td>
<td>Full object comparisons</td>
</tr>
<tr>
<td>Debugging test flow</td>
<td><code>pytest -v -s</code></td>
<td>See print statements</td>
</tr>
<tr>
<td>Debugging complex failure</td>
<td><code>pytest -vv -l --tb=long</code></td>
<td>Maximum context</td>
</tr>
<tr>
<td>CI pipeline</td>
<td><code>pytest -v --tb=short</code></td>
<td>Readable but compact</td>
</tr>
<tr>
<td>Plugin debugging</td>
<td><code>pytest -vvv</code></td>
<td>Internal pytest details</td>
</tr>
</tbody>
</table>
<h2 id="common-verbosity-patterns">Common Verbosity Patterns</h2>
<h3 id="pattern-1-the-progressive-debug">Pattern 1: The Progressive Debug</h3>
<p>Start minimal and add flags as you need more information:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Step 1: See if it fails</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_file.py

<span class="c1"># Step 2: See which test failed</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_file.py<span class="w"> </span>-v

<span class="c1"># Step 3: See the full comparison</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_file.py::test_name<span class="w"> </span>-vv

<span class="c1"># Step 4: See local variables</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_file.py::test_name<span class="w"> </span>-vv<span class="w"> </span>-l

<span class="c1"># Step 5: See print statements</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_file.py::test_name<span class="w"> </span>-vv<span class="w"> </span>-l<span class="w"> </span>-s
</code></pre></div>

<h3 id="pattern-2-the-focused-investigation">Pattern 2: The Focused Investigation</h3>
<p>When you know which test is failing:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run just that test with maximum detail</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_file.py::test_name<span class="w"> </span>-vv<span class="w"> </span>-l<span class="w"> </span>--tb<span class="o">=</span>long<span class="w"> </span>-s
</code></pre></div>

<h3 id="pattern-3-the-ci-friendly-run">Pattern 3: The CI-Friendly Run</h3>
<p>For continuous integration:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Verbose enough to debug, compact enough to read</span>
$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>--tb<span class="o">=</span>short<span class="w"> </span>--maxfail<span class="o">=</span><span class="m">1</span>
</code></pre></div>

<h2 id="key-takeaways-verbosity-modes">Key Takeaways: Verbosity Modes</h2>
<h3 id="1-verbosity-is-a-spectrum-not-a-binary-choice">1. Verbosity is a Spectrum, Not a Binary Choice</h3>
<p>You have fine-grained control over output detail. Use the minimum verbosity needed to solve your current problem.</p>
<h3 id="2-vv-is-your-friend-for-data-debugging">2. <code>-vv</code> is Your Friend for Data Debugging</h3>
<p>When assertions fail on complex data structures, <code>-vv</code> shows you the complete picture.</p>
<h3 id="3-combine-flags-for-maximum-insight">3. Combine Flags for Maximum Insight</h3>
<p><code>-vv -l --tb=long -s</code> gives you everything: full comparisons, local variables, complete tracebacks, and print output.</p>
<h3 id="4-configure-defaults-for-your-workflow">4. Configure Defaults for Your Workflow</h3>
<p>Set <code>addopts = -v</code> in <code>pytest.ini</code> if you always want verbose output.</p>
<h3 id="5-different-scenarios-need-different-verbosity">5. Different Scenarios Need Different Verbosity</h3>
<p>Quick checks need minimal output. Deep debugging needs maximum detail. Choose appropriately.</p>
<h3 id="6-quiet-mode-is-underrated">6. Quiet Mode is Underrated</h3>
<p><code>-q</code> is perfect for scripts and CI where you only care about failures.</p>
<p>In the next section, we'll explore the <code>-x</code> flag, which stops test execution on the first failure‚Äîa powerful technique for focused debugging.</p>
<h2 id="the-x-flag-stop-on-first-failure">The -x Flag (Stop on First Failure)</h2>
<h2 id="why-stop-on-first-failure">Why Stop on First Failure?</h2>
<p>When you have a test suite with multiple failures, pytest shows you all of them. This is useful for getting a complete picture, but when debugging, you often want to focus on one problem at a time.</p>
<p>The <code>-x</code> flag (or <code>--exitfirst</code>) tells pytest to stop immediately after the first test failure. This is invaluable for:</p>
<ol>
<li><strong>Focused debugging</strong>: Fix one problem before moving to the next</li>
<li><strong>Fast feedback loops</strong>: Don't wait for the entire suite to run</li>
<li><strong>Cascading failures</strong>: When one failure causes many others</li>
<li><strong>Development workflow</strong>: Iterate quickly on a single failing test</li>
</ol>
<p>Let's see this in action with our payment processor.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_payment_suite.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_valid_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test successful payment processing.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction_id</span> <span class="o">==</span> <span class="s1">&#39;TXN_1&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_fee_calculation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that fees are calculated correctly.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
    <span class="c1"># This will fail due to floating-point precision</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">2.90</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_net_amount</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that net amount is calculated correctly.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
    <span class="c1"># This will also fail due to floating-point precision</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;net_amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">97.10</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_multiple_payments</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test processing multiple payments.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Process three payments</span>
    <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="mf">100.00</span><span class="p">,</span> <span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">)</span>
    <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="mf">200.00</span><span class="p">,</span> <span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">)</span>
    <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="mf">300.00</span><span class="p">,</span> <span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">)</span>

    <span class="c1"># This will fail because we&#39;re checking exact equality</span>
    <span class="n">total_fees</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">total_fees</span> <span class="o">==</span> <span class="mf">17.40</span>  <span class="c1"># 2.9% of 600.00</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_api_call_count</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that API is called correct number of times.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="mf">100.00</span><span class="p">,</span> <span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">)</span>
    <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="mf">200.00</span><span class="p">,</span> <span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span> <span class="s1">&#39;123&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">api_client</span><span class="o">.</span><span class="n">call_count</span> <span class="o">==</span> <span class="mi">2</span>
</code></pre></div>

<h3 id="without-x-see-all-failures">Without -x: See All Failures</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
collected 5 items

test_payment_suite.py::test_payment_with_valid_data PASSED              [ 20%]
test_payment_suite.py::test_payment_fee_calculation FAILED              [ 40%]
test_payment_suite.py::test_payment_net_amount FAILED                   [ 60%]
test_payment_suite.py::test_multiple_payments FAILED                    [ 80%]
test_payment_suite.py::test_api_call_count PASSED                       [100%]

=================================== FAILURES ===================================
__________________________ test_payment_fee_calculation ________________________
[full traceback for test_payment_fee_calculation]

___________________________ test_payment_net_amount ____________________________
[full traceback for test_payment_net_amount]

___________________________ test_multiple_payments _____________________________
[full traceback for test_multiple_payments]

========================= 2 passed, 3 failed in 0.05s ==========================
</code></pre></div>

<p><strong>What happened</strong>:
- Pytest ran all 5 tests
- Showed 3 complete failure tracebacks
- You have to scroll through all failures to understand any single one</p>
<h3 id="with-x-stop-at-first-failure">With -x: Stop at First Failure</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v<span class="w"> </span>-x
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
collected 5 items

test_payment_suite.py::test_payment_with_valid_data PASSED              [ 20%]
test_payment_suite.py::test_payment_fee_calculation FAILED              [ 40%]

=================================== FAILURES ===================================
__________________________ test_payment_fee_calculation ________________________

    def test_payment_fee_calculation():
        &quot;&quot;&quot;Test that fees are calculated correctly.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        transaction_id = processor.process_payment(
            amount=100.00,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

        transaction = processor.get_transaction(transaction_id)
        # This will fail due to floating-point precision
<span class="k">&gt; </span><span class="ge">      assert transaction[&#39;fee&#39;] == 2.90</span>
E       AssertionError: assert 2.8999999999999995 == 2.90

test_payment_suite.py:31: AssertionError
!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!!!
========================= 1 passed, 1 failed in 0.02s ==========================
</code></pre></div>

<p><strong>What happened</strong>:
- Pytest ran tests until the first failure
- Stopped immediately after <code>test_payment_fee_calculation</code> failed
- Showed only one failure traceback
- Notice the message: "stopping after 1 failures"
- Tests 3, 4, and 5 were never executed</p>
<h3 id="diagnostic-analysis-the-first-failure">Diagnostic Analysis: The First Failure</h3>
<p><strong>The failure</strong>: Floating-point precision issue in fee calculation</p>
<p><strong>Root cause</strong>: <code>100.00 * 0.029 = 2.8999999999999995</code> (not exactly <code>2.90</code>)</p>
<p><strong>Why -x helped</strong>: 
- We can focus on this one problem
- We don't get distracted by other failures
- We can fix this and re-run quickly</p>
<p><strong>The fix</strong>: Use <code>pytest.approx()</code> for floating-point comparisons</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_payment_suite.py (fixed)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_fee_calculation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that fees are calculated correctly.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
    <span class="c1"># Use pytest.approx() for floating-point comparison</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">2.90</span><span class="p">)</span>
</code></pre></div>

<p>Now run again with <code>-x</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v<span class="w"> </span>-x
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
collected 5 items

test_payment_suite.py::test_payment_with_valid_data PASSED              [ 20%]
test_payment_suite.py::test_payment_fee_calculation PASSED              [ 40%]
test_payment_suite.py::test_payment_net_amount FAILED                   [ 60%]

=================================== FAILURES ===================================
___________________________ test_payment_net_amount ____________________________

    def test_payment_net_amount():
        &quot;&quot;&quot;Test that net amount is calculated correctly.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        transaction_id = processor.process_payment(
            amount=100.00,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

        transaction = processor.get_transaction(transaction_id)
        # This will also fail due to floating-point precision
<span class="k">&gt; </span><span class="ge">      assert transaction[&#39;net_amount&#39;] == 97.10</span>
E       AssertionError: assert 97.10000000000001 == 97.10

test_payment_suite.py:48: AssertionError
!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!!!
========================= 1 passed, 2 failed in 0.02s ==========================
</code></pre></div>

<p><strong>Progress</strong>: 
- First test now passes
- Stopped at the next failure
- Same type of problem (floating-point precision)
- We can apply the same fix</p>
<h2 id="the-iterative-fix-workflow">The Iterative Fix Workflow</h2>
<p>The <code>-x</code> flag enables a powerful iterative workflow:</p>
<h3 id="iteration-1-identify-first-failure">Iteration 1: Identify First Failure</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v<span class="w"> </span>-x
<span class="c1"># Output: test_payment_fee_calculation FAILED</span>
</code></pre></div>

<h3 id="iteration-2-fix-first-failure">Iteration 2: Fix First Failure</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Fix: Use pytest.approx() in test_payment_fee_calculation</span>
<span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">2.90</span><span class="p">)</span>
</code></pre></div>

<h3 id="iteration-3-re-run-find-next-failure">Iteration 3: Re-run, Find Next Failure</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v<span class="w"> </span>-x
<span class="c1"># Output: test_payment_net_amount FAILED</span>
</code></pre></div>

<h3 id="iteration-4-fix-second-failure">Iteration 4: Fix Second Failure</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Fix: Use pytest.approx() in test_payment_net_amount</span>
<span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;net_amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">97.10</span><span class="p">)</span>
</code></pre></div>

<h3 id="iteration-5-re-run-find-next-failure">Iteration 5: Re-run, Find Next Failure</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v<span class="w"> </span>-x
<span class="c1"># Output: test_multiple_payments FAILED</span>
</code></pre></div>

<h3 id="iteration-6-fix-third-failure">Iteration 6: Fix Third Failure</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Fix: Use pytest.approx() in test_multiple_payments</span>
<span class="k">assert</span> <span class="n">total_fees</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">17.40</span><span class="p">)</span>
</code></pre></div>

<h3 id="iteration-7-verify-all-pass">Iteration 7: Verify All Pass</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v
<span class="c1"># Output: 5 passed in 0.02s</span>
</code></pre></div>

<h2 id="combining-x-with-other-flags">Combining -x with Other Flags</h2>
<h3 id="-x-with-vv-stop-on-first-failure-with-full-detail">-x with -vv: Stop on First Failure with Full Detail</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-x<span class="w"> </span>-vv
</code></pre></div>

<p><strong>When to use</strong>: You want to stop at the first failure AND see full object comparisons.</p>
<h3 id="-x-with-l-stop-on-first-failure-with-local-variables">-x with -l: Stop on First Failure with Local Variables</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-x<span class="w"> </span>-vv<span class="w"> </span>-l
</code></pre></div>

<p><strong>When to use</strong>: You need to see the state of all variables when the first failure occurred.</p>
<h3 id="-x-with-pdb-stop-and-debug-immediately">-x with --pdb: Stop and Debug Immediately</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-x<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>When to use</strong>: You want to drop into the debugger at the first failure (covered in detail in section 17.4).</p>
<h3 id="-x-with-k-stop-on-first-failure-in-filtered-tests">-x with -k: Stop on First Failure in Filtered Tests</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-x<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;fee or net&quot;</span>
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">collected</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">deselected</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">selected</span>

<span class="n">test_payment_suite</span><span class="p">.</span><span class="n">py</span><span class="o">::</span><span class="n">test_payment_fee_calculation</span><span class="w"> </span><span class="n">PASSED</span><span class="w">              </span><span class="p">[</span><span class="w"> </span><span class="mi">50</span><span class="o">%</span><span class="p">]</span>
<span class="n">test_payment_suite</span><span class="p">.</span><span class="n">py</span><span class="o">::</span><span class="n">test_payment_net_amount</span><span class="w"> </span><span class="n">FAILED</span><span class="w">                   </span><span class="p">[</span><span class="mi">100</span><span class="o">%</span><span class="p">]</span>

<span class="p">[</span><span class="n">failure</span><span class="w"> </span><span class="n">details</span><span class="p">]</span>
<span class="o">!!!!!!!!!!!!!!!!!!!!!!!</span><span class="w"> </span><span class="n">stopping</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">failures</span><span class="w"> </span><span class="o">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
</code></pre></div>

<p><strong>When to use</strong>: You're debugging a specific subset of tests and want to stop at the first failure in that subset.</p>
<h2 id="advanced-maxfailn">Advanced: --maxfail=N</h2>
<p>The <code>-x</code> flag is actually shorthand for <code>--maxfail=1</code>. You can specify a different number:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Stop after 2 failures</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>--maxfail<span class="o">=</span><span class="m">2</span><span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_payment_suite.py::test_payment_with_valid_data PASSED              [ 20%]
test_payment_suite.py::test_payment_fee_calculation FAILED              [ 40%]
test_payment_suite.py::test_payment_net_amount FAILED                   [ 60%]

[failure details for both tests]
!!!!!!!!!!!!!!!!!!!!!!! stopping after 2 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!!!
========================= 1 passed, 2 failed in 0.03s ==========================
</code></pre></div>

<p><strong>When to use</strong>:
- You want to see a few failures but not all
- You're investigating related failures
- You want to batch-fix similar issues</p>
<h2 id="real-world-scenario-cascading-failures">Real-World Scenario: Cascading Failures</h2>
<p>Let's see a scenario where <code>-x</code> is especially valuable: cascading failures where one root cause creates many symptoms.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payment_processor.py (introduce a bug)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PaymentProcessor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_client</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span> <span class="o">=</span> <span class="n">api_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fee_percentage</span> <span class="o">=</span> <span class="mf">0.029</span>
        <span class="c1"># Bug: Initialize with wrong state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Should be True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">card_number</span><span class="p">,</span> <span class="n">cvv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a payment and return transaction ID.&quot;&quot;&quot;</span>
        <span class="c1"># Bug: Check initialization state</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Processor not initialized&quot;</span><span class="p">)</span>

        <span class="c1"># ... rest of the method</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># test_payment_suite.py (all tests will fail now)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_valid_data</span><span class="p">():</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
    <span class="c1"># This will fail: RuntimeError: Processor not initialized</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_fee_calculation</span><span class="p">():</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
    <span class="c1"># This will fail: RuntimeError: Processor not initialized</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># ... all other tests will fail the same way</span>
</code></pre></div>

<p>Without <code>-x</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_payment_suite.py::test_payment_with_valid_data FAILED              [ 20%]
test_payment_suite.py::test_payment_fee_calculation FAILED              [ 40%]
test_payment_suite.py::test_payment_net_amount FAILED                   [ 60%]
test_payment_suite.py::test_multiple_payments FAILED                    [ 80%]
test_payment_suite.py::test_api_call_count FAILED                       [100%]

[5 identical failure tracebacks]
========================= 5 failed in 0.05s ==========================
</code></pre></div>

<p><strong>Problem</strong>: You see 5 failures, but they're all the same root cause. You waste time reading 5 identical tracebacks.</p>
<p>With <code>-x</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v<span class="w"> </span>-x
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_payment_suite.py::test_payment_with_valid_data FAILED              [ 20%]

=================================== FAILURES ===================================
_________________________ test_payment_with_valid_data _________________________

    def test_payment_with_valid_data():
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)
<span class="k">&gt; </span><span class="ge">      transaction_id = processor.process_payment(</span>
            amount=100.00,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

payment_processor.py:15: RuntimeError: Processor not initialized
!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!!!
========================= 1 failed in 0.01s ==========================
</code></pre></div>

<p><strong>Benefit</strong>: You immediately see the root cause. Fix the initialization bug once, and all tests will pass.</p>
<h3 id="the-fix">The Fix</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># payment_processor.py (fixed)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PaymentProcessor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_client</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span> <span class="o">=</span> <span class="n">api_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fee_percentage</span> <span class="o">=</span> <span class="mf">0.029</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Fixed: Initialize correctly</span>
</code></pre></div>

<p>Now all tests pass:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_suite.py<span class="w"> </span>-v
<span class="c1"># Output: 5 passed in 0.02s</span>
</code></pre></div>

<h2 id="when-not-to-use-x">When NOT to Use -x</h2>
<h3 id="scenario-1-comprehensive-test-reports">Scenario 1: Comprehensive Test Reports</h3>
<p>When you need to see all failures for a complete picture:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># CI pipeline: Want to see all failures</span>
$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>--tb<span class="o">=</span>short
</code></pre></div>

<h3 id="scenario-2-independent-failures">Scenario 2: Independent Failures</h3>
<p>When failures are unrelated and you want to fix multiple issues in one session:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># See all failures, fix them all at once</span>
$<span class="w"> </span>pytest<span class="w"> </span>-v
</code></pre></div>

<h3 id="scenario-3-test-coverage-analysis">Scenario 3: Test Coverage Analysis</h3>
<p>When you're measuring coverage and need all tests to run:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Coverage needs all tests to run</span>
$<span class="w"> </span>pytest<span class="w"> </span>--cov<span class="o">=</span>mypackage
</code></pre></div>

<h2 id="decision-framework-when-to-use-x">Decision Framework: When to Use -x</h2>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Use -x?</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td>Debugging a specific failure</td>
<td>‚úÖ Yes</td>
<td>Focus on one problem</td>
</tr>
<tr>
<td>Iterative development</td>
<td>‚úÖ Yes</td>
<td>Fast feedback loop</td>
</tr>
<tr>
<td>Cascading failures</td>
<td>‚úÖ Yes</td>
<td>Find root cause quickly</td>
</tr>
<tr>
<td>CI/CD pipeline</td>
<td>‚ùå No</td>
<td>Need complete report</td>
</tr>
<tr>
<td>Coverage measurement</td>
<td>‚ùå No</td>
<td>Need all tests to run</td>
</tr>
<tr>
<td>Investigating multiple issues</td>
<td>‚ùå No</td>
<td>Want to see all failures</td>
</tr>
<tr>
<td>Test suite validation</td>
<td>‚ùå No</td>
<td>Need comprehensive results</td>
</tr>
</tbody>
</table>
<h2 id="practical-patterns">Practical Patterns</h2>
<h3 id="pattern-1-the-debug-loop">Pattern 1: The Debug Loop</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Run with -x to find first failure</span>
$<span class="w"> </span>pytest<span class="w"> </span>-x<span class="w"> </span>-vv

<span class="c1"># 2. Fix the failure</span>

<span class="c1"># 3. Re-run with -x to find next failure</span>
$<span class="w"> </span>pytest<span class="w"> </span>-x<span class="w"> </span>-vv

<span class="c1"># 4. Repeat until all pass</span>

<span class="c1"># 5. Final verification without -x</span>
$<span class="w"> </span>pytest<span class="w"> </span>-v
</code></pre></div>

<h3 id="pattern-2-the-focused-investigation_1">Pattern 2: The Focused Investigation</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Focus on a specific test file</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_specific.py<span class="w"> </span>-x<span class="w"> </span>-vv<span class="w"> </span>-l

<span class="c1"># Even more focused: specific test</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_specific.py::test_name<span class="w"> </span>-x<span class="w"> </span>-vv<span class="w"> </span>-l<span class="w"> </span>--pdb
</code></pre></div>

<h3 id="pattern-3-the-batch-fix">Pattern 3: The Batch Fix</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># See first N failures</span>
$<span class="w"> </span>pytest<span class="w"> </span>--maxfail<span class="o">=</span><span class="m">3</span><span class="w"> </span>-v

<span class="c1"># Fix all similar issues</span>

<span class="c1"># Verify all pass</span>
$<span class="w"> </span>pytest<span class="w"> </span>-v
</code></pre></div>

<h2 id="key-takeaways-the-x-flag">Key Takeaways: The -x Flag</h2>
<h3 id="1-x-enables-focused-debugging">1. -x Enables Focused Debugging</h3>
<p>Stop at the first failure to concentrate on one problem at a time.</p>
<h3 id="2-perfect-for-iterative-development">2. Perfect for Iterative Development</h3>
<p>Fix one issue, re-run, fix the next. Fast feedback loops accelerate development.</p>
<h3 id="3-reveals-root-causes-in-cascading-failures">3. Reveals Root Causes in Cascading Failures</h3>
<p>When one bug causes many test failures, -x shows you the root cause immediately.</p>
<h3 id="4-combine-with-other-flags-for-maximum-effectiveness">4. Combine with Other Flags for Maximum Effectiveness</h3>
<p><code>-x -vv -l</code> gives you focused, detailed debugging information.</p>
<h3 id="5-maxfailn-provides-flexibility">5. --maxfail=N Provides Flexibility</h3>
<p>Stop after N failures instead of just 1 when you want to see related issues.</p>
<h3 id="6-not-for-cicd">6. Not for CI/CD</h3>
<p>In continuous integration, you want comprehensive reports, not early exits.</p>
<h3 id="7-the-debug-loop-is-your-friend">7. The Debug Loop is Your Friend</h3>
<p>Run with -x, fix, re-run with -x, fix, repeat. This workflow is incredibly efficient.</p>
<p>In the next section, we'll explore the <code>--pdb</code> flag, which takes debugging to the next level by dropping you into an interactive debugger at the point of failure.</p>
<h2 id="the-pdb-flag-drop-into-debugger">The --pdb Flag (Drop into Debugger)</h2>
<h2 id="interactive-debugging-at-the-point-of-failure">Interactive Debugging at the Point of Failure</h2>
<p>The <code>--pdb</code> flag is one of pytest's most powerful debugging features. When a test fails, instead of just showing you the traceback, pytest drops you into Python's interactive debugger (pdb) at the exact point of failure. You can inspect variables, execute code, and understand exactly what went wrong.</p>
<p>This transforms debugging from "read the error and guess" to "explore the failure state interactively."</p>
<h3 id="what-is-pdb">What is pdb?</h3>
<p><code>pdb</code> is Python's built-in debugger. It provides an interactive shell where you can:
- Inspect variable values
- Execute Python code
- Step through code line by line
- Navigate the call stack
- Modify variables and continue execution</p>
<p>When pytest integrates with pdb via <code>--pdb</code>, it automatically drops you into the debugger when a test fails, with the execution context preserved.</p>
<p>Let's see this in action with our payment processor.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_payment_debugging.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_complex_calculation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test payment processing with multiple calculations.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Process a payment</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="mf">1234.56</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Get the transaction</span>
    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

    <span class="c1"># Calculate expected values</span>
    <span class="n">expected_fee</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="mf">0.029</span>
    <span class="n">expected_net</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">expected_fee</span>

    <span class="c1"># These assertions will fail due to floating-point precision</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_fee</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;net_amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_net</span>
</code></pre></div>

<h3 id="running-with-pdb">Running with --pdb</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_debugging.py::test_payment_with_complex_calculation<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
collected 1 item

test_payment_debugging.py::test_payment_with_complex_calculation FAILED

=================================== FAILURES ===================================
_________________ test_payment_with_complex_calculation ________________________

    def test_payment_with_complex_calculation():
        &quot;&quot;&quot;Test payment processing with multiple calculations.&quot;&quot;&quot;
        api_client = MockAPIClient()
        processor = PaymentProcessor(api_client)

        # Process a payment
        amount = 1234.56
        transaction_id = processor.process_payment(
            amount=amount,
            card_number=&#39;1234567890123456&#39;,
            cvv=&#39;123&#39;
        )

        # Get the transaction
        transaction = processor.get_transaction(transaction_id)

        # Calculate expected values
        expected_fee = amount * 0.029
        expected_net = amount - expected_fee

        # These assertions will fail due to floating-point precision
<span class="k">&gt; </span><span class="ge">      assert transaction[&#39;fee&#39;] == expected_fee</span>
E       AssertionError: assert 35.80224 == 35.80223999999999

test_payment_debugging.py:24: AssertionError
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; entering PDB &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; PDB post_mortem (IO-capturing turned off) &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
<span class="k">&gt; </span><span class="ge">/home/user/project/test_payment_debugging.py(24)test_payment_with_complex_calculation()</span>
-&gt; assert transaction[&#39;fee&#39;] == expected_fee
(Pdb) 
</code></pre></div>

<p><strong>What happened</strong>:
- The test failed at the assertion
- Pytest automatically entered pdb
- You're now at an interactive prompt: <code>(Pdb)</code>
- The execution is paused at the exact line that failed
- You can now explore the state</p>
<h3 id="diagnostic-analysis-exploring-the-failure-interactively">Diagnostic Analysis: Exploring the Failure Interactively</h3>
<p>Now we're in the debugger. Let's explore what went wrong.</p>
<p><strong>Step 1: Inspect the variables involved in the assertion</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span>
<span class="mf">35.80224</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">expected_fee</span>
<span class="mf">35.80223999999999</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_fee</span>
<span class="kc">False</span>
</code></pre></div>

<p><strong>What this tells us</strong>: The values are almost identical but not exactly equal due to floating-point precision.</p>
<p><strong>Step 2: See the full transaction object</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction</span>
<span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXN_1&#39;</span><span class="p">,</span> <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">1234.56</span><span class="p">,</span> <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="mf">35.80224</span><span class="p">,</span> <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="mf">1198.7577600000001</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">}</span>
</code></pre></div>

<p><strong>What this tells us</strong>: We can see all fields in the transaction, not just the one that failed.</p>
<p><strong>Step 3: Check the calculation</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">amount</span>
<span class="mf">1234.56</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">amount</span> <span class="o">*</span> <span class="mf">0.029</span>
<span class="mf">35.80223999999999</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">processor</span><span class="o">.</span><span class="n">fee_percentage</span>
<span class="mf">0.029</span>
</code></pre></div>

<p><strong>What this tells us</strong>: The calculation is correct, but floating-point arithmetic introduces tiny errors.</p>
<p><strong>Step 4: Test a potential fix</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="n">expected_fee</span><span class="p">)</span>
<span class="kc">True</span>
</code></pre></div>

<p><strong>What this tells us</strong>: Using <code>pytest.approx()</code> would make the assertion pass.</p>
<p><strong>Step 5: Exit the debugger</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">quit</span>
</code></pre></div>

<h3 id="essential-pdb-commands">Essential pdb Commands</h3>
<p>When you're in the debugger, these commands are your tools:</p>
<h4 id="inspection-commands">Inspection Commands</h4>
<p><strong><code>p</code> or <code>print</code></strong>: Print a variable's value</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">p</span> <span class="n">transaction</span>
<span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXN_1&#39;</span><span class="p">,</span> <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">1234.56</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">p</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span>
<span class="mf">35.80224</span>
</code></pre></div>

<p><strong><code>pp</code></strong>: Pretty-print (better formatting for complex objects)</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">pp</span> <span class="n">transaction</span>
<span class="p">{</span><span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">1234.56</span><span class="p">,</span>
 <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="mf">35.80224</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXN_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="mf">1198.7577600000001</span><span class="p">,</span>
 <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">}</span>
</code></pre></div>

<p><strong><code>type()</code></strong>: Check the type of a variable</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="nb">type</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
<span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="err">&#39;</span><span class="nc">dict</span><span class="s1">&#39;&gt;</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="nb">type</span><span class="p">(</span><span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">])</span>
<span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="err">&#39;</span><span class="nc">float</span><span class="s1">&#39;&gt;</span>
</code></pre></div>

<p><strong><code>dir()</code></strong>: List all attributes and methods</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="nb">dir</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;__delattr__&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;api_client&#39;</span><span class="p">,</span> <span class="s1">&#39;fee_percentage&#39;</span><span class="p">,</span> <span class="s1">&#39;get_transaction&#39;</span><span class="p">,</span> <span class="s1">&#39;process_payment&#39;</span><span class="p">,</span> <span class="s1">&#39;transaction_log&#39;</span><span class="p">]</span>
</code></pre></div>

<p><strong><code>locals()</code></strong>: Show all local variables</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="nb">locals</span><span class="p">()</span>
<span class="p">{</span><span class="s1">&#39;api_client&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">payment_processor</span><span class="o">.</span><span class="n">MockAPIClient</span> <span class="nb">object</span> <span class="n">at</span> <span class="mi">0</span><span class="n">x</span><span class="o">...&gt;</span><span class="p">,</span>
 <span class="s1">&#39;processor&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">payment_processor</span><span class="o">.</span><span class="n">PaymentProcessor</span> <span class="nb">object</span> <span class="n">at</span> <span class="mi">0</span><span class="n">x</span><span class="o">...&gt;</span><span class="p">,</span>
 <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">1234.56</span><span class="p">,</span>
 <span class="s1">&#39;transaction_id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXN_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;transaction&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">},</span>
 <span class="s1">&#39;expected_fee&#39;</span><span class="p">:</span> <span class="mf">35.80223999999999</span><span class="p">,</span>
 <span class="s1">&#39;expected_net&#39;</span><span class="p">:</span> <span class="mf">1198.7577600000001</span><span class="p">}</span>
</code></pre></div>

<h4 id="navigation-commands">Navigation Commands</h4>
<p><strong><code>l</code> or <code>list</code></strong>: Show the current code context</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">l</span>
 <span class="mi">19</span>         <span class="c1"># Calculate expected values</span>
 <span class="mi">20</span>         <span class="n">expected_fee</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="mf">0.029</span>
 <span class="mi">21</span>         <span class="n">expected_net</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">expected_fee</span>
 <span class="mi">22</span>         
 <span class="mi">23</span>         <span class="c1"># These assertions will fail due to floating-point precision</span>
 <span class="mi">24</span>  <span class="o">-&gt;</span>     <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_fee</span>
 <span class="mi">25</span>         <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;net_amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_net</span>
<span class="p">[</span><span class="n">EOF</span><span class="p">]</span>
</code></pre></div>

<p><strong><code>ll</code> or <code>longlist</code></strong>: Show the entire function</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">ll</span>
  <span class="mi">3</span>     <span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_complex_calculation</span><span class="p">():</span>
  <span class="mi">4</span>         <span class="s2">&quot;&quot;&quot;Test payment processing with multiple calculations.&quot;&quot;&quot;</span>
  <span class="mi">5</span>         <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
  <span class="mi">6</span>         <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
  <span class="mi">7</span>         
  <span class="mi">8</span>         <span class="c1"># Process a payment</span>
  <span class="mi">9</span>         <span class="n">amount</span> <span class="o">=</span> <span class="mf">1234.56</span>
 <span class="mi">10</span>         <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
 <span class="mi">11</span>             <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
 <span class="mi">12</span>             <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
 <span class="mi">13</span>             <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
 <span class="mi">14</span>         <span class="p">)</span>
 <span class="mi">15</span>         
 <span class="mi">16</span>         <span class="c1"># Get the transaction</span>
 <span class="mi">17</span>         <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
 <span class="mi">18</span>         
 <span class="mi">19</span>         <span class="c1"># Calculate expected values</span>
 <span class="mi">20</span>         <span class="n">expected_fee</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="mf">0.029</span>
 <span class="mi">21</span>         <span class="n">expected_net</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">expected_fee</span>
 <span class="mi">22</span>         
 <span class="mi">23</span>         <span class="c1"># These assertions will fail due to floating-point precision</span>
 <span class="mi">24</span>  <span class="o">-&gt;</span>     <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_fee</span>
 <span class="mi">25</span>         <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;net_amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_net</span>
</code></pre></div>

<p><strong><code>w</code> or <code>where</code></strong>: Show the call stack</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">w</span>
  <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">_pytest</span><span class="o">/</span><span class="n">python</span><span class="o">.</span><span class="n">py</span><span class="p">(</span><span class="mi">194</span><span class="p">)</span><span class="n">pytest_pyfunc_call</span><span class="p">()</span>
<span class="o">-&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">testfunction</span><span class="p">(</span><span class="o">**</span><span class="n">testargs</span><span class="p">)</span>
  <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">test_payment_debugging</span><span class="o">.</span><span class="n">py</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="n">test_payment_with_complex_calculation</span><span class="p">()</span>
<span class="o">-&gt;</span> <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_fee</span>
</code></pre></div>

<p><strong><code>u</code> or <code>up</code></strong>: Move up one level in the call stack</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">u</span>
<span class="o">&gt;</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">_pytest</span><span class="o">/</span><span class="n">python</span><span class="o">.</span><span class="n">py</span><span class="p">(</span><span class="mi">194</span><span class="p">)</span><span class="n">pytest_pyfunc_call</span><span class="p">()</span>
<span class="o">-&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">testfunction</span><span class="p">(</span><span class="o">**</span><span class="n">testargs</span><span class="p">)</span>
</code></pre></div>

<p><strong><code>d</code> or <code>down</code></strong>: Move down one level in the call stack</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">d</span>
<span class="o">&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">test_payment_debugging</span><span class="o">.</span><span class="n">py</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="n">test_payment_with_complex_calculation</span><span class="p">()</span>
<span class="o">-&gt;</span> <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_fee</span>
</code></pre></div>

<h4 id="execution-commands">Execution Commands</h4>
<p><strong><code>c</code> or <code>continue</code></strong>: Continue execution until the next breakpoint or failure</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
<span class="c1"># Continues execution, may hit another failure or exit</span>
</code></pre></div>

<p><strong><code>q</code> or <code>quit</code></strong>: Exit the debugger and stop test execution</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">q</span>
<span class="c1"># Exits pdb and pytest</span>
</code></pre></div>

<p><strong><code>!</code> prefix</strong>: Execute arbitrary Python code</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">],</span> <span class="n">expected_fee</span><span class="p">)</span>
<span class="kc">True</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="n">new_amount</span> <span class="o">=</span> <span class="mf">500.00</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="n">new_amount</span> <span class="o">*</span> <span class="mf">0.029</span>
<span class="mf">14.5</span>
</code></pre></div>

<h2 id="combining-pdb-with-other-flags">Combining --pdb with Other Flags</h2>
<h3 id="-pdb-with-x-debug-first-failure-only">--pdb with -x: Debug First Failure Only</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_debugging.py<span class="w"> </span>-x<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>When to use</strong>: You want to debug the first failure and ignore subsequent ones.</p>
<h3 id="-pdb-with-v-verbose-output-before-debugging">--pdb with -v: Verbose Output Before Debugging</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_payment_debugging.py<span class="w"> </span>-v<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>When to use</strong>: You want to see test names and progress before dropping into the debugger.</p>
<h3 id="-pdb-with-k-debug-specific-tests">--pdb with -k: Debug Specific Tests</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;complex_calculation&quot;</span><span class="w"> </span>--pdb
</code></pre></div>

<p><strong>When to use</strong>: You want to debug only tests matching a pattern.</p>
<h3 id="-pdb-with-lf-debug-last-failed-test">--pdb with --lf: Debug Last Failed Test</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>--lf<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>When to use</strong>: You want to re-run and debug the test that failed in the previous run.</p>
<h2 id="advanced-pdbcls-for-better-debuggers">Advanced: --pdbcls for Better Debuggers</h2>
<p>Pytest supports alternative debuggers that provide enhanced features:</p>
<h3 id="using-ipdb-ipython-debugger">Using ipdb (IPython Debugger)</h3>
<p>Install ipdb:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>ipdb
</code></pre></div>

<p>Use it with pytest:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>--pdb<span class="w"> </span>--pdbcls<span class="o">=</span>IPython.terminal.debugger:TerminalPdb
</code></pre></div>

<p><strong>Benefits of ipdb</strong>:
- Syntax highlighting
- Tab completion
- Better history
- IPython magic commands</p>
<h3 id="using-pdb">Using pdb++</h3>
<p>Install pdb++:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pdbpp
</code></pre></div>

<p>Use it automatically (it replaces pdb):</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>Benefits of pdb++</strong>:
- Syntax highlighting
- Tab completion
- Sticky mode (shows code context automatically)
- Better command shortcuts</p>
<h2 id="real-world-debugging-scenario">Real-World Debugging Scenario</h2>
<p>Let's work through a complex debugging scenario that demonstrates the power of <code>--pdb</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_complex_debugging.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_refund_processing</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that refunds are processed correctly.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Process original payment</span>
    <span class="n">original_amount</span> <span class="o">=</span> <span class="mf">500.00</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="n">original_amount</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Process refund (not implemented yet)</span>
    <span class="n">refund_amount</span> <span class="o">=</span> <span class="mf">250.00</span>
    <span class="n">refund_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_refund</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">,</span> <span class="n">refund_amount</span><span class="p">)</span>

    <span class="c1"># Verify refund</span>
    <span class="n">refund</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">refund_id</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">refund</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;refund&#39;</span>
    <span class="k">assert</span> <span class="n">refund</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">refund_amount</span>
    <span class="k">assert</span> <span class="n">refund</span><span class="p">[</span><span class="s1">&#39;original_transaction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">transaction_id</span>
</code></pre></div>

<p>This test will fail because <code>process_refund()</code> doesn't exist yet. Let's debug it:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_complex_debugging.py::test_refund_processing<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">==================================</span><span class="p">=</span><span class="w"> </span><span class="nx">FAILURES</span><span class="w"> </span><span class="o">==================================</span><span class="p">=</span>
<span class="nx">__________________________</span><span class="w"> </span><span class="nx">test_refund_processing</span><span class="w"> </span><span class="nx">______________________________</span>

<span class="w">    </span><span class="nx">def</span><span class="w"> </span><span class="nx">test_refund_processing</span><span class="p">():</span>
<span class="w">        </span><span class="s">&quot;&quot;&quot;Test that refunds are processed correctly.&quot;&quot;&quot;</span>
<span class="w">        </span><span class="nx">api_client</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">MockAPIClient</span><span class="p">()</span>
<span class="w">        </span><span class="nx">processor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">PaymentProcessor</span><span class="p">(</span><span class="nx">api_client</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nx">Process</span><span class="w"> </span><span class="nx">original</span><span class="w"> </span><span class="nx">payment</span>
<span class="w">        </span><span class="nx">original_amount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m m-Double">500.00</span>
<span class="w">        </span><span class="nx">transaction_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">processor</span><span class="p">.</span><span class="nx">process_payment</span><span class="p">(</span>
<span class="w">            </span><span class="nx">amount</span><span class="p">=</span><span class="nx">original_amount</span><span class="p">,</span>
<span class="w">            </span><span class="nx">card_number</span><span class="p">=</span><span class="err">&#39;</span><span class="mi">1234567890123456</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">cvv</span><span class="p">=</span><span class="err">&#39;</span><span class="mi">123</span><span class="err">&#39;</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nx">Process</span><span class="w"> </span><span class="nx">refund</span><span class="w"> </span><span class="p">(</span><span class="k">not</span><span class="w"> </span><span class="nx">implemented</span><span class="w"> </span><span class="nx">yet</span><span class="p">)</span>
<span class="w">        </span><span class="nx">refund_amount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m m-Double">250.00</span>
<span class="p">&gt;</span><span class="w">       </span><span class="nx">refund_id</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">processor</span><span class="p">.</span><span class="nx">process_refund</span><span class="p">(</span><span class="nx">transaction_id</span><span class="p">,</span><span class="w"> </span><span class="nx">refund_amount</span><span class="p">)</span>
<span class="nx">E</span><span class="w">       </span><span class="nx">AttributeError</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">PaymentProcessor</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">attribute</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">process_refund</span><span class="err">&#39;</span>

<span class="o">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="nx">entering</span><span class="w"> </span><span class="nx">PDB</span><span class="w"> </span><span class="o">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
<span class="p">(</span><span class="nx">Pdb</span><span class="p">)</span><span class="w"> </span>
</code></pre></div>

<h3 id="interactive-debugging-session">Interactive Debugging Session</h3>
<p><strong>Step 1: Understand what we have</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">processor</span>
<span class="o">&lt;</span><span class="n">payment_processor</span><span class="o">.</span><span class="n">PaymentProcessor</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f8b3c4d5e90</span><span class="o">&gt;</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="nb">dir</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;api_client&#39;</span><span class="p">,</span> <span class="s1">&#39;fee_percentage&#39;</span><span class="p">,</span> <span class="s1">&#39;get_transaction&#39;</span><span class="p">,</span> <span class="s1">&#39;process_payment&#39;</span><span class="p">,</span> <span class="s1">&#39;transaction_log&#39;</span><span class="p">]</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">pp</span> <span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span>
<span class="p">[{</span><span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>
  <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="mf">14.499999999999998</span><span class="p">,</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXN_1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="mf">485.50000000000006</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">}]</span>
</code></pre></div>

<p><strong>What we learned</strong>: 
- The original payment was processed successfully
- We have the transaction in the log
- The <code>process_refund</code> method doesn't exist</p>
<p><strong>Step 2: Check what the test expects</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction_id</span>
<span class="s1">&#39;TXN_1&#39;</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">refund_amount</span>
<span class="mf">250.0</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">original_amount</span>
<span class="mf">500.0</span>
</code></pre></div>

<p><strong>What we learned</strong>: The test wants to refund $250 from a $500 transaction.</p>
<p><strong>Step 3: Verify the original transaction</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">original_transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">pp</span> <span class="n">original_transaction</span>
<span class="p">{</span><span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>
 <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="mf">14.499999999999998</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXN_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="mf">485.50000000000006</span><span class="p">,</span>
 <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">}</span>
</code></pre></div>

<p><strong>What we learned</strong>: The original transaction exists and has all the data we need.</p>
<p><strong>Step 4: Exit and implement the missing method</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">quit</span>
</code></pre></div>

<p>Now implement <code>process_refund()</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payment_processor.py (add this method)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PaymentProcessor</span><span class="p">:</span>
    <span class="c1"># ... existing code ...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_refund</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_transaction_id</span><span class="p">,</span> <span class="n">refund_amount</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a refund for a previous transaction.&quot;&quot;&quot;</span>
        <span class="c1"># Find the original transaction</span>
        <span class="n">original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">original_transaction_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">original</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transaction </span><span class="si">{</span><span class="n">original_transaction_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">refund_amount</span> <span class="o">&gt;</span> <span class="n">original</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Refund amount exceeds original transaction&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate refund fee (same percentage)</span>
        <span class="n">refund_fee</span> <span class="o">=</span> <span class="n">refund_amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fee_percentage</span>
        <span class="n">refund_net</span> <span class="o">=</span> <span class="n">refund_amount</span> <span class="o">-</span> <span class="n">refund_fee</span>

        <span class="c1"># Create refund transaction</span>
        <span class="n">refund_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;REFUND_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">refund_id</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;refund&#39;</span><span class="p">,</span>
            <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">refund_amount</span><span class="p">,</span>
            <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="n">refund_fee</span><span class="p">,</span>
            <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="n">refund_net</span><span class="p">,</span>
            <span class="s1">&#39;original_transaction&#39;</span><span class="p">:</span> <span class="n">original_transaction_id</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="n">refund_id</span>
</code></pre></div>

<p>Run the test again:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_complex_debugging.py::test_refund_processing<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_complex_debugging.py::test_refund_processing PASSED                [100%]
</code></pre></div>

<p>Success! The interactive debugging session helped us:
1. Understand what data was available
2. Verify the test's expectations
3. Identify exactly what was missing
4. Implement the solution with confidence</p>
<h2 id="practical-debugging-patterns">Practical Debugging Patterns</h2>
<h3 id="pattern-1-the-inspection-loop">Pattern 1: The Inspection Loop</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># In pdb:</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">p</span> <span class="n">variable_name</span>          <span class="c1"># Check value</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="nb">type</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>      <span class="c1"># Check type</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="nb">dir</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>       <span class="c1"># Check available methods</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">pp</span> <span class="n">variable_name</span>         <span class="c1"># Pretty print if complex</span>
</code></pre></div>

<h3 id="pattern-2-the-hypothesis-test">Pattern 2: The Hypothesis Test</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># In pdb:</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>  <span class="c1"># Test if approx would work</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="nb">len</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>       <span class="c1"># Test if length matches</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="nb">set</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>       <span class="c1"># Test if sets are equal</span>
</code></pre></div>

<h3 id="pattern-3-the-state-exploration">Pattern 3: The State Exploration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># In pdb:</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="nb">locals</span><span class="p">()</span>                 <span class="c1"># See all local variables</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">pp</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>         <span class="c1"># See object state</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">w</span>                        <span class="c1"># See call stack</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">u</span>                        <span class="c1"># Go up to caller</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">pp</span> <span class="nb">locals</span><span class="p">()</span>              <span class="c1"># See caller&#39;s variables</span>
</code></pre></div>

<h3 id="pattern-4-the-quick-fix-verification">Pattern 4: The Quick Fix Verification</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># In pdb:</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="n">fixed_value</span> <span class="o">=</span> <span class="n">actual</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Try a fix</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="err">!</span><span class="n">fixed_value</span> <span class="o">==</span> <span class="n">expected</span>       <span class="c1"># Test if it works</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">quit</span>                           <span class="c1"># Exit and implement the fix</span>
</code></pre></div>

<h2 id="when-to-use-pdb">When to Use --pdb</h2>
<h3 id="use-pdb-when">‚úÖ Use --pdb When:</h3>
<ol>
<li><strong>The failure is mysterious</strong>: The traceback doesn't make the problem obvious</li>
<li><strong>You need to inspect state</strong>: You want to see variable values at the failure point</li>
<li><strong>You're exploring</strong>: You don't know what's wrong and need to investigate</li>
<li><strong>You want to test hypotheses</strong>: You want to try different fixes interactively</li>
<li><strong>Complex data structures</strong>: You need to navigate nested objects or large dictionaries</li>
</ol>
<h3 id="dont-use-pdb-when">‚ùå Don't Use --pdb When:</h3>
<ol>
<li><strong>The failure is obvious</strong>: The traceback clearly shows the problem</li>
<li><strong>Batch processing</strong>: You're running many tests in CI/CD</li>
<li><strong>You know the fix</strong>: You already understand what's wrong</li>
<li><strong>Automated environments</strong>: CI servers can't interact with pdb</li>
<li><strong>Quick iterations</strong>: Adding print statements might be faster</li>
</ol>
<h2 id="decision-framework-pdb-vs-other-debugging-methods">Decision Framework: --pdb vs. Other Debugging Methods</h2>
<table>
<thead>
<tr>
<th>Debugging Need</th>
<th>Best Approach</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td>Inspect variable at failure</td>
<td><code>--pdb</code></td>
<td>Interactive exploration</td>
</tr>
<tr>
<td>See all local variables</td>
<td><code>--pdb</code> or <code>-l</code></td>
<td><code>-l</code> is faster if you don't need interaction</td>
</tr>
<tr>
<td>Test a hypothesis</td>
<td><code>--pdb</code></td>
<td>Can execute code interactively</td>
</tr>
<tr>
<td>Understand call stack</td>
<td><code>--pdb</code> with <code>w</code>, <code>u</code>, <code>d</code></td>
<td>Navigate the stack interactively</td>
</tr>
<tr>
<td>Quick value check</td>
<td><code>-vv -l</code></td>
<td>Faster than interactive debugging</td>
</tr>
<tr>
<td>Complex object inspection</td>
<td><code>--pdb</code> with <code>pp</code></td>
<td>Pretty-print complex structures</td>
</tr>
<tr>
<td>Automated debugging</td>
<td><code>-vv -l --tb=long</code></td>
<td>Can't use interactive debugger in CI</td>
</tr>
</tbody>
</table>
<h2 id="key-takeaways-the-pdb-flag">Key Takeaways: The --pdb Flag</h2>
<h3 id="1-pdb-transforms-debugging-from-passive-to-active">1. --pdb Transforms Debugging from Passive to Active</h3>
<p>Instead of reading error messages, you actively explore the failure state.</p>
<h3 id="2-essential-pdb-commands-p-pp-l-w-q">2. Essential pdb Commands: p, pp, l, w, q</h3>
<p>Master these five commands and you can debug most issues.</p>
<h3 id="3-combine-with-x-for-focused-debugging">3. Combine with -x for Focused Debugging</h3>
<p><code>-x --pdb</code> stops at the first failure and drops you into the debugger.</p>
<h3 id="4-use-to-execute-arbitrary-code">4. Use ! to Execute Arbitrary Code</h3>
<p>Test hypotheses, try fixes, and explore possibilities interactively.</p>
<h3 id="5-navigate-the-call-stack-with-u-and-d">5. Navigate the Call Stack with u and d</h3>
<p>Understand the execution context by moving up and down the stack.</p>
<h3 id="6-ipdb-and-pdb-provide-better-experience">6. ipdb and pdb++ Provide Better Experience</h3>
<p>Consider upgrading to enhanced debuggers for syntax highlighting and tab completion.</p>
<h3 id="7-not-for-automated-environments">7. Not for Automated Environments</h3>
<p><code>--pdb</code> requires human interaction, so it's not suitable for CI/CD.</p>
<p>In the next section, we'll explore how to use breakpoints in your tests for even more control over debugging.</p>
<h2 id="using-breakpoints-in-tests">Using Breakpoints in Tests</h2>
<h2 id="proactive-debugging-with-breakpoints">Proactive Debugging with Breakpoints</h2>
<p>While <code>--pdb</code> drops you into the debugger when a test fails, sometimes you want to pause execution at a specific point before any failure occurs. This is where breakpoints come in.</p>
<p>A breakpoint is a deliberate pause point in your code where execution stops and you can inspect the state. Python 3.7+ provides the built-in <code>breakpoint()</code> function, which integrates seamlessly with pytest.</p>
<h3 id="why-use-breakpoints">Why Use Breakpoints?</h3>
<ol>
<li><strong>Inspect state before failure</strong>: See what's happening before the assertion fails</li>
<li><strong>Understand execution flow</strong>: Verify that code paths are executed as expected</li>
<li><strong>Debug complex logic</strong>: Step through complicated calculations or transformations</li>
<li><strong>Validate assumptions</strong>: Check that your mental model matches reality</li>
<li><strong>Explore APIs</strong>: Understand how external libraries behave</li>
</ol>
<p>Let's explore breakpoints with our payment processor.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_breakpoint_demo.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_breakpoint</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test payment processing with a breakpoint for inspection.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="mf">1000.00</span>

    <span class="c1"># Set a breakpoint before processing</span>
    <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Set another breakpoint after processing</span>
    <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

    <span class="c1"># Verify the transaction</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">amount</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;completed&#39;</span>
</code></pre></div>

<h3 id="running-tests-with-breakpoints">Running Tests with Breakpoints</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_breakpoint_demo.py::test_payment_with_breakpoint<span class="w"> </span>-s
</code></pre></div>

<p><strong>Note</strong>: The <code>-s</code> flag is important‚Äîit disables output capturing so you can interact with the debugger.</p>
<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">=============================</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="o">==============================</span>
<span class="n">collected</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">item</span>

<span class="n">test_breakpoint_demo</span><span class="p">.</span><span class="n">py</span><span class="o">::</span><span class="n">test_payment_with_breakpoint</span><span class="w"> </span>
<span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="nf">project</span><span class="o">/</span><span class="n">test_breakpoint_demo</span><span class="p">.</span><span class="n">py</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="n">test_payment_with_breakpoint</span><span class="p">()</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="n">transaction_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processor</span><span class="p">.</span><span class="n">process_payment</span><span class="p">(</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span><span class="w"> </span>
</code></pre></div>

<p><strong>What happened</strong>:
- Execution stopped at the first <code>breakpoint()</code>
- You're in pdb at line 12, before <code>process_payment()</code> is called
- You can now inspect the state before the payment is processed</p>
<h3 id="diagnostic-analysis-exploring-state-at-breakpoints">Diagnostic Analysis: Exploring State at Breakpoints</h3>
<p><strong>At the first breakpoint (before processing)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">amount</span>
<span class="mf">1000.0</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span>
<span class="p">[]</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">api_client</span><span class="o">.</span><span class="n">call_count</span>
<span class="mi">0</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">ll</span>
  <span class="mi">3</span>     <span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_breakpoint</span><span class="p">():</span>
  <span class="mi">4</span>         <span class="s2">&quot;&quot;&quot;Test payment processing with a breakpoint for inspection.&quot;&quot;&quot;</span>
  <span class="mi">5</span>         <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
  <span class="mi">6</span>         <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>
  <span class="mi">7</span>         
  <span class="mi">8</span>         <span class="n">amount</span> <span class="o">=</span> <span class="mf">1000.00</span>
  <span class="mi">9</span>         
 <span class="mi">10</span>         <span class="c1"># Set a breakpoint before processing</span>
 <span class="mi">11</span>         <span class="nb">breakpoint</span><span class="p">()</span>
 <span class="mi">12</span>         
 <span class="mi">13</span>  <span class="o">-&gt;</span>     <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
 <span class="mi">14</span>             <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
 <span class="mi">15</span>             <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
 <span class="mi">16</span>             <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
 <span class="mi">17</span>         <span class="p">)</span>
 <span class="mi">18</span>         
 <span class="mi">19</span>         <span class="c1"># Set another breakpoint after processing</span>
 <span class="mi">20</span>         <span class="nb">breakpoint</span><span class="p">()</span>
</code></pre></div>

<p><strong>What we learned</strong>:
- The amount is set correctly
- No transactions have been processed yet
- The API hasn't been called yet
- We're about to call <code>process_payment()</code></p>
<p><strong>Continue to the next breakpoint</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
<span class="o">&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">test_breakpoint_demo</span><span class="o">.</span><span class="n">py</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span><span class="n">test_payment_with_breakpoint</span><span class="p">()</span>
<span class="o">-&gt;</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span>
</code></pre></div>

<p><strong>At the second breakpoint (after processing)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction_id</span>
<span class="s1">&#39;TXN_1&#39;</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">pp</span> <span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span>
<span class="p">[{</span><span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span>
  <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="mf">28.999999999999996</span><span class="p">,</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TXN_1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="mf">971.0000000000001</span><span class="p">,</span>
  <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">}]</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">api_client</span><span class="o">.</span><span class="n">call_count</span>
<span class="mi">1</span>

<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
<span class="c1"># Test continues and completes</span>
</code></pre></div>

<p><strong>What we learned</strong>:
- The payment was processed successfully
- Transaction ID is 'TXN_1'
- The transaction is in the log
- The API was called once
- We can now verify the transaction details</p>
<h2 id="strategic-breakpoint-placement">Strategic Breakpoint Placement</h2>
<h3 id="pattern-1-before-and-after-critical-operations">Pattern 1: Before and After Critical Operations</h3>
<p>Place breakpoints around important operations to verify state changes:
    </markdown></p>
<p>def test_multiple_payments_with_breakpoints():
    """Test multiple payments with strategic breakpoints."""
    api_client = MockAPIClient()
    processor = PaymentProcessor(api_client)</p>
<div class="codehilite"><pre><span></span><code><span class="gh">#</span> Breakpoint: Initial state
breakpoint()

<span class="gh">#</span> Process first payment
txn1 = processor.process_payment(100.00, &#39;1234567890123456&#39;, &#39;123&#39;)

<span class="gh">#</span> Breakpoint: After first payment
breakpoint()

<span class="gh">#</span> Process second payment
txn2 = processor.process_payment(200.00, &#39;1234567890123456&#39;, &#39;123&#39;)

<span class="gh">#</span> Breakpoint: After second payment
breakpoint()

<span class="gh">#</span> Verify both transactions
assert len(processor.transaction_log) == 2
assert txn1 != txn2
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="o">**</span><span class="n">When</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="o">**</span><span class="p">:</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">change</span><span class="o">.</span>

<span class="c1">### Pattern 2: Inside Loops</span>

<span class="n">Place</span><span class="w"> </span><span class="n">breakpoints</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">inspect</span><span class="w"> </span><span class="n">iteration</span><span class="w"> </span><span class="n">state</span><span class="p">:</span>

<span class="err">```</span><span class="n">python</span>
<span class="n">def</span><span class="w"> </span><span class="n">test_batch_processing_with_breakpoint</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test batch payment processing with loop inspection.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">api_client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MockAPIClient</span><span class="p">()</span>
<span class="w">    </span><span class="n">processor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

<span class="w">    </span><span class="n">amounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">100.00</span><span class="p">,</span><span class="w"> </span><span class="mf">200.00</span><span class="p">,</span><span class="w"> </span><span class="mf">300.00</span><span class="p">,</span><span class="w"> </span><span class="mf">400.00</span><span class="p">,</span><span class="w"> </span><span class="mf">500.00</span><span class="p">]</span>
<span class="w">    </span><span class="n">transaction_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">enumerate</span><span class="p">(</span><span class="n">amounts</span><span class="p">):</span>
<span class="w">        </span><span class="c1"># Breakpoint: Inspect each iteration</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">  </span><span class="c1"># Stop at third iteration</span>
<span class="w">            </span><span class="k">breakpoint</span><span class="p">()</span>

<span class="w">        </span><span class="n">txn_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
<span class="w">            </span><span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
<span class="w">            </span><span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">transaction_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txn_id</span><span class="p">)</span>

<span class="w">    </span><span class="nb">assert</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">transaction_ids</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">amounts</span><span class="p">)</span>
</code></pre></div>

<p><strong>When to use</strong>: When you need to understand what's happening in a specific iteration.</p>
<h3 id="pattern-3-conditional-breakpoints">Pattern 3: Conditional Breakpoints</h3>
<p>Use conditional logic to break only when certain conditions are met:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_conditional_breakpoint</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with conditional breakpoint.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">amounts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50.00</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">,</span> <span class="mf">150.00</span><span class="p">,</span> <span class="mf">200.00</span><span class="p">,</span> <span class="mf">250.00</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">amounts</span><span class="p">:</span>
        <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
            <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
            <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
        <span class="p">)</span>

        <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

        <span class="c1"># Break only if fee is above a threshold</span>
        <span class="k">if</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">5.00</span><span class="p">:</span>
            <span class="nb">breakpoint</span><span class="p">()</span>

        <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;completed&#39;</span>
</code></pre></div>

<p><strong>When to use</strong>: When you want to inspect state only in specific scenarios.</p>
<h3 id="pattern-4-before-assertions">Pattern 4: Before Assertions</h3>
<p>Place breakpoints right before assertions to verify expected values:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_assertion_inspection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with breakpoint before assertion.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">1234.56</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

    <span class="c1"># Calculate expected values</span>
    <span class="n">expected_fee</span> <span class="o">=</span> <span class="mf">1234.56</span> <span class="o">*</span> <span class="mf">0.029</span>
    <span class="n">expected_net</span> <span class="o">=</span> <span class="mf">1234.56</span> <span class="o">-</span> <span class="n">expected_fee</span>

    <span class="c1"># Breakpoint: Verify calculations before asserting</span>
    <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="n">expected_fee</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;net_amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="n">expected_net</span><span class="p">)</span>
</code></pre></div>

<p><strong>When to use</strong>: When you want to verify your expected values are correct before the assertion fails.</p>
<h2 id="advanced-breakpoint-techniques">Advanced Breakpoint Techniques</h2>
<h3 id="using-breakpoint-with-arguments">Using breakpoint() with Arguments</h3>
<p>The <code>breakpoint()</code> function accepts arguments that are passed to the debugger:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_breakpoint_with_context</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with contextual breakpoint.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="mf">500.00</span>

    <span class="c1"># You can&#39;t pass arguments to breakpoint() directly,</span>
    <span class="c1"># but you can set variables to provide context</span>
    <span class="n">debug_context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="s1">&#39;before_payment&#39;</span><span class="p">,</span>
        <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
        <span class="s1">&#39;expected_fee&#39;</span><span class="p">:</span> <span class="n">amount</span> <span class="o">*</span> <span class="mf">0.029</span>
    <span class="p">}</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Inspect debug_context in pdb</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<h3 id="disabling-breakpoints-with-environment-variables">Disabling Breakpoints with Environment Variables</h3>
<p>You can disable all breakpoints by setting the <code>PYTHONBREAKPOINT</code> environment variable:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Disable all breakpoints</span>
$<span class="w"> </span><span class="nv">PYTHONBREAKPOINT</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>pytest<span class="w"> </span>test_breakpoint_demo.py

<span class="c1"># Use a different debugger</span>
$<span class="w"> </span><span class="nv">PYTHONBREAKPOINT</span><span class="o">=</span>ipdb.set_trace<span class="w"> </span>pytest<span class="w"> </span>test_breakpoint_demo.py
</code></pre></div>

<p><strong>When to use</strong>: 
- In CI/CD pipelines where breakpoints should be ignored
- When you want to run tests without stopping at breakpoints
- When switching between different debuggers</p>
<h3 id="temporary-breakpoints-for-quick-debugging">Temporary Breakpoints for Quick Debugging</h3>
<p>Add breakpoints temporarily during development and remove them before committing:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_temporary_debugging</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with temporary breakpoint for debugging.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># TODO: Remove this breakpoint before committing</span>
    <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<p><strong>Best practice</strong>: Use a linter or pre-commit hook to catch breakpoints before they reach version control.</p>
<h2 id="breakpoints-vs-pdb-when-to-use-each">Breakpoints vs. --pdb: When to Use Each</h2>
<h3 id="use-breakpoint-when">Use breakpoint() When:</h3>
<ol>
<li><strong>You know where to look</strong>: You have a specific location you want to inspect</li>
<li><strong>Proactive debugging</strong>: You want to understand code flow before any failure</li>
<li><strong>Iterative development</strong>: You're building new functionality and want to verify each step</li>
<li><strong>Complex logic</strong>: You need to step through complicated calculations</li>
<li><strong>Reusable inspection points</strong>: You want to keep the breakpoint for multiple test runs</li>
</ol>
<h3 id="use-pdb-when_1">Use --pdb When:</h3>
<ol>
<li><strong>Reactive debugging</strong>: A test failed and you want to inspect the failure point</li>
<li><strong>Unknown failure location</strong>: You don't know where the problem is</li>
<li><strong>One-time investigation</strong>: You don't need a permanent breakpoint</li>
<li><strong>Multiple tests</strong>: You want to debug any test that fails</li>
<li><strong>Quick inspection</strong>: You want to drop into the debugger without modifying code</li>
</ol>
<h3 id="combining-both-approaches">Combining Both Approaches</h3>
<p>You can use both <code>breakpoint()</code> and <code>--pdb</code> together:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_combined_debugging</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test using both breakpoint() and --pdb.&quot;&quot;&quot;</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Breakpoint: Inspect initial state</span>
    <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

    <span class="c1"># This assertion might fail, triggering --pdb</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">2.90</span>  <span class="c1"># Will fail without pytest.approx()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_combined_debugging.py<span class="w"> </span>-s<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>What happens</strong>:
1. Execution stops at <code>breakpoint()</code>
2. You inspect the initial state
3. You continue with <code>c</code>
4. If the assertion fails, <code>--pdb</code> drops you into the debugger again
5. You can inspect the failure state</p>
<h2 id="real-world-debugging-scenario_1">Real-World Debugging Scenario</h2>
<p>Let's work through a complex scenario that demonstrates strategic breakpoint placement.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_complex_breakpoint_scenario.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_retry_logic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test payment retry logic with breakpoints.&quot;&quot;&quot;</span>
    <span class="c1"># Simulate an API that fails twice then succeeds</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">(</span><span class="n">should_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="mf">100.00</span>
    <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Breakpoint: Before retry loop</span>
    <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="k">while</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Breakpoint: At start of each retry</span>
            <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">breakpoint</span><span class="p">()</span>

            <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
                <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
                <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
                <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
            <span class="p">)</span>

            <span class="c1"># Success - break out of loop</span>
            <span class="k">break</span>

        <span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Breakpoint: After each failure</span>
            <span class="nb">breakpoint</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&gt;=</span> <span class="n">max_retries</span><span class="p">:</span>
                <span class="k">raise</span>

            <span class="c1"># Simulate fixing the API after 2 failures</span>
            <span class="k">if</span> <span class="n">retry_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">api_client</span><span class="o">.</span><span class="n">should_fail</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Breakpoint: After successful payment</span>
    <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">transaction_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">retry_count</span> <span class="o">==</span> <span class="mi">2</span>  <span class="c1"># Should succeed on third try</span>
</code></pre></div>

<h3 id="debugging-session-walkthrough">Debugging Session Walkthrough</h3>
<p>Run the test:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_complex_breakpoint_scenario.py::test_payment_retry_logic<span class="w"> </span>-s
</code></pre></div>

<p><strong>At first breakpoint (before retry loop)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">retry_count</span>
<span class="mi">0</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">api_client</span><span class="o">.</span><span class="n">should_fail</span>
<span class="kc">True</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction_id</span>
<span class="kc">None</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
</code></pre></div>

<p><strong>At second breakpoint (after first failure)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">retry_count</span>
<span class="mi">1</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">api_client</span><span class="o">.</span><span class="n">should_fail</span>
<span class="kc">True</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction_id</span>
<span class="kc">None</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
</code></pre></div>

<p><strong>At third breakpoint (start of second retry)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">retry_count</span>
<span class="mi">1</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">api_client</span><span class="o">.</span><span class="n">should_fail</span>
<span class="kc">True</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
</code></pre></div>

<p><strong>At fourth breakpoint (after second failure)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">retry_count</span>
<span class="mi">2</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">api_client</span><span class="o">.</span><span class="n">should_fail</span>
<span class="kc">False</span>  <span class="c1"># API is now fixed</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
</code></pre></div>

<p><strong>At fifth breakpoint (start of third retry)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">retry_count</span>
<span class="mi">2</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">api_client</span><span class="o">.</span><span class="n">should_fail</span>
<span class="kc">False</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
<span class="c1"># Payment succeeds, loop breaks</span>
</code></pre></div>

<p><strong>At sixth breakpoint (after successful payment)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">transaction_id</span>
<span class="s1">&#39;TXN_1&#39;</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">retry_count</span>
<span class="mi">2</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">api_client</span><span class="o">.</span><span class="n">call_count</span>
<span class="mi">3</span>
<span class="p">(</span><span class="n">Pdb</span><span class="p">)</span> <span class="n">c</span>
<span class="c1"># Test completes successfully</span>
</code></pre></div>

<p><strong>What we learned</strong>:
- The retry logic works correctly
- The API failed twice as expected
- The third attempt succeeded
- We verified the state at each critical point</p>
<h2 id="practical-breakpoint-patterns">Practical Breakpoint Patterns</h2>
<h3 id="pattern-1-the-state-verification-pattern">Pattern 1: The State Verification Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_state_verification</span><span class="p">():</span>
    <span class="c1"># Setup</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">create_object</span><span class="p">()</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Verify initial state</span>

    <span class="n">obj</span><span class="o">.</span><span class="n">modify</span><span class="p">()</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Verify state after modification</span>

    <span class="k">assert</span> <span class="n">obj</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
</code></pre></div>

<h3 id="pattern-2-the-calculation-inspection-pattern">Pattern 2: The Calculation Inspection Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_calculation_inspection</span><span class="p">():</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">get_input</span><span class="p">()</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Inspect input</span>

    <span class="n">intermediate</span> <span class="o">=</span> <span class="n">process_step_1</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Inspect intermediate result</span>

    <span class="n">final</span> <span class="o">=</span> <span class="n">process_step_2</span><span class="p">(</span><span class="n">intermediate</span><span class="p">)</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Inspect final result</span>

    <span class="k">assert</span> <span class="n">final</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>

<h3 id="pattern-3-the-conditional-investigation-pattern">Pattern 3: The Conditional Investigation Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_conditional_investigation</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">is_suspicious</span><span class="p">():</span>
            <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Investigate suspicious cases</span>

        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
</code></pre></div>

<h3 id="pattern-4-the-comparison-pattern">Pattern 4: The Comparison Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_comparison</span><span class="p">():</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">compute_actual</span><span class="p">()</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">compute_expected</span><span class="p">()</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Compare actual vs expected before assertion</span>

    <span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>

<h2 id="best-practices-for-using-breakpoints">Best Practices for Using Breakpoints</h2>
<h3 id="1-remove-breakpoints-before-committing">1. Remove Breakpoints Before Committing</h3>
<p>Use a pre-commit hook or linter to catch breakpoints:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># .pre-commit-config.yaml</span>
repos:
<span class="w">  </span>-<span class="w"> </span>repo:<span class="w"> </span><span class="nb">local</span>
<span class="w">    </span>hooks:
<span class="w">      </span>-<span class="w"> </span>id:<span class="w"> </span>check-breakpoints
<span class="w">        </span>name:<span class="w"> </span>Check<span class="w"> </span><span class="k">for</span><span class="w"> </span>breakpoints
<span class="w">        </span>entry:<span class="w"> </span>grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;breakpoint()&quot;</span><span class="w"> </span>tests/
<span class="w">        </span>language:<span class="w"> </span>system
<span class="w">        </span>pass_filenames:<span class="w"> </span><span class="nb">false</span>
</code></pre></div>

<h3 id="2-use-descriptive-variable-names-before-breakpoints">2. Use Descriptive Variable Names Before Breakpoints</h3>
<p>Make debugging easier by setting up context:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_with_context</span><span class="p">():</span>
    <span class="c1"># Set up debugging context</span>
    <span class="n">debug_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="s1">&#39;before_critical_operation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;input&#39;</span><span class="p">:</span> <span class="n">input_data</span><span class="p">,</span>
        <span class="s1">&#39;expected&#39;</span><span class="p">:</span> <span class="n">expected_result</span>
    <span class="p">}</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Inspect debug_info</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">critical_operation</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">expected_result</span>
</code></pre></div>

<h3 id="3-combine-with-logging">3. Combine with Logging</h3>
<p>Use logging alongside breakpoints for permanent debugging information:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_with_logging_and_breakpoint</span><span class="p">():</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting payment processing&quot;</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transaction ID: </span><span class="si">{</span><span class="n">transaction_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">breakpoint</span><span class="p">()</span>  <span class="c1"># Inspect if needed</span>

    <span class="k">assert</span> <span class="n">transaction_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<h3 id="4-use-environment-variables-for-conditional-breakpoints">4. Use Environment Variables for Conditional Breakpoints</h3>
<p>Make breakpoints conditional on environment variables:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_conditional_breakpoint</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">):</span>
        <span class="nb">breakpoint</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Enable debugging</span>
$<span class="w"> </span><span class="nv">DEBUG</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>pytest<span class="w"> </span>test_file.py<span class="w"> </span>-s

<span class="c1"># Normal run (no breakpoints)</span>
$<span class="w"> </span>pytest<span class="w"> </span>test_file.py
</code></pre></div>

<h2 id="key-takeaways-using-breakpoints">Key Takeaways: Using Breakpoints</h2>
<h3 id="1-breakpoint-enables-proactive-debugging">1. breakpoint() Enables Proactive Debugging</h3>
<p>Stop execution at specific points to inspect state before failures occur.</p>
<h3 id="2-strategic-placement-is-key">2. Strategic Placement is Key</h3>
<p>Place breakpoints before/after critical operations, inside loops, or before assertions.</p>
<h3 id="3-combine-with-pdb-for-comprehensive-debugging">3. Combine with --pdb for Comprehensive Debugging</h3>
<p>Use <code>breakpoint()</code> for planned inspection and <code>--pdb</code> for reactive debugging.</p>
<h3 id="4-use-s-flag-to-enable-interaction">4. Use -s Flag to Enable Interaction</h3>
<p>Always run with <code>-s</code> when using breakpoints to disable output capturing.</p>
<h3 id="5-conditional-breakpoints-reduce-noise">5. Conditional Breakpoints Reduce Noise</h3>
<p>Use <code>if</code> statements to break only when specific conditions are met.</p>
<h3 id="6-remove-before-committing">6. Remove Before Committing</h3>
<p>Use pre-commit hooks or linters to prevent breakpoints from reaching production.</p>
<h3 id="7-pythonbreakpoint0-disables-all-breakpoints">7. PYTHONBREAKPOINT=0 Disables All Breakpoints</h3>
<p>Useful for CI/CD or when you want to run tests without stopping.</p>
<p>In the next section, we'll explore how to use logging and debugging information to create permanent debugging infrastructure in your tests.</p>
<h2 id="logging-and-debugging-information">Logging and Debugging Information</h2>
<h2 id="building-permanent-debugging-infrastructure">Building Permanent Debugging Infrastructure</h2>
<p>While <code>--pdb</code> and <code>breakpoint()</code> are powerful for interactive debugging, they're temporary solutions. Logging provides permanent debugging infrastructure that helps you understand test behavior without stopping execution.</p>
<p>Logging is especially valuable for:
1. <strong>Understanding test flow</strong>: See what happens during test execution
2. <strong>Debugging intermittent failures</strong>: Capture information about flaky tests
3. <strong>Performance analysis</strong>: Track timing and resource usage
4. <strong>Production debugging</strong>: Understand behavior in CI/CD environments
5. <strong>Historical analysis</strong>: Review logs from past test runs</p>
<p>Let's build a comprehensive logging strategy for our payment processor.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># payment_processor.py (with logging)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PaymentProcessor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_client</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span> <span class="o">=</span> <span class="n">api_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fee_percentage</span> <span class="o">=</span> <span class="mf">0.029</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;PaymentProcessor initialized with fee_percentage=</span><span class="si">%.3f</span><span class="s2">&quot;</span><span class="p">,</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">fee_percentage</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">card_number</span><span class="p">,</span> <span class="n">cvv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a payment and return transaction ID.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing payment: amount=</span><span class="si">%.2f</span><span class="s2">, card=****</span><span class="si">%s</span><span class="s2">, cvv=***&quot;</span><span class="p">,</span>
                    <span class="n">amount</span><span class="p">,</span> <span class="n">card_number</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>

        <span class="k">if</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid amount: </span><span class="si">%.2f</span><span class="s2"> (must be positive)&quot;</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Amount must be positive&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">card_number</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid card number length: </span><span class="si">%d</span><span class="s2"> (expected 16)&quot;</span><span class="p">,</span> 
                        <span class="nb">len</span><span class="p">(</span><span class="n">card_number</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid card number&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cvv</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid CVV length: </span><span class="si">%d</span><span class="s2"> (expected 3)&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cvv</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid CVV&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate fee and net amount</span>
        <span class="n">fee</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fee_percentage</span>
        <span class="n">net_amount</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">fee</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculated fee=</span><span class="si">%.2f</span><span class="s2">, net_amount=</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fee</span><span class="p">,</span> <span class="n">net_amount</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span>
                <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
                <span class="n">card</span><span class="o">=</span><span class="n">card_number</span><span class="p">,</span>
                <span class="n">cvv</span><span class="o">=</span><span class="n">cvv</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;API charge successful: transaction_id=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> 
                       <span class="n">response</span><span class="p">[</span><span class="s1">&#39;transaction_id&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;API charge failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;transaction_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">transaction_id</span><span class="p">,</span>
            <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
            <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="n">fee</span><span class="p">,</span>
            <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="n">net_amount</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span>
        <span class="p">})</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Payment processed successfully: transaction_id=</span><span class="si">%s</span><span class="s2">, amount=</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span>
                   <span class="n">transaction_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">transaction_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a transaction by ID.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Looking up transaction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">transaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">transaction_id</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">transaction</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Transaction not found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MockAPIClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">should_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">should_fail</span> <span class="o">=</span> <span class="n">should_fail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MockAPIClient initialized: should_fail=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">should_fail</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">cvv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;API charge called (attempt </span><span class="si">%d</span><span class="s2">): amount=</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_fail</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;API charge failed (simulated failure)&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;API unavailable&quot;</span><span class="p">)</span>

        <span class="n">transaction_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;TXN_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">call_count</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;API charge succeeded: transaction_id=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;transaction_id&#39;</span><span class="p">:</span> <span class="n">transaction_id</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span>
        <span class="p">}</span>
</code></pre></div>

<h2 id="configuring-logging-in-tests">Configuring Logging in Tests</h2>
<h3 id="basic-logging-configuration">Basic Logging Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_logging_demo.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="c1"># Configure logging for tests</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
<span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_logging</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test payment processing with logging enabled.&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=== Starting test_payment_with_logging ===&quot;</span><span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing payment for $100.00&quot;</span><span class="p">)</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Payment processed: transaction_id=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">)</span>

    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Retrieved transaction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">100.00</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;completed&#39;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=== Test completed successfully ===&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Run the test with logging output:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_logging_demo.py::test_payment_with_logging<span class="w"> </span>-s
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>============================= test session starts ==============================
collected 1 item

test_logging_demo.py::test_payment_with_logging 
2024-01-15 10:30:45,123 - test_logging_demo - INFO - === Starting test_payment_with_logging ===
2024-01-15 10:30:45,124 - payment_processor - INFO - MockAPIClient initialized: should_fail=False
2024-01-15 10:30:45,124 - payment_processor - INFO - PaymentProcessor initialized with fee_percentage=0.029
2024-01-15 10:30:45,124 - test_logging_demo - INFO - Processing payment for $100.00
2024-01-15 10:30:45,125 - payment_processor - DEBUG - Processing payment: amount=100.00, card=****3456, cvv=***
2024-01-15 10:30:45,125 - payment_processor - DEBUG - Calculated fee=2.90, net_amount=97.10
2024-01-15 10:30:45,125 - payment_processor - DEBUG - API charge called (attempt 1): amount=100.00
2024-01-15 10:30:45,125 - payment_processor - INFO - API charge succeeded: transaction_id=TXN_1
2024-01-15 10:30:45,125 - payment_processor - INFO - API charge successful: transaction_id=TXN_1
2024-01-15 10:30:45,126 - payment_processor - INFO - Payment processed successfully: transaction_id=TXN_1, amount=100.00
2024-01-15 10:30:45,126 - test_logging_demo - INFO - Payment processed: transaction_id=TXN_1
2024-01-15 10:30:45,126 - payment_processor - DEBUG - Looking up transaction: TXN_1
2024-01-15 10:30:45,126 - payment_processor - DEBUG - Transaction found: TXN_1
2024-01-15 10:30:45,126 - test_logging_demo - DEBUG - Retrieved transaction: {&#39;id&#39;: &#39;TXN_1&#39;, &#39;amount&#39;: 100.0, &#39;fee&#39;: 2.8999999999999995, &#39;net_amount&#39;: 97.10000000000001, &#39;status&#39;: &#39;completed&#39;}
2024-01-15 10:30:45,126 - test_logging_demo - INFO - === Test completed successfully ===
PASSED

============================== 1 passed in 0.01s ===============================
</code></pre></div>

<p><strong>What we see</strong>:
- Complete execution flow with timestamps
- All log levels (INFO, DEBUG)
- Detailed information about each operation
- Clear test boundaries</p>
<h3 id="diagnostic-analysis-reading-log-output">Diagnostic Analysis: Reading Log Output</h3>
<p>Let's trace through the log output to understand the execution flow:</p>
<p><strong>1. Test initialization</strong>:</p>
<div class="codehilite"><pre><span></span><code>INFO - === Starting test_payment_with_logging ===
INFO - MockAPIClient initialized: should_fail=False
INFO - PaymentProcessor initialized with fee_percentage=0.029
</code></pre></div>

<p><strong>What this tells us</strong>: The test started, and both objects were initialized correctly.</p>
<p><strong>2. Payment processing begins</strong>:</p>
<div class="codehilite"><pre><span></span><code>INFO - Processing payment for $100.00
DEBUG - Processing payment: amount=100.00, card=****3456, cvv=***
DEBUG - Calculated fee=2.90, net_amount=97.10
</code></pre></div>

<p><strong>What this tells us</strong>: The payment amount is correct, and fee calculation happened.</p>
<p><strong>3. API interaction</strong>:</p>
<div class="codehilite"><pre><span></span><code>DEBUG - API charge called (attempt 1): amount=100.00
INFO - API charge succeeded: transaction_id=TXN_1
INFO - API charge successful: transaction_id=TXN_1
</code></pre></div>

<p><strong>What this tells us</strong>: The API was called once and succeeded immediately.</p>
<p><strong>4. Transaction storage</strong>:</p>
<div class="codehilite"><pre><span></span><code>INFO - Payment processed successfully: transaction_id=TXN_1, amount=100.00
</code></pre></div>

<p><strong>What this tells us</strong>: The transaction was stored in the log.</p>
<p><strong>5. Transaction retrieval</strong>:</p>
<div class="codehilite"><pre><span></span><code>DEBUG - Looking up transaction: TXN_1
DEBUG - Transaction found: TXN_1
DEBUG - Retrieved transaction: {...}
</code></pre></div>

<p><strong>What this tells us</strong>: The transaction was successfully retrieved with all its data.</p>
<h2 id="advanced-logging-configurations">Advanced Logging Configurations</h2>
<h3 id="using-pytests-caplog-fixture">Using pytest's caplog Fixture</h3>
<p>Pytest provides the <code>caplog</code> fixture for capturing and asserting on log messages:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_caplog_demo.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_logging_with_caplog</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that payment processing logs expected messages.&quot;&quot;&quot;</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Assert that specific log messages were generated</span>
    <span class="k">assert</span> <span class="s2">&quot;PaymentProcessor initialized&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;Payment processed successfully&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="sa">f</span><span class="s2">&quot;transaction_id=</span><span class="si">{</span><span class="n">transaction_id</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>

    <span class="c1"># Check log levels</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s2">&quot;INFO&quot;</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>

    <span class="c1"># Check specific log records</span>
    <span class="n">payment_logs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span> 
                   <span class="k">if</span> <span class="s2">&quot;Payment processed successfully&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">message</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">payment_logs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">payment_logs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s2">&quot;INFO&quot;</span>
</code></pre></div>

<p><strong>Benefits of caplog</strong>:
- Capture logs without printing them
- Assert on log content
- Verify log levels
- Test logging behavior</p>
<h3 id="logging-configuration-with-pytestini">Logging Configuration with pytest.ini</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">log_cli</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="na">log_cli_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">INFO</span>
<span class="na">log_cli_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%(asctime)s [%(levelname)8s] %(name)s - %(message)s</span>
<span class="na">log_cli_date_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%Y-%m-%d %H:%M:%S</span>

<span class="na">log_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">tests.log</span>
<span class="na">log_file_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">DEBUG</span>
<span class="na">log_file_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%(asctime)s [%(levelname)8s] %(name)s - %(message)s (%(filename)s:%(lineno)d)</span>
<span class="na">log_file_date_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">%Y-%m-%d %H:%M:%S</span>
</code></pre></div>

<p><strong>What this does</strong>:
- <code>log_cli = true</code>: Enable live logging to console
- <code>log_cli_level = INFO</code>: Show INFO and above in console
- <code>log_file = tests.log</code>: Write all logs to a file
- <code>log_file_level = DEBUG</code>: Include DEBUG logs in file</p>
<p>Now run tests:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_logging_demo.py
</code></pre></div>

<p><strong>Console output</strong> (INFO and above):</p>
<div class="codehilite"><pre><span></span><code><span class="mf">2024</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="w"> </span><span class="mf">10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45</span><span class="w"> </span><span class="err">[</span><span class="w">    </span><span class="n">INFO</span><span class="err">]</span><span class="w"> </span><span class="n">test_logging_demo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">test_payment_with_logging</span><span class="w"> </span><span class="o">===</span>
<span class="mf">2024</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="w"> </span><span class="mf">10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45</span><span class="w"> </span><span class="err">[</span><span class="w">    </span><span class="n">INFO</span><span class="err">]</span><span class="w"> </span><span class="n">payment_processor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MockAPIClient</span><span class="w"> </span><span class="n">initialized</span><span class="p">:</span><span class="w"> </span><span class="n">should_fail</span><span class="o">=</span><span class="n">False</span>
<span class="mf">2024</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="w"> </span><span class="mf">10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45</span><span class="w"> </span><span class="err">[</span><span class="w">    </span><span class="n">INFO</span><span class="err">]</span><span class="w"> </span><span class="n">payment_processor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PaymentProcessor</span><span class="w"> </span><span class="n">initialized</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">fee_percentage</span><span class="o">=</span><span class="mf">0.029</span>
<span class="mf">...</span>
</code></pre></div>

<p><strong>File output</strong> (tests.log, includes DEBUG):</p>
<div class="codehilite"><pre><span></span><code><span class="mf">2024</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="w"> </span><span class="mf">10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45</span><span class="w"> </span><span class="err">[</span><span class="w">    </span><span class="n">INFO</span><span class="err">]</span><span class="w"> </span><span class="n">test_logging_demo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">test_payment_with_logging</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="p">(</span><span class="n">test_logging_demo</span><span class="mf">.</span><span class="n">py</span><span class="p">:</span><span class="mf">12</span><span class="p">)</span>
<span class="mf">2024</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="w"> </span><span class="mf">10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45</span><span class="w"> </span><span class="err">[</span><span class="w">    </span><span class="n">INFO</span><span class="err">]</span><span class="w"> </span><span class="n">payment_processor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MockAPIClient</span><span class="w"> </span><span class="n">initialized</span><span class="p">:</span><span class="w"> </span><span class="n">should_fail</span><span class="o">=</span><span class="n">False</span><span class="w"> </span><span class="p">(</span><span class="n">payment_processor</span><span class="mf">.</span><span class="n">py</span><span class="p">:</span><span class="mf">95</span><span class="p">)</span>
<span class="mf">2024</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="w"> </span><span class="mf">10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45</span><span class="w"> </span><span class="err">[</span><span class="w">    </span><span class="n">INFO</span><span class="err">]</span><span class="w"> </span><span class="n">payment_processor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PaymentProcessor</span><span class="w"> </span><span class="n">initialized</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">fee_percentage</span><span class="o">=</span><span class="mf">0.029</span><span class="w"> </span><span class="p">(</span><span class="n">payment_processor</span><span class="mf">.</span><span class="n">py</span><span class="p">:</span><span class="mf">13</span><span class="p">)</span>
<span class="mf">2024</span><span class="o">-</span><span class="mf">01</span><span class="o">-</span><span class="mf">15</span><span class="w"> </span><span class="mf">10</span><span class="p">:</span><span class="mf">30</span><span class="p">:</span><span class="mf">45</span><span class="w"> </span><span class="err">[</span><span class="w">   </span><span class="n">DEBUG</span><span class="err">]</span><span class="w"> </span><span class="n">payment_processor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Processing</span><span class="w"> </span><span class="n">payment</span><span class="p">:</span><span class="w"> </span><span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span><span class="w"> </span><span class="n">card</span><span class="o">=****</span><span class="mf">3456</span><span class="p">,</span><span class="w"> </span><span class="n">cvv</span><span class="o">=***</span><span class="w"> </span><span class="p">(</span><span class="n">payment_processor</span><span class="mf">.</span><span class="n">py</span><span class="p">:</span><span class="mf">17</span><span class="p">)</span>
<span class="mf">...</span>
</code></pre></div>

<h3 id="structured-logging-with-json">Structured Logging with JSON</h3>
<p>For machine-readable logs, use JSON formatting:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_structured_logging.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">class</span><span class="w"> </span><span class="nc">JSONFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom formatter that outputs JSON.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">log_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatTime</span><span class="p">(</span><span class="n">record</span><span class="p">),</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">levelname</span><span class="p">,</span>
            <span class="s1">&#39;logger&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">getMessage</span><span class="p">(),</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
            <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">funcName</span><span class="p">,</span>
            <span class="s1">&#39;line&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">lineno</span>
        <span class="p">}</span>

        <span class="c1"># Add extra fields if present</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;transaction_id&#39;</span><span class="p">):</span>
            <span class="n">log_data</span><span class="p">[</span><span class="s1">&#39;transaction_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">transaction_id</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;amount&#39;</span><span class="p">):</span>
            <span class="n">log_data</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">amount</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">log_data</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_structured_logging</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with structured JSON logging.&quot;&quot;&quot;</span>
    <span class="c1"># Configure JSON formatter</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">JSONFormatter</span><span class="p">())</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;payment_processor&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>

<p><strong>Output</strong> (JSON format):</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-01-15 10:30:45,123&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;logger&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_processor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MockAPIClient initialized: should_fail=False&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_processor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__init__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;line&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-01-15 10:30:45,124&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;logger&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_processor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PaymentProcessor initialized with fee_percentage=0.029&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;payment_processor&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__init__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;line&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="p">}</span>
<span class="err">...</span>
</code></pre></div>

<p><strong>Benefits</strong>:
- Machine-readable format
- Easy to parse and analyze
- Can be ingested by log aggregation systems
- Structured data for queries</p>
<h2 id="logging-strategies-for-different-scenarios">Logging Strategies for Different Scenarios</h2>
<h3 id="strategy-1-debug-intermittent-failures">Strategy 1: Debug Intermittent Failures</h3>
<p>For flaky tests, add detailed logging to capture state:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_intermittent_failure.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_retry_logging</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with detailed logging for retry logic.&quot;&quot;&quot;</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">(</span><span class="n">should_fail</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting payment with retry logic: max_retries=</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">max_retries</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Attempt </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">retry_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_retries</span><span class="p">)</span>

            <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
                <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
                <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
                <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Payment succeeded on attempt </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">retry_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Payment failed on attempt </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">retry_count</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&gt;=</span> <span class="n">max_retries</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;All retry attempts exhausted&quot;</span><span class="p">)</span>
                <span class="k">raise</span>

            <span class="c1"># Fix API after 2 failures</span>
            <span class="k">if</span> <span class="n">retry_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fixing API for next attempt&quot;</span><span class="p">)</span>
                <span class="n">api_client</span><span class="o">.</span><span class="n">should_fail</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Verify logging captured the retry behavior</span>
    <span class="k">assert</span> <span class="s2">&quot;Attempt 1 of 3&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;Payment failed on attempt 1&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;Attempt 2 of 3&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;Payment failed on attempt 2&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;Fixing API for next attempt&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;Attempt 3 of 3&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;Payment succeeded on attempt 3&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
</code></pre></div>

<h3 id="strategy-2-performance-logging">Strategy 2: Performance Logging</h3>
<p>Track timing information to identify slow operations:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_performance_logging.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_performance_logging</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with performance timing logs.&quot;&quot;&quot;</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Time the entire operation</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting payment processing&quot;</span><span class="p">)</span>

    <span class="c1"># Time payment processing</span>
    <span class="n">payment_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>
    <span class="n">payment_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">payment_start</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Payment processing took </span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">payment_duration</span><span class="p">)</span>

    <span class="c1"># Time transaction retrieval</span>
    <span class="n">retrieval_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>
    <span class="n">retrieval_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">retrieval_start</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Transaction retrieval took </span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">retrieval_duration</span><span class="p">)</span>

    <span class="n">total_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Total operation took </span><span class="si">%.3f</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">total_duration</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">transaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="c1"># Assert performance expectations</span>
    <span class="k">assert</span> <span class="n">payment_duration</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;Payment processing too slow&quot;</span>
    <span class="k">assert</span> <span class="n">retrieval_duration</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;Transaction retrieval too slow&quot;</span>
</code></pre></div>

<h3 id="strategy-3-state-transition-logging">Strategy 3: State Transition Logging</h3>
<p>Log state changes to understand object lifecycle:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_state_logging.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_state_transitions</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with state transition logging.&quot;&quot;&quot;</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;State: INITIAL - Creating objects&quot;</span><span class="p">)</span>
    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;State: READY - Objects created, transaction_log=</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> 
               <span class="nb">len</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;State: PROCESSING - Starting payment&quot;</span><span class="p">)</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;State: PROCESSED - Payment complete, transaction_log=</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
               <span class="nb">len</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;State: RETRIEVING - Looking up transaction&quot;</span><span class="p">)</span>
    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;State: COMPLETE - Transaction retrieved, status=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
               <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>

    <span class="c1"># Verify state transitions were logged</span>
    <span class="k">assert</span> <span class="s2">&quot;State: INITIAL&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;State: READY&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;State: PROCESSING&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;State: PROCESSED&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;State: RETRIEVING&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="s2">&quot;State: COMPLETE&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
</code></pre></div>

<h3 id="strategy-4-error-context-logging">Strategy 4: Error Context Logging</h3>
<p>Provide rich context when errors occur:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_error_context_logging.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_error_with_context</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test error logging with rich context.&quot;&quot;&quot;</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Attempt invalid payment</span>
    <span class="n">invalid_amount</span> <span class="o">=</span> <span class="o">-</span><span class="mf">50.00</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Attempting payment with invalid data&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Payment details: amount=</span><span class="si">%.2f</span><span class="s2">, card=****3456, cvv=***&quot;</span><span class="p">,</span>
                <span class="n">invalid_amount</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">invalid_amount</span><span class="p">,</span>
            <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
            <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Payment validation failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Error context: amount=</span><span class="si">%.2f</span><span class="s2">, processor_state=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">invalid_amount</span><span class="p">,</span> 
                    <span class="p">{</span><span class="s1">&#39;transaction_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">processor</span><span class="o">.</span><span class="n">transaction_log</span><span class="p">)})</span>

        <span class="c1"># Verify error was logged with context</span>
        <span class="k">assert</span> <span class="s2">&quot;Payment validation failed&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
        <span class="k">assert</span> <span class="s2">&quot;Invalid amount&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
        <span class="k">assert</span> <span class="s2">&quot;Error context&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>

        <span class="k">return</span>  <span class="c1"># Expected error</span>

    <span class="n">pytest</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Expected ValueError was not raised&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="combining-logging-with-other-debugging-tools">Combining Logging with Other Debugging Tools</h2>
<h3 id="logging-pdb-best-of-both-worlds">Logging + --pdb: Best of Both Worlds</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_logging_with_pdb.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_with_logging_and_pdb</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test combining logging with pdb debugging.&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="c1"># Add console handler for immediate feedback</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=== Test starting ===&quot;</span><span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing payment&quot;</span><span class="p">)</span>
    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Payment processed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">)</span>

    <span class="c1"># If you run with --pdb, you can inspect logs in the debugger</span>
    <span class="n">transaction</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">get_transaction</span><span class="p">(</span><span class="n">transaction_id</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction details: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction</span><span class="p">)</span>

    <span class="c1"># This assertion will fail, triggering --pdb</span>
    <span class="k">assert</span> <span class="n">transaction</span><span class="p">[</span><span class="s1">&#39;fee&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">2.90</span>  <span class="c1"># Will fail without pytest.approx()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_logging_with_pdb.py<span class="w"> </span>-s<span class="w"> </span>--pdb
</code></pre></div>

<p><strong>What happens</strong>:
1. Logs print to console as test runs
2. When assertion fails, pdb starts
3. You can review the logs that were printed
4. You can inspect variables in the debugger</p>
<h3 id="logging-caplog-verify-logging-behavior">Logging + caplog: Verify Logging Behavior</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_logging_verification.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">payment_processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PaymentProcessor</span><span class="p">,</span> <span class="n">MockAPIClient</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_verify_logging_behavior</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that verifies logging behavior itself.&quot;&quot;&quot;</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">api_client</span> <span class="o">=</span> <span class="n">MockAPIClient</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PaymentProcessor</span><span class="p">(</span><span class="n">api_client</span><span class="p">)</span>

    <span class="c1"># Clear any previous logs</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">transaction_id</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">process_payment</span><span class="p">(</span>
        <span class="n">amount</span><span class="o">=</span><span class="mf">100.00</span><span class="p">,</span>
        <span class="n">card_number</span><span class="o">=</span><span class="s1">&#39;1234567890123456&#39;</span><span class="p">,</span>
        <span class="n">cvv</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Verify specific log messages were generated</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;No logs were generated&quot;</span>

    <span class="c1"># Verify log levels</span>
    <span class="n">debug_logs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">]</span>
    <span class="n">info_logs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s2">&quot;INFO&quot;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">debug_logs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;No DEBUG logs generated&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">info_logs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;No INFO logs generated&quot;</span>

    <span class="c1"># Verify specific messages</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">message</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;Processing payment&quot;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;Payment processed successfully&quot;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">)</span>

    <span class="c1"># Verify log order</span>
    <span class="n">processing_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> 
                         <span class="k">if</span> <span class="s2">&quot;Processing payment&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
    <span class="n">success_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">)</span> 
                      <span class="k">if</span> <span class="s2">&quot;Payment processed successfully&quot;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">processing_idx</span> <span class="o">&lt;</span> <span class="n">success_idx</span><span class="p">,</span> <span class="s2">&quot;Logs out of order&quot;</span>
</code></pre></div>

<h2 id="best-practices-for-logging-in-tests">Best Practices for Logging in Tests</h2>
<h3 id="1-use-appropriate-log-levels">1. Use Appropriate Log Levels</h3>
<p><strong>DEBUG</strong>: Detailed diagnostic information</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing payment: amount=</span><span class="si">%.2f</span><span class="s2">, card=****</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">card</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</code></pre></div>

<p><strong>INFO</strong>: General informational messages</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Payment processed successfully: transaction_id=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">txn_id</span><span class="p">)</span>
</code></pre></div>

<p><strong>WARNING</strong>: Warning messages for unexpected but handled situations</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Transaction not found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">)</span>
</code></pre></div>

<p><strong>ERROR</strong>: Error messages for failures</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;API charge failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-include-context-in-log-messages">2. Include Context in Log Messages</h3>
<p>Bad:</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Payment processed&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Good:</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Payment processed: transaction_id=</span><span class="si">%s</span><span class="s2">, amount=</span><span class="si">%.2f</span><span class="s2">, fee=</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span>
           <span class="n">transaction_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">fee</span><span class="p">)</span>
</code></pre></div>

<h3 id="3-use-structured-logging-for-machine-parsing">3. Use Structured Logging for Machine Parsing</h3>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;payment_processed&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;transaction_id&#39;</span><span class="p">:</span> <span class="n">transaction_id</span><span class="p">,</span>
    <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
    <span class="s1">&#39;fee&#39;</span><span class="p">:</span> <span class="n">fee</span><span class="p">,</span>
    <span class="s1">&#39;net_amount&#39;</span><span class="p">:</span> <span class="n">net_amount</span>
<span class="p">})</span>
</code></pre></div>

<h3 id="4-log-entry-and-exit-of-important-functions">4. Log Entry and Exit of Important Functions</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">card_number</span><span class="p">,</span> <span class="n">cvv</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Entering process_payment: amount=</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># ... processing logic ...</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Exiting process_payment: transaction_id=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">transaction_id</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Exception in process_payment: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>

<h3 id="5-dont-log-sensitive-information">5. Don't Log Sensitive Information</h3>
<p>Bad:</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing payment: card=</span><span class="si">%s</span><span class="s2">, cvv=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">card_number</span><span class="p">,</span> <span class="n">cvv</span><span class="p">)</span>
</code></pre></div>

<p>Good:</p>
<div class="codehilite"><pre><span></span><code><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing payment: card=****</span><span class="si">%s</span><span class="s2">, cvv=***&quot;</span><span class="p">,</span> <span class="n">card_number</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</code></pre></div>

<h3 id="6-use-caplog-for-testing-logging-behavior">6. Use caplog for Testing Logging Behavior</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_error_logging</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
    <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

    <span class="c1"># ... code that should log an error ...</span>

    <span class="k">assert</span> <span class="s2">&quot;Expected error message&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">levelname</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
</code></pre></div>

<h2 id="key-takeaways-logging-and-debugging-information">Key Takeaways: Logging and Debugging Information</h2>
<h3 id="1-logging-provides-permanent-debugging-infrastructure">1. Logging Provides Permanent Debugging Infrastructure</h3>
<p>Unlike breakpoints and --pdb, logs persist and can be reviewed later.</p>
<h3 id="2-use-appropriate-log-levels">2. Use Appropriate Log Levels</h3>
<p>DEBUG for detailed diagnostics, INFO for general flow, WARNING for unexpected situations, ERROR for failures.</p>
<h3 id="3-configure-logging-in-pytestini">3. Configure Logging in pytest.ini</h3>
<p>Set up console and file logging with appropriate levels and formats.</p>
<h3 id="4-use-caplog-for-testing-logging-behavior">4. Use caplog for Testing Logging Behavior</h3>
<p>Verify that your code logs the right messages at the right levels.</p>
<h3 id="5-include-rich-context-in-log-messages">5. Include Rich Context in Log Messages</h3>
<p>Log relevant data like IDs, amounts, and state to make debugging easier.</p>
<h3 id="6-structured-logging-enables-analysis">6. Structured Logging Enables Analysis</h3>
<p>Use JSON or other structured formats for machine-readable logs.</p>
<h3 id="7-combine-logging-with-other-tools">7. Combine Logging with Other Tools</h3>
<p>Use logging alongside --pdb, breakpoints, and verbose modes for comprehensive debugging.</p>
<h3 id="8-never-log-sensitive-information">8. Never Log Sensitive Information</h3>
<p>Mask or redact sensitive data like credit card numbers, passwords, and personal information.</p>
<h2 id="conclusion-building-a-debugging-toolkit">Conclusion: Building a Debugging Toolkit</h2>
<p>Throughout this chapter, we've built a comprehensive debugging toolkit:</p>
<ol>
<li><strong>Reading test output</strong>: Understanding pytest's detailed failure messages</li>
<li><strong>Verbose modes</strong>: Controlling output detail with -v, -vv, and -vvv</li>
<li><strong>The -x flag</strong>: Stopping at the first failure for focused debugging</li>
<li><strong>The --pdb flag</strong>: Interactive debugging at the point of failure</li>
<li><strong>Breakpoints</strong>: Proactive debugging at specific code locations</li>
<li><strong>Logging</strong>: Permanent debugging infrastructure for understanding test behavior</li>
</ol>
<p>Each tool has its place:
- Use <strong>output reading</strong> to understand what failed
- Use <strong>verbose modes</strong> to see more detail
- Use <strong>-x</strong> to focus on one failure at a time
- Use <strong>--pdb</strong> for reactive, interactive debugging
- Use <strong>breakpoints</strong> for proactive, planned debugging
- Use <strong>logging</strong> for permanent, reviewable debugging information</p>
<p>Master these tools, and you'll transform debugging from frustration into systematic investigation.</p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 10:37:11 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>