<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>07 Assertions and Error Handling</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">02 Core Testing Concepts</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-7-assertions-and-error-handling">Chapter 7: Assertions and Error Handling</h1>
<h2 id="beyond-simple-assertions">Beyond Simple Assertions</h2>
<h2 id="beyond-simple-assertions_1">Beyond Simple Assertions</h2>
<p>At the heart of every test is an assertion. It's the line in the sand, the statement that declares, "This must be true." In Chapter 2, you learned the basics of <code>assert</code>, but its power in pytest goes far beyond simple equality checks. Pytest's magic lies in its ability to take a standard Python <code>assert</code> statement and provide incredibly detailed feedback when it fails. This is called "assertion introspection."</p>
<p>Let's explore the versatility of the humble <code>assert</code> statement.</p>
<h3 id="asserting-equality-and-inequality">Asserting Equality and Inequality</h3>
<p>The most common assertion is checking for equality with <code>==</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_assertions.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_inequality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">3</span>
</code></pre></div>

<h3 id="asserting-comparisons">Asserting Comparisons</h3>
<p>You can use any standard comparison operator, and pytest will give you helpful output if it fails.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_assertions.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_greater_than</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">5</span> <span class="o">&gt;</span> <span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_less_than_or_equal</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="mi">4</span>
</code></pre></div>

<h3 id="asserting-membership">Asserting Membership</h3>
<p>You can check if an item is present in a collection (like a list, tuple, dictionary, or string) using the <code>in</code> keyword.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_assertions.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_list_membership</span><span class="p">():</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">]</span>
    <span class="k">assert</span> <span class="s2">&quot;apple&quot;</span> <span class="ow">in</span> <span class="n">items</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_dict_key_membership</span><span class="p">():</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">}</span>
    <span class="k">assert</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">user_data</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_substring</span><span class="p">():</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Hello, Pytest!&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;Pytest&quot;</span> <span class="ow">in</span> <span class="n">message</span>
</code></pre></div>

<h3 id="asserting-identity">Asserting Identity</h3>
<p>Sometimes you need to check if two variables refer to the exact same object in memory, not just that they have the same value. For this, you use <code>is</code>. This is common when dealing with singletons or specific object instances.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_assertions.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_identity</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>  <span class="c1"># b is a reference to the same object as a</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># c has the same value, but is a different object</span>

    <span class="k">assert</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">a</span>
    <span class="k">assert</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span>  <span class="c1"># They are not the same object</span>
    <span class="k">assert</span> <span class="n">c</span> <span class="o">==</span> <span class="n">a</span>      <span class="c1"># But they are equal in value</span>
</code></pre></div>

<h3 id="asserting-truthiness">Asserting Truthiness</h3>
<p>You can assert that a value is "truthy" (evaluates to <code>True</code> in a boolean context) or "falsy" (evaluates to <code>False</code>).</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_assertions.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_truthiness</span><span class="p">():</span>
    <span class="k">assert</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="s2">&quot;hello&quot;</span>
    <span class="k">assert</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_falsiness</span><span class="p">():</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="kc">False</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="s2">&quot;&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">[]</span>
</code></pre></div>

<p>The key takeaway is that you don't need special functions like <code>assertEqual()</code> or <code>assertTrue()</code> from other frameworks. You can use plain, idiomatic Python expressions, and pytest will do the hard work of figuring out what went wrong when an assertion fails. We'll see exactly how it does that next.</p>
<h2 id="assertion-introspection-reading-failure-messages">Assertion Introspection: Reading Failure Messages</h2>
<h2 id="assertion-introspection-reading-failure-messages_1">Assertion Introspection: Reading Failure Messages</h2>
<p>This is where pytest truly shines and one of the main reasons developers love it. When an <code>assert</code> statement fails, pytest doesn't just tell you <code>AssertionError</code>. It "introspects" the expression, meaning it looks inside the objects being compared and gives you a detailed, human-readable report of the difference.</p>
<p>A test failure is not an error; it's data. Learning to read this data is one of the most critical skills in testing.</p>
<h3 id="the-problem-a-failing-test-with-complex-data">The Problem: A Failing Test with Complex Data</h3>
<p>Imagine we have a function that processes user data and we want to test it. Let's create a test that intentionally fails so we can analyze the output.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_user_profile.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_processed_user_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A function that returns a user profile, but with a bug.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test.user@example.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;theme&quot;</span><span class="p">:</span> <span class="s2">&quot;dark&quot;</span><span class="p">,</span>
            <span class="s2">&quot;notifications&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;sms&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># This is the bug, it should be True</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;roles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;editor&quot;</span><span class="p">,</span> <span class="s2">&quot;contributor&quot;</span><span class="p">],</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_user_profile_processing</span><span class="p">():</span>
    <span class="n">expected_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test.user@example.com&quot;</span><span class="p">,</span>
        <span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;theme&quot;</span><span class="p">:</span> <span class="s2">&quot;dark&quot;</span><span class="p">,</span>
            <span class="s2">&quot;notifications&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;sms&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># We expect this to be True</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;roles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;editor&quot;</span><span class="p">,</span> <span class="s2">&quot;contributor&quot;</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">actual_data</span> <span class="o">=</span> <span class="n">get_processed_user_data</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">actual_data</span> <span class="o">==</span> <span class="n">expected_data</span>
</code></pre></div>

<h3 id="reading-the-failure-report">Reading the Failure Report</h3>
<p>Now, let's run this test with <code>pytest -v</code> and carefully dissect the output.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_user_profile.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_user_profile.py::test_user_profile_processing<span class="w"> </span>FAILED<span class="w">          </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
______________________<span class="w"> </span>test_user_profile_processing<span class="w"> </span>______________________

<span class="w">    </span>def<span class="w"> </span>test_user_profile_processing<span class="o">()</span>:
<span class="w">        </span><span class="nv">expected_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="m">101</span>,
<span class="w">            </span><span class="s2">&quot;username&quot;</span>:<span class="w"> </span><span class="s2">&quot;testuser&quot;</span>,
<span class="w">            </span><span class="s2">&quot;email&quot;</span>:<span class="w"> </span><span class="s2">&quot;test.user@example.com&quot;</span>,
<span class="w">            </span><span class="s2">&quot;profile&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="s2">&quot;theme&quot;</span>:<span class="w"> </span><span class="s2">&quot;dark&quot;</span>,
<span class="w">                </span><span class="s2">&quot;notifications&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                    </span><span class="s2">&quot;email&quot;</span>:<span class="w"> </span>True,
<span class="w">                    </span><span class="s2">&quot;sms&quot;</span>:<span class="w"> </span>True,<span class="w">  </span><span class="c1"># We expect this to be True</span>
<span class="w">                </span><span class="o">}</span>,
<span class="w">            </span><span class="o">}</span>,
<span class="w">            </span><span class="s2">&quot;roles&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;editor&quot;</span>,<span class="w"> </span><span class="s2">&quot;contributor&quot;</span><span class="o">]</span>,
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="nv">actual_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>get_processed_user_data<span class="o">()</span>
&gt;<span class="w">       </span>assert<span class="w"> </span><span class="nv">actual_data</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>expected_data
E<span class="w">       </span>assert<span class="w"> </span><span class="o">{</span><span class="s1">&#39;email&#39;</span>:<span class="w"> </span><span class="s1">&#39;te... &#39;</span>testuser<span class="s1">&#39;} == {&#39;</span>email<span class="s1">&#39;: &#39;</span>te...<span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="o">}</span>
E<span class="w">         </span>Differing<span class="w"> </span>items:
E<span class="w">         </span><span class="o">{</span><span class="s1">&#39;profile&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;notifications&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;sms&#39;</span>:<span class="w"> </span>False<span class="o">}}}</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="s1">&#39;profile&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;notifications&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;sms&#39;</span>:<span class="w"> </span>True<span class="o">}}}</span>
E<span class="w">         </span>Full<span class="w"> </span>diff:
E<span class="w">         </span>-<span class="w"> </span><span class="o">{</span><span class="s1">&#39;email&#39;</span>:<span class="w"> </span><span class="s1">&#39;test.user@example.com&#39;</span>,
E<span class="w">         </span>-<span class="w">  </span><span class="s1">&#39;id&#39;</span>:<span class="w"> </span><span class="m">101</span>,
E<span class="w">         </span>-<span class="w">  </span><span class="s1">&#39;profile&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;notifications&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;email&#39;</span>:<span class="w"> </span>True,<span class="w"> </span><span class="s1">&#39;sms&#39;</span>:<span class="w"> </span>True<span class="o">}</span>,<span class="w"> </span><span class="s1">&#39;theme&#39;</span>:<span class="w"> </span><span class="s1">&#39;dark&#39;</span><span class="o">}</span>,
E<span class="w">         </span>?<span class="w">                                                      </span>^^^^
E<span class="w">         </span>+<span class="w"> </span><span class="o">{</span><span class="s1">&#39;email&#39;</span>:<span class="w"> </span><span class="s1">&#39;test.user@example.com&#39;</span>,
E<span class="w">         </span>+<span class="w">  </span><span class="s1">&#39;id&#39;</span>:<span class="w"> </span><span class="m">101</span>,
E<span class="w">         </span>+<span class="w">  </span><span class="s1">&#39;profile&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;notifications&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;email&#39;</span>:<span class="w"> </span>True,<span class="w"> </span><span class="s1">&#39;sms&#39;</span>:<span class="w"> </span>False<span class="o">}</span>,<span class="w"> </span><span class="s1">&#39;theme&#39;</span>:<span class="w"> </span><span class="s1">&#39;dark&#39;</span><span class="o">}</span>,
E<span class="w">         </span>?<span class="w">                                                      </span>^^^^^
E<span class="w">         </span>-<span class="w">  </span><span class="s1">&#39;roles&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;editor&#39;</span>,<span class="w"> </span><span class="s1">&#39;contributor&#39;</span><span class="o">]</span>,
E<span class="w">         </span>-<span class="w">  </span><span class="s1">&#39;username&#39;</span>:<span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="o">}</span>
E<span class="w">         </span>+<span class="w">  </span><span class="s1">&#39;roles&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;editor&#39;</span>,<span class="w"> </span><span class="s1">&#39;contributor&#39;</span><span class="o">]</span>,
E<span class="w">         </span>+<span class="w">  </span><span class="s1">&#39;username&#39;</span>:<span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="o">}</span>

test_user_profile.py:28:<span class="w"> </span><span class="nv">AssertionError</span>
<span class="o">=========================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">===========================</span>
</code></pre></div>

<p>Let's break this down piece by piece:</p>
<ol>
<li><strong><code>&gt; assert actual_data == expected_data</code></strong>: The <code>&gt;</code> points to the exact line where the assertion failed.</li>
<li><strong><code>E assert {'email': ...} == {'email': ...}</code></strong>: The <code>E</code> stands for "Error". Pytest shows you the assertion expression again, often abbreviating large data structures for readability.</li>
<li><strong><code>E   Differing items:</code></strong>: This is the magic. Pytest intelligently finds the <em>smallest possible difference</em> between the two structures. It tells you exactly where the mismatch is, saving you from manually comparing two giant dictionaries.
    <code>{'profile': {'notifications': {'sms': False}}} != {'profile': {'notifications': {'sms': True}}}</code>
    It has drilled down through the nested dictionaries to pinpoint the exact key-value pair that differs.</li>
<li><strong><code>E   Full diff:</code></strong>: For more context, pytest provides a full <code>diff</code> view, similar to what you'd see in version control systems like Git.<ul>
<li>Lines starting with <code>-</code> are from the left side of the comparison (<code>actual_data</code>).</li>
<li>Lines starting with <code>+</code> are from the right side (<code>expected_data</code>).</li>
<li>Lines starting with <code>?</code> highlight the exact characters that differ within a line. Here, <code>^^^^</code> points to <code>True</code> and <code>^^^^^</code> points to <code>False</code>.</li>
</ul>
</li>
</ol>
<p>Without assertion introspection, you would just get <code>AssertionError</code>, and you'd have to manually print both dictionaries and stare at them until you found the difference. Pytest's detailed output turns minutes of frustrating debugging into seconds of clear insight.</p>
<h2 id="custom-assertion-messages">Custom Assertion Messages</h2>
<h2 id="custom-assertion-messages_1">Custom Assertion Messages</h2>
<p>Python's <code>assert</code> statement allows for an optional message that will be displayed if the assertion fails.</p>
<p>The syntax is: <code>assert &lt;expression&gt;, &lt;message&gt;</code></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_custom_message.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_account_balance</span><span class="p">():</span>
    <span class="n">account</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;acc_123&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">50</span><span class="p">}</span>
    <span class="c1"># This assertion will fail</span>
    <span class="k">assert</span> <span class="n">account</span><span class="p">[</span><span class="s2">&quot;balance&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Account </span><span class="si">{</span><span class="n">account</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> has a negative balance!&quot;</span>
</code></pre></div>

<p>When we run this test, the custom message is included in the output.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>test_custom_message.py
<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
_________________________<span class="w"> </span>test_account_balance<span class="w"> </span>_________________________

<span class="w">    </span>def<span class="w"> </span>test_account_balance<span class="o">()</span>:
<span class="w">        </span><span class="nv">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;acc_123&quot;</span>,<span class="w"> </span><span class="s2">&quot;balance&quot;</span>:<span class="w"> </span>-50<span class="o">}</span>
<span class="w">        </span><span class="c1"># This assertion will fail</span>
&gt;<span class="w">       </span>assert<span class="w"> </span>account<span class="o">[</span><span class="s2">&quot;balance&quot;</span><span class="o">]</span><span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>f<span class="s2">&quot;Account {account[&#39;id&#39;]} has a negative balance!&quot;</span>
E<span class="w">       </span>AssertionError:<span class="w"> </span>Account<span class="w"> </span>acc_123<span class="w"> </span>has<span class="w"> </span>a<span class="w"> </span>negative<span class="w"> </span>balance!
E<span class="w">       </span>assert<span class="w"> </span>-50<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">0</span>

test_custom_message.py:6:<span class="w"> </span><span class="nv">AssertionError</span>
<span class="o">=========================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">===========================</span>
</code></pre></div>

<h3 id="to-use-or-not-to-use">To Use or Not to Use?</h3>
<p>While custom messages can be useful, a common pytest philosophy is to <strong>rely on assertion introspection first</strong>. Pytest's automatic diffing is often more informative than a manually written message.</p>
<p><strong>When to use custom messages:</strong></p>
<ol>
<li><strong>When the expression isn't self-explanatory:</strong> If the assertion involves complex logic, a message can clarify the <em>intent</em> of the test.</li>
<li><strong>When testing business rules:</strong> A message can describe the business rule that was violated, which is helpful for non-technical stakeholders.</li>
<li><strong>When looping:</strong> If an assertion is inside a loop, the message can include the loop variable to identify which iteration failed.</li>
</ol>
<p><strong>When to avoid them:</strong></p>
<ol>
<li><strong>When comparing simple values:</strong> <code>assert x == y</code> provides a great failure message on its own. A custom message like <code>assert x == y, "x should be equal to y"</code> is redundant and adds noise.</li>
<li><strong>When comparing data structures:</strong> Pytest's diffing is almost always superior to any message you could write.</li>
</ol>
<p><strong>Guideline:</strong> Write your assertion first. If the failure message from pytest isn't clear enough, then consider adding a custom message to provide more context.</p>
<h2 id="testing-exceptions-with-pytestraises">Testing Exceptions with pytest.raises()</h2>
<h2 id="testing-exceptions-with-pytestraises_1">Testing Exceptions with pytest.raises()</h2>
<p>A crucial part of robust software is handling errors gracefully. This means your code should raise exceptions when it receives invalid input or encounters an error state. Your tests must verify that the correct exceptions are raised under the right circumstances.</p>
<h3 id="the-wrong-way-tryexcept">The Wrong Way: <code>try...except</code></h3>
<p>A beginner might be tempted to write a test like this:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_exceptions_wrong.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">divide</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot divide by zero&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>

<span class="c1"># This is NOT the recommended way to test exceptions in pytest</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_divide_by_zero_wrong</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># The exception was raised, so the test passes.</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If no exception was raised, the test should fail.</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;ValueError was not raised&quot;</span>
</code></pre></div>

<p>This approach has several problems:
-   It's verbose and boilerplate-heavy.
-   It can accidentally catch the wrong exception if the <code>try</code> block is too large.
-   The test will pass if a <code>ValueError</code> is raised for the <em>wrong reason</em> inside the <code>try</code> block.
-   It doesn't provide a clean way to inspect the exception message or attributes.</p>
<h3 id="the-pytest-way-pytestraises">The Pytest Way: <code>pytest.raises</code></h3>
<p>Pytest provides a clean, expressive, and safe way to assert that a block of code raises an exception: the <code>pytest.raises</code> context manager.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_exceptions_right.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">divide</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot divide by zero&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_divide_by_zero</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_divide_by_zero_fails_if_no_exception</span><span class="p">():</span>
    <span class="c1"># This test will fail because no exception is raised</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>

<p>This is much cleaner. The <code>with pytest.raises(ValueError):</code> block tells pytest: "I expect the code inside this block to raise a <code>ValueError</code>. If it does, the test passes. If it raises a different exception or no exception at all, the test fails."</p>
<p>Running the file above produces a clear failure for the second test:</p>
<div class="codehilite"><pre><span></span><code>_________________ test_divide_by_zero_fails_if_no_exception __________________
...
Failed: DID NOT RAISE &lt;class &#39;ValueError&#39;&gt;
</code></pre></div>

<h3 id="inspecting-the-exception">Inspecting the Exception</h3>
<p>Often, you need to check not only that an exception was raised, but also that it has the correct error message. You can capture the exception info using <code>as excinfo</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_exceptions_right.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">divide</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot divide by zero&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_divide_by_zero_with_message_check</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">excinfo</span><span class="p">:</span>
        <span class="n">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># excinfo is an ExceptionInfo object</span>
    <span class="c1"># excinfo.value is the actual exception instance</span>
    <span class="k">assert</span> <span class="s2">&quot;Cannot divide by zero&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">excinfo</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>

<p>The <code>excinfo</code> object is a wrapper around the actual exception. It gives you access to:
-   <code>excinfo.type</code>: The type of the exception (e.g., <code>ValueError</code>).
-   <code>excinfo.value</code>: The exception instance itself.
-   <code>excinfo.traceback</code>: The traceback object.</p>
<h3 id="using-match-for-cleaner-message-checks">Using <code>match</code> for Cleaner Message Checks</h3>
<p>Checking the message with <code>str(excinfo.value)</code> works, but pytest provides an even more convenient way: the <code>match</code> parameter. It asserts that the exception message matches a regular expression.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_exceptions_right.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">divide</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot divide by zero&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_divide_by_zero_with_match</span><span class="p">():</span>
    <span class="c1"># The match parameter accepts a regex pattern.</span>
    <span class="c1"># &#39;zero&#39; will match &quot;Cannot divide by zero&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;divide by zero&quot;</span><span class="p">):</span>
        <span class="n">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Using <code>match</code> is often preferred because it's more concise and directly states the expectation in the <code>pytest.raises</code> call. It makes the test's intent clearer at a glance.</p>
<h2 id="testing-warnings-with-pytestwarns">Testing Warnings with pytest.warns()</h2>
<h2 id="testing-warnings-with-pytestwarns_1">Testing Warnings with pytest.warns()</h2>
<p>Warnings are a way for libraries to inform users about deprecated features, potential bugs, or upcoming changes without raising a full exception. Like exceptions, it's important to test that your code emits the correct warnings when it should.</p>
<p>Pytest provides <code>pytest.warns</code>, which works almost identically to <code>pytest.raises</code>.</p>
<h3 id="a-function-that-emits-a-warning">A Function That Emits a Warning</h3>
<p>Let's create a function that uses Python's built-in <code>warnings</code> module.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_warnings.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">old_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a deprecated function.&quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;old_function() is deprecated, use new_function() instead.&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">new_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is the new function.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
</code></pre></div>

<h3 id="testing-for-a-specific-warning">Testing for a Specific Warning</h3>
<p>We can use <code>pytest.warns</code> as a context manager to assert that code inside the <code>with</code> block triggers a specific type of warning.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_warnings.py</span>
<span class="c1"># ... (previous code) ...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_old_function_emits_warning</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">):</span>
        <span class="n">old_function</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_new_function_does_not_emit_warning</span><span class="p">():</span>
    <span class="c1"># This will fail if any warning is emitted</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">new_function</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Assert that the &#39;record&#39; list is empty</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div>

<p>If the code inside <code>pytest.warns(DeprecationWarning)</code> does not raise that specific warning, the test will fail with a clear message, just like <code>pytest.raises</code>.</p>
<h3 id="inspecting-the-warning-message">Inspecting the Warning Message</h3>
<p>Just like <code>pytest.raises</code>, you can use the <code>match</code> parameter to check the warning's message.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_warnings.py</span>
<span class="c1"># ... (previous code) ...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_old_function_warning_message</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;is deprecated, use new_function()&quot;</span><span class="p">):</span>
        <span class="n">old_function</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<p>You can also capture the warning objects into a list for more detailed inspection. This is useful if a block of code is expected to emit multiple warnings.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_warnings.py</span>
<span class="c1"># ... (previous code) ...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">function_with_multiple_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;First warning&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Second warning&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_multiple_warnings</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">function_with_multiple_warnings</span><span class="p">()</span>

    <span class="c1"># The test only passes if at least one UserWarning was caught.</span>
    <span class="c1"># The record contains only the captured warnings of the specified type.</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="s2">&quot;First warning&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</code></pre></div>

<p>Using <code>pytest.warns</code> ensures that your application's communication about deprecations and potential issues remains correct and reliable as your codebase evolves.</p>
<h2 id="context-managers-for-advanced-assertions">Context Managers for Advanced Assertions</h2>
<h2 id="context-managers-for-advanced-assertions_1">Context Managers for Advanced Assertions</h2>
<p>You've already seen two powerful examples of context managers used for assertions: <code>pytest.raises</code> and <code>pytest.warns</code>. This pattern‚Äîusing a <code>with</code> statement to assert something about the code block inside it‚Äîis incredibly powerful and can be extended for custom, complex assertions.</p>
<p>A context manager is any object in Python that defines <code>__enter__</code> and <code>__exit__</code> methods, allowing it to be used with the <code>with</code> statement. This is perfect for "setup" and "teardown" logic around a piece of code. In testing, we can use the "teardown" part (<code>__exit__</code>) to perform assertions about what happened during the "setup" part (<code>__enter__</code> and the <code>with</code> block).</p>
<h3 id="example-asserting-on-log-messages">Example: Asserting on Log Messages</h3>
<p>Imagine you want to test that a specific log message is emitted by a function. You could redirect <code>stdout</code> or mock the logging framework, but a custom context manager provides a much cleaner, reusable solution.</p>
<p>Let's build an <code>assert_logs</code> context manager.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_advanced_assertions.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>

<span class="c1"># This is our custom context manager</span>
<span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">assert_logs</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A context manager to assert that a logger emits a specific message.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: Capture logs</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>
    <span class="n">log_capture_string</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">log_capture_string</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="c1"># Store original level and set the desired one</span>
    <span class="n">original_level</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">level</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

    <span class="k">yield</span>  <span class="c1"># The code inside the &#39;with&#39; block runs here</span>

    <span class="c1"># Teardown: Perform assertions</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">original_level</span><span class="p">)</span>

    <span class="n">log_contents</span> <span class="o">=</span> <span class="n">log_capture_string</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">expected_message</span> <span class="ow">in</span> <span class="n">log_contents</span>

<span class="c1"># --- Code to be tested ---</span>
<span class="n">app_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;my_app&quot;</span><span class="p">)</span>
<span class="n">app_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Received empty data payload.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing data: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># ... processing logic ...</span>

<span class="c1"># --- The Test ---</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_process_data_logs_warning_for_empty_payload</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">assert_logs</span><span class="p">(</span><span class="n">app_logger</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Received empty data payload.&quot;</span><span class="p">):</span>
        <span class="n">process_data</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_process_data_logs_info</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">assert_logs</span><span class="p">(</span><span class="n">app_logger</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Processing data: {&#39;id&#39;: 1}&quot;</span><span class="p">):</span>
        <span class="n">process_data</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div>

<h3 id="how-it-works">How It Works</h3>
<ol>
<li><strong><code>@contextmanager</code></strong>: This decorator from Python's standard library lets us write a generator-based context manager, which is simpler than writing a full class.</li>
<li><strong>Setup (<code>__enter__</code>)</strong>: Everything before the <code>yield</code> is the setup. We create an in-memory text stream (<code>StringIO</code>), add a handler to our logger to redirect its output to our stream, and set the logging level.</li>
<li><strong><code>yield</code></strong>: This is where control is passed back to the <code>with</code> block in the test. The <code>process_data()</code> function runs at this point.</li>
<li><strong>Teardown (<code>__exit__</code>)</strong>: Everything after the <code>yield</code> is the teardown. We remove our custom handler to stop capturing logs and restore the logger's original level. This cleanup is critical to avoid interfering with other tests.</li>
<li><strong>Assertion</strong>: Finally, we get the captured log content from our stream and assert that our expected message is present.</li>
</ol>
<p>This pattern is extremely powerful. You can create context managers to assert on all kinds of behavior:
-   That a database transaction was committed or rolled back.
-   That a file was created or deleted.
-   That a cache was written to or cleared.
-   That a certain number of API calls were made.</p>
<p>While you won't write custom assertion context managers every day, understanding this pattern helps you recognize the power of <code>pytest.raises</code> and <code>pytest.warns</code> and gives you a tool for creating highly expressive and reusable assertions for complex scenarios.</p>
        </div>
        <div class="footer">
            Generated on 2025-11-22 16:29:18 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>