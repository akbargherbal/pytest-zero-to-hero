<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05 Parameterized Testing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">02 Core Testing Concepts</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-5-parameterized-testing">Chapter 5: Parameterized Testing</h1>
<h2 id="testing-multiple-scenarios-without-repetition">Testing Multiple Scenarios Without Repetition</h2>
<h2 id="the-problem-copy-paste-testing">The Problem: Copy-Paste Testing</h2>
<p>You're building a password validation system. The requirements are clear:</p>
<ul>
<li>Passwords must be at least 8 characters</li>
<li>Passwords must contain at least one uppercase letter</li>
<li>Passwords must contain at least one number</li>
<li>Passwords must contain at least one special character</li>
</ul>
<p>You need to test all these rules. Your first instinct might be to write separate test functions for each scenario.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># password_validator.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate a password against security requirements.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (is_valid, error_message) tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="s2">&quot;!@#$%^&amp;*()_+-=[]</span><span class="si">{}</span><span class="s2">|;:,.&lt;&gt;?&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span>

    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span>
</code></pre></div>

<h3 id="phase-1-the-naive-approach-separate-test-functions">Phase 1: The Naive Approach - Separate Test Functions</h3>
<p>Let's write tests the straightforward way: one test function per scenario.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_password_validator_naive.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">password_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_password</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_too_short</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_no_uppercase</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_no_number</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;Password!&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password must contain at least one number&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_no_special_char</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;Password123&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_valid</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;Password123!&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password is valid&quot;</span>
</code></pre></div>

<p>Let's run these tests to verify they work:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_password_validator_naive.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validator_naive.py::test_password_too_short PASSED
test_password_validator_naive.py::test_password_no_uppercase PASSED
test_password_validator_naive.py::test_password_no_number PASSED
test_password_validator_naive.py::test_password_no_special_char PASSED
test_password_validator_naive.py::test_password_valid PASSED

======================== 5 passed in 0.02s =========================
</code></pre></div>

<p>Great! All tests pass. But look at the code. Notice anything?</p>
<h3 id="the-hidden-cost-of-repetition">The Hidden Cost of Repetition</h3>
<p>Every test function follows the exact same pattern:</p>
<ol>
<li>Call <code>validate_password()</code> with a test input</li>
<li>Assert the validity boolean</li>
<li>Assert the error message</li>
</ol>
<p>The only things that change are:
- The input password
- The expected validity
- The expected message</p>
<p><strong>This is the anchor example we'll refine throughout this chapter.</strong> We have working tests, but they suffer from severe code duplication.</p>
<h3 id="current-limitations">Current Limitations</h3>
<p><strong>What happens when requirements change?</strong></p>
<p>Imagine your product manager says: "Actually, we need to return a structured error object instead of a tuple."</p>
<p>You'd need to modify <strong>every single test function</strong>. Five tests means five places to update. In a real system with dozens of validation rules, this becomes:</p>
<ul>
<li><strong>Maintenance nightmare</strong>: Change the function signature? Update 50 test functions.</li>
<li><strong>Error-prone</strong>: Miss one test during refactoring? Silent bugs.</li>
<li><strong>Verbose</strong>: 100 lines of code to test what's essentially a data table.</li>
<li><strong>Hard to extend</strong>: Adding a new test case means writing an entire new function.</li>
</ul>
<h3 id="what-we-need">What We Need</h3>
<p>We need a way to:
1. Define the test logic <strong>once</strong>
2. Run it against <strong>multiple inputs</strong>
3. Get <strong>separate test results</strong> for each input
4. Keep tests <strong>readable and maintainable</strong></p>
<p>This is exactly what <strong>parameterized testing</strong> solves.</p>
<h2 id="pytestmarkparametrize-basics">@pytest.mark.parametrize Basics</h2>
<h2 id="iteration-1-introducing-parametrization">Iteration 1: Introducing Parametrization</h2>
<p>Let's transform our repetitive tests into a single parameterized test. We'll start with the simplest possible example to understand the mechanism.</p>
<h3 id="the-basic-syntax">The Basic Syntax</h3>
<p>The <code>@pytest.mark.parametrize</code> decorator takes two arguments:</p>
<ol>
<li><strong>Parameter names</strong> (as a string)</li>
<li><strong>Parameter values</strong> (as a list)</li>
</ol>
<p>Here's the minimal transformation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_password_validator_param_v1.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">password_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_password</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s2">&quot;Short1!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password123!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Password!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Password123&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Password123!&quot;</span><span class="p">,</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="c1"># What do we assert here?</span>
</code></pre></div>

<p>Wait. We have a problem. We're passing different passwords, but we need to check different <strong>expected results</strong> for each one. The test above is incomplete‚Äîwe can't write meaningful assertions without knowing what each password should produce.</p>
<h3 id="diagnostic-analysis-the-incomplete-parametrization">Diagnostic Analysis: The Incomplete Parametrization</h3>
<p>Let's try to run this incomplete test to see what happens:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_password_validator_param_v1.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validator_param_v1.py::test_password_validation[Short1!] PASSED
test_password_validator_param_v1.py::test_password_validation[password123!] PASSED
test_password_validator_param_v1.py::test_password_validation[Password!] PASSED
test_password_validator_param_v1.py::test_password_validation[Password123] PASSED
test_password_validator_param_v1.py::test_password_validation[Password123!] PASSED

======================== 5 passed in 0.02s =========================
</code></pre></div>

<p><strong>The tests pass, but they're meaningless.</strong> Without assertions, pytest just executes the function and considers it passed if no exception is raised.</p>
<p>Notice something important in the output: <code>test_password_validation[Short1!]</code>, <code>test_password_validation[password123!]</code>, etc. Pytest automatically:</p>
<ol>
<li><strong>Generated 5 separate test cases</strong> from our single test function</li>
<li><strong>Named each test</strong> by appending the parameter value in brackets</li>
<li><strong>Ran each test independently</strong></li>
</ol>
<p>This is the core mechanism of parametrization. But we need to pass <strong>both</strong> the input and the expected output.</p>
<h3 id="iteration-2-parametrizing-multiple-values">Iteration 2: Parametrizing Multiple Values</h3>
<p>To make our test meaningful, we need to pass tuples containing both the input and expected results:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_password_validator_param_v2.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">password_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_password</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password,expected_valid,expected_message&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password123&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password123!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<p><strong>Key changes</strong>:</p>
<ol>
<li><strong>Parameter names</strong>: <code>"password,expected_valid,expected_message"</code> - comma-separated string</li>
<li><strong>Parameter values</strong>: List of tuples, each containing three values</li>
<li><strong>Test function signature</strong>: Now accepts three parameters matching the names</li>
<li><strong>Assertions</strong>: Compare actual results against expected values</li>
</ol>
<p>Let's run this:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_password_validator_param_v2.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validator_param_v2.py::test_password_validation[Short1!-False-Password must be at least 8 characters] PASSED
test_password_validator_param_v2.py::test_password_validation[password123!-False-Password must contain at least one uppercase letter] PASSED
test_password_validator_param_v2.py::test_password_validation[Password!-False-Password must contain at least one number] PASSED
test_password_validator_param_v2.py::test_password_validation[Password123-False-Password must contain at least one special character] PASSED
test_password_validator_param_v2.py::test_password_validation[Password123!-True-Password is valid] PASSED

======================== 5 passed in 0.02s =========================
</code></pre></div>

<p><strong>Success!</strong> We've transformed 5 separate test functions into a single parameterized test.</p>
<h3 id="understanding-what-just-happened">Understanding What Just Happened</h3>
<p>Pytest performed these steps:</p>
<ol>
<li><strong>Read the decorator</strong>: Found <code>@pytest.mark.parametrize</code> with parameter names and values</li>
<li><strong>Generated test cases</strong>: Created 5 test instances, one per tuple in the list</li>
<li><strong>Unpacked parameters</strong>: For each test, unpacked the tuple into the three named parameters</li>
<li><strong>Executed independently</strong>: Ran each test case as if it were a separate function</li>
<li><strong>Reported separately</strong>: Each test case appears as a distinct line in the output</li>
</ol>
<h3 id="the-mechanics-how-parametrization-works">The Mechanics: How Parametrization Works</h3>
<p>When pytest encounters <code>@pytest.mark.parametrize</code>, it essentially does this transformation internally:</p>
<p><strong>Before (what you write)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;x,y&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_addition</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>

<p><strong>After (what pytest executes)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_addition_case_0</span><span class="p">():</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_addition_case_1</span><span class="p">():</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
    <span class="k">assert</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>

<p>Each parameterized test is a <strong>completely independent test execution</strong>. If one fails, the others still run.</p>
<h3 id="demonstrating-independence-intentional-failure">Demonstrating Independence: Intentional Failure</h3>
<p>Let's prove that test cases are independent by introducing a failing case:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_password_validator_param_v3.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">password_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_password</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password,expected_valid,expected_message&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;WRONG MESSAGE&quot;</span><span class="p">),</span>  <span class="c1"># Intentionally wrong</span>
    <span class="p">(</span><span class="s2">&quot;Password!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password123&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password123!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_password_validator_param_v3.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validator_param_v3.py::test_password_validation[Short1!-False-Password must be at least 8 characters] PASSED
test_password_validator_param_v3.py::test_password_validation[password123!-False-WRONG MESSAGE] FAILED
test_password_validator_param_v3.py::test_password_validation[Password!-False-Password must contain at least one number] PASSED
test_password_validator_param_v3.py::test_password_validation[Password123-False-Password must contain at least one special character] PASSED
test_password_validator_param_v3.py::test_password_validation[Password123!-True-Password is valid] PASSED

================================ FAILURES =================================
____________ test_password_validation[password123!-False-WRONG MESSAGE] ____________

password = &#39;password123!&#39;, expected_valid = False, expected_message = &#39;WRONG MESSAGE&#39;

    @pytest.mark.parametrize(&quot;password,expected_valid,expected_message&quot;, [
        (&quot;Short1!&quot;, False, &quot;Password must be at least 8 characters&quot;),
        (&quot;password123!&quot;, False, &quot;WRONG MESSAGE&quot;),
        (&quot;Password!&quot;, False, &quot;Password must contain at least one number&quot;),
        (&quot;Password123&quot;, False, &quot;Password must contain at least one special character&quot;),
        (&quot;Password123!&quot;, True, &quot;Password is valid&quot;),
    ])
    def test_password_validation(password, expected_valid, expected_message):
        is_valid, message = validate_password(password)
        assert is_valid == expected_valid
&gt;       assert message == expected_message
E       AssertionError: assert &#39;Password must...ppercase letter&#39; == &#39;WRONG MESSAGE&#39;
E         - WRONG MESSAGE
E         + Password must contain at least one uppercase letter

test_password_validator_param_v3.py:13: AssertionError
==================== 1 failed, 4 passed in 0.03s ====================
</code></pre></div>

<h3 id="diagnostic-analysis-reading-the-parametrized-failure">Diagnostic Analysis: Reading the Parametrized Failure</h3>
<p><strong>The summary line</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validation[password123!-False-WRONG MESSAGE] FAILED
</code></pre></div>

<p>This tells us:
- <strong>Which test function</strong>: <code>test_password_validation</code>
- <strong>Which parameter set</strong>: <code>[password123!-False-WRONG MESSAGE]</code> - the second tuple in our list
- <strong>The result</strong>: <code>FAILED</code></p>
<p><strong>The failure details</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;password123!&#39;</span><span class="p">,</span> <span class="n">expected_valid</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">expected_message</span> <span class="o">=</span> <span class="s1">&#39;WRONG MESSAGE&#39;</span>
</code></pre></div>

<p>Pytest shows us the <strong>exact parameter values</strong> that caused this specific test case to fail. This is crucial for debugging‚Äîyou immediately know which scenario broke.</p>
<p><strong>The assertion introspection</strong>:</p>
<div class="codehilite"><pre><span></span><code>E       AssertionError: assert &#39;Password must...ppercase letter&#39; == &#39;WRONG MESSAGE&#39;
E         - WRONG MESSAGE
E         + Password must contain at least one uppercase letter
</code></pre></div>

<p>Pytest shows:
- What we expected: <code>'WRONG MESSAGE'</code>
- What we got: <code>'Password must contain at least one uppercase letter'</code></p>
<p><strong>Key insight</strong>: The other 4 test cases continued running and passed. One failing parameter set doesn't stop the entire test function.</p>
<h3 id="comparison-before-and-after">Comparison: Before and After</h3>
<p><strong>Before parametrization</strong> (5 functions, 25 lines):</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_password_too_short</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_no_uppercase</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span>

<span class="c1"># ... 3 more functions</span>
</code></pre></div>

<p><strong>After parametrization</strong> (1 function, 13 lines):</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password,expected_valid,expected_message&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password123&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password123!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<p><strong>Benefits achieved</strong>:
- <strong>48% less code</strong>: 13 lines vs 25 lines
- <strong>Single source of truth</strong>: Test logic defined once
- <strong>Easy to extend</strong>: Add new test case = add one line to the list
- <strong>Maintainable</strong>: Change assertion logic in one place
- <strong>Clear data structure</strong>: Test cases are now a readable table</p>
<h3 id="current-limitation">Current Limitation</h3>
<p>Our test names are getting unwieldy:</p>
<div class="codehilite"><pre><span></span><code>test_password_validation[Short1!-False-Password must be at least 8 characters]
</code></pre></div>

<p>This works, but it's verbose and hard to scan. In section 5.6, we'll learn how to generate custom test IDs for better readability.</p>
<p>But first, we need to understand how to parametrize multiple parameters independently, which opens up powerful testing patterns.</p>
<h2 id="multiple-parameters">Multiple Parameters</h2>
<h2 id="the-power-of-cartesian-products">The Power of Cartesian Products</h2>
<p>So far, we've parametrized a single test function with multiple test cases. But what if you need to test <strong>combinations</strong> of different parameters?</p>
<h3 id="phase-1-the-new-scenario-email-validation">Phase 1: The New Scenario - Email Validation</h3>
<p>Let's extend our authentication system with email validation. Emails must:</p>
<ol>
<li>Contain exactly one <code>@</code> symbol</li>
<li>Have a domain with at least one dot</li>
<li>Not start or end with special characters</li>
</ol>
<p>We want to test this against multiple email formats <strong>and</strong> multiple validation modes (strict vs. lenient).</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># email_validator.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_email</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate an email address.</span>

<span class="sd">    Args:</span>
<span class="sd">        email: Email address to validate</span>
<span class="sd">        strict: If True, apply stricter validation rules</span>

<span class="sd">    Returns:</span>
<span class="sd">        (is_valid, error_message) tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Email must contain exactly one @ symbol&quot;</span>

    <span class="n">local</span><span class="p">,</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">local</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">domain</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Email must have both local and domain parts&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">domain</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Domain must contain at least one dot&quot;</span>

    <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
        <span class="c1"># Strict mode: no special characters at start/end</span>
        <span class="k">if</span> <span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;.-_&quot;</span> <span class="ow">or</span> <span class="n">local</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;.-_&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Local part cannot start or end with special characters&quot;</span>

    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Email is valid&quot;</span>
</code></pre></div>

<h3 id="naive-approach-nested-loops-in-your-head">Naive Approach: Nested Loops in Your Head</h3>
<p>You might think: "I need to test 4 email formats √ó 2 modes = 8 test cases." Your first instinct might be to write them all out:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_email_validator_naive.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">email_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_email</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_email_strict</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">validate_email</span><span class="p">(</span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_email_lenient</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">validate_email</span><span class="p">(</span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_email_with_leading_dot_strict</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">validate_email</span><span class="p">(</span><span class="s2">&quot;.user@example.com&quot;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_email_with_leading_dot_lenient</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">validate_email</span><span class="p">(</span><span class="s2">&quot;.user@example.com&quot;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span>

<span class="c1"># ... 4 more test functions for other email formats</span>
</code></pre></div>

<p>This is tedious and error-prone. We're manually creating the Cartesian product of (email formats) √ó (validation modes).</p>
<h3 id="iteration-1-stacking-parametrize-decorators">Iteration 1: Stacking Parametrize Decorators</h3>
<p>Pytest allows you to <strong>stack multiple <code>@pytest.mark.parametrize</code> decorators</strong>. When you do this, pytest automatically generates the Cartesian product of all parameter combinations.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_email_validator_param_v1.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">email_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_email</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;strict&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;email,should_pass&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;.user@example.com&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user.@example.com&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user@example&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_email_validation</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">should_pass</span><span class="p">,</span> <span class="n">strict</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_email</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">should_pass</span> <span class="ow">and</span> <span class="n">strict</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">is_valid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2"> to be valid in strict mode&quot;</span>
    <span class="k">elif</span> <span class="n">should_pass</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">strict</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">is_valid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2"> to be valid in lenient mode&quot;</span>
    <span class="c1"># ... more conditional logic</span>
</code></pre></div>

<p>Wait. This is getting complicated. We have conditional logic in our test, which is a code smell. Let's see what happens when we run this:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_email_validator_param_v1.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_email_validator_param_v1.py::test_email_validation[user@example.com-True-True] PASSED
test_email_validator_param_v1.py::test_email_validation[user@example.com-True-False] PASSED
test_email_validator_param_v1.py::test_email_validation[.user@example.com-False-True] PASSED
test_email_validator_param_v1.py::test_email_validation[.user@example.com-False-False] FAILED
test_email_validator_param_v1.py::test_email_validation[user.@example.com-False-True] PASSED
test_email_validator_param_v1.py::test_email_validation[user.@example.com-False-False] FAILED
test_email_validator_param_v1.py::test_email_validation[user@example-False-True] PASSED
test_email_validator_param_v1.py::test_email_validation[user@example-False-False] PASSED

================================ FAILURES =================================
</code></pre></div>

<h3 id="diagnostic-analysis-the-cartesian-product-problem">Diagnostic Analysis: The Cartesian Product Problem</h3>
<p><strong>What happened</strong>: Pytest generated <strong>8 test cases</strong> (4 emails √ó 2 modes), but our test logic is wrong. The problem is that <code>should_pass</code> doesn't account for the <code>strict</code> parameter.</p>
<p>For example:
- <code>.user@example.com</code> should <strong>fail</strong> in strict mode (leading dot)
- <code>.user@example.com</code> should <strong>pass</strong> in lenient mode (lenient allows it)</p>
<p>But we marked it as <code>should_pass=False</code> unconditionally, so the lenient mode test fails.</p>
<p><strong>Root cause</strong>: We're trying to use a single boolean (<code>should_pass</code>) to represent behavior that depends on <strong>two</strong> variables (email format <strong>and</strong> validation mode).</p>
<p><strong>What we need</strong>: A way to specify expected results for each <strong>combination</strong> of parameters, not just for each email in isolation.</p>
<h3 id="iteration-2-explicit-combination-parametrization">Iteration 2: Explicit Combination Parametrization</h3>
<p>Instead of stacking decorators, let's explicitly define the combinations we want to test:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_email_validator_param_v2.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">email_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_email</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;email,strict,expected_valid,expected_message&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="c1"># Valid emails pass in both modes</span>
    <span class="p">(</span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Email is valid&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Email is valid&quot;</span><span class="p">),</span>

    <span class="c1"># Leading dot: fails strict, passes lenient</span>
    <span class="p">(</span><span class="s2">&quot;.user@example.com&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Local part cannot start or end with special characters&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;.user@example.com&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Email is valid&quot;</span><span class="p">),</span>

    <span class="c1"># Trailing dot: fails strict, passes lenient</span>
    <span class="p">(</span><span class="s2">&quot;user.@example.com&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Local part cannot start or end with special characters&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user.@example.com&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Email is valid&quot;</span><span class="p">),</span>

    <span class="c1"># Missing domain dot: fails both modes</span>
    <span class="p">(</span><span class="s2">&quot;user@example&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Domain must contain at least one dot&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;user@example&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Domain must contain at least one dot&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_email_validation</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">strict</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_email</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_email_validator_param_v2.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_email_validator_param_v2.py::test_email_validation[user@example.com-True-True-Email is valid] PASSED
test_email_validator_param_v2.py::test_email_validation[user@example.com-False-True-Email is valid] PASSED
test_email_validator_param_v2.py::test_email_validation[.user@example.com-True-False-Local part cannot start or end with special characters] PASSED
test_email_validator_param_v2.py::test_email_validation[.user@example.com-False-True-Email is valid] PASSED
test_email_validator_param_v2.py::test_email_validation[user.@example.com-True-False-Local part cannot start or end with special characters] PASSED
test_email_validator_param_v2.py::test_email_validation[user.@example.com-False-True-Email is valid] PASSED
test_email_validator_param_v2.py::test_email_validation[user@example-True-False-Domain must contain at least one dot] PASSED
test_email_validator_param_v2.py::test_email_validation[user@example-False-False-Domain must contain at least one dot] PASSED

======================== 8 passed in 0.03s =========================
</code></pre></div>

<p><strong>Success!</strong> All 8 test cases pass. But notice we had to manually write out all 8 combinations.</p>
<h3 id="when-to-use-stacked-decorators-vs-explicit-combinations">When to Use Stacked Decorators vs. Explicit Combinations</h3>
<p><strong>Use stacked decorators when</strong>:
- The parameters are <strong>independent</strong>
- You want to test <strong>all combinations</strong>
- The expected result is the <strong>same</strong> for all combinations</p>
<p><strong>Example</strong>: Testing a function with different input types and different operations:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;operation&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;subtract&quot;</span><span class="p">,</span> <span class="s2">&quot;multiply&quot;</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;input_type&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_calculator</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">input_type</span><span class="p">):</span>
    <span class="c1"># Test that calculator works with all combinations</span>
    <span class="c1"># of operations and input types</span>
    <span class="k">pass</span>
</code></pre></div>

<p>This generates 3 √ó 3 = 9 test cases automatically.</p>
<p><strong>Use explicit combinations when</strong>:
- The expected result <strong>depends on the combination</strong>
- Not all combinations are valid or meaningful
- You need fine-grained control over test cases</p>
<p><strong>Example</strong>: Our email validation where strict/lenient mode changes the expected result.</p>
<h3 id="iteration-3-hybrid-approach-stacking-with-conditional-logic">Iteration 3: Hybrid Approach - Stacking with Conditional Logic</h3>
<p>Sometimes you want the convenience of stacking but need some conditional behavior. Here's a pattern that works:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_email_validator_param_v3.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">email_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_email</span>

<span class="c1"># Define test cases with their strict-mode behavior</span>
<span class="n">EMAIL_TEST_CASES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Email is valid&quot;</span><span class="p">),</span>  <span class="c1"># Valid in both modes</span>
    <span class="p">(</span><span class="s2">&quot;.user@example.com&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Local part cannot start or end with special characters&quot;</span><span class="p">),</span>  <span class="c1"># Strict-only failure</span>
    <span class="p">(</span><span class="s2">&quot;user.@example.com&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Local part cannot start or end with special characters&quot;</span><span class="p">),</span>  <span class="c1"># Strict-only failure</span>
    <span class="p">(</span><span class="s2">&quot;user@example&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Domain must contain at least one dot&quot;</span><span class="p">),</span>  <span class="c1"># Fails in both modes</span>
<span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;strict&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;email,strict_fails,strict_message&quot;</span><span class="p">,</span> <span class="n">EMAIL_TEST_CASES</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_email_validation</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">strict_fails</span><span class="p">,</span> <span class="n">strict_message</span><span class="p">,</span> <span class="n">strict</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_email</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
        <span class="c1"># In strict mode, use the provided expectations</span>
        <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="p">(</span><span class="ow">not</span> <span class="n">strict_fails</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">strict_fails</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">strict_message</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># In lenient mode, only domain-level failures matter</span>
        <span class="k">if</span> <span class="s2">&quot;Domain&quot;</span> <span class="ow">in</span> <span class="n">strict_message</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
            <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">strict_message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">is_valid</span>
            <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Email is valid&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_email_validator_param_v3.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_email_validator_param_v3.py::test_email_validation[True-user@example.com-True-Email is valid] PASSED
test_email_validator_param_v3.py::test_email_validation[True-.user@example.com-False-Local part cannot start or end with special characters] PASSED
test_email_validator_param_v3.py::test_email_validation[True-user.@example.com-False-Local part cannot start or end with special characters] PASSED
test_email_validator_param_v3.py::test_email_validation[True-user@example-False-Domain must contain at least one dot] PASSED
test_email_validator_param_v3.py::test_email_validation[False-user@example.com-True-Email is valid] PASSED
test_email_validator_param_v3.py::test_email_validation[False-.user@example.com-False-Local part cannot start or end with special characters] PASSED
test_email_validator_param_v3.py::test_email_validation[False-user.@example.com-False-Local part cannot start or end with special characters] PASSED
test_email_validator_param_v3.py::test_email_validation[False-user@example-False-Domain must contain at least one dot] PASSED

======================== 8 passed in 0.03s =========================
</code></pre></div>

<p>This approach:
- ‚úÖ Generates all combinations automatically (4 emails √ó 2 modes = 8 tests)
- ‚úÖ Defines email test cases once
- ‚ö†Ô∏è Contains conditional logic in the test (acceptable when the logic is simple and clear)</p>
<h3 id="when-to-apply-multiple-parameter-approaches">When to Apply Multiple Parameter Approaches</h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Approach</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Parameters are independent, same expected result</td>
<td>Stacked decorators</td>
<td>Automatic Cartesian product</td>
</tr>
<tr>
<td>Expected result depends on combination</td>
<td>Explicit combinations</td>
<td>Full control over expectations</td>
</tr>
<tr>
<td>Some conditional logic, but mostly independent</td>
<td>Hybrid (stacked + conditionals)</td>
<td>Balance between DRY and clarity</td>
</tr>
<tr>
<td>Many parameters, few meaningful combinations</td>
<td>Explicit combinations</td>
<td>Avoid testing invalid combinations</td>
</tr>
</tbody>
</table>
<h3 id="current-limitation_1">Current Limitation</h3>
<p>Our test names are still auto-generated and verbose:</p>
<div class="codehilite"><pre><span></span><code><span class="n">test_email_validation</span><span class="o">[</span><span class="n">True-user@example.com-True-Email is valid</span><span class="o">]</span>
</code></pre></div>

<p>This is functional but not ideal for quickly scanning test results. We'll address this in section 5.6 with custom test IDs.</p>
<p>But first, we need to understand how parametrization interacts with fixtures‚Äîa powerful combination that enables sophisticated test setups.</p>
<h2 id="combining-parametrization-with-fixtures">Combining Parametrization with Fixtures</h2>
<h2 id="when-test-data-needs-setup">When Test Data Needs Setup</h2>
<p>So far, our parametrized tests have used simple values: strings, booleans, integers. But what if your test data requires <strong>setup and teardown</strong>? What if you need to test against database connections, file handles, or API clients?</p>
<p>This is where parametrization meets fixtures.</p>
<h3 id="phase-1-the-new-scenario-testing-database-queries">Phase 1: The New Scenario - Testing Database Queries</h3>
<p>Let's build a user repository that queries a database. We want to test it against multiple database backends: SQLite, PostgreSQL, and MySQL.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_repository.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UserRepository</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Repository for user data operations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_connection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db_connection</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a user and return their ID.&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO users (username, email) VALUES (?, ?)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a user by ID.&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id, username, email FROM users WHERE id = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,))</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">count_users</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Count total users.&quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) FROM users&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

<h3 id="naive-approach-separate-test-functions-per-database">Naive Approach: Separate Test Functions Per Database</h3>
<p>You might write separate test functions for each database:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_user_repository_naive.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRepository</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_create_user_sqlite</span><span class="p">():</span>
    <span class="c1"># Setup SQLite</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, email TEXT)&quot;</span><span class="p">)</span>

    <span class="n">repo</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">user_id</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">repo</span><span class="o">.</span><span class="n">count_users</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_create_user_postgres</span><span class="p">():</span>
    <span class="c1"># Setup PostgreSQL</span>
    <span class="c1"># ... connection code ...</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_create_user_mysql</span><span class="p">():</span>
    <span class="c1"># Setup MySQL</span>
    <span class="c1"># ... connection code ...</span>
    <span class="k">pass</span>
</code></pre></div>

<p>This is repetitive. The test logic is identical‚Äîonly the database connection changes. We need to parametrize the <strong>database connection</strong>, but connections require setup and teardown.</p>
<h3 id="iteration-1-fixture-without-parametrization">Iteration 1: Fixture Without Parametrization</h3>
<p>First, let's extract the database setup into a fixture:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_user_repository_fixture_v1.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRepository</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">db_connection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide an in-memory SQLite database.&quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, email TEXT)&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">conn</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_create_user</span><span class="p">(</span><span class="n">db_connection</span><span class="p">):</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(</span><span class="n">db_connection</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">user_id</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">repo</span><span class="o">.</span><span class="n">count_users</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_get_user</span><span class="p">(</span><span class="n">db_connection</span><span class="p">):</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(</span><span class="n">db_connection</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bob&quot;</span>
    <span class="k">assert</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bob@example.com&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_user_repository_fixture_v1.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_user_repository_fixture_v1.py::test_create_user PASSED
test_user_repository_fixture_v1.py::test_get_user PASSED

======================== 2 passed in 0.02s =========================
</code></pre></div>

<p>Good! But we're only testing SQLite. How do we test against multiple databases?</p>
<h3 id="iteration-2-parametrizing-the-fixture">Iteration 2: Parametrizing the Fixture</h3>
<p>Pytest allows you to <strong>parametrize fixtures</strong> using the <code>params</code> argument to <code>@pytest.fixture</code>. This is the key to testing against multiple setups.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_user_repository_fixture_v2.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRepository</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sqlite&quot;</span><span class="p">,</span> <span class="s2">&quot;postgres&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql&quot;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">db_connection</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide database connections for multiple backends.&quot;&quot;&quot;</span>
    <span class="n">db_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>

    <span class="k">if</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, email TEXT)&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">conn</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s2">&quot;postgres&quot;</span><span class="p">:</span>
        <span class="c1"># For demonstration, we&#39;ll simulate PostgreSQL</span>
        <span class="c1"># In real code, you&#39;d use psycopg2</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>  <span class="c1"># Simulating</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, email TEXT)&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">conn</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s2">&quot;mysql&quot;</span><span class="p">:</span>
        <span class="c1"># For demonstration, we&#39;ll simulate MySQL</span>
        <span class="c1"># In real code, you&#39;d use mysql-connector-python</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>  <span class="c1"># Simulating</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, email TEXT)&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">conn</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_create_user</span><span class="p">(</span><span class="n">db_connection</span><span class="p">):</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(</span><span class="n">db_connection</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">user_id</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">repo</span><span class="o">.</span><span class="n">count_users</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_get_user</span><span class="p">(</span><span class="n">db_connection</span><span class="p">):</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(</span><span class="n">db_connection</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bob&quot;</span>
    <span class="k">assert</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bob@example.com&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_user_repository_fixture_v2.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_user_repository_fixture_v2.py::test_create_user[sqlite] PASSED
test_user_repository_fixture_v2.py::test_create_user[postgres] PASSED
test_user_repository_fixture_v2.py::test_create_user[mysql] PASSED
test_user_repository_fixture_v2.py::test_get_user[sqlite] PASSED
test_user_repository_fixture_v2.py::test_get_user[postgres] PASSED
test_user_repository_fixture_v2.py::test_get_user[mysql] PASSED

======================== 6 passed in 0.03s =========================
</code></pre></div>

<h3 id="understanding-what-just-happened_1">Understanding What Just Happened</h3>
<p><strong>The mechanics</strong>:</p>
<ol>
<li><strong><code>params=["sqlite", "postgres", "mysql"]</code></strong>: Tells pytest to run the fixture three times, once per parameter</li>
<li><strong><code>request.param</code></strong>: Inside the fixture, this gives you the current parameter value</li>
<li><strong>Test multiplication</strong>: Each test function that uses <code>db_connection</code> runs <strong>three times</strong> (once per database)</li>
</ol>
<p>We wrote <strong>2 test functions</strong> but got <strong>6 test executions</strong> (2 tests √ó 3 databases).</p>
<h3 id="the-power-of-fixture-parametrization">The Power of Fixture Parametrization</h3>
<p>This pattern is incredibly powerful because:</p>
<ol>
<li><strong>Test logic stays DRY</strong>: Write the test once, run it against multiple setups</li>
<li><strong>Setup is encapsulated</strong>: Database connection logic lives in the fixture</li>
<li><strong>Automatic cleanup</strong>: The <code>yield</code> pattern ensures proper teardown</li>
<li><strong>Scales effortlessly</strong>: Add a new database? Add one line to <code>params</code></li>
</ol>
<h3 id="combining-test-parametrization-with-fixture-parametrization">Combining Test Parametrization with Fixture Parametrization</h3>
<p>Now let's combine both techniques. We'll parametrize the test <strong>and</strong> the fixture:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_user_repository_combined.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">user_repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserRepository</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sqlite&quot;</span><span class="p">,</span> <span class="s2">&quot;postgres&quot;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">db_connection</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide database connections for multiple backends.&quot;&quot;&quot;</span>
    <span class="n">db_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>

    <span class="k">if</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, email TEXT)&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">conn</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s2">&quot;postgres&quot;</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>  <span class="c1"># Simulating</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, email TEXT)&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">conn</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;username,email&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;alice@example.com&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;charlie&quot;</span><span class="p">,</span> <span class="s2">&quot;charlie@example.com&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_create_user</span><span class="p">(</span><span class="n">db_connection</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(</span><span class="n">db_connection</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">user_id</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">username</span>
    <span class="k">assert</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">email</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_user_repository_combined.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_user_repository_combined.py::test_create_user[sqlite-alice-alice@example.com] PASSED
test_user_repository_combined.py::test_create_user[sqlite-bob-bob@example.com] PASSED
test_user_repository_combined.py::test_create_user[sqlite-charlie-charlie@example.com] PASSED
test_user_repository_combined.py::test_create_user[postgres-alice-alice@example.com] PASSED
test_user_repository_combined.py::test_create_user[postgres-bob-bob@example.com] PASSED
test_user_repository_combined.py::test_create_user[postgres-charlie-charlie@example.com] PASSED

======================== 6 passed in 0.03s =========================
</code></pre></div>

<p><strong>The multiplication</strong>:
- 2 database backends (fixture params)
- √ó 3 user test cases (test params)
- = <strong>6 total test executions</strong></p>
<p>We wrote <strong>1 test function</strong> and got <strong>6 comprehensive test cases</strong> covering multiple databases and multiple user scenarios.</p>
<h3 id="demonstrating-failure-isolation">Demonstrating Failure Isolation</h3>
<p>Let's introduce a bug that only affects one database backend:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># user_repository_buggy.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UserRepository</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_connection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db_connection</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="c1"># Bug: PostgreSQL uses different placeholder syntax</span>
        <span class="c1"># This will fail for postgres but work for sqlite</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO users (username, email) VALUES (?, ?)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
</code></pre></div>

<p>If we had a real PostgreSQL connection (which uses <code>%s</code> placeholders instead of <code>?</code>), we'd see:</p>
<div class="codehilite"><pre><span></span><code>test_user_repository_combined.py::test_create_user[sqlite-alice-alice@example.com] PASSED
test_user_repository_combined.py::test_create_user[sqlite-bob-bob@example.com] PASSED
test_user_repository_combined.py::test_create_user[sqlite-charlie-charlie@example.com] PASSED
test_user_repository_combined.py::test_create_user[postgres-alice-alice@example.com] FAILED
test_user_repository_combined.py::test_create_user[postgres-bob-bob@example.com] FAILED
test_user_repository_combined.py::test_create_user[postgres-charlie-charlie@example.com] FAILED

================================ FAILURES =================================
____________ test_create_user[postgres-alice-alice@example.com] ____________
...
ProgrammingError: syntax error at or near &quot;?&quot;
</code></pre></div>

<p><strong>Key insight</strong>: The failure is <strong>isolated to the postgres parameter</strong>. All SQLite tests pass. This immediately tells you the bug is database-specific, not a logic error in your test.</p>
<h3 id="when-to-apply-this-pattern">When to Apply This Pattern</h3>
<p><strong>Use fixture parametrization when</strong>:
- You need to test against multiple <strong>environments</strong> (databases, APIs, file systems)
- Setup/teardown is <strong>complex</strong> and shouldn't be in the test
- You want to ensure <strong>cross-platform compatibility</strong></p>
<p><strong>Use combined parametrization when</strong>:
- You need to test multiple <strong>scenarios</strong> across multiple <strong>environments</strong>
- You want <strong>comprehensive coverage</strong> with minimal code
- The test logic is <strong>identical</strong> across all combinations</p>
<p><strong>Avoid when</strong>:
- Different environments require <strong>different test logic</strong> (use separate test functions)
- The number of combinations is <strong>excessive</strong> (2 fixtures √ó 10 params each = 20 tests might be too many)
- Setup is <strong>trivial</strong> (just use test parametrization)</p>
<h3 id="current-limitation_2">Current Limitation</h3>
<p>Our test IDs are getting very long:</p>
<div class="codehilite"><pre><span></span><code><span class="n">test_create_user</span><span class="o">[</span><span class="n">postgres-alice-alice@example.com</span><span class="o">]</span>
</code></pre></div>

<p>When you have multiple parameters, the auto-generated IDs become unwieldy. We need a way to create <strong>custom, readable test IDs</strong>.</p>
<p>But first, there's one more advanced parametrization technique to cover: <strong>indirect parametrization</strong>, which gives you even more control over how parameters flow into fixtures.</p>
<h2 id="indirect-parametrization">Indirect Parametrization</h2>
<h2 id="when-parameters-need-transformation">When Parameters Need Transformation</h2>
<p>So far, we've seen two parametrization patterns:</p>
<ol>
<li><strong>Direct parametrization</strong>: Parameters go straight to the test function</li>
<li><strong>Fixture parametrization</strong>: Parameters are defined in the fixture itself</li>
</ol>
<p>But what if you need a <strong>hybrid</strong>? What if you want to:
- Define parameter values in the test (for visibility)
- But have the fixture <strong>transform</strong> those values before use</p>
<p>This is <strong>indirect parametrization</strong>.</p>
<h3 id="phase-1-the-new-scenario-testing-with-different-file-formats">Phase 1: The New Scenario - Testing with Different File Formats</h3>
<p>Let's build a data loader that reads configuration from files. We want to test it with JSON, YAML, and TOML formats.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># config_loader.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tomli</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ConfigLoader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load configuration from various file formats.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load config based on file extension.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.yaml&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.yml&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.toml&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tomli</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a configuration value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</code></pre></div>

<h3 id="naive-approach-fixture-creates-all-files">Naive Approach: Fixture Creates All Files</h3>
<p>You might create a fixture that generates all file formats:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_config_loader_naive.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tomli_w</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigLoader</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_files</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create config files in all formats.&quot;&quot;&quot;</span>
    <span class="n">config_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;TestApp&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="c1"># Create JSON file</span>
    <span class="n">json_file</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.json&quot;</span>
    <span class="n">json_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>

    <span class="c1"># Create YAML file</span>
    <span class="n">yaml_file</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.yaml&quot;</span>
    <span class="n">yaml_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>

    <span class="c1"># Create TOML file</span>
    <span class="n">toml_file</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.toml&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toml_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">tomli_w</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="n">json_file</span><span class="p">,</span>
        <span class="s2">&quot;yaml&quot;</span><span class="p">:</span> <span class="n">yaml_file</span><span class="p">,</span>
        <span class="s2">&quot;toml&quot;</span><span class="p">:</span> <span class="n">toml_file</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_load_json</span><span class="p">(</span><span class="n">config_files</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">config_files</span><span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">]))</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TestApp&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_load_yaml</span><span class="p">(</span><span class="n">config_files</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">config_files</span><span class="p">[</span><span class="s2">&quot;yaml&quot;</span><span class="p">]))</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TestApp&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_load_toml</span><span class="p">(</span><span class="n">config_files</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">config_files</span><span class="p">[</span><span class="s2">&quot;toml&quot;</span><span class="p">]))</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TestApp&quot;</span>
</code></pre></div>

<p><strong>Problems</strong>:
1. The fixture creates <strong>all three files</strong> even if a test only needs one
2. We have <strong>three separate test functions</strong> with identical logic
3. Adding a new format requires modifying the fixture <strong>and</strong> adding a new test function</p>
<h3 id="iteration-1-fixture-parametrization-review">Iteration 1: Fixture Parametrization (Review)</h3>
<p>We could use fixture parametrization:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_config_loader_fixture_param.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tomli_w</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigLoader</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;toml&quot;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_file</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a config file in the specified format.&quot;&quot;&quot;</span>
    <span class="n">file_format</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
    <span class="n">config_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;TestApp&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.json&quot;</span>
        <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;yaml&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.yaml&quot;</span>
        <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;toml&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.toml&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">tomli_w</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_load_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TestApp&quot;</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1.0&quot;</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_config_loader_fixture_param.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_config_loader_fixture_param.py::test_load_config[json] PASSED
test_config_loader_fixture_param.py::test_load_config[yaml] PASSED
test_config_loader_fixture_param.py::test_load_config[toml] PASSED

======================== 3 passed in 0.03s =========================
</code></pre></div>

<p>This works! But there's a limitation: <strong>the parameter values are hidden inside the fixture</strong>. When you look at the test function, you can't see what formats are being tested without reading the fixture code.</p>
<h3 id="iteration-2-indirect-parametrization-making-parameters-visible">Iteration 2: Indirect Parametrization - Making Parameters Visible</h3>
<p><strong>Indirect parametrization</strong> lets you define parameters at the test level but have the fixture process them. This gives you the best of both worlds:</p>
<ol>
<li><strong>Visibility</strong>: Parameters are visible in the test decorator</li>
<li><strong>Transformation</strong>: The fixture can transform raw parameters into complex objects</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_config_loader_indirect.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tomli_w</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigLoader</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_file</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a config file in the specified format.</span>

<span class="sd">    Expects request.param to be the file format string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_format</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
    <span class="n">config_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;TestApp&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.json&quot;</span>
        <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;yaml&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.yaml&quot;</span>
        <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;toml&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.toml&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">tomli_w</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported format: </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;config_file&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;toml&quot;</span><span class="p">],</span> <span class="n">indirect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_load_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TestApp&quot;</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1.0&quot;</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div>

<p><strong>Key differences</strong>:</p>
<ol>
<li><strong><code>@pytest.fixture</code></strong> (no <code>params</code>): The fixture doesn't define its own parameters</li>
<li><strong><code>@pytest.mark.parametrize("config_file", [...], indirect=True)</code></strong>: </li>
<li>The test defines the parameter values</li>
<li><code>indirect=True</code> tells pytest to pass these values to the fixture via <code>request.param</code></li>
<li><strong>Fixture receives <code>request.param</code></strong>: The fixture gets the parameter value and transforms it</li>
</ol>
<p>Let's run it:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_config_loader_indirect.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_config_loader_indirect.py::test_load_config[json] PASSED
test_config_loader_indirect.py::test_load_config[yaml] PASSED
test_config_loader_indirect.py::test_load_config[toml] PASSED

======================== 3 passed in 0.03s =========================
</code></pre></div>

<h3 id="understanding-the-flow">Understanding the Flow</h3>
<p><strong>Without <code>indirect=True</code> (direct parametrization)</strong>:</p>
<div class="codehilite"><pre><span></span><code>Parameter value ‚Üí Test function directly
</code></pre></div>

<p><strong>With <code>indirect=True</code> (indirect parametrization)</strong>:</p>
<div class="codehilite"><pre><span></span><code>Parameter value ‚Üí Fixture (via request.param) ‚Üí Transformed value ‚Üí Test function
</code></pre></div>

<h3 id="why-this-matters-complex-object-creation">Why This Matters: Complex Object Creation</h3>
<p>The real power of indirect parametrization becomes clear when you need to create complex objects. Let's extend our example:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_config_loader_indirect_v2.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tomli_w</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigLoader</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_file</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a config file based on a specification.</span>

<span class="sd">    Expects request.param to be a dict with:</span>
<span class="sd">        - format: str (json/yaml/toml)</span>
<span class="sd">        - data: dict (config data to write)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
    <span class="n">file_format</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span>
    <span class="n">config_data</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.json&quot;</span>
        <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;yaml&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.yaml&quot;</span>
        <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;toml&quot;</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;config.toml&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">tomli_w</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;config_file&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;TestApp&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;TestApp&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">}},</span>
    <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;toml&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ProdApp&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">}},</span>
<span class="p">],</span> <span class="n">indirect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_load_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_name&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TestApp&quot;</span><span class="p">,</span> <span class="s2">&quot;ProdApp&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;2.0&quot;</span><span class="p">]</span>
</code></pre></div>

<p>Now we're passing <strong>complex specifications</strong> (dictionaries) as parameters, and the fixture transforms them into actual files. This pattern is incredibly powerful for:</p>
<ul>
<li>Creating test databases with specific schemas</li>
<li>Setting up API clients with different configurations</li>
<li>Generating test files with varying content</li>
</ul>
<h3 id="partial-indirect-parametrization">Partial Indirect Parametrization</h3>
<p>You can mix direct and indirect parameters in the same test:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_config_loader_mixed.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigLoader</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_file</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a config file in the specified format.&quot;&quot;&quot;</span>
    <span class="n">file_format</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
    <span class="n">config_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;TestApp&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">}</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;config.</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">file_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;config_file&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">],</span> <span class="n">indirect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;key,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;app_name&quot;</span><span class="p">,</span> <span class="s2">&quot;TestApp&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;1.0&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>  <span class="c1"># Key doesn&#39;t exist</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_config_value</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>

<p><strong>What's happening</strong>:
- <code>config_file</code> is <strong>indirect</strong>: Goes through the fixture
- <code>key</code> and <code>expected</code> are <strong>direct</strong>: Go straight to the test function</p>
<p>This generates: 1 file format √ó 3 key-value pairs = <strong>3 test cases</strong>.</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_config_loader_mixed.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_config_loader_mixed.py::test_get_config_value[json-app_name-TestApp] PASSED
test_config_loader_mixed.py::test_get_config_value[json-version-1.0] PASSED
test_config_loader_mixed.py::test_get_config_value[json-debug-None] PASSED

======================== 3 passed in 0.02s =========================
</code></pre></div>

<h3 id="demonstrating-failure-invalid-format">Demonstrating Failure: Invalid Format</h3>
<p>Let's see what happens when we pass an invalid format:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_config_loader_indirect_fail.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigLoader</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_file</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a config file in the specified format.&quot;&quot;&quot;</span>
    <span class="n">file_format</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>

    <span class="k">if</span> <span class="n">file_format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;toml&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported format: </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ... rest of fixture code</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;config_file&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;xml&quot;</span><span class="p">,</span> <span class="s2">&quot;toml&quot;</span><span class="p">],</span> <span class="n">indirect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_load_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">ConfigLoader</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">loader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;TestApp&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_config_loader_indirect_fail.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_config_loader_indirect_fail.py::test_load_config[json] PASSED
test_config_loader_indirect_fail.py::test_load_config[xml] ERROR
test_config_loader_indirect_fail.py::test_load_config[toml] PASSED

================================ ERRORS ===================================
____________ ERROR at setup of test_load_config[xml] ____________

request = &lt;FixtureRequest for &lt;Function test_load_config[xml]&gt;&gt;
tmp_path = PosixPath(&#39;/tmp/pytest-of-user/pytest-123/test_load_config_xml0&#39;)

    @pytest.fixture
    def config_file(request, tmp_path):
        &quot;&quot;&quot;Create a config file in the specified format.&quot;&quot;&quot;
        file_format = request.param

        if file_format not in [&quot;json&quot;, &quot;yaml&quot;, &quot;toml&quot;]:
&gt;           raise ValueError(f&quot;Unsupported format: {file_format}&quot;)
E           ValueError: Unsupported format: xml

test_config_loader_indirect_fail.py:8: ValueError
==================== 1 passed, 1 error, 1 passed in 0.03s ====================
</code></pre></div>

<h3 id="diagnostic-analysis-fixture-setup-failure">Diagnostic Analysis: Fixture Setup Failure</h3>
<p><strong>The summary line</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">ERROR</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">setup</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">test_load_config</span><span class="o">[</span><span class="n">xml</span><span class="o">]</span>
</code></pre></div>

<p>This tells us:
- The error occurred during <strong>fixture setup</strong>, not during the test itself
- The problematic parameter was <code>xml</code></p>
<p><strong>The error details</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;</span>           <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported format: </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">E</span>           <span class="ne">ValueError</span><span class="p">:</span> <span class="n">Unsupported</span> <span class="nb">format</span><span class="p">:</span> <span class="n">xml</span>
</code></pre></div>

<p>The fixture raised an exception before the test could even run. This is different from a test failure‚Äîit's a <strong>setup error</strong>.</p>
<p><strong>Key insight</strong>: When using indirect parametrization, validation errors in the fixture appear as <strong>setup errors</strong>, not test failures. This helps distinguish between:
- <strong>Setup problems</strong>: The test environment couldn't be created
- <strong>Test failures</strong>: The test ran but assertions failed</p>
<h3 id="when-to-apply-indirect-parametrization">When to Apply Indirect Parametrization</h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Use Indirect Parametrization</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Simple values (strings, ints)</td>
<td>‚ùå Use direct parametrization</td>
<td>No transformation needed</td>
</tr>
<tr>
<td>Complex object creation</td>
<td>‚úÖ Yes</td>
<td>Fixture can build objects from specs</td>
</tr>
<tr>
<td>File/database setup</td>
<td>‚úÖ Yes</td>
<td>Fixture handles setup/teardown</td>
</tr>
<tr>
<td>Parameter validation</td>
<td>‚úÖ Yes</td>
<td>Fixture can validate and fail early</td>
</tr>
<tr>
<td>Multiple tests need same transformation</td>
<td>‚úÖ Yes</td>
<td>DRY: transformation logic in one place</td>
</tr>
<tr>
<td>Parameters are already the right type</td>
<td>‚ùå Use direct parametrization</td>
<td>Simpler and more readable</td>
</tr>
</tbody>
</table>
<h3 id="decision-framework-direct-vs-indirect">Decision Framework: Direct vs. Indirect</h3>
<p><strong>Use direct parametrization when</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_something</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>

<ul>
<li>Parameters are <strong>ready to use</strong> as-is</li>
<li>No setup/teardown needed</li>
<li>Simple and readable</li>
</ul>
<p><strong>Use indirect parametrization when</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;db&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sqlite&quot;</span><span class="p">,</span> <span class="s2">&quot;postgres&quot;</span><span class="p">],</span> <span class="n">indirect</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_something</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="c1"># db is a fully configured database connection</span>
    <span class="k">assert</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT 1&quot;</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>Parameters need <strong>transformation</strong> into complex objects</li>
<li>Setup/teardown is required</li>
<li>Multiple tests need the same transformation logic</li>
</ul>
<h3 id="current-limitation_3">Current Limitation</h3>
<p>Our test IDs are still auto-generated:</p>
<div class="codehilite"><pre><span></span><code><span class="n">test_load_config</span><span class="o">[</span><span class="n">json</span><span class="o">]</span>
<span class="n">test_load_config</span><span class="o">[</span><span class="n">yaml</span><span class="o">]</span>
<span class="n">test_load_config</span><span class="o">[</span><span class="n">toml</span><span class="o">]</span>
</code></pre></div>

<p>These are okay, but what if we want more descriptive names? What if we're testing with complex objects and the default representation is unreadable?</p>
<p>This is where <strong>custom test IDs</strong> come in‚Äîour final parametrization technique.</p>
<h2 id="generating-test-ids-for-clarity">Generating Test IDs for Clarity</h2>
<h2 id="the-problem-unreadable-test-names">The Problem: Unreadable Test Names</h2>
<p>As your parametrized tests grow more complex, the auto-generated test IDs become harder to read. Consider this test:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_api_client.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;endpoint,method,headers,expected_status&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;/api/users&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">},</span> <span class="mi">200</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;/api/users&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">,</span> <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span> <span class="mi">201</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;/api/users/123&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">},</span> <span class="mi">204</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_api_request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">expected_status</span><span class="p">):</span>
    <span class="c1"># Test implementation</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_api_client.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_api_client.py::test_api_request[/api/users-GET-headers0-200] PASSED
test_api_client.py::test_api_request[/api/users-POST-headers1-201] PASSED
test_api_client.py::test_api_request[/api/users/123-DELETE-headers2-204] PASSED
</code></pre></div>

<p><strong>Problems</strong>:
1. <code>headers0</code>, <code>headers1</code>, <code>headers2</code> are meaningless
2. The full parameter values aren't shown (headers are complex)
3. Hard to quickly identify which test failed in CI logs</p>
<h3 id="phase-1-understanding-default-id-generation">Phase 1: Understanding Default ID Generation</h3>
<p>Pytest generates test IDs by converting each parameter to a string. For simple types, this works well:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_simple</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c1"># IDs: test_simple[1], test_simple[2], test_simple[3]</span>
</code></pre></div>

<p>But for complex types, pytest falls back to generic names:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_complex</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c1"># IDs: test_complex[data0], test_complex[data1]  ‚Üê Not helpful!</span>
</code></pre></div>

<h3 id="iteration-1-using-the-ids-parameter">Iteration 1: Using the <code>ids</code> Parameter</h3>
<p>The <code>ids</code> parameter lets you provide custom names for each test case:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_api_client_ids_v1.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;endpoint,method,headers,expected_status&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;/api/users&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">},</span> <span class="mi">200</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;/api/users&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">,</span> <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span> <span class="mi">201</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;/api/users/123&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">},</span> <span class="mi">204</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">ids</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;get_users&quot;</span><span class="p">,</span>
        <span class="s2">&quot;create_user&quot;</span><span class="p">,</span>
        <span class="s2">&quot;delete_user&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_api_request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">expected_status</span><span class="p">):</span>
    <span class="c1"># Test implementation</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_api_client_ids_v1.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_api_client_ids_v1.py::test_api_request[get_users] PASSED
test_api_client_ids_v1.py::test_api_request[create_user] PASSED
test_api_client_ids_v1.py::test_api_request[delete_user] PASSED
</code></pre></div>

<p><strong>Much better!</strong> Now the test names are meaningful and scannable.</p>
<h3 id="iteration-2-dynamic-id-generation-with-functions">Iteration 2: Dynamic ID Generation with Functions</h3>
<p>Manually writing IDs for every test case is tedious. You can use a <strong>function</strong> to generate IDs automatically:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_api_client_ids_v2.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_api_test_id</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">expected_status</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a readable test ID from API parameters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">endpoint</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">expected_status</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;endpoint,method,headers,expected_status&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;/api/users&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">},</span> <span class="mi">200</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;/api/users&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">,</span> <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span> <span class="mi">201</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;/api/users/123&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span><span class="p">},</span> <span class="mi">204</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">ids</span><span class="o">=</span><span class="n">make_api_test_id</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_api_request</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">expected_status</span><span class="p">):</span>
    <span class="c1"># Test implementation</span>
    <span class="k">pass</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_api_client_ids_v2.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_api_client_ids_v2.py::test_api_request[GET__api_users_200] PASSED
test_api_client_ids_v2.py::test_api_request[POST__api_users_201] PASSED
test_api_client_ids_v2.py::test_api_request[DELETE__api_users_123_204] PASSED
</code></pre></div>

<p><strong>How it works</strong>:
- Pytest calls <code>make_api_test_id(endpoint, method, headers, expected_status)</code> for each parameter set
- The function returns a string that becomes the test ID
- The function receives the <strong>unpacked</strong> parameter values</p>
<h3 id="iteration-3-using-lambda-for-inline-id-generation">Iteration 3: Using Lambda for Inline ID Generation</h3>
<p>For simple transformations, you can use a lambda:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_password_validator_ids.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">password_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_password</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;password,expected_valid,expected_message&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Password!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Password123&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Password123!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">ids</span><span class="o">=</span><span class="k">lambda</span> <span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">:</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;valid_</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">expected_valid</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;invalid_</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_password_validator_ids.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validator_ids.py::test_password_validation[invalid_Short1!] PASSED
test_password_validator_ids.py::test_password_validation[invalid_password123!] PASSED
test_password_validator_ids.py::test_password_validation[invalid_Password!] PASSED
test_password_validator_ids.py::test_password_validation[invalid_Password123] PASSED
test_password_validator_ids.py::test_password_validation[valid_Password123!] PASSED
</code></pre></div>

<h3 id="iteration-4-using-pytestparam-for-per-case-ids">Iteration 4: Using <code>pytest.param</code> for Per-Case IDs</h3>
<p>Sometimes you want to specify IDs for only <strong>some</strong> test cases. Use <code>pytest.param</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_password_validator_param_ids.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">password_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_password</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;password,expected_valid,expected_message&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;Short1!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;too_short&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;password123!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_uppercase&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;Password!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_number&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;Password123&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_special_char&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;Password123!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;valid_password&quot;</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_password_validator_param_ids.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validator_param_ids.py::test_password_validation[too_short] PASSED
test_password_validator_param_ids.py::test_password_validation[no_uppercase] PASSED
test_password_validator_param_ids.py::test_password_validation[no_number] PASSED
test_password_validator_param_ids.py::test_password_validation[no_special_char] PASSED
test_password_validator_param_ids.py::test_password_validation[valid_password] PASSED
</code></pre></div>

<p><strong>Perfect!</strong> Now our test names are:
- ‚úÖ Descriptive
- ‚úÖ Scannable
- ‚úÖ Meaningful in CI logs</p>
<h3 id="combining-pytestparam-with-marks">Combining pytest.param with Marks</h3>
<p><code>pytest.param</code> can also carry <strong>marks</strong> (like <code>skip</code> or <code>xfail</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_password_validator_param_marks.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">password_validator</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_password</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;password,expected_valid,expected_message&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;Short1!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;too_short&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;password123!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_uppercase&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;Password!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_number&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;Password123&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_special_char&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;Password123!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;valid_password&quot;</span>
        <span class="p">),</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span>
            <span class="s2">&quot;P@ssw0rd!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;unicode_special_char&quot;</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Unicode special chars not yet supported&quot;</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_password_validator_param_marks.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validator_param_marks.py::test_password_validation[too_short] PASSED
test_password_validator_param_marks.py::test_password_validation[no_uppercase] PASSED
test_password_validator_param_marks.py::test_password_validation[no_number] PASSED
test_password_validator_param_marks.py::test_password_validation[no_special_char] PASSED
test_password_validator_param_marks.py::test_password_validation[valid_password] PASSED
test_password_validator_param_marks.py::test_password_validation[unicode_special_char] XFAIL

==================== 5 passed, 1 xfailed in 0.03s ====================
</code></pre></div>

<p>The <code>unicode_special_char</code> test is marked as <strong>expected to fail</strong> (XFAIL), and pytest reports it separately.</p>
<h3 id="demonstrating-failure-with-custom-ids">Demonstrating Failure with Custom IDs</h3>
<p>Let's introduce a bug and see how custom IDs help with debugging:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># password_validator_buggy.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate a password (with a bug).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span>

    <span class="c1"># BUG: Forgot to check for numbers!</span>
    <span class="c1"># if not any(c.isdigit() for c in password):</span>
    <span class="c1">#     return False, &quot;Password must contain at least one number&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="s2">&quot;!@#$%^&amp;*()_+-=[]</span><span class="si">{}</span><span class="s2">|;:,.&lt;&gt;?&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span>

    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>test_password_validator_param_ids.py<span class="w"> </span>-v
</code></pre></div>

<p><strong>Output</strong>:</p>
<div class="codehilite"><pre><span></span><code>test_password_validator_param_ids.py::test_password_validation[too_short] PASSED
test_password_validator_param_ids.py::test_password_validation[no_uppercase] PASSED
test_password_validator_param_ids.py::test_password_validation[no_number] FAILED
test_password_validator_param_ids.py::test_password_validation[no_special_char] PASSED
test_password_validator_param_ids.py::test_password_validation[valid_password] PASSED

================================ FAILURES =================================
____________ test_password_validation[no_number] ____________

password = &#39;Password!&#39;, expected_valid = False
expected_message = &#39;Password must contain at least one number&#39;

    @pytest.mark.parametrize(
        &quot;password,expected_valid,expected_message&quot;,
        [
            pytest.param(
                &quot;Short1!&quot;, False, &quot;Password must be at least 8 characters&quot;,
                id=&quot;too_short&quot;
            ),
            pytest.param(
                &quot;password123!&quot;, False, &quot;Password must contain at least one uppercase letter&quot;,
                id=&quot;no_uppercase&quot;
            ),
            pytest.param(
                &quot;Password!&quot;, False, &quot;Password must contain at least one number&quot;,
                id=&quot;no_number&quot;
            ),
            # ...
        ]
    )
    def test_password_validation(password, expected_valid, expected_message):
        is_valid, message = validate_password(password)
        assert is_valid == expected_valid
&gt;       assert message == expected_message
E       AssertionError: assert &#39;Password is valid&#39; == &#39;Password must...ast one number&#39;
E         - Password must contain at least one number
E         + Password is valid

test_password_validator_param_ids.py:XX: AssertionError
==================== 1 failed, 4 passed in 0.03s ====================
</code></pre></div>

<h3 id="diagnostic-analysis-the-value-of-custom-ids">Diagnostic Analysis: The Value of Custom IDs</h3>
<p><strong>The summary line</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">test_password_validation</span><span class="o">[</span><span class="n">no_number</span><span class="o">]</span><span class="w"> </span><span class="n">FAILED</span>
</code></pre></div>

<p><strong>Immediately tells us</strong>:
- Which validation rule failed: <code>no_number</code>
- Without custom IDs, this would be: <code>test_password_validation[Password!-False-Password must contain at least one number]</code></p>
<p><strong>In CI logs</strong>, custom IDs make failures instantly recognizable:</p>
<div class="codehilite"><pre><span></span><code><span class="err">‚ùå</span><span class="w"> </span><span class="n">test_password_validation</span><span class="o">[</span><span class="n">no_number</span><span class="o">]</span>
<span class="err">‚úÖ</span><span class="w"> </span><span class="n">test_password_validation</span><span class="o">[</span><span class="n">too_short</span><span class="o">]</span>
<span class="err">‚úÖ</span><span class="w"> </span><span class="n">test_password_validation</span><span class="o">[</span><span class="n">no_uppercase</span><span class="o">]</span>
</code></pre></div>

<p>vs. without custom IDs:</p>
<div class="codehilite"><pre><span></span><code>‚ùå test_password_validation[Password!-False-Password must contain at least one number]
‚úÖ test_password_validation[Short1!-False-Password must be at least 8 characters]
‚úÖ test_password_validation[password123!-False-Password must contain at least one uppercase letter]
</code></pre></div>

<h3 id="best-practices-for-test-ids">Best Practices for Test IDs</h3>
<p><strong>DO</strong>:
- ‚úÖ Use descriptive names that explain <strong>what</strong> is being tested
- ‚úÖ Keep IDs short but meaningful (aim for &lt; 40 characters)
- ‚úÖ Use consistent naming conventions across your test suite
- ‚úÖ Include the key distinguishing feature of each test case</p>
<p><strong>DON'T</strong>:
- ‚ùå Include the full parameter values in the ID (redundant)
- ‚ùå Use generic names like <code>test1</code>, <code>test2</code>, <code>case_a</code>
- ‚ùå Make IDs so long they wrap in terminal output
- ‚ùå Use special characters that might cause issues in file systems</p>
<h3 id="id-generation-strategies">ID Generation Strategies</h3>
<table>
<thead>
<tr>
<th>Strategy</th>
<th>When to Use</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Manual list</td>
<td>Few test cases, very specific names</td>
<td><code>ids=["valid", "invalid", "edge_case"]</code></td>
</tr>
<tr>
<td>Function</td>
<td>Many test cases, algorithmic naming</td>
<td><code>ids=lambda x, y: f"{x}_{y}"</code></td>
</tr>
<tr>
<td>Lambda</td>
<td>Simple transformation</td>
<td><code>ids=lambda x: f"test_{x}"</code></td>
</tr>
<tr>
<td><code>pytest.param</code></td>
<td>Per-case control, need marks</td>
<td><code>pytest.param(..., id="name", marks=...)</code></td>
</tr>
</tbody>
</table>
<h3 id="the-complete-journey-from-repetition-to-clarity">The Complete Journey: From Repetition to Clarity</h3>
<p>Let's review how far we've come with our password validator:</p>
<p><strong>Iteration 0: Separate test functions</strong> (25 lines)</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_password_too_short</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_no_uppercase</span><span class="p">():</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span>

<span class="c1"># ... 3 more functions</span>
</code></pre></div>

<p><strong>Iteration 1: Basic parametrization</strong> (13 lines)</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password,expected_valid,expected_message&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password123&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Password123!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<p><strong>Iteration 2: Custom IDs with pytest.param</strong> (20 lines, but much clearer)</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password,expected_valid,expected_message&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;Short1!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;too_short&quot;</span><span class="p">),</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;password123!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_uppercase&quot;</span><span class="p">),</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;Password!&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_number&quot;</span><span class="p">),</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;Password123&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one special character&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;no_special_char&quot;</span><span class="p">),</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;Password123!&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;valid_password&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_valid</span><span class="p">,</span> <span class="n">expected_message</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="o">==</span> <span class="n">expected_valid</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="o">==</span> <span class="n">expected_message</span>
</code></pre></div>

<p><strong>Benefits achieved</strong>:
- ‚úÖ <strong>DRY</strong>: Test logic defined once
- ‚úÖ <strong>Maintainable</strong>: Change logic in one place
- ‚úÖ <strong>Extensible</strong>: Add test case = add one line
- ‚úÖ <strong>Readable</strong>: Custom IDs make failures obvious
- ‚úÖ <strong>Debuggable</strong>: Clear test names in CI logs</p>
<h3 id="lessons-learned">Lessons Learned</h3>
<p><strong>Parametrization is about more than reducing code</strong>. It's about:</p>
<ol>
<li><strong>Expressing intent</strong>: Test data as a table makes patterns visible</li>
<li><strong>Enabling growth</strong>: Adding test cases becomes trivial</li>
<li><strong>Improving debugging</strong>: Custom IDs make failures instantly recognizable</li>
<li><strong>Maintaining quality</strong>: Change test logic once, all cases benefit</li>
</ol>
<p><strong>The progression</strong>:
1. Start with direct parametrization for simple cases
2. Add fixture parametrization when setup is complex
3. Use indirect parametrization when parameters need transformation
4. Apply custom IDs when test names matter (always in production code)</p>
<p><strong>The decision tree</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">Need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">multiple</span><span class="w"> </span><span class="nx">scenarios</span><span class="p">?</span>
<span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="nx">Simple</span><span class="w"> </span><span class="nx">values</span><span class="p">,</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">setup</span><span class="w"> </span><span class="nx">needed</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="err">@</span><span class="nx">pytest</span><span class="p">.</span><span class="nx">mark</span><span class="p">.</span><span class="nx">parametrize</span><span class="w"> </span><span class="p">(</span><span class="nx">direct</span><span class="p">)</span>
<span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="nx">Complex</span><span class="w"> </span><span class="nx">setup</span><span class="o">/</span><span class="nx">teardown</span><span class="w"> </span><span class="nx">required</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">fixture</span><span class="w"> </span><span class="nx">parametrization</span>
<span class="err">‚îú‚îÄ</span><span class="w"> </span><span class="nx">Parameters</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">transformation</span>
<span class="err">‚îÇ</span><span class="w">  </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">indirect</span><span class="w"> </span><span class="nx">parametrization</span>
<span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nx">Test</span><span class="w"> </span><span class="nx">names</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">unclear</span>
<span class="w">   </span><span class="err">‚îî‚îÄ</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">custom</span><span class="w"> </span><span class="nx">IDs</span><span class="w"> </span><span class="p">(</span><span class="nx">function</span><span class="p">,</span><span class="w"> </span><span class="nx">lambda</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">pytest</span><span class="p">.</span><span class="nx">param</span><span class="p">)</span>
</code></pre></div>

<p>You now have the complete toolkit for parametrized testing in pytest. Use these techniques to write comprehensive, maintainable test suites that scale with your codebase.</p>
        </div>
        <div class="footer">
            Generated on 2025-12-03 10:37:00 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>