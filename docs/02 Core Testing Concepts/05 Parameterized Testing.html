<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>05 Parameterized Testing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">02 Core Testing Concepts</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-5-parameterized-testing">Chapter 5: Parameterized Testing</h1>
<h2 id="testing-multiple-scenarios-without-repetition">Testing Multiple Scenarios Without Repetition</h2>
<h2 id="the-problem-testing-the-same-logic-with-different-data">The Problem: Testing the Same Logic with Different Data</h2>
<p>In testing, we rarely check just one scenario. For any given function, we need to verify its behavior with various inputs: valid data, invalid data, edge cases, boundary conditions, and more. A robust test suite is one that covers a wide spectrum of possibilities.</p>
<p>Let's establish our anchor example for this chapter: a password validation function. This is a classic use case because the rules for a "valid" password create numerous scenarios we need to test.</p>
<h3 id="phase-1-establish-the-reference-implementation">Phase 1: Establish the Reference Implementation</h3>
<p>Our initial function, <code>is_valid_password</code>, will have a few simple rules:
1.  Must be at least 8 characters long.
2.  Must contain at least one number.
3.  Must contain at least one uppercase letter.</p>
<p>Here is the implementation.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># validation.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="k">def</span><span class="w"> </span><span class="nf">is_valid_password</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if a password meets the following criteria:</span>
<span class="sd">    1. At least 8 characters long.</span>
<span class="sd">    2. Contains at least one number.</span>
<span class="sd">    3. Contains at least one uppercase letter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[A-Z]&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>

<p>Now, let's write some tests for it. The most straightforward, yet most problematic, approach is to write a separate test function for each scenario.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_v1.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_password</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_password</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A valid password should be accepted.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="s2">&quot;ValidPass1&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_too_short</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A password shorter than 8 characters should be rejected.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="s2">&quot;Short1&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_missing_number</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A password without a number should be rejected.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="s2">&quot;NoNumberPass&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_missing_uppercase</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A password without an uppercase letter should be rejected.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="s2">&quot;nouppercase1&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</code></pre></div>

<p>Let's run these tests to confirm they work as expected.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_validation_v1.py::test_valid_password<span class="w"> </span>PASSED<span class="w">                 </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_validation_v1.py::test_password_too_short<span class="w"> </span>PASSED<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_validation_v1.py::test_password_missing_number<span class="w"> </span>PASSED<span class="w">         </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_validation_v1.py::test_password_missing_uppercase<span class="w"> </span>PASSED<span class="w">      </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">==========================</span>
</code></pre></div>

<h3 id="the-pitfall-code-duplication-and-maintenance-burden">The Pitfall: Code Duplication and Maintenance Burden</h3>
<p>The tests pass, but we've created a maintenance problem. This approach violates the "Don't Repeat Yourself" (DRY) principle.</p>
<p><strong>Current Limitation:</strong>
-   <strong>Repetitive Structure:</strong> Every test function has the exact same structure: call <code>is_valid_password</code> with a specific input and assert the expected boolean result.
-   <strong>High Maintenance:</strong> If the function's signature changes (e.g., it starts returning a reason for failure), we have to update <em>every single test function</em>.
-   <strong>Poor Scalability:</strong> What if we need to test 20 more scenarios? We would have to write 20 more nearly identical functions. The test file would become bloated and hard to read.</p>
<p>This is a "maintenance failure" waiting to happen. The code works today, but it's brittle and expensive to change tomorrow. We need a way to test the <em>same logic</em> with a <em>list of different inputs</em>. This is the core problem that parametrization solves.</p>
<h2 id="pytestmarkparametrize-basics">@pytest.mark.parametrize Basics</h2>
<h2 id="iteration-1-consolidating-tests-with-pytestmarkparametrize">Iteration 1: Consolidating Tests with <code>@pytest.mark.parametrize</code></h2>
<p>Pytest provides a powerful decorator, <code>@pytest.mark.parametrize</code>, to handle this exact situation. It allows you to define multiple sets of arguments for a single test function. Pytest will then run the test function once for each set of arguments.</p>
<p><strong>The Concept Before the Syntax:</strong>
Instead of thinking "I need four tests," we shift our thinking to "I need one test that verifies password validity, and I have four <em>scenarios</em> to check."</p>
<p>The decorator takes two main arguments:
1.  A string containing a comma-separated list of argument names.
2.  A list of values, where each element in the list is a set of arguments for one test run.</p>
<h3 id="refactoring-to-a-single-parameterized-test">Refactoring to a Single Parameterized Test</h3>
<p>Let's refactor our four separate tests into one concise, data-driven test. We will have two parameters: the <code>password</code> to test and the <code>expected</code> boolean result.</p>
<p><strong>Before:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_v1.py (excerpt)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_valid_password</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="s2">&quot;ValidPass1&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_too_short</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="s2">&quot;Short1&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_missing_number</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="s2">&quot;NoNumberPass&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_password_missing_uppercase</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="s2">&quot;nouppercase1&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</code></pre></div>

<p><strong>After:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_v2.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_password</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password, expected&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;ValidPass1&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>         <span class="c1"># Scenario: Valid password</span>
    <span class="p">(</span><span class="s2">&quot;Short1&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>            <span class="c1"># Scenario: Too short</span>
    <span class="p">(</span><span class="s2">&quot;NoNumberPass&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>      <span class="c1"># Scenario: Missing number</span>
    <span class="p">(</span><span class="s2">&quot;nouppercase1&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>      <span class="c1"># Scenario: Missing uppercase</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests is_valid_password with multiple scenarios.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="ow">is</span> <span class="n">expected</span>
</code></pre></div>

<h3 id="verification-running-the-parameterized-test">Verification: Running the Parameterized Test</h3>
<p>Let's run this new test file with the verbose (<code>-v</code>) flag to see how pytest handles it.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_validation_v2.py
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_validation_v2.py::test_password_validation<span class="o">[</span>ValidPass1-True<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_validation_v2.py::test_password_validation<span class="o">[</span>Short1-False<span class="o">]</span><span class="w"> </span>PASSED<span class="w">   </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_validation_v2.py::test_password_validation<span class="o">[</span>NoNumberPass-False<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_validation_v2.py::test_password_validation<span class="o">[</span>nouppercase1-False<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">==========================</span>
</code></pre></div>

<h3 id="banish-magic-with-mechanics-how-it-works">Banish Magic with Mechanics: How It Works</h3>
<p>Notice the output. Even though we wrote only one test function (<code>test_password_validation</code>), pytest reports that it collected and ran <strong>4 items</strong>. It has dynamically generated a separate test case for each tuple in our parameter list.</p>
<p>The part in the square brackets, like <code>[ValidPass1-True]</code>, is the <strong>Test ID</strong>. Pytest automatically generates this from the parameter values to help you distinguish which specific scenario passed or failed.</p>
<p><strong>Expected vs. Actual Improvement:</strong>
-   <strong>Code Volume:</strong> We replaced four functions (12 lines of code) with one parameterized function (8 lines).
-   <strong>Maintainability:</strong> Adding a new test case is now a one-line change‚Äîwe just add a new tuple to the list. If the <code>is_valid_password</code> function signature changes, we only have to update one test function.
-   <strong>Readability:</strong> The test data is neatly organized as a table of inputs and expected outputs, making the intent of the test crystal clear.</p>
<p><strong>Limitation Preview:</strong> This is excellent for simple inputs. But what if our function takes multiple, distinct arguments? Or what if we need to combine this with fixtures? We'll explore that next.</p>
<h2 id="multiple-parameters">Multiple Parameters</h2>
<h2 id="iteration-2-handling-multiple-distinct-parameters">Iteration 2: Handling Multiple Distinct Parameters</h2>
<p>Our current test uses two parameters, <code>password</code> and <code>expected</code>, which works perfectly. The syntax <code>parametrize("arg1, arg2", [...])</code> is designed for exactly this. Each element in the list of parameters must be a tuple whose size matches the number of argument names.</p>
<p>Let's evolve our anchor example to make this more explicit. A simple boolean return value is often not enough. Good validation functions should tell you <em>why</em> something failed. Let's refactor <code>is_valid_password</code> to return a tuple: <code>(bool, str)</code>, where the string is a reason for failure.</p>
<h3 id="evolving-the-function-under-test">Evolving the Function Under Test</h3>
<p>Here's the new version of our validation function.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># validation_v2.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>

<span class="k">def</span><span class="w"> </span><span class="nf">is_valid_password</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks password validity and returns a tuple of (bool, reason_string).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[A-Z]&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid.&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="failure-demonstration-adapting-the-test">Failure Demonstration: Adapting the Test</h3>
<p>Our existing test is now broken because it only asserts against a boolean. If we run it against the new function, it will fail. Let's create a new test file and adapt our test. We now need to check three things: the input <code>password</code>, the <code>expected_validity</code> (boolean), and the <code>expected_reason</code>.</p>
<p>This requires us to parametrize three arguments.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_v3.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">validation_v2</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_password</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password, expected_validity, expected_reason&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;ValidPass1&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Short1&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters long.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;NoNumberPass&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;nouppercase1&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter.&quot;</span><span class="p">),</span>
    <span class="c1"># Let&#39;s add a new case that fails on the first check to be thorough</span>
    <span class="p">(</span><span class="s2">&quot;short&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters long.&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation_with_reasons</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">expected_validity</span><span class="p">,</span> <span class="n">expected_reason</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests is_valid_password with multiple scenarios, checking validity and reason.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="ow">is</span> <span class="n">expected_validity</span>
    <span class="k">assert</span> <span class="n">reason</span> <span class="o">==</span> <span class="n">expected_reason</span>
</code></pre></div>

<h3 id="verification">Verification</h3>
<p>Running this new test shows that all scenarios are correctly handled.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_validation_v3.py
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
collected<span class="w"> </span><span class="m">5</span><span class="w"> </span>items

test_validation_v3.py::test_password_validation_with_reasons<span class="o">[</span>ValidPass1-True-Password<span class="w"> </span>is<span class="w"> </span>valid.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">20</span>%<span class="o">]</span>
test_validation_v3.py::test_password_validation_with_reasons<span class="o">[</span>Short1-False-Password<span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>at<span class="w"> </span>least<span class="w"> </span><span class="m">8</span><span class="w"> </span>characters<span class="w"> </span>long.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">40</span>%<span class="o">]</span>
test_validation_v3.py::test_password_validation_with_reasons<span class="o">[</span>NoNumberPass-False-Password<span class="w"> </span>must<span class="w"> </span>contain<span class="w"> </span>at<span class="w"> </span>least<span class="w"> </span>one<span class="w"> </span>number.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">60</span>%<span class="o">]</span>
test_validation_v3.py::test_password_validation_with_reasons<span class="o">[</span>nouppercase1-False-Password<span class="w"> </span>must<span class="w"> </span>contain<span class="w"> </span>at<span class="w"> </span>least<span class="w"> </span>one<span class="w"> </span>uppercase<span class="w"> </span>letter.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">80</span>%<span class="o">]</span>
test_validation_v3.py::test_password_validation_with_reasons<span class="o">[</span>short-False-Password<span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>at<span class="w"> </span>least<span class="w"> </span><span class="m">8</span><span class="w"> </span>characters<span class="w"> </span>long.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">==========================</span>
</code></pre></div>

<h3 id="key-takeaway">Key Takeaway</h3>
<p>The <code>@pytest.mark.parametrize</code> decorator seamlessly handles multiple arguments.</p>
<ul>
<li>The first argument to the decorator is a string of comma-separated names: <code>"arg1, arg2, arg3"</code>.</li>
<li>The second argument is a list of tuples, where each tuple contains the values for <code>(arg1, arg2, arg3)</code> for a single test run.</li>
<li>The test function must accept arguments with the same names.</li>
</ul>
<p>This pattern is incredibly powerful for testing complex logic where multiple inputs influence the outcome.</p>
<p><strong>Limitation Preview:</strong> Our test data is hardcoded inside the decorator. This is fine for a few cases, but what if the data is complex, comes from a file, or needs to be generated? Also, what if our test needs a shared resource, like a database connection, in addition to the parameters? This is where combining parametrization with fixtures becomes essential.</p>
<h2 id="combining-parametrization-with-fixtures">Combining Parametrization with Fixtures</h2>
<h2 id="iteration-3-using-fixtures-and-parameters-together">Iteration 3: Using Fixtures and Parameters Together</h2>
<p>Tests rarely exist in a vacuum. They often require setup, teardown, or access to shared resources. In pytest, these are handled by fixtures. A common question is: "How can I use my parameters alongside my fixtures?"</p>
<p>The answer is simple: pytest handles it automatically. A test function can accept arguments that come from both <code>@pytest.mark.parametrize</code> and fixtures. Pytest is smart enough to resolve each argument to its correct source.</p>
<h3 id="evolving-the-anchor-example">Evolving the Anchor Example</h3>
<p>Let's imagine our password validation rules are no longer hardcoded. Instead, they are defined in a <code>PasswordPolicy</code> object. This makes our system more flexible.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># validation_v3.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PasswordPolicy</span><span class="p">:</span>
    <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">require_number</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">require_uppercase</span><span class="p">:</span> <span class="nb">bool</span>

<span class="k">def</span><span class="w"> </span><span class="nf">is_valid_password</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="n">PasswordPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks password validity against a given policy object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">policy</span><span class="o">.</span><span class="n">min_length</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Password must be at least </span><span class="si">{</span><span class="n">policy</span><span class="o">.</span><span class="n">min_length</span><span class="si">}</span><span class="s2"> characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">require_number</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">require_uppercase</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[A-Z]&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid.&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Our <code>is_valid_password</code> function now requires a <code>PasswordPolicy</code> instance. In a real application, this policy might be loaded from a configuration file or a database. For our tests, it's a perfect candidate for a fixture.</p>
<h3 id="creating-a-fixture-and-a-parameterized-test">Creating a Fixture and a Parameterized Test</h3>
<p>Let's create a fixture that provides a default password policy. Our test function will then accept this fixture <em>and</em> our parameterized arguments.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_v4.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">validation_v3</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_password</span><span class="p">,</span> <span class="n">PasswordPolicy</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">default_policy</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">PasswordPolicy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides a default password policy for tests.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PasswordPolicy</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">require_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">require_uppercase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password, expected_validity, expected_reason&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;ValidPass1&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Password is valid.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Short1&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must be at least 8 characters long.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;NoNumberPass&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one number.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;nouppercase1&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Password must contain at least one uppercase letter.&quot;</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation_with_fixture</span><span class="p">(</span><span class="n">default_policy</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">expected_validity</span><span class="p">,</span> <span class="n">expected_reason</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests password validation using a fixture for the policy</span>
<span class="sd">    and parameters for the scenarios.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The &#39;default_policy&#39; argument is supplied by the fixture.</span>
    <span class="c1"># The other arguments are supplied by @pytest.mark.parametrize.</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">default_policy</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">is_valid</span> <span class="ow">is</span> <span class="n">expected_validity</span>
    <span class="k">assert</span> <span class="n">reason</span> <span class="o">==</span> <span class="n">expected_reason</span>
</code></pre></div>

<h3 id="verification-and-mechanics">Verification and Mechanics</h3>
<p>When we run this, it works exactly as you'd hope.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_validation_v4.py
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_validation_v4.py::test_password_validation_with_fixture<span class="o">[</span>ValidPass1-True-Password<span class="w"> </span>is<span class="w"> </span>valid.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_validation_v4.py::test_password_validation_with_fixture<span class="o">[</span>Short1-False-Password<span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>at<span class="w"> </span>least<span class="w"> </span><span class="m">8</span><span class="w"> </span>characters<span class="w"> </span>long.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_validation_v4.py::test_password_validation_with_fixture<span class="o">[</span>NoNumberPass-False-Password<span class="w"> </span>must<span class="w"> </span>contain<span class="w"> </span>at<span class="w"> </span>least<span class="w"> </span>one<span class="w"> </span>number.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_validation_v4.py::test_password_validation_with_fixture<span class="o">[</span>nouppercase1-False-Password<span class="w"> </span>must<span class="w"> </span>contain<span class="w"> </span>at<span class="w"> </span>least<span class="w"> </span>one<span class="w"> </span>uppercase<span class="w"> </span>letter.<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">==========================</span>
</code></pre></div>

<p><strong>How Pytest Resolves Arguments:</strong></p>
<ol>
<li>Pytest first inspects the signature of <code>test_password_validation_with_fixture</code>: <code>(default_policy, password, expected_validity, expected_reason)</code>.</li>
<li>It sees the <code>@pytest.mark.parametrize</code> decorator and knows it is responsible for providing <code>password</code>, <code>expected_validity</code>, and <code>expected_reason</code>.</li>
<li>It then looks for a source for the remaining argument, <code>default_policy</code>. It finds a fixture with that name and injects its return value.</li>
</ol>
<p>This composition of fixtures and parametrization is a cornerstone of writing clean, scalable, and maintainable tests with pytest.</p>
<p><strong>Limitation Preview:</strong> This is powerful, but what if the <em>parameters themselves</em> need to be processed by a fixture? For example, what if our parameters are not the final data, but rather instructions for a fixture to <em>create</em> the data? This scenario requires a special feature called "indirect parametrization."</p>
<h2 id="indirect-parametrization">Indirect Parametrization</h2>
<h2 id="iteration-4-processing-parameters-with-fixtures">Iteration 4: Processing Parameters with Fixtures</h2>
<p>Sometimes, the values you want to parametrize are not the direct inputs to your test function. Instead, they are identifiers or configurations that a fixture should use to perform some setup.</p>
<p>Consider this scenario: We want to test our password policy against auto-generated passwords. Our parameters won't be the password strings themselves, but rather <em>specifications</em> for how to generate them.</p>
<p><strong>The Problem:</strong> How do we get a fixture to receive a value from <code>@pytest.mark.parametrize</code>?</p>
<p>The solution is <strong>indirect parametrization</strong>. By adding <code>indirect=True</code> to the decorator, you tell pytest that the specified parameters should be passed to fixtures of the same name, and the <em>result</em> of those fixtures should be passed to the test function.</p>
<h3 id="evolving-the-anchor-example-for-indirect-parametrization">Evolving the Anchor Example for Indirect Parametrization</h3>
<p>Let's create a test where the parameters are dictionaries describing the password to be generated. We'll create a fixture that takes these dictionaries and builds the password strings.</p>
<p>First, a simple password generator function.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># utils.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_password</span><span class="p">(</span><span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a password based on a specification dictionary.&quot;&quot;&quot;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">has_number</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_number&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">has_uppercase</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_uppercase&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">has_uppercase</span><span class="p">:</span>
        <span class="n">password</span> <span class="o">+=</span> <span class="s2">&quot;A&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">password</span> <span class="o">+=</span> <span class="s2">&quot;a&quot;</span>

    <span class="k">if</span> <span class="n">has_number</span><span class="p">:</span>
        <span class="n">password</span> <span class="o">+=</span> <span class="s2">&quot;1&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">password</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>

    <span class="c1"># Fill the rest with lowercase letters</span>
    <span class="n">password</span> <span class="o">+=</span> <span class="s2">&quot;c&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">password</span>
</code></pre></div>

<p>Now, let's write the test. We will create a parameter named <code>password_spec</code>. We will then tell pytest to pass this parameter to a fixture, also named <code>password_spec</code>, for processing.</p>
<p><strong>Before (Direct Parametrization):</strong> The test receives the parameter value directly.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ValidPass1&quot;</span><span class="p">,</span> <span class="s2">&quot;Short1&quot;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_direct</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
    <span class="c1"># &#39;password&#39; is &quot;ValidPass1&quot; in the first run.</span>
    <span class="o">...</span>
</code></pre></div>

<p><strong>After (Indirect Parametrization):</strong> The test receives the <em>return value</em> of the fixture that was called with the parameter value.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_v5.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_password</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">validation_v3</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_password</span><span class="p">,</span> <span class="n">PasswordPolicy</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">default_policy</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">PasswordPolicy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides a default password policy for tests.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PasswordPolicy</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">require_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">require_uppercase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generated_password</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A fixture that receives a password spec via indirect parametrization</span>
<span class="sd">    and returns a generated password string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>  <span class="c1"># This is how a fixture accesses the parameter</span>
    <span class="k">return</span> <span class="n">generate_password</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;generated_password, expected_validity&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">indirect</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;generated_password&quot;</span><span class="p">]</span>  <span class="c1"># Tell pytest this parameter is indirect</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation_indirect</span><span class="p">(</span><span class="n">default_policy</span><span class="p">,</span> <span class="n">generated_password</span><span class="p">,</span> <span class="n">expected_validity</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests password validation using an indirectly parameterized fixture</span>
<span class="sd">    to generate test data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &#39;generated_password&#39; is now the *result* of the fixture, not the spec dict.</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="n">generated_password</span><span class="p">,</span> <span class="n">default_policy</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="ow">is</span> <span class="n">expected_validity</span>
</code></pre></div>

<h3 id="verification-and-mechanics_1">Verification and Mechanics</h3>
<p>Let's run this and see the result.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_validation_v5.py
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_validation_v5.py::test_password_validation_indirect<span class="o">[</span>generated_password0-True<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_validation_v5.py::test_password_validation_indirect<span class="o">[</span>generated_password1-False<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_validation_v5.py::test_password_validation_indirect<span class="o">[</span>generated_password2-False<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_validation_v5.py::test_password_validation_indirect<span class="o">[</span>generated_password3-False<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">==========================</span>
</code></pre></div>

<p><strong>The Flow of Indirect Parametrization:</strong></p>
<ol>
<li>Pytest sees <code>@pytest.mark.parametrize</code> with <code>indirect=["generated_password"]</code>.</li>
<li>For the first run, it takes the parameter value <code>{"length": 8, ...}</code>.</li>
<li>Because <code>generated_password</code> is marked as indirect, it does <strong>not</strong> pass this dictionary to the test function.</li>
<li>Instead, it finds the fixture named <code>generated_password</code>.</li>
<li>It calls the <code>generated_password</code> fixture, making the dictionary available via the special <code>request.param</code> object.</li>
<li>The fixture runs its logic (<code>generate_password(...)</code>) and returns a password string (e.g., <code>"A1cccccc"</code>).</li>
<li>Pytest then calls the test function <code>test_password_validation_indirect</code>, passing the <em>return value</em> of the fixture as the <code>generated_password</code> argument.</li>
</ol>
<h3 id="when-to-apply-this-solution">When to Apply This Solution</h3>
<ul>
<li><strong>What it optimizes for:</strong> Decoupling test data from test logic. It allows your parameters to be high-level descriptions, while the complex object creation is encapsulated in a reusable fixture.</li>
<li><strong>When to choose this approach:</strong><ul>
<li>When parameters are identifiers (e.g., user IDs, file names) that a fixture needs to look up or load.</li>
<li>When parameters are configurations for creating complex objects (as in our example).</li>
<li>When the setup for a parameter is expensive and you want to contain it within a fixture's scope.</li>
</ul>
</li>
<li><strong>When to avoid this approach:</strong> For simple, self-contained data types (strings, numbers, booleans), direct parametrization is simpler and more readable.</li>
</ul>
<p><strong>Limitation Preview:</strong> Look at the test output IDs: <code>[generated_password0-True]</code>, <code>[generated_password1-False]</code>. These are not very helpful. If a test fails, we have no idea which scenario it was. We need a way to provide clear, descriptive names for our test cases.</p>
<h2 id="generating-test-ids-for-clarity">Generating Test IDs for Clarity</h2>
<h2 id="iteration-5-improving-readability-with-custom-test-ids">Iteration 5: Improving Readability with Custom Test IDs</h2>
<p>When a parameterized test fails, the test ID is your first clue to understanding what went wrong. As we saw in the last section, pytest's default IDs can be unhelpful, especially with complex data structures like dictionaries.</p>
<p><code>test_password_validation_indirect[generated_password2-False]</code></p>
<p>Which scenario is <code>generated_password2</code>? We have to go back to the source code and count down the list to figure it out. This slows down debugging.</p>
<p>Pytest allows you to provide custom, human-readable test IDs using the <code>ids</code> parameter in <code>@pytest.mark.parametrize</code>.</p>
<h3 id="failure-demonstration-the-unhelpful-failure-report">Failure Demonstration: The Unhelpful Failure Report</h3>
<p>Let's intentionally break one of our indirect tests to see the problem clearly. Suppose our generator has a bug and produces a password with no number when it should.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_v6_fail.py (with an intentional error in the data)</span>

<span class="c1"># ... (fixtures and imports from v5) ...</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;generated_password, expected_validity&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="c1"># ... other cases ...</span>
        <span class="c1"># INTENTIONAL BUG: Expecting valid, but spec will produce invalid password</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">indirect</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;generated_password&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation_indirect_fail</span><span class="p">(</span><span class="n">default_policy</span><span class="p">,</span> <span class="n">generated_password</span><span class="p">,</span> <span class="n">expected_validity</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="n">generated_password</span><span class="p">,</span> <span class="n">default_policy</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="ow">is</span> <span class="n">expected_validity</span>
</code></pre></div>

<h3 id="diagnostic-analysis-reading-the-failure">Diagnostic Analysis: Reading the Failure</h3>
<p><strong>The complete output</strong>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_validation_v6_fail.py
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>item

test_validation_v6_fail.py::test_password_validation_indirect_fail<span class="o">[</span>generated_password0-True<span class="o">]</span><span class="w"> </span>FAILED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==============================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">==============================</span>
__<span class="w"> </span>test_password_validation_indirect_fail<span class="o">[</span>generated_password0-True<span class="o">]</span><span class="w"> </span>__

<span class="nv">default_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PasswordPolicy<span class="o">(</span><span class="nv">min_length</span><span class="o">=</span><span class="m">8</span>,<span class="w"> </span><span class="nv">require_number</span><span class="o">=</span>True,<span class="w"> </span><span class="nv">require_uppercase</span><span class="o">=</span>True<span class="o">)</span>
<span class="nv">generated_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Abbbbbbb&#39;</span>,<span class="w"> </span><span class="nv">expected_validity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True

<span class="w">    </span>@pytest.mark.parametrize<span class="o">(</span>
<span class="w">        </span><span class="s2">&quot;generated_password, expected_validity&quot;</span>,
<span class="w">        </span><span class="o">[</span>
<span class="w">            </span><span class="c1"># ... other cases ...</span>
<span class="w">            </span><span class="c1"># INTENTIONAL BUG: Expecting valid, but spec will produce invalid password</span>
<span class="w">            </span><span class="o">({</span><span class="s2">&quot;length&quot;</span>:<span class="w"> </span><span class="m">8</span>,<span class="w"> </span><span class="s2">&quot;has_number&quot;</span>:<span class="w"> </span>False,<span class="w"> </span><span class="s2">&quot;has_uppercase&quot;</span>:<span class="w"> </span>True<span class="o">}</span>,<span class="w"> </span>True<span class="o">)</span>,
<span class="w">        </span><span class="o">]</span>,
<span class="w">        </span><span class="nv">indirect</span><span class="o">=[</span><span class="s2">&quot;generated_password&quot;</span><span class="o">]</span>
<span class="w">    </span><span class="o">)</span>
<span class="w">    </span>def<span class="w"> </span>test_password_validation_indirect_fail<span class="o">(</span>default_policy,<span class="w"> </span>generated_password,<span class="w"> </span>expected_validity<span class="o">)</span>:
<span class="w">        </span>is_valid,<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>is_valid_password<span class="o">(</span>generated_password,<span class="w"> </span>default_policy<span class="o">)</span>
&gt;<span class="w">       </span>assert<span class="w"> </span>is_valid<span class="w"> </span>is<span class="w"> </span>expected_validity
E<span class="w">       </span>assert<span class="w"> </span>False<span class="w"> </span>is<span class="w"> </span>True
E<span class="w">        </span>+<span class="w">  </span>where<span class="w"> </span><span class="nv">False</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>is_valid_password<span class="o">(</span><span class="s1">&#39;Abbbbbbb&#39;</span>,<span class="w"> </span>PasswordPolicy<span class="o">(</span><span class="nv">min_length</span><span class="o">=</span><span class="m">8</span>,<span class="w"> </span><span class="nv">require_number</span><span class="o">=</span>True,<span class="w"> </span><span class="nv">require_uppercase</span><span class="o">=</span>True<span class="o">))[</span><span class="m">0</span><span class="o">]</span>

test_validation_v6_fail.py:36:<span class="w"> </span><span class="nv">AssertionError</span>
<span class="o">=======================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">=======================</span>
</code></pre></div>

<p><strong>Let's parse this section by section</strong>:</p>
<ol>
<li>
<p><strong>The summary line</strong>: <code>FAILED test_validation_v6_fail.py::test_password_validation_indirect_fail[generated_password0-True]</code></p>
<ul>
<li>What this tells us: The test named <code>test_password_validation_indirect_fail</code> failed. The failing scenario is identified only as <code>generated_password0-True</code>. This is not descriptive. We don't know <em>which</em> case failed without looking at the code.</li>
</ul>
</li>
<li>
<p><strong>The traceback</strong>: The traceback points to the <code>assert</code> line, which is correct.</p>
</li>
<li>
<p><strong>The assertion introspection</strong>: <code>assert False is True</code></p>
<ul>
<li>What this tells us: The <code>is_valid_password</code> function returned <code>False</code>, but the test expected <code>True</code>. The introspection helpfully shows us the generated password was <code>'Abbbbbbb'</code>.</li>
</ul>
</li>
</ol>
<p><strong>Root cause identified</strong>: The test failed because a password generated from a spec with <code>has_number: False</code> was expected to be valid, which is incorrect according to our policy.
<strong>Why the current approach is problematic</strong>: The test ID <code>[generated_password0-True]</code> gives us no context about the <em>intent</em> of the failing test case. We want it to say something like "fail-if-no-number".</p>
<h3 id="solution-providing-custom-ids">Solution: Providing Custom IDs</h3>
<p>We can fix this by passing a list of strings to the <code>ids</code> parameter. The list must have the same number of elements as the parameter sets.</p>
<p><strong>Before:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_v5.py (excerpt)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;generated_password, expected_validity&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">indirect</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;generated_password&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation_indirect</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>

<p><strong>After (Final Implementation):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_validation_final.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_password</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">validation_v3</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_password</span><span class="p">,</span> <span class="n">PasswordPolicy</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">default_policy</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">PasswordPolicy</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PasswordPolicy</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">require_number</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">require_uppercase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generated_password</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
    <span class="k">return</span> <span class="n">generate_password</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

<span class="c1"># A helper function for generating IDs</span>
<span class="k">def</span><span class="w"> </span><span class="nf">id_generator</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_uppercase&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;no_upper&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_number&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;no_num&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;len_</span><span class="si">{</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;valid_password&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;generated_password, expected_validity&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">({</span><span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;has_number&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;has_uppercase&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">indirect</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;generated_password&quot;</span><span class="p">],</span>
    <span class="c1"># We can provide a list of strings...</span>
    <span class="c1"># ids=[</span>
    <span class="c1">#     &quot;valid-password&quot;,</span>
    <span class="c1">#     &quot;too-short&quot;,</span>
    <span class="c1">#     &quot;missing-number&quot;,</span>
    <span class="c1">#     &quot;missing-uppercase&quot;,</span>
    <span class="c1"># ]</span>
    <span class="c1"># ...or even better, a function to generate them!</span>
    <span class="n">ids</span><span class="o">=</span><span class="k">lambda</span> <span class="n">spec</span><span class="p">:</span> <span class="n">id_generator</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">id_generator</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_password_validation_with_ids</span><span class="p">(</span><span class="n">default_policy</span><span class="p">,</span> <span class="n">generated_password</span><span class="p">,</span> <span class="n">expected_validity</span><span class="p">):</span>
    <span class="n">is_valid</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">is_valid_password</span><span class="p">(</span><span class="n">generated_password</span><span class="p">,</span> <span class="n">default_policy</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_valid</span> <span class="ow">is</span> <span class="n">expected_validity</span>
</code></pre></div>

<h3 id="verification-with-new-ids">Verification with New IDs</h3>
<p>Now when we run the tests, the output is far more informative.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_validation_final.py
<span class="o">=========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_validation_final.py::test_password_validation_with_ids<span class="o">[</span>valid_password<span class="o">]</span><span class="w"> </span>PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_validation_final.py::test_password_validation_with_ids<span class="o">[</span>len_7<span class="o">]</span><span class="w"> </span>PASSED<span class="w">      </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_validation_final.py::test_password_validation_with_ids<span class="o">[</span>no_num<span class="o">]</span><span class="w"> </span>PASSED<span class="w">      </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_validation_final.py::test_password_validation_with_ids<span class="o">[</span>no_upper<span class="o">]</span><span class="w"> </span>PASSED<span class="w">    </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==========================</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span>...s<span class="w"> </span><span class="o">==========================</span>
</code></pre></div>

<p>If the "missing-number" test were to fail now, the report would immediately tell us <code>FAILED ... [no_num]</code>, giving us instant context for debugging.</p>
<h3 id="the-journey-from-problem-to-solution">The Journey: From Problem to Solution</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Failure Mode / Problem</th>
<th>Technique Applied</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Repetitive test functions, high maintenance cost.</td>
<td>None (Copy-Paste)</td>
<td>Four separate, brittle tests.</td>
</tr>
<tr>
<td>1</td>
<td>Consolidated tests but only handled one parameter.</td>
<td><code>@pytest.mark.parametrize</code></td>
<td>A single test function for all scenarios.</td>
</tr>
<tr>
<td>2</td>
<td>Needed to test multiple inputs and outputs.</td>
<td>Multiple arguments in <code>parametrize</code></td>
<td>Test now validates input, validity, and reason message together.</td>
</tr>
<tr>
<td>3</td>
<td>Test logic coupled with policy creation.</td>
<td>Combining with Fixtures</td>
<td>Policy creation is handled by a fixture, separating concerns.</td>
</tr>
<tr>
<td>4</td>
<td>Parameters were complex to create directly.</td>
<td>Indirect Parametrization</td>
<td>Parameters became high-level specs; a fixture handled data generation.</td>
</tr>
<tr>
<td>5</td>
<td>Default test IDs were unreadable and unhelpful.</td>
<td><code>ids</code> parameter</td>
<td>Clear, descriptive test IDs that accelerate debugging.</td>
</tr>
</tbody>
</table>
<h3 id="lessons-learned">Lessons Learned</h3>
<ul>
<li><strong>Start Simple:</strong> Begin by writing separate tests to understand your scenarios.</li>
<li><strong>Refactor to Parametrize:</strong> Once you see repetition, consolidate your tests with <code>@pytest.mark.parametrize</code> to make them data-driven.</li>
<li><strong>Compose with Fixtures:</strong> Freely combine fixtures (for state/resources) and parameters (for scenarios) to build powerful and clean tests.</li>
<li><strong>Use Indirect Parametrization for Setup:</strong> When your parameters describe <em>what</em> to set up rather than being the data itself, use <code>indirect=True</code> to delegate creation to a fixture.</li>
<li><strong>Always Use Custom IDs:</strong> For any non-trivial parameter set, provide custom <code>ids</code>. It is a small investment that pays huge dividends when a test fails.</li>
</ul>
        </div>
        <div class="footer">
            Generated on 2025-11-24 14:31:15 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>