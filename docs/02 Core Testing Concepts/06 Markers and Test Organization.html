<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06 Markers and Test Organization</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0f172a;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --accent: #06b6d4;
            --success: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.7; 
            color: var(--text-primary); 
            background: var(--bg-main);
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: var(--accent);
            color: white; 
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-decoration: none; 
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn:hover { 
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5);
        }
        
        .breadcrumb { 
            background: var(--bg-card);
            padding: 12px 0; 
            margin-bottom: 24px; 
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .breadcrumb a { 
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .breadcrumb a:hover { 
            color: var(--primary);
            text-decoration: underline;
        }
        
        .content { 
            background: var(--bg-card);
            padding: 3rem; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }
        
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin: 2rem 0; 
        }
        
        .file-item { 
            padding: 1.5rem; 
            border: 1px solid var(--border);
            border-radius: 12px; 
            background: var(--bg-main);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .file-item:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.3);
            border-color: var(--primary);
        }
        
        .file-item:hover::before {
            opacity: 1;
        }
        
        .file-item a { 
            color: var(--text-primary);
            text-decoration: none; 
            font-weight: 600; 
            display: block;
            font-size: 1.1rem;
        }
        
        .file-item a:hover { 
            color: var(--primary);
        }
        
        .file-type { 
            font-size: 13px; 
            color: var(--text-secondary);
            margin-top: 8px; 
            font-weight: 500;
        }
        
        /* Code Blocks */
        pre { 
            background: var(--bg-code);
            padding: 1.5rem; 
            border-radius: 12px; 
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 1.5rem 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        pre code { 
            background: none;
            padding: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            opacity: 0.7;
            z-index: 10;
        }
        
        .copy-btn:hover {
            opacity: 1;
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        pre:hover .copy-btn {
            opacity: 1;
        }
        
        /* Inline Code */
        code { 
            background: var(--bg-code);
            color: #8b5cf6;
            padding: 3px 8px; 
            border-radius: 6px; 
            font-size: 1.1em;
            font-family: 'Fira Code', 'Consolas', monospace;
            border: 1px solid var(--border);
        }
        
        /* Headings */
        h1, h2, h3, h4, h5, h6 { 
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        h1 { 
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 12px;
            margin-bottom: 1.5rem;
        }
        
        h2 { 
            font-size: 2rem;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }
        
        h3 { 
            font-size: 1.5rem;
            color: var(--accent);
        }
        
        /* Links */
        a { 
            color: var(--accent);
            transition: color 0.2s;
        }
        
        a:hover { 
            color: var(--primary);
        }
        
        /* Paragraphs */
        p {
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        
        /* Lists */
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
            color: var(--text-secondary);
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        /* Tables */
        table { 
            border-collapse: collapse;
            width: 100%;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        th, td { 
            border: 1px solid var(--border);
            padding: 12px 16px;
            text-align: left;
        }
        
        th { 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg-card);
        }
        
        /* Blockquotes */
        blockquote {
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            background: var(--bg-main);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Horizontal Rule */
        hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 2rem 0;
        }
        
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 3rem; 
            font-size: 14px;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1.5rem; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-btn">üè†</a>
    <div class="container">
        <div class="breadcrumb">
            <div style="padding: 0 20px;">
                <a href="../index.html">üè† Home</a> <span style="color: #64748b;">/</span> <a href="index.html">02 Core Testing Concepts</a>
            </div>
        </div>
        <div class="content">
            <h1 id="chapter-6-markers-and-test-organization">Chapter 6: Markers and Test Organization</h1>
<h2 id="what-are-markers">What Are Markers?</h2>
<h2 id="what-are-markers_1">What Are Markers?</h2>
<p>As a test suite grows, you'll inevitably face an organization problem. You'll have fast unit tests, slower integration tests, and perhaps even end-to-end tests that take minutes to run. During development, you might want to run only the fast unit tests. Before a release, you might want to run everything <em>except</em> tests for features that are currently disabled.</p>
<p>How can you manage this complexity?</p>
<p>Pytest's solution is <strong>markers</strong>. A marker is a metadata tag you can apply to a test function or class. It doesn't change what the test does, but it gives you powerful ways to group, filter, and manage your tests from the command line.</p>
<p>Think of markers like labels in your email inbox (<code>work</code>, <code>urgent</code>, <code>personal</code>) or tags on a blog post (<code>python</code>, <code>testing</code>, <code>pytest</code>). The content remains the same, but the tags allow you to find and act on specific items easily.</p>
<h3 id="phase-1-establish-the-reference-implementation">Phase 1: Establish the Reference Implementation</h3>
<p>Let's build our anchor example for this chapter. We'll model a simple e-commerce order processing system. The system has different components, and we'll write different kinds of tests for them.</p>
<p>First, the application code we'll be testing.</p>
<p><strong>The Anchor Example: <code>commerce_system.py</code></strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># commerce_system.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Product</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">price</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Order</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">products</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Product</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">products</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot create an order with no products.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">products</span> <span class="o">=</span> <span class="n">products</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_discount_applied</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">total</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the total price of products in the order.&quot;&quot;&quot;</span>
        <span class="n">base_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">price</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">base_total</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_discount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentage</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies a percentage discount to the order total.&quot;&quot;&quot;</span>
        <span class="c1"># Known bug: This logic is incorrect, it should modify the total.</span>
        <span class="c1"># We will use this to demonstrate xfail later.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">percentage</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Discount must be between 1 and 100.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discount_applied</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Discount has already been applied.&quot;</span><span class="p">)</span>

        <span class="c1"># Buggy implementation for demonstration purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">*</span> <span class="p">((</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentage</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_discount_applied</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">def</span><span class="w"> </span><span class="nf">connect_to_db</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulates a slow database connection.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Connecting to database...)&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;(Connection successful.)&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;connected&quot;</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">process_payment_via_api</span><span class="p">(</span><span class="n">total</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulates a very slow external API call.&quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;This payment gateway is deprecated.&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Calling external payment API for $</span><span class="si">{</span><span class="n">total</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">...)&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;(API call successful.)&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;paid&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">total</span><span class="p">}</span>
</code></pre></div>

<p>Now, let's write a test file with a mix of tests for this system.</p>
<p><strong>The Initial Test Suite: <code>test_commerce_initial.py</code></strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># test_commerce_initial.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">commerce_system</span><span class="w"> </span><span class="kn">import</span> <span class="n">Order</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">connect_to_db</span><span class="p">,</span> <span class="n">process_payment_via_api</span>

<span class="c1"># A fast, simple unit test</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_order_total</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the total calculation for a simple order.&quot;&quot;&quot;</span>
    <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Laptop&quot;</span><span class="p">,</span> <span class="mf">1200.00</span><span class="p">),</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">)]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1225.00</span>

<span class="c1"># A test for a known bug</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_order_discount_logic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the discount application logic, which is known to be buggy.&quot;&quot;&quot;</span>
    <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Keyboard&quot;</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">),</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">)]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
    <span class="n">order</span><span class="o">.</span><span class="n">apply_discount</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="c1"># This will fail because the discount logic is flawed</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">==</span> <span class="mf">112.50</span>

<span class="c1"># A slower integration test</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_database_connection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the function that connects to the database.&quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect_to_db</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">conn</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;connected&quot;</span>

<span class="c1"># A very slow API test</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_api_call</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the external payment API call.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">process_payment_via_api</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mf">150.00</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;paid&quot;</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">150.00</span>
</code></pre></div>

<h3 id="the-problem-an-unorganized-suite">The Problem: An Unorganized Suite</h3>
<p>Let's run this suite.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_commerce_initial.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_commerce_initial.py::test_order_total<span class="w"> </span>PASSED<span class="w">                     </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_commerce_initial.py::test_order_discount_logic<span class="w"> </span>FAILED<span class="w">            </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_commerce_initial.py::test_database_connection<span class="w"> </span>
<span class="o">(</span>Connecting<span class="w"> </span>to<span class="w"> </span>database...<span class="o">)</span>
<span class="o">(</span>Connection<span class="w"> </span>successful.<span class="o">)</span>
PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_commerce_initial.py::test_payment_api_call<span class="w"> </span>
<span class="o">(</span>Calling<span class="w"> </span>external<span class="w"> </span>payment<span class="w"> </span>API<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">$150</span>.00...<span class="o">)</span>
.../test_commerce_initial.py:31:<span class="w"> </span>DeprecationWarning:<span class="w"> </span>This<span class="w"> </span>payment<span class="w"> </span>gateway<span class="w"> </span>is<span class="w"> </span>deprecated.
<span class="w">  </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>process_payment_via_api<span class="o">(</span><span class="nv">total</span><span class="o">=</span><span class="m">150</span>.00<span class="o">)</span>
<span class="o">(</span>API<span class="w"> </span>call<span class="w"> </span>successful.<span class="o">)</span>
PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
________________________<span class="w"> </span>test_order_discount_logic<span class="w"> </span>_________________________

<span class="w">    </span>def<span class="w"> </span>test_order_discount_logic<span class="o">()</span>:
<span class="w">        </span><span class="s2">&quot;&quot;&quot;Tests the discount application logic, which is known to be buggy.&quot;&quot;&quot;</span>
<span class="w">        </span><span class="nv">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>Product<span class="o">(</span><span class="s2">&quot;Keyboard&quot;</span>,<span class="w"> </span><span class="m">100</span>.00<span class="o">)</span>,<span class="w"> </span>Product<span class="o">(</span><span class="s2">&quot;Mouse&quot;</span>,<span class="w"> </span><span class="m">25</span>.00<span class="o">)]</span>
<span class="w">        </span><span class="nv">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Order<span class="o">(</span>products<span class="o">)</span>
<span class="w">        </span>order.apply_discount<span class="o">(</span><span class="m">10</span><span class="o">)</span>
<span class="w">        </span><span class="c1"># This will fail because the discount logic is flawed</span>
&gt;<span class="w">       </span>assert<span class="w"> </span>order.total<span class="o">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">112</span>.50
E<span class="w">       </span>assert<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">112</span>.5
E<span class="w">        </span>+<span class="w">  </span>where<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;bound<span class="w"> </span>method<span class="w"> </span>Order.total<span class="w"> </span>of<span class="w"> </span>&lt;commerce_system.Order<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x...&gt;&gt;<span class="o">()</span>
E<span class="w">        </span>+<span class="w">    </span>where<span class="w"> </span>&lt;bound<span class="w"> </span>method<span class="w"> </span>Order.total<span class="w"> </span>of<span class="w"> </span>&lt;commerce_system.Order<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x...&gt;&gt;<span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;commerce_system.Order<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x...&gt;.total

test_commerce_initial.py:18:<span class="w"> </span><span class="nv">AssertionError</span>
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
FAILED<span class="w"> </span>test_commerce_initial.py::test_order_discount_logic<span class="w"> </span>-<span class="w"> </span>assert<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">112</span>.5
<span class="o">==================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>failed,<span class="w"> </span><span class="m">3</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">3</span>.05s<span class="w"> </span><span class="o">===================</span>
</code></pre></div>

<p>We have several problems here:</p>
<ol>
<li><strong>One Failure Halts the Build:</strong> The <code>test_order_discount_logic</code> is failing due to a known bug. This marks the entire test run as a failure, which might block a CI/CD pipeline.</li>
<li><strong>Everything Runs:</strong> The entire suite took over 3 seconds to run. The database and API tests are slow. During rapid development, we don't want to wait for these every single time.</li>
<li><strong>Noisy Warnings:</strong> The <code>DeprecationWarning</code> clutters the output. In a large suite, this noise can hide important information.</li>
</ol>
<p>We have no way to tell pytest, "Run the fast tests," or "Ignore the known failure for now." This is the problem that markers are designed to solve.</p>
<h2 id="built-in-markers-skip-xfail-filterwarnings">Built-in Markers (skip, xfail, filterwarnings)</h2>
<h2 id="built-in-markers">Built-in Markers</h2>
<p>Pytest provides several useful markers out of the box to handle common testing scenarios like known bugs, temporarily disabled tests, and unwanted warnings. Let's apply them to our commerce test suite to solve the problems we just identified.</p>
<h3 id="iteration-1-handling-a-known-bug-with-pytestmarkxfail">Iteration 1: Handling a Known Bug with <code>@pytest.mark.xfail</code></h3>
<p>Our current test suite fails because of a known bug in the <code>apply_discount</code> method. We don't want to delete the test‚Äîit's valuable documentation of the bug‚Äîbut we also don't want it to fail our build.</p>
<p><strong>Current Limitation:</strong> A legitimate test is failing due to a bug in the application code, causing the entire test suite to be marked as <code>FAILED</code>.</p>
<p><strong>New Scenario:</strong> We need to inform pytest that we <em>expect</em> this test to fail.</p>
<p><strong>Failure Demonstration:</strong> As we saw above, running <code>pytest</code> results in a clear <code>FAILED</code> status.</p>
<h3 id="diagnostic-analysis-reading-the-failure">Diagnostic Analysis: Reading the Failure</h3>
<p><strong>The complete output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">=================================</span><span class="w"> </span><span class="nv">FAILURES</span><span class="w"> </span><span class="o">=================================</span>
________________________<span class="w"> </span>test_order_discount_logic<span class="w"> </span>_________________________

<span class="w">    </span>def<span class="w"> </span>test_order_discount_logic<span class="o">()</span>:
<span class="w">        </span><span class="s2">&quot;&quot;&quot;Tests the discount application logic, which is known to be buggy.&quot;&quot;&quot;</span>
<span class="w">        </span><span class="nv">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>Product<span class="o">(</span><span class="s2">&quot;Keyboard&quot;</span>,<span class="w"> </span><span class="m">100</span>.00<span class="o">)</span>,<span class="w"> </span>Product<span class="o">(</span><span class="s2">&quot;Mouse&quot;</span>,<span class="w"> </span><span class="m">25</span>.00<span class="o">)]</span>
<span class="w">        </span><span class="nv">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Order<span class="o">(</span>products<span class="o">)</span>
<span class="w">        </span>order.apply_discount<span class="o">(</span><span class="m">10</span><span class="o">)</span>
<span class="w">        </span><span class="c1"># This will fail because the discount logic is flawed</span>
&gt;<span class="w">       </span>assert<span class="w"> </span>order.total<span class="o">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">112</span>.50
E<span class="w">       </span>assert<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">112</span>.5

test_commerce_initial.py:18:<span class="w"> </span><span class="nv">AssertionError</span>
<span class="o">=========================</span><span class="w"> </span>short<span class="w"> </span><span class="nb">test</span><span class="w"> </span>summary<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">==========================</span>
FAILED<span class="w"> </span>test_commerce_initial.py::test_order_discount_logic<span class="w"> </span>-<span class="w"> </span>assert<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">112</span>.5
</code></pre></div>

<p><strong>Let's parse this section by section</strong>:</p>
<ol>
<li>
<p><strong>The summary line</strong>: <code>FAILED test_commerce_initial.py::test_order_discount_logic - assert 125.0 == 112.5</code></p>
<ul>
<li>What this tells us: The test failed because of a direct <code>AssertionError</code>. The values did not match.</li>
</ul>
</li>
<li>
<p><strong>The traceback</strong>: The traceback points directly to the line <code>assert order.total() == 112.50</code>.</p>
<ul>
<li>What this tells us: The failure is in the test's final check.</li>
</ul>
</li>
<li>
<p><strong>The assertion introspection</strong>: <code>E assert 125.0 == 112.5</code></p>
<ul>
<li>What this tells us: Pytest shows us the exact values being compared. The <code>order.total()</code> method returned <code>125.0</code>, but we expected <code>112.5</code>.</li>
</ul>
</li>
</ol>
<p><strong>Root cause identified</strong>: The <code>apply_discount</code> method does not actually change the value returned by <code>order.total()</code>.
<strong>Why the current approach can't solve this</strong>: We can't fix the test without fixing the application code. But if the bug fix is scheduled for a later time, the test will continue to fail the build.
<strong>What we need</strong>: A way to tell pytest: "Run this test, but I expect it to fail. Don't count this failure against me."</p>
<h3 id="technique-introduced-pytestmarkxfail">Technique Introduced: <code>@pytest.mark.xfail</code></h3>
<p>The <code>@pytest.mark.xfail</code> (expected failure) marker does exactly this. It tells pytest to run the test, but if it fails in a way we expect (like an <code>AssertionError</code>), the test run as a whole will still pass.</p>
<p>Let's apply it. We'll rename our file to <code>test_commerce_marked.py</code> to track our progress.</p>
<h3 id="solution-implementation">Solution Implementation</h3>
<p><strong>Before (<code>test_commerce_initial.py</code>):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_order_discount_logic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the discount application logic, which is known to be buggy.&quot;&quot;&quot;</span>
    <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Keyboard&quot;</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">),</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">)]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
    <span class="n">order</span><span class="o">.</span><span class="n">apply_discount</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="c1"># This will fail because the discount logic is flawed</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">==</span> <span class="mf">112.50</span>
</code></pre></div>

<p><strong>After (<code>test_commerce_marked.py</code>):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">commerce_system</span><span class="w"> </span><span class="kn">import</span> <span class="n">Order</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">connect_to_db</span><span class="p">,</span> <span class="n">process_payment_via_api</span>

<span class="c1"># ... other tests ...</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Discount logic is buggy, see TICKET-123&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_order_discount_logic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the discount application logic, which is known to be buggy.&quot;&quot;&quot;</span>
    <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Keyboard&quot;</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">),</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">)]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
    <span class="n">order</span><span class="o">.</span><span class="n">apply_discount</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="c1"># This will fail because the discount logic is flawed</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">==</span> <span class="mf">112.50</span>

<span class="c1"># ... other tests ...</span>
</code></pre></div>

<p>Note that we added a <code>reason</code> argument. This is excellent practice for documenting <em>why</em> the test is expected to fail.</p>
<h3 id="verification">Verification</h3>
<p>Let's run the new file.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_commerce_marked.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_commerce_marked.py::test_order_total<span class="w"> </span>PASSED<span class="w">                      </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_commerce_marked.py::test_order_discount_logic<span class="w"> </span>XFAIL<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_commerce_marked.py::test_database_connection<span class="w"> </span>
<span class="o">(</span>Connecting<span class="w"> </span>to<span class="w"> </span>database...<span class="o">)</span>
<span class="o">(</span>Connection<span class="w"> </span>successful.<span class="o">)</span>
PASSED<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_commerce_marked.py::test_payment_api_call<span class="w"> </span>
<span class="o">(</span>Calling<span class="w"> </span>external<span class="w"> </span>payment<span class="w"> </span>API<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">$150</span>.00...<span class="o">)</span>
.../test_commerce_marked.py:32:<span class="w"> </span>DeprecationWarning:<span class="w"> </span>This<span class="w"> </span>payment<span class="w"> </span>gateway<span class="w"> </span>is<span class="w"> </span>deprecated.
<span class="w">  </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>process_payment_via_api<span class="o">(</span><span class="nv">total</span><span class="o">=</span><span class="m">150</span>.00<span class="o">)</span>
<span class="o">(</span>API<span class="w"> </span>call<span class="w"> </span>successful.<span class="o">)</span>
PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">====================</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>xfailed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">3</span>.06s<span class="w"> </span><span class="o">====================</span>
</code></pre></div>

<p><strong>Expected vs. Actual Improvement:</strong> The test suite now passes! The summary shows <code>3 passed, 1 xfailed</code>. The known failure is acknowledged but no longer breaks the build. This is a huge win for CI/CD stability.</p>
<p>A fascinating side effect of <code>xfail</code> is that if the test <em>unexpectedly passes</em> (e.g., someone fixes the bug), pytest will report it as <code>XPASS</code>. This is a signal that your test and code are out of sync and the <code>xfail</code> marker should be removed.</p>
<h3 id="iteration-2-temporarily-disabling-a-test-with-pytestmarkskip">Iteration 2: Temporarily Disabling a Test with <code>@pytest.mark.skip</code></h3>
<p>Now, imagine the database team is refactoring the schema, and <code>connect_to_db()</code> is temporarily broken. The <code>test_database_connection</code> is guaranteed to fail, and running it just wastes time.</p>
<p><strong>Current Limitation:</strong> We have a test for a feature that is temporarily unavailable. Running it is pointless and slows down the test suite.</p>
<p><strong>What we need:</strong> A way to tell pytest: "Don't even bother running this test for now."</p>
<h3 id="technique-introduced-pytestmarkskip">Technique Introduced: <code>@pytest.mark.skip</code></h3>
<p>The <code>@pytest.mark.skip</code> marker tells pytest to not execute a test function at all. Like <code>xfail</code>, it's best practice to provide a <code>reason</code>.</p>
<h3 id="solution-implementation_1">Solution Implementation</h3>
<p>Let's add it to <code>test_database_connection</code>.</p>
<p><strong>Before:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># A slower integration test</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_database_connection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the function that connects to the database.&quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect_to_db</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">conn</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;connected&quot;</span>
</code></pre></div>

<p><strong>After (<code>test_commerce_marked.py</code>):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ... other tests ...</span>

<span class="c1"># A slower integration test</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Database schema is being refactored.&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_database_connection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the function that connects to the database.&quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect_to_db</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">conn</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;connected&quot;</span>

<span class="c1"># ... other tests ...</span>
</code></pre></div>

<h3 id="verification_1">Verification</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_commerce_marked.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_commerce_marked.py::test_order_total<span class="w"> </span>PASSED<span class="w">                      </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_commerce_marked.py::test_order_discount_logic<span class="w"> </span>XFAIL<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_commerce_marked.py::test_database_connection<span class="w"> </span>SKIPPED<span class="w"> </span><span class="o">(</span>Database<span class="w"> </span>schema<span class="w"> </span>is<span class="w"> </span>being<span class="w"> </span>refactored.<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_commerce_marked.py::test_payment_api_call<span class="w"> </span>
<span class="o">(</span>Calling<span class="w"> </span>external<span class="w"> </span>payment<span class="w"> </span>API<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">$150</span>.00...<span class="o">)</span>
.../test_commerce_marked.py:32:<span class="w"> </span>DeprecationWarning:<span class="w"> </span>This<span class="w"> </span>payment<span class="w"> </span>gateway<span class="w"> </span>is<span class="w"> </span>deprecated.
<span class="w">  </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>process_payment_via_api<span class="o">(</span><span class="nv">total</span><span class="o">=</span><span class="m">150</span>.00<span class="o">)</span>
<span class="o">(</span>API<span class="w"> </span>call<span class="w"> </span>successful.<span class="o">)</span>
PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==================</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">1</span><span class="w"> </span>xfailed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span>.04s<span class="w"> </span><span class="o">=================</span>
</code></pre></div>

<p><strong>Expected vs. Actual Improvement:</strong> The test is now marked as <code>SKIPPED</code>, and the reason is displayed. Notice the total test time dropped by about one second‚Äîthe time it took to <code>connect_to_db()</code>. We've made our test run faster by not executing irrelevant tests.</p>
<h3 id="iteration-3-suppressing-warnings-with-pytestmarkfilterwarnings">Iteration 3: Suppressing Warnings with <code>@pytest.mark.filterwarnings</code></h3>
<p>Our final problem is the <code>DeprecationWarning</code> from the payment API call. While it's good to be aware of these, sometimes they are out of our control and just add noise.</p>
<p><strong>Current Limitation:</strong> A test triggers a warning that we can't fix immediately, cluttering the test output.</p>
<p><strong>What we need:</strong> A way to tell pytest: "For this specific test, I know about this specific warning, and I want you to ignore it."</p>
<h3 id="technique-introduced-pytestmarkfilterwarnings">Technique Introduced: <code>@pytest.mark.filterwarnings</code></h3>
<p>This marker allows you to add a warning filter for a specific test, using the same syntax as Python's own warning filters.</p>
<h3 id="solution-implementation_2">Solution Implementation</h3>
<p>Let's suppress the <code>DeprecationWarning</code> in <code>test_payment_api_call</code>.</p>
<p><strong>Before:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># A very slow API test</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_api_call</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the external payment API call.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">process_payment_via_api</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mf">150.00</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;paid&quot;</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">150.00</span>
</code></pre></div>

<p><strong>After (<code>test_commerce_marked.py</code>):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ... other tests ...</span>

<span class="c1"># A very slow API test</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore:This payment gateway is deprecated.&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_api_call</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the external payment API call.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">process_payment_via_api</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mf">150.00</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;paid&quot;</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">150.00</span>
</code></pre></div>

<h3 id="verification_2">Verification</h3>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_commerce_marked.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_commerce_marked.py::test_order_total<span class="w"> </span>PASSED<span class="w">                      </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_commerce_marked.py::test_order_discount_logic<span class="w"> </span>XFAIL<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_commerce_marked.py::test_database_connection<span class="w"> </span>SKIPPED<span class="w"> </span><span class="o">(</span>Database<span class="w"> </span>schema<span class="w"> </span>is<span class="w"> </span>being<span class="w"> </span>refactored.<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_commerce_marked.py::test_payment_api_call<span class="w"> </span>
<span class="o">(</span>Calling<span class="w"> </span>external<span class="w"> </span>payment<span class="w"> </span>API<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">$150</span>.00...<span class="o">)</span>
<span class="o">(</span>API<span class="w"> </span>call<span class="w"> </span>successful.<span class="o">)</span>
PASSED<span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==================</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">1</span><span class="w"> </span>xfailed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span>.04s<span class="w"> </span><span class="o">=================</span>
</code></pre></div>

<p><strong>Expected vs. Actual Improvement:</strong> The test output is now clean. The <code>DeprecationWarning</code> is no longer displayed in the summary, making the output easier to read. We've successfully managed all the initial problems using built-in markers.</p>
<p><strong>Limitation Preview:</strong> This is great, but we still haven't solved our biggest organizational problem: we can't selectively run tests based on their <em>type</em> (e.g., fast unit tests vs. slow API tests). For that, we need to create our own markers.</p>
<h2 id="creating-custom-markers">Creating Custom Markers</h2>
<h2 id="creating-custom-markers_1">Creating Custom Markers</h2>
<p>The true power of markers comes from creating your own. You can define any marker you want to categorize your tests by functionality, speed, or any other criteria relevant to your project.</p>
<h3 id="iteration-4-categorizing-tests-with-custom-markers">Iteration 4: Categorizing Tests with Custom Markers</h3>
<p>Our test suite has different kinds of tests:
- <code>test_order_total</code>: A fast unit test.
- <code>test_order_discount_logic</code>: Another fast unit test.
- <code>test_database_connection</code>: A slower integration test.
- <code>test_payment_api_call</code>: A very slow test that depends on an external API.</p>
<p><strong>Current Limitation:</strong> We have no way to distinguish between these types of tests. <code>pytest</code> treats them all the same, forcing us to run them all, every time.</p>
<p><strong>New Scenario:</strong> As a developer, I want to run only the fast <code>unit</code> tests while I'm actively coding to get quick feedback.</p>
<h3 id="technique-introduced-custom-marker-naming">Technique Introduced: Custom Marker Naming</h3>
<p>Creating a custom marker is as simple as adding a decorator with a name you choose. The syntax is <code>@pytest.mark.your_marker_name</code>.</p>
<p>Let's categorize our tests using the markers <code>unit</code>, <code>integration</code>, and <code>api</code>.</p>
<h3 id="solution-implementation_3">Solution Implementation</h3>
<p>We will apply these new markers to our <code>test_commerce_marked.py</code> file.</p>
<p><strong>Before:</strong>
The tests had only built-in markers (<code>xfail</code>, <code>skip</code>, etc.) or no markers at all.</p>
<p><strong>After (<code>test_commerce_marked.py</code>):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">commerce_system</span><span class="w"> </span><span class="kn">import</span> <span class="n">Order</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">connect_to_db</span><span class="p">,</span> <span class="n">process_payment_via_api</span>

<span class="c1"># A fast, simple unit test</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_order_total</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the total calculation for a simple order.&quot;&quot;&quot;</span>
    <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Laptop&quot;</span><span class="p">,</span> <span class="mf">1200.00</span><span class="p">),</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">)]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1225.00</span>

<span class="c1"># A test for a known bug</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unit</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Discount logic is buggy, see TICKET-123&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_order_discount_logic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the discount application logic, which is known to be buggy.&quot;&quot;&quot;</span>
    <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Keyboard&quot;</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">),</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">)]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
    <span class="n">order</span><span class="o">.</span><span class="n">apply_discount</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">==</span> <span class="mf">112.50</span>

<span class="c1"># A slower integration test</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Database schema is being refactored.&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_database_connection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the function that connects to the database.&quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect_to_db</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">conn</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;connected&quot;</span>

<span class="c1"># A very slow API test</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">api</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore:This payment gateway is deprecated.&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_api_call</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the external payment API call.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">process_payment_via_api</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mf">150.00</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;paid&quot;</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">150.00</span>
</code></pre></div>

<p>Notice that you can stack markers. <code>test_order_discount_logic</code> is now marked as both <code>unit</code> and <code>xfail</code>.</p>
<h3 id="verification_3">Verification</h3>
<p>Let's run pytest and see what happens.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_commerce_marked.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_commerce_marked.py::test_order_total<span class="w"> </span>PASSED<span class="w">                      </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_commerce_marked.py::test_order_discount_logic<span class="w"> </span>XFAIL<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_commerce_marked.py::test_database_connection<span class="w"> </span>SKIPPED<span class="w"> </span><span class="o">(</span>Database<span class="w"> </span>schema<span class="w"> </span>is<span class="w"> </span>being<span class="w"> </span>refactored.<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_commerce_marked.py::test_payment_api_call<span class="w"> </span>PASSED<span class="w">                 </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>
<span class="o">===========================</span><span class="w"> </span>warnings<span class="w"> </span><span class="nv">summary</span><span class="w"> </span><span class="o">===============================</span>
.../test_commerce_marked.py:7
<span class="w">  </span>.../test_commerce_marked.py:7:<span class="w"> </span>PytestUnknownMarkWarning:<span class="w"> </span>Unknown<span class="w"> </span>pytest.mark.unit<span class="w"> </span>-<span class="w"> </span>is<span class="w"> </span>this<span class="w"> </span>a<span class="w"> </span>typo?<span class="w">  </span>You<span class="w"> </span>can<span class="w"> </span>register<span class="w"> </span>custom<span class="w"> </span>marks<span class="w"> </span>to<span class="w"> </span>avoid<span class="w"> </span>this<span class="w"> </span>warning.
<span class="w">    </span>@pytest.mark.unit

.../test_commerce_marked.py:22
<span class="w">  </span>.../test_commerce_marked.py:22:<span class="w"> </span>PytestUnknownMarkWarning:<span class="w"> </span>Unknown<span class="w"> </span>pytest.mark.integration<span class="w"> </span>-<span class="w"> </span>is<span class="w"> </span>this<span class="w"> </span>a<span class="w"> </span>typo?<span class="w">  </span>You<span class="w"> </span>can<span class="w"> </span>register<span class="w"> </span>custom<span class="w"> </span>marks<span class="w"> </span>to<span class="w"> </span>avoid<span class="w"> </span>this<span class="w"> </span>warning.
<span class="w">    </span>@pytest.mark.integration

.../test_commerce_marked.py:30
<span class="w">  </span>.../test_commerce_marked.py:30:<span class="w"> </span>PytestUnknownMarkWarning:<span class="w"> </span>Unknown<span class="w"> </span>pytest.mark.api<span class="w"> </span>-<span class="w"> </span>is<span class="w"> </span>this<span class="w"> </span>a<span class="w"> </span>typo?<span class="w">  </span>You<span class="w"> </span>can<span class="w"> </span>register<span class="w"> </span>custom<span class="w"> </span>marks<span class="w"> </span>to<span class="w"> </span>avoid<span class="w"> </span>this<span class="w"> </span>warning.
<span class="w">    </span>@pytest.mark.api

--<span class="w"> </span>Docs:<span class="w"> </span>https://docs.pytest.org/en/stable/how-to/mark.html#registering-marks
<span class="o">==================</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">1</span><span class="w"> </span>xfailed,<span class="w"> </span><span class="m">3</span><span class="w"> </span>warnings<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span>.05s<span class="w"> </span><span class="o">=================</span>
</code></pre></div>

<p>The tests ran as before, but now we have a new problem: <code>PytestUnknownMarkWarning</code>.</p>
<h2 id="registering-markers-in-configuration">Registering Markers in Configuration</h2>
<h2 id="registering-markers-in-configuration_1">Registering Markers in Configuration</h2>
<p>We've successfully added custom markers, but pytest is helpfully warning us that it doesn't recognize them. This is a safety feature to prevent typos (e.g., <code>@pytest.mark.integraton</code> instead of <code>@pytest.mark.integration</code>). To make our markers "official," we need to register them.</p>
<h3 id="iteration-5-eliminating-unknown-marker-warnings">Iteration 5: Eliminating "Unknown Marker" Warnings</h3>
<p><strong>Current Limitation:</strong> Our test suite runs but produces <code>PytestUnknownMarkWarning</code> for each of our custom markers, cluttering the output and indicating poor practice.</p>
<h3 id="diagnostic-analysis-reading-the-warning">Diagnostic Analysis: Reading the Warning</h3>
<p><strong>The complete output</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">===========================</span><span class="w"> </span>warnings<span class="w"> </span><span class="nv">summary</span><span class="w"> </span><span class="o">===============================</span>
.../test_commerce_marked.py:7
<span class="w">  </span>.../test_commerce_marked.py:7:<span class="w"> </span>PytestUnknownMarkWarning:<span class="w"> </span>Unknown<span class="w"> </span>pytest.mark.unit<span class="w"> </span>-<span class="w"> </span>is<span class="w"> </span>this<span class="w"> </span>a<span class="w"> </span>typo?<span class="w">  </span>You<span class="w"> </span>can<span class="w"> </span>register<span class="w"> </span>custom<span class="w"> </span>marks<span class="w"> </span>to<span class="w"> </span>avoid<span class="w"> </span>this<span class="w"> </span>warning.
<span class="w">    </span>@pytest.mark.unit
...
</code></pre></div>

<p><strong>Let's parse this section by section</strong>:</p>
<ol>
<li>
<p><strong>The warning type</strong>: <code>PytestUnknownMarkWarning</code>.</p>
<ul>
<li>What this tells us: This is a specific warning from pytest itself about the usage of markers.</li>
</ul>
</li>
<li>
<p><strong>The message</strong>: <code>Unknown pytest.mark.unit - is this a typo?</code></p>
<ul>
<li>What this tells us: Pytest is explicitly asking if we made a mistake. It doesn't know if <code>unit</code> is a valid category we intended to create or a typo of a built-in marker.</li>
</ul>
</li>
<li>
<p><strong>The suggestion</strong>: <code>You can register custom marks to avoid this warning.</code></p>
<ul>
<li>What this tells us: Pytest is guiding us directly to the solution.</li>
</ul>
</li>
</ol>
<p><strong>Root cause identified</strong>: We have defined custom markers in our test code, but we haven't declared them in our project's configuration.
<strong>What we need</strong>: A configuration file (<code>pytest.ini</code>, <code>pyproject.toml</code>, or <code>tox.ini</code>) where we can list our custom markers.</p>
<h3 id="technique-introduced-the-markers-configuration-key">Technique Introduced: The <code>markers</code> Configuration Key</h3>
<p>You can register markers by creating a <code>pytest.ini</code> file in the root of your project and adding a <code>[pytest]</code> section with a <code>markers</code> key.</p>
<h3 id="solution-implementation_4">Solution Implementation</h3>
<p>Let's create a <code>pytest.ini</code> file.</p>
<p><strong><code>pytest.ini</code>:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">[pytest]</span>
<span class="na">markers</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">unit</span><span class="o">:</span><span class="w"> </span><span class="s">marks tests as unit tests (fast, no dependencies)</span>
<span class="w">    </span><span class="na">integration</span><span class="o">:</span><span class="w"> </span><span class="s">marks tests as integration tests (slower, may require services like a DB)</span>
<span class="w">    </span><span class="na">api</span><span class="o">:</span><span class="w"> </span><span class="s">marks tests as API tests (very slow, requires network access)</span>
</code></pre></div>

<p>This format is simple: each line under <code>markers</code> is <code>marker_name: description</code>. The description is important, as it will appear in pytest's help text.</p>
<h3 id="verification_4">Verification</h3>
<p>First, let's see if pytest recognizes our markers now by running <code>pytest --markers</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>--markers

@pytest.mark.unit:<span class="w"> </span>marks<span class="w"> </span>tests<span class="w"> </span>as<span class="w"> </span>unit<span class="w"> </span>tests<span class="w"> </span><span class="o">(</span>fast,<span class="w"> </span>no<span class="w"> </span>dependencies<span class="o">)</span>
@pytest.mark.integration:<span class="w"> </span>marks<span class="w"> </span>tests<span class="w"> </span>as<span class="w"> </span>integration<span class="w"> </span>tests<span class="w"> </span><span class="o">(</span>slower,<span class="w"> </span>may<span class="w"> </span>require<span class="w"> </span>services<span class="w"> </span>like<span class="w"> </span>a<span class="w"> </span>DB<span class="o">)</span>
@pytest.mark.api:<span class="w"> </span>marks<span class="w"> </span>tests<span class="w"> </span>as<span class="w"> </span>API<span class="w"> </span>tests<span class="w"> </span><span class="o">(</span>very<span class="w"> </span>slow,<span class="w"> </span>requires<span class="w"> </span>network<span class="w"> </span>access<span class="o">)</span>

@pytest.mark.filterwarnings<span class="o">(</span>warning<span class="o">)</span>:<span class="w"> </span>add<span class="w"> </span>a<span class="w"> </span>warning<span class="w"> </span>filter<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span>test.
@pytest.mark.skip<span class="o">(</span><span class="nv">reason</span><span class="o">=</span>None<span class="o">)</span>:<span class="w"> </span>skip<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">function</span><span class="w"> </span>with<span class="w"> </span>an<span class="w"> </span>optional<span class="w"> </span>reason.
@pytest.mark.skipif<span class="o">(</span>condition,<span class="w"> </span>...,<span class="w"> </span><span class="nv">reason</span><span class="o">=</span>None<span class="o">)</span>:<span class="w"> </span>skip<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">if</span><span class="w"> </span>any<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>conditions<span class="w"> </span>evaluate<span class="w"> </span>to<span class="w"> </span>true.
@pytest.mark.xfail<span class="o">(</span>condition,<span class="w"> </span>...,<span class="w"> </span><span class="nv">reason</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">run</span><span class="o">=</span>True,<span class="w"> </span><span class="nv">raises</span><span class="o">=</span>None,<span class="w"> </span><span class="nv">strict</span><span class="o">=</span>False<span class="o">)</span>:<span class="w"> </span>mark<span class="w"> </span>the<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">function</span><span class="w"> </span>as<span class="w"> </span>an<span class="w"> </span>expected<span class="w"> </span>failure<span class="w"> </span><span class="k">if</span><span class="w"> </span>any<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>conditions<span class="w"> </span>are<span class="w"> </span>true.
@pytest.mark.parametrize<span class="o">(</span>argnames,<span class="w"> </span>argvalues,<span class="w"> </span>...<span class="o">)</span>:<span class="w"> </span>call<span class="w"> </span>a<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">function</span><span class="w"> </span>multiple<span class="w"> </span><span class="nb">times</span><span class="w"> </span>with<span class="w"> </span>different<span class="w"> </span>arguments.
</code></pre></div>

<p>Success! Our custom markers <code>unit</code>, <code>integration</code>, and <code>api</code> are listed alongside the built-in ones, complete with our descriptions.</p>
<p>Now, let's re-run our test suite and check for warnings.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>test_commerce_marked.py
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items

test_commerce_marked.py::test_order_total<span class="w"> </span>PASSED<span class="w">                      </span><span class="o">[</span><span class="w"> </span><span class="m">25</span>%<span class="o">]</span>
test_commerce_marked.py::test_order_discount_logic<span class="w"> </span>XFAIL<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_commerce_marked.py::test_database_connection<span class="w"> </span>SKIPPED<span class="w"> </span><span class="o">(</span>Database<span class="w"> </span>schema<span class="w"> </span>is<span class="w"> </span>being<span class="w"> </span>refactored.<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="m">75</span>%<span class="o">]</span>
test_commerce_marked.py::test_payment_api_call<span class="w"> </span>PASSED<span class="w">                 </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">==================</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">1</span><span class="w"> </span>xfailed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span>.06s<span class="w"> </span><span class="o">=================</span>
</code></pre></div>

<p><strong>Expected vs. Actual Improvement:</strong> The output is perfectly clean. The <code>PytestUnknownMarkWarning</code> messages are gone. Our test suite is now well-organized <em>and</em> correctly configured.</p>
<p><strong>Limitation Preview:</strong> We've done all the setup. We've categorized and registered our markers. But we still haven't actually <em>used</em> them to change which tests are run. That's the final, crucial step.</p>
<h2 id="filtering-tests-by-markers">Filtering Tests by Markers</h2>
<h2 id="filtering-tests-by-markers_1">Filtering Tests by Markers</h2>
<p>This is where all our organizational work pays off. With markers in place, we can use the <code>-m</code> command-line option to run specific subsets of our tests.</p>
<h3 id="iteration-6-selectively-running-tests-with-m">Iteration 6: Selectively Running Tests with <code>-m</code></h3>
<p><strong>Current Limitation:</strong> We have markers, but <code>pytest</code> still runs everything it finds (respecting <code>skip</code> and <code>xfail</code>, of course). We cannot yet run <em>only</em> the unit tests.</p>
<h3 id="technique-introduced-the-m-command-line-option">Technique Introduced: The <code>-m</code> Command-Line Option</h3>
<p>The <code>-m</code> flag allows you to specify a "marker expression" to select tests.</p>
<h3 id="solution-implementation-verification">Solution Implementation &amp; Verification</h3>
<p>Let's try out some common filtering scenarios.</p>
<p><strong>1. Run only the unit tests:</strong>
This is our primary goal: get fast feedback during development.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>-m<span class="w"> </span><span class="nv">unit</span>
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items<span class="w"> </span>/<span class="w"> </span><span class="m">2</span><span class="w"> </span>deselected<span class="w"> </span>/<span class="w"> </span><span class="m">2</span><span class="w"> </span>selected

test_commerce_marked.py::test_order_total<span class="w"> </span>PASSED<span class="w">                      </span><span class="o">[</span><span class="w"> </span><span class="m">50</span>%<span class="o">]</span>
test_commerce_marked.py::test_order_discount_logic<span class="w"> </span>XFAIL<span class="w">              </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">====================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>xfailed,<span class="w"> </span><span class="m">2</span><span class="w"> </span>deselected<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.02s<span class="w"> </span><span class="o">====================</span>
</code></pre></div>

<p>Look at that! Pytest selected only the two tests marked <code>unit</code>. The integration and API tests were <code>deselected</code>. The total run time was a fraction of a second. This is the rapid feedback loop we wanted.</p>
<p><strong>2. Run only the integration tests:</strong></p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>-m<span class="w"> </span><span class="nv">integration</span>
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items<span class="w"> </span>/<span class="w"> </span><span class="m">3</span><span class="w"> </span>deselected<span class="w"> </span>/<span class="w"> </span><span class="m">1</span><span class="w"> </span>selected

test_commerce_marked.py::test_database_connection<span class="w"> </span>SKIPPED<span class="w"> </span><span class="o">(</span>Database<span class="w"> </span>schema<span class="w"> </span>is<span class="w"> </span>being<span class="w"> </span>refactored.<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">===================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">3</span><span class="w"> </span>deselected<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01s<span class="w"> </span><span class="o">===================</span>
</code></pre></div>

<p>As expected, it selected our single integration test, which is currently skipped.</p>
<p><strong>3. Run everything <em>except</em> the slow API tests:</strong>
You can use boolean logic. <code>not</code> is very useful for excluding slow or disruptive tests.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;not api&quot;</span>
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items<span class="w"> </span>/<span class="w"> </span><span class="m">1</span><span class="w"> </span>deselected<span class="w"> </span>/<span class="w"> </span><span class="m">3</span><span class="w"> </span>selected

test_commerce_marked.py::test_order_total<span class="w"> </span>PASSED<span class="w">                      </span><span class="o">[</span><span class="w"> </span><span class="m">33</span>%<span class="o">]</span>
test_commerce_marked.py::test_order_discount_logic<span class="w"> </span>XFAIL<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">66</span>%<span class="o">]</span>
test_commerce_marked.py::test_database_connection<span class="w"> </span>SKIPPED<span class="w"> </span><span class="o">(</span>Database<span class="w"> </span>schema<span class="w"> </span>is<span class="w"> </span>being<span class="w"> </span>refactored.<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">1</span><span class="w"> </span>xfailed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>deselected<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.02s<span class="w"> </span><span class="o">================</span>
</code></pre></div>

<p>This ran the <code>unit</code> and <code>integration</code> tests but skipped the <code>api</code> test. This is perfect for a pre-commit hook or a quick CI check.</p>
<p><strong>4. Run unit tests OR integration tests:</strong></p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>pytest<span class="w"> </span>-v<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;unit or integration&quot;</span>
<span class="o">===========================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">============================</span>
...
collected<span class="w"> </span><span class="m">4</span><span class="w"> </span>items<span class="w"> </span>/<span class="w"> </span><span class="m">1</span><span class="w"> </span>deselected<span class="w"> </span>/<span class="w"> </span><span class="m">3</span><span class="w"> </span>selected

test_commerce_marked.py::test_order_total<span class="w"> </span>PASSED<span class="w">                      </span><span class="o">[</span><span class="w"> </span><span class="m">33</span>%<span class="o">]</span>
test_commerce_marked.py::test_order_discount_logic<span class="w"> </span>XFAIL<span class="w">              </span><span class="o">[</span><span class="w"> </span><span class="m">66</span>%<span class="o">]</span>
test_commerce_marked.py::test_database_connection<span class="w"> </span>SKIPPED<span class="w"> </span><span class="o">(</span>Database<span class="w"> </span>schema<span class="w"> </span>is<span class="w"> </span>being<span class="w"> </span>refactored.<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>passed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>skipped,<span class="w"> </span><span class="m">1</span><span class="w"> </span>xfailed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>deselected<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.02s<span class="w"> </span><span class="o">================</span>
</code></pre></div>

<p>The expression <code>unit or integration</code> selects any test that has at least one of those markers. You can also use <code>and</code> to select tests that must have <em>all</em> specified markers. For example, <code>pytest -m "slow and database"</code> would run tests marked with both <code>@pytest.mark.slow</code> and <code>@pytest.mark.database</code>.</p>
<p>We have now achieved full control over which tests we run and when.</p>
<h2 id="organizing-tests-by-category">Organizing Tests by Category</h2>
<h2 id="organizing-tests-by-category_1">Organizing Tests by Category</h2>
<p>We've completed the journey from a disorganized, all-or-nothing test suite to a flexible, well-managed collection of tests that can be run selectively based on our needs.</p>
<h3 id="the-journey-from-problem-to-solution">The Journey: From Problem to Solution</h3>
<table>
<thead>
<tr>
<th>Iteration</th>
<th>Failure Mode / Problem</th>
<th>Technique Applied</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>One failing test breaks the build.</td>
<td>None</td>
<td>Initial state: <code>1 failed, 3 passed</code>.</td>
</tr>
<tr>
<td>1</td>
<td>Known bug causes CI failure.</td>
<td><code>@pytest.mark.xfail</code></td>
<td>Test is run but its failure is expected; build passes.</td>
</tr>
<tr>
<td>2</td>
<td>Test for unavailable feature slows down suite.</td>
<td><code>@pytest.mark.skip</code></td>
<td>Test is not executed at all, speeding up the run.</td>
</tr>
<tr>
<td>3</td>
<td>Unactionable warnings clutter output.</td>
<td><code>@pytest.mark.filterwarnings</code></td>
<td>Specific warnings are suppressed for a clean test report.</td>
</tr>
<tr>
<td>4</td>
<td>No way to differentiate test types.</td>
<td>Custom markers (<code>@pytest.mark.unit</code>)</td>
<td>Tests are categorized with metadata.</td>
</tr>
<tr>
<td>5</td>
<td>Custom markers produce <code>PytestUnknownMarkWarning</code>.</td>
<td>Registering markers in <code>pytest.ini</code></td>
<td>Warnings are eliminated; markers are officially part of the project.</td>
</tr>
<tr>
<td>6</td>
<td>Still running all tests by default.</td>
<td>Command-line flag <code>-m</code></td>
<td>Full control to run specific subsets of tests (e.g., <code>pytest -m unit</code>).</td>
</tr>
</tbody>
</table>
<h3 id="final-implementation">Final Implementation</h3>
<p>Here is the complete, production-ready version of our test file and configuration.</p>
<p><strong><code>pytest.ini</code></strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">[pytest]</span>
<span class="na">markers</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">unit</span><span class="o">:</span><span class="w"> </span><span class="s">marks tests as unit tests (fast, no dependencies)</span>
<span class="w">    </span><span class="na">integration</span><span class="o">:</span><span class="w"> </span><span class="s">marks tests as integration tests (slower, may require services like a DB)</span>
<span class="w">    </span><span class="na">api</span><span class="o">:</span><span class="w"> </span><span class="s">marks tests as API tests (very slow, requires network access)</span>
</code></pre></div>

<p><strong><code>test_commerce_final.py</code></strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">commerce_system</span><span class="w"> </span><span class="kn">import</span> <span class="n">Order</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">connect_to_db</span><span class="p">,</span> <span class="n">process_payment_via_api</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_order_total</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the total calculation for a simple order.&quot;&quot;&quot;</span>
    <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Laptop&quot;</span><span class="p">,</span> <span class="mf">1200.00</span><span class="p">),</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">)]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1225.00</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unit</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Discount logic is buggy, see TICKET-123&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_order_discount_logic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the discount application logic, which is known to be buggy.&quot;&quot;&quot;</span>
    <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Keyboard&quot;</span><span class="p">,</span> <span class="mf">100.00</span><span class="p">),</span> <span class="n">Product</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">)]</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
    <span class="n">order</span><span class="o">.</span><span class="n">apply_discount</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">==</span> <span class="mf">112.50</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Database schema is being refactored.&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_database_connection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the function that connects to the database.&quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">connect_to_db</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">conn</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;connected&quot;</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">api</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore:This payment gateway is deprecated.&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_payment_api_call</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the external payment API call.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">process_payment_via_api</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mf">150.00</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;paid&quot;</span>
    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">150.00</span>
</code></pre></div>

<h3 id="decision-framework-which-approach-when">Decision Framework: Which Approach When?</h3>
<p>Markers are a tool for organization. Here's a guide on when and how to use them effectively.</p>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>Recommended Marker Strategy</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Managing known bugs</strong></td>
<td>Use <code>@pytest.mark.xfail</code> with a clear <code>reason</code>.</td>
<td><code>@pytest.mark.xfail(reason="Bug #451: rounding error")</code></td>
</tr>
<tr>
<td><strong>Temporarily disabling tests</strong></td>
<td>Use <code>@pytest.mark.skip</code> for features in flux or broken environments.</td>
<td><code>@pytest.mark.skip(reason="Feature X under rework")</code></td>
</tr>
<tr>
<td><strong>Categorizing by test scope/speed</strong></td>
<td>Create custom markers like <code>unit</code>, <code>integration</code>, <code>e2e</code>.</td>
<td><code>@pytest.mark.unit</code>, <code>@pytest.mark.integration</code></td>
</tr>
<tr>
<td><strong>Categorizing by feature area</strong></td>
<td>Create custom markers for major parts of your app, like <code>auth</code>, <code>payments</code>, <code>search</code>.</td>
<td><code>@pytest.mark.payments</code></td>
</tr>
<tr>
<td><strong>Marking tests with special needs</strong></td>
<td>Create markers for tests that need specific resources, like <code>needs_db</code> or <code>needs_network</code>.</td>
<td><code>@pytest.mark.needs_db</code></td>
</tr>
<tr>
<td><strong>Running a test with many inputs</strong></td>
<td><strong>Do not use markers.</strong> Use <code>@pytest.mark.parametrize</code> instead (see Chapter 7).</td>
<td><code>@pytest.mark.parametrize("input,expected", [...])</code></td>
</tr>
</tbody>
</table>
<h3 id="lessons-learned">Lessons Learned</h3>
<p>Markers embody the pytest philosophy of <strong>explicit over implicit</strong>. By tagging a test, you are explicitly stating its characteristics and purpose beyond just its name.</p>
<ol>
<li><strong>Markers Separate <em>What<em> from </em>When</em></strong>: The test function body defines <em>what</em> is being tested. The markers define <em>when</em> and <em>how</em> that test should be run. This separation of concerns is key to a maintainable test suite.</li>
<li><strong>Configuration is Code</strong>: Registering your markers in <code>pytest.ini</code> is as important as writing the tests themselves. It makes your test suite self-documenting and prevents errors.</li>
<li><strong>Empower Your CI/CD</strong>: A well-marked test suite allows you to create sophisticated CI/CD pipelines. You can have a fast pipeline that runs only <code>unit</code> tests on every commit, and a slower, more comprehensive pipeline that runs <code>"not e2e"</code> tests on every pull request, and a full nightly build that runs everything. This granular control is essential for scaling your testing efforts.</li>
</ol>
        </div>
        <div class="footer">
            Generated on 2025-11-24 14:31:15 | Made with ‚ù§Ô∏è by GitHub Pages Generator
        </div>
    </div>
    <script>
        // Syntax highlighting for code blocks
        document.addEventListener('DOMContentLoaded', (event) => {
            // Highlight code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
            
            // Add copy buttons to code blocks
            document.querySelectorAll('pre').forEach((pre) => {
                const button = document.createElement('button');
                button.className = 'copy-btn';
                button.textContent = 'Copy';
                
                button.addEventListener('click', () => {
                    const code = pre.querySelector('code').textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        button.textContent = 'Error';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
                
                pre.appendChild(button);
            });
        });
    </script>
</body>
</html>